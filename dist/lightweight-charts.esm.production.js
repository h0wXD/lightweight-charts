/*!
 * @license
 * TradingView Lightweight Charts v3.8.0-dev+202112190350
 * Copyright (c) 2020 TradingView, Inc.
 * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
 */
import{bindToDevicePixelRatio as t}from"fancy-canvas/coordinate-space";var i,n;function s(t,i){var n,s=((n={})[0]=[],n[1]=[t.lineWidth,t.lineWidth],n[2]=[2*t.lineWidth,2*t.lineWidth],n[3]=[6*t.lineWidth,6*t.lineWidth],n[4]=[t.lineWidth,4*t.lineWidth],n)[i];t.setLineDash(s)}function h(t,i,n,s){t.beginPath();var h=t.lineWidth%2?.5:0;t.moveTo(n,i+h),t.lineTo(s,i+h),t.stroke()}!function(t){t[t.Simple=0]="Simple",t[t.WithSteps=1]="WithSteps",t[t.WithGaps=2]="WithGaps"}(i||(i={})),function(t){t[t.Solid=0]="Solid",t[t.Dotted=1]="Dotted",t[t.Dashed=2]="Dashed",t[t.LargeDashed=3]="LargeDashed",t[t.SparseDotted=4]="SparseDotted"}(n||(n={}));var r=function(t,i){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])})(t,i)};function e(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}r(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}var u=function(){return(u=Object.assign||function(t){for(var i,n=1,s=arguments.length;n<s;n++)for(var h in i=arguments[n])Object.prototype.hasOwnProperty.call(i,h)&&(t[h]=i[h]);return t}).apply(this,arguments)};function a(t,i){for(var n=0,s=i.length,h=t.length;n<s;n++,h++)t[h]=i[n];return t}function o(t,i){if(!t)throw new Error("Assertion failed"+(i?": "+i:""))}function l(t){if(void 0===t)throw new Error("Value is undefined");return t}function f(t){if(null===t)throw new Error("Value is null");return t}function c(t){return f(l(t))}function v(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];for(var s=0,h=i;s<h.length;s++){var r=h[s];for(var e in r)void 0!==r[e]&&("object"!=typeof r[e]||void 0===t[e]?t[e]=r[e]:v(t[e],r[e]))}return t}function d(t){return"number"==typeof t&&isFinite(t)}function _(t){return"number"==typeof t&&t%1==0}function w(t){return"string"==typeof t}function M(t){return"boolean"==typeof t}function b(t){var i,n,s,h=t;if(!h||"object"!=typeof h)return h;for(n in i=Array.isArray(h)?[]:{},h)h.hasOwnProperty(n)&&(s=h[n],i[n]=s&&"object"==typeof s?b(s):s);return i}function m(t){return null!==t}function g(t){return null===t?void 0:t}var p=function(){function t(){this.t=[]}return t.prototype.i=function(t){this.t=t},t.prototype.draw=function(t,i,n,s){this.t.forEach((function(h){t.save(),h.draw(t,i,n,s),t.restore()}))},t}(),y=function(){function t(){}return t.prototype.draw=function(t,i,n,s){t.save(),t.scale(i,i),this.h(t,n,s),t.restore()},t.prototype.drawBackground=function(t,i,n,s){t.save(),t.scale(i,i),this.u(t,n,s),t.restore()},t.prototype.u=function(t,i,n){},t}(),k=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.o=null,i}return e(i,t),i.prototype.l=function(t){this.o=t},i.prototype.h=function(t){if(null!==this.o&&null!==this.o.v){var i=this.o.v,n=this.o,s=function(s){t.beginPath();for(var h=i.to-1;h>=i.from;--h){var r=n._[h];t.moveTo(r.x,r.y),t.arc(r.x,r.y,s,0,2*Math.PI)}t.fill()};t.fillStyle=n.M,s(n.m+2),t.fillStyle=n.g,s(n.m)}},i}(y);function C(){return{_:[{x:0,y:0,time:0,price:0}],g:"",M:"",m:0,v:null}}var S={from:0,to:1},N=function(){function t(t,i){this.p=new p,this.k=[],this.C=[],this.S=!0,this.N=t,this.D=i,this.p.i(this.k)}return t.prototype.update=function(t){var i=this.N.serieses();i.length!==this.k.length&&(this.C=i.map(C),this.k=this.C.map((function(t){var i=new k;return i.l(t),i})),this.p.i(this.k)),this.S=!0},t.prototype.renderer=function(t,i,n){return this.S&&(this.T(t),this.S=!1),this.p},t.prototype.T=function(t){var i=this,n=this.N.serieses(),s=this.D.appliedIndex(),h=this.N.timeScale();n.forEach((function(n,r){var e,u=i.C[r],a=n.markerDataAtIndex(s);if(null!==a&&n.visible()){var o=f(n.firstValue());u.g=a.backgroundColor,u.m=a.radius,u._[0].price=a.price,u._[0].y=n.priceScale().priceToCoordinate(a.price,o.value),u.M=null!==(e=a.borderColor)&&void 0!==e?e:i.N.backgroundColorAtYPercentFromTop(u._[0].y/t),u._[0].time=s,u._[0].x=h.indexToCoordinate(s),u.v=S}else u.v=null}))},t}(),x=function(){function t(t){this.B=t}return t.prototype.draw=function(t,i,n,r){if(null!==this.B){var e=this.B.L.A,u=this.B.F.A;if(e||u){t.save();var a=Math.round(this.B.O*i),o=Math.round(this.B.P*i),l=Math.ceil(this.B.V*i),f=Math.ceil(this.B.W*i);t.lineCap="butt",e&&a>=0&&(t.lineWidth=Math.floor(this.B.L.R*i),t.strokeStyle=this.B.L.I,t.fillStyle=this.B.L.I,s(t,this.B.L.U),function(t,i,n,s){t.beginPath();var h=t.lineWidth%2?.5:0;t.moveTo(i+h,n),t.lineTo(i+h,s),t.stroke()}(t,a,0,f)),u&&o>=0&&(t.lineWidth=Math.floor(this.B.F.R*i),t.strokeStyle=this.B.F.I,t.fillStyle=this.B.F.I,s(t,this.B.F.U),h(t,o,0,l)),t.restore()}}},t}(),D=function(){function t(t){this.S=!0,this.j={L:{R:1,U:0,I:"",A:!1},F:{R:1,U:0,I:"",A:!1},V:0,W:0,O:0,P:0},this.q=new x(this.j),this.H=t}return t.prototype.Y=function(){this.S=!0},t.prototype.renderer=function(t,i){return this.S&&(this.T(),this.S=!1),this.q},t.prototype.T=function(){var t=this.H.visible(),i=f(this.H.pane()),n=i.model().options().crosshair,s=this.j;s.F.A=t&&this.H.horzLineVisible(i),s.L.A=t&&this.H.vertLineVisible(),s.F.R=n.horzLine.width,s.F.U=n.horzLine.style,s.F.I=n.horzLine.color,s.L.R=n.vertLine.width,s.L.U=n.vertLine.style,s.L.I=n.vertLine.color,s.V=i.width(),s.W=i.height(),s.O=this.H.appliedX(),s.P=this.H.appliedY()},t}(),T={khaki:"#f0e68c",azure:"#f0ffff",aliceblue:"#f0f8ff",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",gray:"#808080",green:"#008000",honeydew:"#f0fff0",floralwhite:"#fffaf0",lightblue:"#add8e6",lightcoral:"#f08080",lemonchiffon:"#fffacd",hotpink:"#ff69b4",lightyellow:"#ffffe0",greenyellow:"#adff2f",lightgoldenrodyellow:"#fafad2",limegreen:"#32cd32",linen:"#faf0e6",lightcyan:"#e0ffff",magenta:"#f0f",maroon:"#800000",olive:"#808000",orange:"#ffa500",oldlace:"#fdf5e6",mediumblue:"#0000cd",transparent:"#0000",lime:"#0f0",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",midnightblue:"#191970",orchid:"#da70d6",mediumorchid:"#ba55d3",mediumturquoise:"#48d1cc",orangered:"#ff4500",royalblue:"#4169e1",powderblue:"#b0e0e6",red:"#f00",coral:"#ff7f50",turquoise:"#40e0d0",white:"#fff",whitesmoke:"#f5f5f5",wheat:"#f5deb3",teal:"#008080",steelblue:"#4682b4",bisque:"#ffe4c4",aquamarine:"#7fffd4",aqua:"#0ff",sienna:"#a0522d",silver:"#c0c0c0",springgreen:"#00ff7f",antiquewhite:"#faebd7",burlywood:"#deb887",brown:"#a52a2a",beige:"#f5f5dc",chocolate:"#d2691e",chartreuse:"#7fff00",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cadetblue:"#5f9ea0",tomato:"#ff6347",fuchsia:"#f0f",blue:"#00f",salmon:"#fa8072",blanchedalmond:"#ffebcd",slateblue:"#6a5acd",slategray:"#708090",thistle:"#d8bfd8",tan:"#d2b48c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",blueviolet:"#8a2be2",black:"#000",darkmagenta:"#8b008b",darkslateblue:"#483d8b",darkkhaki:"#bdb76b",darkorchid:"#9932cc",darkorange:"#ff8c00",darkgreen:"#006400",darkred:"#8b0000",dodgerblue:"#1e90ff",darkslategray:"#2f4f4f",dimgray:"#696969",deepskyblue:"#00bfff",firebrick:"#b22222",forestgreen:"#228b22",indigo:"#4b0082",ivory:"#fffff0",lavenderblush:"#fff0f5",feldspar:"#d19275",indianred:"#cd5c5c",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightskyblue:"#87cefa",lightslategray:"#789",lightslateblue:"#8470ff",snow:"#fffafa",lightseagreen:"#20b2aa",lightsalmon:"#ffa07a",darksalmon:"#e9967a",darkviolet:"#9400d3",mediumpurple:"#9370d8",mediumaquamarine:"#66cdaa",skyblue:"#87ceeb",lavender:"#e6e6fa",lightsteelblue:"#b0c4de",mediumvioletred:"#c71585",mintcream:"#f5fffa",navajowhite:"#ffdead",navy:"#000080",olivedrab:"#6b8e23",palevioletred:"#d87093",violetred:"#d02090",yellow:"#ff0",yellowgreen:"#9acd32",lawngreen:"#7cfc00",pink:"#ffc0cb",paleturquoise:"#afeeee",palegoldenrod:"#eee8aa",darkolivegreen:"#556b2f",darkseagreen:"#8fbc8f",darkturquoise:"#00ced1",peachpuff:"#ffdab9",deeppink:"#ff1493",violet:"#ee82ee",palegreen:"#98fb98",mediumseagreen:"#3cb371",peru:"#cd853f",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",purple:"#800080",seagreen:"#2e8b57",seashell:"#fff5ee",papayawhip:"#ffefd5",mediumslateblue:"#7b68ee",plum:"#dda0dd",mediumspringgreen:"#00fa9a"};function B(t){return t<0?0:t>255?255:Math.round(t)||0}function A(t){return t<=0||t>0?t<0?0:t>1?1:Math.round(1e4*t)/1e4:0}var L=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,F=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,E=/^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/,O=/^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?[\d]{0,10}(?:\.\d+)?)\s*\)$/;function P(t){var i;if((t=t.toLowerCase())in T&&(t=T[t]),i=O.exec(t)||E.exec(t))return[B(parseInt(i[1],10)),B(parseInt(i[2],10)),B(parseInt(i[3],10)),A(i.length<5?1:parseFloat(i[4]))];if(i=F.exec(t))return[B(parseInt(i[1],16)),B(parseInt(i[2],16)),B(parseInt(i[3],16)),1];if(i=L.exec(t))return[B(17*parseInt(i[1],16)),B(17*parseInt(i[2],16)),B(17*parseInt(i[3],16)),1];throw new Error("Cannot parse color: "+t)}function V(t){var i,n=P(t);return{K:"rgb("+n[0]+", "+n[1]+", "+n[2]+")",X:(i=n,.199*i[0]+.687*i[1]+.114*i[2]>160?"black":"white")}}function W(t,i,n,s,h,r){t.fillRect(i+r,n,s-2*r,r),t.fillRect(i+r,n+h-r,s-2*r,r),t.fillRect(i,n,r,h),t.fillRect(i+s-r,n,r,h)}function z(t,i,n){t.save(),t.scale(i,i),n(),t.restore()}function R(t,i,n,s,h,r){t.save(),t.globalCompositeOperation="copy",t.fillStyle=r,t.fillRect(i,n,s,h),t.restore()}function I(t,i,n,s,h,r,e){t.save(),t.globalCompositeOperation="copy";var u=t.createLinearGradient(0,0,0,h);u.addColorStop(0,r),u.addColorStop(1,e),t.fillStyle=u,t.fillRect(i,n,s,h),t.restore()}var U,j=function(){function t(t,i){this.setData(t,i)}return t.prototype.setData=function(t,i){this.B=t,this.$=i},t.prototype.draw=function(t,i,n,s,h,r){if(this.B.visible){t.font=i.font;var e=this.B.tickVisible||!this.B.moveTextToInvisibleTick?i.tickLength:0,u=i.borderSize,a=i.paddingTop,o=i.paddingBottom,l=i.paddingInner,f=i.paddingOuter,c=this.B.text,v=Math.ceil(n.measureText(t,c)),d=i.baselineOffset,_=i.fontSize+a+o,w=Math.ceil(.5*_),M=u+v+l+f+e,b=this.$.coordinate;this.$.fixedCoordinate&&(b=this.$.fixedCoordinate);var m,g,p=(b=Math.round(b))-w,y=p+_,k="right"===h,C=k?s:0,S=Math.ceil(s*r),N=C;if(t.fillStyle=this.$.background,t.lineWidth=1,t.lineCap="butt",c){k?(m=C-e,g=(N=C-M)+f):(N=C+M,m=C+e,g=C+u+e+l);var x=Math.max(1,Math.floor(r)),D=Math.max(1,Math.floor(u*r)),T=k?S:0,B=Math.round(p*r),A=Math.round(N*r),L=Math.round(b*r)-Math.floor(.5*r),F=L+x+(L-B),E=Math.round(m*r);t.save(),t.beginPath(),t.moveTo(T,B),t.lineTo(A,B),t.lineTo(A,F),t.lineTo(T,F),t.fill(),t.fillStyle=this.B.borderColor,t.fillRect(k?S-D:0,B,D,F-B),this.B.tickVisible&&(t.fillStyle=this.$.color,t.fillRect(T,L,E-T,x)),t.textAlign="left",t.fillStyle=this.$.color,z(t,r,(function(){t.fillText(c,g,y-o-d)})),t.restore()}}},t.prototype.height=function(t,i){return this.B.visible?t.fontSize+t.paddingTop+t.paddingBottom:0},t}(),q=function(){function t(t){this.Z={coordinate:0,color:"#FFF",background:"#000"},this.J={text:"",visible:!1,tickVisible:!0,moveTextToInvisibleTick:!1,borderColor:""},this.G={text:"",visible:!1,tickVisible:!1,moveTextToInvisibleTick:!0,borderColor:""},this.S=!0,this.tt=new(t||j)(this.J,this.Z),this.it=new(t||j)(this.G,this.Z)}return t.prototype.text=function(){return this.J.text},t.prototype.coordinate=function(){return this.nt(),this.Z.coordinate},t.prototype.update=function(){this.S=!0},t.prototype.height=function(t,i){return void 0===i&&(i=!1),Math.max(this.tt.height(t,i),this.it.height(t,i))},t.prototype.getFixedCoordinate=function(){return this.Z.fixedCoordinate||0},t.prototype.setFixedCoordinate=function(t){this.Z.fixedCoordinate=t},t.prototype.isVisible=function(){return this.nt(),this.J.visible||this.G.visible},t.prototype.isAxisLabelVisible=function(){return this.nt(),this.J.visible},t.prototype.renderer=function(t){return this.nt(),this.J.tickVisible=this.J.tickVisible&&t.options().drawTicks,this.G.tickVisible=this.G.tickVisible&&t.options().drawTicks,this.tt.setData(this.J,this.Z),this.it.setData(this.G,this.Z),this.tt},t.prototype.paneRenderer=function(){return this.nt(),this.tt.setData(this.J,this.Z),this.it.setData(this.G,this.Z),this.it},t.prototype.nt=function(){this.S&&(this.J.tickVisible=!0,this.G.tickVisible=!1,this.st(this.J,this.G,this.Z))},t}(),H=function(t){function i(i,n,s){var h=t.call(this)||this;return h.H=i,h.ht=n,h.rt=s,h}return e(i,t),i.prototype.st=function(t,i,n){t.visible=!1;var s=this.H.options().horzLine;if(s.labelVisible){var h=this.ht.firstValue();if(this.H.visible()&&!this.ht.isEmpty()&&null!==h){var r=V(s.labelBackgroundColor);n.background=r.K,n.color=r.X;var e=this.rt(this.ht);n.coordinate=e.et,t.text=this.ht.formatPrice(e.ut,h),t.visible=!0}}},i}(q),Y=/[1-9]/g,K=function(){function t(){this.B=null}return t.prototype.setData=function(t){this.B=t},t.prototype.draw=function(t,i,n){var s=this;if(null!==this.B&&!1!==this.B.visible&&0!==this.B.text.length){t.font=i.font;var h=Math.round(i.widthCache.measureText(t,this.B.text,Y));if(!(h<=0)){t.save();var r=i.paddingHorizontal,e=h+2*r,u=e/2,a=this.B.width,o=this.B.coordinate,l=Math.floor(o-u)+.5;l<0?(o+=Math.abs(0-l),l=Math.floor(o-u)+.5):l+e>a&&(o-=Math.abs(a-(l+e)),l=Math.floor(o-u)+.5);var c=l+e,v=0+i.borderSize+i.paddingTop+i.fontSize+i.paddingBottom;t.fillStyle=this.B.background;var d=Math.round(l*n),_=Math.round(0*n),w=Math.round(c*n),M=Math.round(v*n);t.fillRect(d,_,w-d,M-_);var b=Math.round(this.B.coordinate*n),m=_,g=Math.round((m+i.borderSize+i.tickLength)*n);t.fillStyle=this.B.color;var p=Math.max(1,Math.floor(n)),y=Math.floor(.5*n);t.fillRect(b-y,m,p,g-m);var k=v-i.baselineOffset-i.paddingBottom;t.textAlign="left",t.fillStyle=this.B.color,z(t,n,(function(){t.fillText(f(s.B).text,l+r,k)})),t.restore()}}},t}(),X=function(){function t(t,i,n){this.S=!0,this.q=new K,this.j={visible:!1,background:"#4c525e",color:"white",text:"",width:0,coordinate:NaN},this.D=t,this.at=i,this.rt=n}return t.prototype.Y=function(){this.S=!0},t.prototype.renderer=function(){return this.S&&(this.T(),this.S=!1),this.q.setData(this.j),this.q},t.prototype.T=function(){var t=this.j;t.visible=!1;var i=this.D.options().vertLine;if(i.labelVisible){var n=this.at.timeScale();if(!n.isEmpty()){var s=n.indexToTime(this.D.appliedIndex());t.width=n.width();var h=this.rt();if(h.ot){t.coordinate=h.et,t.text=n.formatDateTime(f(s)),t.visible=!0;var r=V(i.labelBackgroundColor);t.background=r.K,t.color=r.X}}}},t}(),$=function(){function t(){this._priceScale=null,this.lt=0}return t.prototype.zorder=function(){return this.lt},t.prototype.setZorder=function(t){this.lt=t},t.prototype.priceScale=function(){return this._priceScale},t.prototype.setPriceScale=function(t){this._priceScale=t},t.prototype.timeAxisViews=function(){return[]},t.prototype.visible=function(){return!0},t}();!function(t){t[t.Normal=0]="Normal",t[t.Magnet=1]="Magnet"}(U||(U={}));var Z=function(t){function i(i,n){var s=t.call(this)||this;s.ft=null,s.ct=NaN,s.vt=0,s.dt=!0,s._t=new Map,s.wt=!1,s.Mt=NaN,s.bt=NaN,s.gt=NaN,s.yt=NaN,s.at=i,s.kt=n,s.Ct=new N(i,s);var h,r;s.St=(h=function(){return s.ct},r=function(){return s.bt},function(t){var i=r(),n=h();if(t===f(s.ft).defaultPriceScale())return{ut:n,et:i};var e=f(t.firstValue());return{ut:t.coordinateToPrice(i,e),et:i}});var e=function(t,i){return function(){return{ot:s.at.timeScale().indexToTime(t()),et:i()}}}((function(){return s.vt}),(function(){return s.appliedX()}));return s.Nt=new X(s,i,e),s.xt=new D(s),s}return e(i,t),i.prototype.options=function(){return this.kt},i.prototype.saveOriginCoord=function(t,i){this.gt=t,this.yt=i},i.prototype.clearOriginCoord=function(){this.gt=NaN,this.yt=NaN},i.prototype.originCoordX=function(){return this.gt},i.prototype.originCoordY=function(){return this.yt},i.prototype.setPosition=function(t,i,n){this.wt||(this.wt=!0),this.dt=!0,this.Dt(t,i,n)},i.prototype.appliedIndex=function(){return this.vt},i.prototype.appliedX=function(){return this.Mt},i.prototype.appliedY=function(){return this.bt},i.prototype.visible=function(){return this.dt},i.prototype.clearPosition=function(){this.dt=!1,this.Tt(),this.ct=NaN,this.Mt=NaN,this.bt=NaN,this.ft=null,this.clearOriginCoord()},i.prototype.paneViews=function(t){return null!==this.ft?[this.xt,this.Ct]:[]},i.prototype.horzLineVisible=function(t){return t===this.ft&&this.kt.horzLine.visible},i.prototype.vertLineVisible=function(){return this.kt.vertLine.visible},i.prototype.priceAxisViews=function(t,i){this.dt&&this.ft===t||this._t.clear();var n=[];return this.ft===t&&n.push(this.Bt(this._t,i,this.St)),n},i.prototype.timeAxisViews=function(){return this.dt?[this.Nt]:[]},i.prototype.pane=function(){return this.ft},i.prototype.updateAllViews=function(){this.xt.Y(),this._t.forEach((function(t){return t.update()})),this.Nt.Y(),this.Ct.update()},i.prototype.At=function(t){return t&&!t.defaultPriceScale().isEmpty()?t.defaultPriceScale():null},i.prototype.Dt=function(t,i,n){this.Lt(t,i,n)&&this.updateAllViews()},i.prototype.Lt=function(t,i,n){var s=this.Mt,h=this.bt,r=this.ct,e=this.vt,u=this.ft,a=this.At(n);this.vt=t,this.Mt=isNaN(t)?NaN:this.at.timeScale().indexToCoordinate(t),this.ft=n;var o=null!==a?a.firstValue():null;return null!==a&&null!==o?(this.ct=i,this.bt=a.priceToCoordinate(i,o)):(this.ct=NaN,this.bt=NaN),s!==this.Mt||h!==this.bt||e!==this.vt||r!==this.ct||u!==this.ft},i.prototype.Tt=function(){var t=this.at.serieses().map((function(t){return t.bars().lastIndex()})).filter(m),i=0===t.length?null:Math.max.apply(Math,t);this.vt=null!==i?i:NaN},i.prototype.Bt=function(t,i,n){var s=t.get(i);return void 0===s&&(s=new H(this,i,n),t.set(i,s)),s},i}($),J=".";function G(t,i){if(!d(t))return"n/a";if(!_(i))throw new TypeError("invalid length");if(i<0||i>16)throw new TypeError("invalid length");if(0===i)return t.toString();return("0000000000000000"+t.toString()).slice(-i)}var Q=function(){function t(t,i){if(i||(i=1),d(t)&&_(t)||(t=100),t<0)throw new TypeError("invalid base");this.ht=t,this.Ft=i,this.Et()}return t.prototype.format=function(t){var i=t<0?"âˆ’":"";return t=Math.abs(t),i+this.Ot(t)},t.prototype.Et=function(){if(this._fractionalLength=0,this.ht>0&&this.Ft>0)for(var t=this.ht;t>1;)t/=10,this._fractionalLength++},t.prototype.Ot=function(t){var i=this.ht/this.Ft,n=Math.floor(t),s="",h=void 0!==this._fractionalLength?this._fractionalLength:NaN;if(i>1){var r=+(Math.round(t*i)-n*i).toFixed(this._fractionalLength);r>=i&&(r-=i,n+=1),s=J+G(+r.toFixed(this._fractionalLength)*this.Ft,h)}else n=Math.round(n*i)/i,h>0&&(s=J+G(0,h));return n.toFixed(0)+s},t}(),tt=function(t){function i(i){return void 0===i&&(i=100),t.call(this,i)||this}return e(i,t),i.prototype.format=function(i){return t.prototype.format.call(this,i)+"%"},i}(Q),it=function(){function t(){this.Pt=[]}return t.prototype.subscribe=function(t,i,n){var s={Vt:t,Wt:i,zt:!0===n};this.Pt.push(s)},t.prototype.unsubscribe=function(t){var i=this.Pt.findIndex((function(i){return t===i.Vt}));i>-1&&this.Pt.splice(i,1)},t.prototype.unsubscribeAll=function(t){this.Pt=this.Pt.filter((function(i){return i.Wt===t}))},t.prototype.Rt=function(t,i){var n=a([],this.Pt);this.Pt=this.Pt.filter((function(t){return!t.zt})),n.forEach((function(n){return n.Vt(t,i)}))},t.prototype.It=function(){return this.Pt.length>0},t.prototype.Ut=function(){this.Pt=[]},t}(),nt=function(){function t(t,i){this.jt=t,this.qt=i}return t.prototype.equals=function(t){return null!==t&&(this.jt===t.jt&&this.qt===t.qt)},t.prototype.clone=function(){return new t(this.jt,this.qt)},t.prototype.minValue=function(){return this.jt},t.prototype.maxValue=function(){return this.qt},t.prototype.length=function(){return this.qt-this.jt},t.prototype.isEmpty=function(){return this.qt===this.jt||Number.isNaN(this.qt)||Number.isNaN(this.jt)},t.prototype.merge=function(i){return null===i?this:new t(Math.min(this.minValue(),i.minValue()),Math.max(this.maxValue(),i.maxValue()))},t.prototype.scaleAroundCenter=function(t){if(d(t)&&0!==this.qt-this.jt){var i=.5*(this.qt+this.jt),n=this.qt-i,s=this.jt-i;n*=t,s*=t,this.qt=i+n,this.jt=i+s}},t.prototype.shift=function(t){d(t)&&(this.qt+=t,this.jt+=t)},t.prototype.toRaw=function(){return{minValue:this.jt,maxValue:this.qt}},t.fromRaw=function(i){return null===i?null:new t(i.minValue,i.maxValue)},t}();function st(t,i,n){return Math.min(Math.max(t,i),n)}function ht(t,i,n){return i-t<=n}function rt(t){return t<=0?NaN:Math.log(t)/Math.log(10)}function et(t){var i=Math.ceil(t);return i%2!=0?i-1:i}function ut(t){var i=Math.ceil(t);return i%2==0?i-1:i}var at={Ht:4,Yt:1e-4};function ot(t,i){var n=100*(t-i)/i;return i<0?-n:n}function lt(t,i){var n=ot(t.minValue(),i),s=ot(t.maxValue(),i);return new nt(n,s)}function ft(t,i){var n=100*(t-i)/i+100;return i<0?-n:n}function ct(t,i){var n=ft(t.minValue(),i),s=ft(t.maxValue(),i);return new nt(n,s)}function vt(t,i){var n=Math.abs(t);if(n<1e-15)return 0;var s=rt(n+i.Yt)+i.Ht;return t<0?-s:s}function dt(t,i){var n=Math.abs(t);if(n<1e-15)return 0;var s=Math.pow(10,n-i.Ht)-i.Yt;return t<0?-s:s}function _t(t,i){if(null===t)return null;var n=vt(t.minValue(),i),s=vt(t.maxValue(),i);return new nt(n,s)}function wt(t,i){if(null===t)return null;var n=dt(t.minValue(),i),s=dt(t.maxValue(),i);return new nt(n,s)}function Mt(t){if(null===t)return at;var i=Math.abs(t.maxValue()-t.minValue());if(i>=1||i<1e-15)return at;var n=Math.ceil(Math.abs(Math.log10(i))),s=at.Ht+n;return{Ht:s,Yt:1/Math.pow(10,s)}}var bt,mt=function(){function t(t,i){if(this.Kt=t,this.Xt=i,function(t){if(t<0)return!1;for(var i=t;i>1;i/=10)if(i%10!=0)return!1;return!0}(this.Kt))this.$t=[2,2.5,2];else{this.$t=[];for(var n=this.Kt;1!==n;){if(n%2==0)this.$t.push(2),n/=2;else{if(n%5!=0)throw new Error("unexpected base");this.$t.push(2,2.5),n/=5}if(this.$t.length>100)throw new Error("something wrong with base")}}}return t.prototype.Zt=function(t,i,n){for(var s,h,r,e=0===this.Kt?0:1/this.Kt,u=Math.pow(10,Math.max(0,Math.ceil(rt(t-i)))),a=0,o=this.Xt[0];;){var l=ht(u,e,1e-14)&&u>e+1e-14,f=ht(u,n*o,1e-14),c=ht(u,1,1e-14);if(!(l&&f&&c))break;u/=o,o=this.Xt[++a%this.Xt.length]}if(u<=e+1e-14&&(u=e),u=Math.max(1,u),this.$t.length>0&&(s=u,h=1,r=1e-14,Math.abs(s-h)<r))for(a=0,o=this.$t[0];ht(u,n*o,1e-14)&&u>e+1e-14;)u/=o,o=this.$t[++a%this.$t.length];return u},t}(),gt=function(){function t(t,i,n,s){this.Jt=[],this.ht=t,this.Kt=i,this.Gt=n,this.Qt=s}return t.prototype.Zt=function(t,i){if(t<i)throw new Error("high < low");var n=this.ht.height(),s=(t-i)*this.ti()/n,h=new mt(this.Kt,[2,2.5,2]),r=new mt(this.Kt,[2,2,2.5]),e=new mt(this.Kt,[2.5,2,2]),u=[];return u.push(h.Zt(t,i,s),r.Zt(t,i,s),e.Zt(t,i,s)),function(t){if(t.length<1)throw Error("array is empty");for(var i=t[0],n=1;n<t.length;++n)t[n]<i&&(i=t[n]);return i}(u)},t.prototype.ii=function(){var t=this.ht,i=t.firstValue();if(null!==i){var n=t.height(),s=this.Gt(n-1,i),h=this.Gt(0,i),r=this.ht.options().entireTextOnly?this.ni()/2:0,e=r,u=n-1-r,a=Math.max(s,h),o=Math.min(s,h);if(a!==o){for(var l=this.Zt(a,o),f=a%l,c=a>=o?1:-1,v=null,d=0,_=a-(f+=f<0?l:0);_>o;_-=l){var w=this.Qt(_,i,!0);null!==v&&Math.abs(w-v)<this.ti()||(w<e||w>u||(d<this.Jt.length?(this.Jt[d].coord=w,this.Jt[d].label=t.formatLogical(_)):this.Jt.push({coord:w,label:t.formatLogical(_)}),d++,v=w,t.isLog()&&(l=this.Zt(_*c,o))))}this.Jt.length=d}else this.Jt=[]}else this.Jt=[]},t.prototype.si=function(){return this.Jt},t.prototype.ni=function(){return this.ht.fontSize()},t.prototype.ti=function(){return Math.ceil(2.5*this.ni())},t}();function pt(t){return t.slice().sort((function(t,i){return f(t.zorder())-f(i.zorder())}))}!function(t){t[t.Normal=0]="Normal",t[t.Logarithmic=1]="Logarithmic",t[t.Percentage=2]="Percentage",t[t.IndexedTo100=3]="IndexedTo100"}(bt||(bt={}));var yt,kt,Ct=new tt,St=new Q(100,1),Nt=function(){function t(t,i,n,s){this.hi=0,this.ri=null,this.ei=null,this.ui=null,this.ai={oi:!1,li:null},this.fi=0,this.ci=0,this.vi=new it,this.di=new it,this._i=[],this.wi=null,this.Mi=null,this.bi=null,this.mi=null,this.gi=St,this.pi=Mt(null),this.yi=t,this.kt=i,this.ki=n,this.Ci=s,this.Si=new gt(this,100,this.Ni.bind(this),this.xi.bind(this))}return t.prototype.id=function(){return this.yi},t.prototype.options=function(){return this.kt},t.prototype.applyOptions=function(t){if(v(this.kt,t),this.updateFormatter(),void 0!==t.mode&&this.setMode({mode:t.mode}),void 0!==t.scaleMargins){var i=l(t.scaleMargins.top),n=l(t.scaleMargins.bottom);if(i<0||i>1)throw new Error("Invalid top margin - expect value between 0 and 1, given="+i);if(n<0||n>1||i+n>1)throw new Error("Invalid bottom margin - expect value between 0 and 1, given="+n);if(i+n>1)throw new Error("Invalid margins - sum of margins must be less than 1, given="+(i+n));this.Di(),this.Mi=null}},t.prototype.isAutoScale=function(){return this.kt.autoScale},t.prototype.isLog=function(){return 1===this.kt.mode},t.prototype.isPercentage=function(){return 2===this.kt.mode},t.prototype.isIndexedTo100=function(){return 3===this.kt.mode},t.prototype.mode=function(){return{autoScale:this.kt.autoScale,isInverted:this.kt.invertScale,mode:this.kt.mode}},t.prototype.setMode=function(t){var i=this.mode(),n=null;void 0!==t.autoScale&&(this.kt.autoScale=t.autoScale),void 0!==t.mode&&(this.kt.mode=t.mode,2!==t.mode&&3!==t.mode||(this.kt.autoScale=!0),this.ai.oi=!1),1===i.mode&&t.mode!==i.mode&&(!function(t,i){if(null===t)return!1;var n=dt(t.minValue(),i),s=dt(t.maxValue(),i);return isFinite(n)&&isFinite(s)}(this.ei,this.pi)?this.kt.autoScale=!0:null!==(n=wt(this.ei,this.pi))&&this.setPriceRange(n)),1===t.mode&&t.mode!==i.mode&&null!==(n=_t(this.ei,this.pi))&&this.setPriceRange(n);var s=i.mode!==this.kt.mode;s&&(2===i.mode||this.isPercentage())&&this.updateFormatter(),s&&(3===i.mode||this.isIndexedTo100())&&this.updateFormatter(),void 0!==t.isInverted&&i.isInverted!==t.isInverted&&(this.kt.invertScale=t.isInverted,this.Ti()),this.di.Rt(i,this.mode())},t.prototype.modeChanged=function(){return this.di},t.prototype.fontSize=function(){return this.ki.fontSize},t.prototype.height=function(){return this.hi},t.prototype.setHeight=function(t){this.hi!==t&&(this.hi=t,this.Di(),this.Mi=null)},t.prototype.internalHeight=function(){if(this.ri)return this.ri;var t=this.height()-this.Bi()-this.Ai();return this.ri=t,t},t.prototype.priceRange=function(){return this.Li(),this.ei},t.prototype.setPriceRange=function(t,i){var n=this.ei;(i||null===n&&null!==t||null!==n&&!n.equals(t))&&(this.Mi=null,this.ei=t)},t.prototype.isEmpty=function(){return this.Li(),0===this.hi||!this.ei||this.ei.isEmpty()},t.prototype.invertedCoordinate=function(t){return this.isInverted()?t:this.height()-1-t},t.prototype.priceToCoordinate=function(t,i){return this.isPercentage()?t=ot(t,i):this.isIndexedTo100()&&(t=ft(t,i)),this.xi(t,i)},t.prototype.pointsArrayToCoordinates=function(t,i,n){this.Li();for(var s=this.Ai(),h=f(this.priceRange()),r=h.minValue(),e=h.maxValue(),u=this.internalHeight()-1,a=this.isInverted(),o=u/(e-r),l=void 0===n?0:n.from,c=void 0===n?t.length:n.to,v=this.Fi(),d=l;d<c;d++){var _=t[d],w=_.price;if(!isNaN(w)){var M=w;null!==v&&(M=v(_.price,i));var b=s+o*(M-r),m=a?b:this.hi-1-b;_.y=m}}},t.prototype.barPricesToCoordinates=function(t,i,n){this.Li();for(var s=this.Ai(),h=f(this.priceRange()),r=h.minValue(),e=h.maxValue(),u=this.internalHeight()-1,a=this.isInverted(),o=u/(e-r),l=void 0===n?0:n.from,c=void 0===n?t.length:n.to,v=this.Fi(),d=l;d<c;d++){var _=t[d],w=_.open,M=_.high,b=_.low,m=_.close;null!==v&&(w=v(_.open,i),M=v(_.high,i),b=v(_.low,i),m=v(_.close,i));var g=s+o*(w-r),p=a?g:this.hi-1-g;_.openY=p,g=s+o*(M-r),p=a?g:this.hi-1-g,_.highY=p,g=s+o*(b-r),p=a?g:this.hi-1-g,_.lowY=p,g=s+o*(m-r),p=a?g:this.hi-1-g,_.closeY=p}},t.prototype.coordinateToPrice=function(t,i){var n=this.Ni(t,i);return this.logicalToPrice(n,i)},t.prototype.logicalToPrice=function(t,i){var n=t;return this.isPercentage()?n=function(t,i){return i<0&&(t=-t),t/100*i+i}(n,i):this.isIndexedTo100()&&(n=function(t,i){return t-=100,i<0&&(t=-t),t/100*i+i}(n,i)),n},t.prototype.dataSources=function(){return this._i},t.prototype.orderedSources=function(){if(this.wi)return this.wi;for(var t=[],i=0;i<this._i.length;i++){var n=this._i[i];null===n.zorder()&&n.setZorder(i+1),t.push(n)}return t=pt(t),this.wi=t,this.wi},t.prototype.addDataSource=function(t){-1===this._i.indexOf(t)&&(this._i.push(t),this.updateFormatter(),this.invalidateSourcesCache())},t.prototype.removeDataSource=function(t){var i=this._i.indexOf(t);if(-1===i)throw new Error("source is not attached to scale");this._i.splice(i,1),0===this._i.length&&(this.setMode({autoScale:!0}),this.setPriceRange(null)),this.updateFormatter(),this.invalidateSourcesCache()},t.prototype.firstValue=function(){for(var t=null,i=0,n=this._i;i<n.length;i++){var s=n[i].firstValue();null!==s&&null!==s.value&&((null===t||s.timePoint<t.timePoint)&&(t=s))}return null===t?null:t.value},t.prototype.isInverted=function(){return this.kt.invertScale},t.prototype.marks=function(){return this.Mi||(this.Si.ii(),this.Mi=this.Si.si(),this.vi.Rt()),this.Mi},t.prototype.onMarksChanged=function(){return this.vi},t.prototype.startScale=function(t){this.isPercentage()||this.isIndexedTo100()||null===this.bi&&null===this.ui&&(this.isEmpty()||(this.bi=this.hi-t,this.ui=f(this.priceRange()).clone()))},t.prototype.scaleTo=function(t){if(!this.isPercentage()&&!this.isIndexedTo100()&&null!==this.bi){this.setMode({autoScale:!1}),(t=this.hi-t)<0&&(t=0);var i=(this.bi+.2*(this.hi-1))/(t+.2*(this.hi-1)),n=f(this.ui).clone();i=Math.max(i,.1),n.scaleAroundCenter(i),this.setPriceRange(n)}},t.prototype.endScale=function(){this.isPercentage()||this.isIndexedTo100()||(this.bi=null,this.ui=null)},t.prototype.startScroll=function(t){this.isAutoScale()||null===this.mi&&null===this.ui&&(this.isEmpty()||(this.mi=t,this.ui=f(this.priceRange()).clone()))},t.prototype.scrollTo=function(t){if(!this.isAutoScale()&&null!==this.mi){var i=f(this.priceRange()).length()/(this.internalHeight()-1),n=t-this.mi;this.isInverted()&&(n*=-1);var s=n*i,h=f(this.ui).clone();h.shift(s),this.setPriceRange(h,!0),this.Mi=null}},t.prototype.endScroll=function(){this.isAutoScale()||null!==this.mi&&(this.mi=null,this.ui=null)},t.prototype.formatter=function(){return this.gi||this.updateFormatter(),this.gi},t.prototype.formatPrice=function(t,i){switch(this.kt.mode){case 2:return this.formatter().format(ot(t,i));case 3:return this.formatter().format(ft(t,i));default:return this.Ei(t)}},t.prototype.formatLogical=function(t){switch(this.kt.mode){case 2:case 3:return this.formatter().format(t);default:return this.Ei(t)}},t.prototype.formatPriceAbsolute=function(t){return this.Ei(t,f(this.Oi()).formatter())},t.prototype.formatPricePercentage=function(t,i){return t=ot(t,i),Ct.format(t)},t.prototype.sourcesForAutoScale=function(){return this._i},t.prototype.recalculatePriceRange=function(t){this.ai={li:t,oi:!1}},t.prototype.updateAllViews=function(){this._i.forEach((function(t){return t.updateAllViews()}))},t.prototype.updateFormatter=function(){this.Mi=null;var t=this.Oi(),i=100;null!==t&&(i=Math.round(1/t.minMove())),this.gi=St,this.isPercentage()?(this.gi=Ct,i=100):this.isIndexedTo100()?(this.gi=new Q(100,1),i=100):null!==t&&(this.gi=t.formatter()),this.Si=new gt(this,i,this.Ni.bind(this),this.xi.bind(this)),this.Si.ii()},t.prototype.invalidateSourcesCache=function(){this.wi=null},t.prototype.Oi=function(){return this._i[0]||null},t.prototype.Bi=function(){return this.isInverted()?this.kt.scaleMargins.bottom*this.height()+this.ci:this.kt.scaleMargins.top*this.height()+this.fi},t.prototype.Ai=function(){return this.isInverted()?this.kt.scaleMargins.top*this.height()+this.fi:this.kt.scaleMargins.bottom*this.height()+this.ci},t.prototype.Li=function(){this.ai.oi||(this.ai.oi=!0,this.Pi())},t.prototype.Di=function(){this.ri=null},t.prototype.xi=function(t,i){if(this.Li(),this.isEmpty())return 0;t=this.isLog()&&t?vt(t,this.pi):t;var n=f(this.priceRange()),s=this.Ai()+(this.internalHeight()-1)*(t-n.minValue())/n.length();return this.invertedCoordinate(s)},t.prototype.Ni=function(t,i){if(this.Li(),this.isEmpty())return 0;var n=this.invertedCoordinate(t),s=f(this.priceRange()),h=s.minValue()+s.length()*((n-this.Ai())/(this.internalHeight()-1));return this.isLog()?dt(h,this.pi):h},t.prototype.Ti=function(){this.Mi=null,this.Si.ii()},t.prototype.Pi=function(){var t=this.ai.li;if(null!==t){for(var i,n,s=null,h=0,r=0,e=0,u=this.sourcesForAutoScale();e<u.length;e++){var a=u[e];if(a.visible()){var o=a.firstValue();if(null!==o){var l=a.autoscaleInfo(t.left(),t.right()),c=l&&l.priceRange();if(null!==c){switch(this.kt.mode){case 1:c=_t(c,this.pi);break;case 2:c=lt(c,o.value);break;case 3:c=ct(c,o.value)}if(s=null===s?c:s.merge(f(c)),null!==l){var v=l.margins();null!==v&&(h=Math.max(h,v.above),r=Math.max(h,v.below))}}}}}if(h===this.fi&&r===this.ci||(this.fi=h,this.ci=r,this.Mi=null,this.Di()),null!==s){if(s.minValue()===s.maxValue()){var d=this.Oi(),_=5*(null===d||this.isPercentage()||this.isIndexedTo100()?1:d.minMove());this.isLog()&&(s=wt(s,this.pi)),s=new nt(s.minValue()-_,s.maxValue()+_),this.isLog()&&(s=_t(s,this.pi))}if(this.isLog()){var w=wt(s,this.pi),M=Mt(w);if(i=M,n=this.pi,i.Ht!==n.Ht||i.Yt!==n.Yt){var b=null!==this.ui?wt(this.ui,this.pi):null;this.pi=M,s=_t(w,M),null!==b&&(this.ui=_t(b,M))}}this.setPriceRange(s)}else null===this.ei&&(this.setPriceRange(new nt(-.5,.5)),this.pi=Mt(null));this.ai.oi=!0}},t.prototype.Fi=function(){var t=this;return this.isPercentage()?ot:this.isIndexedTo100()?ft:this.isLog()?function(i){return vt(i,t.pi)}:null},t.prototype.Ei=function(t,i){return void 0===this.Ci.priceFormatter?(void 0===i&&(i=this.formatter()),i.format(t)):this.Ci.priceFormatter(t)},t}();function xt(t){void 0!==t.borderColor&&(t.borderUpColor=t.borderColor,t.borderDownColor=t.borderColor),void 0!==t.wickColor&&(t.wickUpColor=t.wickColor,t.wickDownColor=t.wickColor)}!function(t){t[t.Disabled=0]="Disabled",t[t.Continuous=1]="Continuous",t[t.OnDataUpdate=2]="OnDataUpdate"}(yt||(yt={})),function(t){t[t.LastBar=0]="LastBar",t[t.LastVisible=1]="LastVisible"}(kt||(kt={}));var Dt=function(t){return t.getUTCFullYear()};function Tt(t,i,n){return i.replace(/yyyy/g,function(t){return G(Dt(t),4)}(t)).replace(/yy/g,function(t){return G(Dt(t)%100,2)}(t)).replace(/MMMM/g,function(t,i){return new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"long"})}(t,n)).replace(/MMM/g,function(t,i){return new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"short"})}(t,n)).replace(/MM/g,function(t){return G(function(t){return t.getUTCMonth()+1}(t),2)}(t)).replace(/dd/g,function(t){return G(function(t){return t.getUTCDate()}(t),2)}(t))}var Bt=function(){function t(t,i){void 0===t&&(t="yyyy-MM-dd"),void 0===i&&(i="default"),this.Vi=t,this.Wi=i}return t.prototype.zi=function(t){return Tt(t,this.Vi,this.Wi)},t}(),At=function(){function t(t){this.Ri=t||"%h:%m:%s"}return t.prototype.zi=function(t){return this.Ri.replace("%h",G(t.getUTCHours(),2)).replace("%m",G(t.getUTCMinutes(),2)).replace("%s",G(t.getUTCSeconds(),2))},t}(),Lt={Ii:"yyyy-MM-dd",Ui:"%h:%m:%s",ji:" ",qi:"default"},Ft=function(){function t(t){void 0===t&&(t={});var i=u(u({},Lt),t);this.Hi=new Bt(i.Ii,i.qi),this.Yi=new At(i.Ui),this.Ki=i.ji}return t.prototype.zi=function(t){return""+this.Hi.zi(t)+this.Ki+this.Yi.zi(t)},t}();function Et(t,i,n,s,h){void 0===s&&(s=0),void 0===h&&(h=t.length);for(var r=h-s;0<r;){var e=r>>1,u=s+e;n(t[u],i)?(s=u+1,r-=e+1):r=e}return s}function Ot(t,i,n,s,h){void 0===s&&(s=0),void 0===h&&(h=t.length);for(var r=h-s;0<r;){var e=r>>1,u=s+e;n(i,t[u])?r=e:(s=u+1,r-=e+1)}return s}var Pt=function(){function t(t,i){void 0===i&&(i=50),this.Xi=0,this.$i=1,this.Zi=1,this.Ji=new Map,this.Gi=new Map,this.Qi=t,this.tn=i}return t.prototype.zi=function(t){var i=void 0===t.businessDay?new Date(1e3*t.timestamp).getTime():new Date(Date.UTC(t.businessDay.year,t.businessDay.month-1,t.businessDay.day)).getTime(),n=this.Ji.get(i);if(void 0!==n)return n.nn;if(this.Xi===this.tn){var s=this.Gi.get(this.Zi);this.Gi.delete(this.Zi),this.Ji.delete(l(s)),this.Zi++,this.Xi--}var h=this.Qi(t);return this.Ji.set(i,{nn:h,sn:this.$i}),this.Gi.set(this.$i,i),this.Xi++,this.$i++,h},t}(),Vt=function(){function t(t,i){o(t<=i,"right should be >= left"),this.hn=t,this.rn=i}return t.prototype.left=function(){return this.hn},t.prototype.right=function(){return this.rn},t.prototype.count=function(){return this.rn-this.hn+1},t.prototype.contains=function(t){return this.hn<=t&&t<=this.rn},t.prototype.equals=function(t){return this.hn===t.left()&&this.rn===t.right()},t}();function Wt(t,i){return null===t||null===i?t===i:t.equals(i)}var zt,Rt=function(){function t(){this.en=new Map,this.Ji=null}return t.prototype.un=function(t,i){this.an(i),this.Ji=null;for(var n=i;n<t.length;++n){var s=t[n],h=this.en.get(s.timeWeight);void 0===h&&(h=[],this.en.set(s.timeWeight,h)),h.push({on:n,ot:s.time,ln:s.timeWeight})}},t.prototype.fn=function(t,i){var n=Math.ceil(i/t);return null!==this.Ji&&this.Ji.cn===n||(this.Ji={si:this.vn(n),cn:n}),this.Ji.si},t.prototype.an=function(t){if(0!==t){var i=[];this.en.forEach((function(n,s){t<=n[0].on?i.push(s):n.splice(Et(n,t,(function(i){return i.on<t})),1/0)}));for(var n=0,s=i;n<s.length;n++){var h=s[n];this.en.delete(h)}}else this.en.clear()},t.prototype.vn=function(t){for(var i=[],n=0,s=Array.from(this.en.keys()).sort((function(t,i){return i-t}));n<s.length;n++){var h=s[n];if(this.en.get(h)){var r=i;i=[];for(var e=r.length,u=0,a=l(this.en.get(h)),o=a.length,f=1/0,c=-1/0,v=0;v<o;v++){for(var d=a[v],_=d.on;u<e;){var w=r[u],M=w.on;if(!(M<_)){f=M;break}u++,i.push(w),c=M,f=1/0}f-_>=t&&_-c>=t&&(i.push(d),c=_)}for(;u<e;u++)i.push(r[u])}}return i},t}(),It=function(){function t(t){this.dn=t}return t.prototype._n=function(){return null===this.dn?null:new Vt(Math.floor(this.dn.left()),Math.ceil(this.dn.right()))},t.prototype.wn=function(){return this.dn},t.Mn=function(){return new t(null)},t}();!function(t){t[t.Year=0]="Year",t[t.Month=1]="Month",t[t.DayOfMonth=2]="DayOfMonth",t[t.Time=3]="Time",t[t.TimeWithSeconds=4]="TimeWithSeconds"}(zt||(zt={}));var Ut,jt=function(){function t(t,i,n){this.bn=0,this.mn=null,this.gn=[],this.mi=null,this.bi=null,this.pn=new Rt,this.yn=new Map,this.kn=It.Mn(),this.Cn=!0,this.Sn=new it,this.Nn=new it,this.xn=new it,this.Dn=null,this.Tn=null,this.Bn=[],this.kt=i,this.Ci=n,this.An=i.rightOffset,this.Ln=i.barSpacing,this.at=t,this.Fn()}return t.prototype.options=function(){return this.kt},t.prototype.applyLocalizationOptions=function(t){v(this.Ci,t),this.En(),this.Fn()},t.prototype.applyOptions=function(t,i){var n;v(this.kt,t),this.kt.fixLeftEdge&&this.On(),this.kt.fixRightEdge&&this.Pn(),void 0!==t.barSpacing&&this.at.setBarSpacing(t.barSpacing),void 0!==t.rightOffset&&this.at.setRightOffset(t.rightOffset),void 0!==t.minBarSpacing&&this.at.setBarSpacing(null!==(n=t.barSpacing)&&void 0!==n?n:this.Ln),this.En(),this.Fn(),this.xn.Rt()},t.prototype.indexToTime=function(t){var i;return(null===(i=this.gn[t])||void 0===i?void 0:i.time)||null},t.prototype.timeToIndex=function(t,i){if(this.gn.length<1)return null;if(t.timestamp>this.gn[this.gn.length-1].time.timestamp)return i?this.gn.length-1:null;var n=Et(this.gn,t.timestamp,(function(t,i){return t.time.timestamp<i}));return t.timestamp<this.gn[n].time.timestamp?i?n:null:n},t.prototype.isEmpty=function(){return 0===this.bn||0===this.gn.length||null===this.mn},t.prototype.visibleStrictRange=function(){return this.Vn(),this.kn._n()},t.prototype.visibleLogicalRange=function(){return this.Vn(),this.kn.wn()},t.prototype.visibleTimeRange=function(){var t=this.visibleStrictRange();if(null===t)return null;var i={from:t.left(),to:t.right()};return this.timeRangeForLogicalRange(i)},t.prototype.timeRangeForLogicalRange=function(t){var i=Math.round(t.from),n=Math.round(t.to),s=f(this.Wn()),h=f(this.zn());return{from:f(this.indexToTime(Math.max(s,i))),to:f(this.indexToTime(Math.min(h,n)))}},t.prototype.logicalRangeForTimeRange=function(t){return{from:f(this.timeToIndex(t.from,!0)),to:f(this.timeToIndex(t.to,!0))}},t.prototype.width=function(){return this.bn},t.prototype.setWidth=function(t){if(isFinite(t)&&!(t<=0)&&this.bn!==t){if(this.kt.lockVisibleTimeRangeOnResize&&this.bn){var i=this.Ln*t/this.bn;this.Ln=i}if(this.kt.fixLeftEdge){var n=this.visibleStrictRange();if(null!==n)if(n.left()<=0){var s=this.bn-t;this.An-=Math.round(s/this.Ln)+1}}this.bn=t,this.Cn=!0,this.Rn(),this.In()}},t.prototype.indexToCoordinate=function(t){if(this.isEmpty()||!_(t))return 0;var i=this.baseIndex()+this.An-t;return this.bn-(i+.5)*this.Ln-1},t.prototype.indexesToCoordinates=function(t,i){for(var n=this.baseIndex(),s=void 0===i?0:i.from,h=void 0===i?t.length:i.to,r=s;r<h;r++){var e=t[r].time,u=n+this.An-e,a=this.bn-(u+.5)*this.Ln-1;t[r].x=a}},t.prototype.coordinateToIndex=function(t){return Math.ceil(this.Un(t))},t.prototype.setRightOffset=function(t){this.Cn=!0,this.An=t,this.In(),this.at.recalculateAllPanes(),this.at.lightUpdate()},t.prototype.barSpacing=function(){return this.Ln},t.prototype.setBarSpacing=function(t){this.jn(t),this.In(),this.at.recalculateAllPanes(),this.at.lightUpdate()},t.prototype.rightOffset=function(){return this.An},t.prototype.marks=function(){if(this.isEmpty())return null;if(null!==this.Tn)return this.Tn;for(var t=this.Ln,i=5*(this.at.options().layout.fontSize+4),n=Math.round(i/t),s=f(this.visibleStrictRange()),h=Math.max(s.left(),s.left()-n),r=Math.max(s.right(),s.right()-n),e=this.pn.fn(t,i),u=this.Wn()+n,a=this.zn()-n,o=0,l=0,c=e;l<c.length;l++){var v=c[l];if(h<=v.on&&v.on<=r){var d=void 0;o<this.Bn.length?((d=this.Bn[o]).coord=this.indexToCoordinate(v.on),d.label=this.qn(v.ot,v.ln),d.weight=v.ln):(d={needAlignCoordinate:!1,coord:this.indexToCoordinate(v.on),label:this.qn(v.ot,v.ln),weight:v.ln},this.Bn.push(d)),this.Ln>i/2?d.needAlignCoordinate=!1:d.needAlignCoordinate=this.kt.fixLeftEdge&&v.on<=u||this.kt.fixRightEdge&&v.on>=a,o++}}return this.Bn.length=o,this.Tn=this.Bn,this.Bn},t.prototype.restoreDefault=function(){this.Cn=!0,this.setBarSpacing(this.kt.barSpacing),this.setRightOffset(this.kt.rightOffset)},t.prototype.setBaseIndex=function(t){this.Cn=!0,this.mn=t,this.In(),this.On()},t.prototype.zoom=function(t,i){var n=this.Un(t),s=this.barSpacing(),h=s+i*(s/10);this.setBarSpacing(h),this.kt.rightBarStaysOnScroll||this.setRightOffset(this.rightOffset()+(n-this.Un(t)))},t.prototype.startScale=function(t){this.mi&&this.endScroll(),null===this.bi&&null===this.Dn&&(this.isEmpty()||(this.bi=t,this.Hn()))},t.prototype.scaleTo=function(t){if(null!==this.Dn){var i=st(this.bn-t,0,this.bn),n=st(this.bn-f(this.bi),0,this.bn);0!==i&&0!==n&&this.setBarSpacing(this.Dn.Yn*i/n)}},t.prototype.endScale=function(){null!==this.bi&&(this.bi=null,this.Kn())},t.prototype.startScroll=function(t){null===this.mi&&null===this.Dn&&(this.isEmpty()||(this.mi=t,this.Hn()))},t.prototype.scrollTo=function(t){if(null!==this.mi){var i=(this.mi-t)/this.barSpacing();this.An=f(this.Dn).Xn+i,this.Cn=!0,this.In()}},t.prototype.endScroll=function(){null!==this.mi&&(this.mi=null,this.Kn())},t.prototype.scrollToRealTime=function(){this.scrollToOffsetAnimated(this.kt.rightOffset)},t.prototype.scrollToOffsetAnimated=function(t,i){var n=this;if(void 0===i&&(i=400),!isFinite(t))throw new RangeError("offset is required and must be finite number");if(!isFinite(i)||i<=0)throw new RangeError("animationDuration (optional) must be finite positive number");var s=this.An,h=performance.now(),r=function(){var e=(performance.now()-h)/i,u=e>=1,a=u?t:s+(t-s)*e;n.setRightOffset(a),u||setTimeout(r,20)};r()},t.prototype.update=function(t,i){this.Cn=!0,this.gn=t,this.pn.un(t,i),this.In()},t.prototype.visibleBarsChanged=function(){return this.Sn},t.prototype.logicalRangeChanged=function(){return this.Nn},t.prototype.optionsApplied=function(){return this.xn},t.prototype.baseIndex=function(){return this.mn||0},t.prototype.setVisibleRange=function(t){var i=t.count();this.jn(this.bn/i),this.An=t.right()-this.baseIndex(),this.In(),this.Cn=!0,this.at.recalculateAllPanes(),this.at.lightUpdate()},t.prototype.fitContent=function(){var t=this.Wn(),i=this.zn();null!==t&&null!==i&&this.setVisibleRange(new Vt(t,i+this.kt.rightOffset))},t.prototype.setLogicalRange=function(t){var i=new Vt(t.from,t.to);this.setVisibleRange(i)},t.prototype.formatDateTime=function(t){return void 0!==this.Ci.timeFormatter?this.Ci.timeFormatter(t.businessDay||t.timestamp):this.$n.zi(new Date(1e3*t.timestamp))},t.prototype.Wn=function(){return 0===this.gn.length?null:0},t.prototype.zn=function(){return 0===this.gn.length?null:this.gn.length-1},t.prototype.Zn=function(t){return(this.bn-1-t)/this.Ln},t.prototype.Un=function(t){var i=this.Zn(t),n=this.baseIndex()+this.An-i;return Math.round(1e6*n)/1e6},t.prototype.jn=function(t){var i=this.Ln;this.Ln=t,this.Rn(),i!==this.Ln&&(this.Cn=!0,this.Jn())},t.prototype.Vn=function(){if(this.Cn)if(this.Cn=!1,this.isEmpty())this.Gn(It.Mn());else{var t=this.baseIndex(),i=this.bn/this.Ln,n=this.An+t,s=new Vt(n-i+1,n);this.Gn(new It(s))}},t.prototype.Rn=function(){var t=this.Qn();if(this.Ln<t&&(this.Ln=t,this.Cn=!0),0!==this.bn){var i=.5*this.bn;this.Ln>i&&(this.Ln=i,this.Cn=!0)}},t.prototype.Qn=function(){return this.kt.fixLeftEdge&&this.kt.fixRightEdge&&0!==this.gn.length?this.bn/this.gn.length:this.kt.minBarSpacing},t.prototype.In=function(){var t=this.ts();this.An>t&&(this.An=t,this.Cn=!0);var i=this.ns();null!==i&&this.An<i&&(this.An=i,this.Cn=!0)},t.prototype.ns=function(){var t=this.Wn(),i=this.mn;return null===t||null===i?null:t-i-1+(this.kt.fixLeftEdge?this.bn/this.Ln:Math.min(2,this.gn.length))},t.prototype.ts=function(){return this.kt.fixRightEdge?0:this.bn/this.Ln-Math.min(2,this.gn.length)},t.prototype.Hn=function(){this.Dn={Yn:this.barSpacing(),Xn:this.rightOffset()}},t.prototype.Kn=function(){this.Dn=null},t.prototype.qn=function(t,i){var n=this,s=this.yn.get(i);return void 0===s&&(s=new Pt((function(t){return n.ss(t,i)})),this.yn.set(i,s)),s.zi(t)},t.prototype.ss=function(t,i){var n,s=function(t,i,n){switch(t){case 0:case 10:return i?n?4:3:2;case 20:case 21:case 22:case 30:case 31:case 32:case 33:return i?3:2;case 50:return 2;case 60:return 1;case 70:return 0}}(i,this.kt.timeVisible,this.kt.secondsVisible);return void 0!==this.kt.tickMarkFormatter?this.kt.tickMarkFormatter(null!==(n=t.businessDay)&&void 0!==n?n:t.timestamp,s,this.Ci.locale):function(t,i,n){var s={};switch(i){case 0:s.year="numeric";break;case 1:s.month="short";break;case 2:s.day="numeric";break;case 3:s.hour12=!1,s.hour="2-digit",s.minute="2-digit";break;case 4:s.hour12=!1,s.hour="2-digit",s.minute="2-digit",s.second="2-digit"}var h=void 0===t.businessDay?new Date(1e3*t.timestamp):new Date(Date.UTC(t.businessDay.year,t.businessDay.month-1,t.businessDay.day));return new Date(h.getUTCFullYear(),h.getUTCMonth(),h.getUTCDate(),h.getUTCHours(),h.getUTCMinutes(),h.getUTCSeconds(),h.getUTCMilliseconds()).toLocaleString(n,s)}(t,s,this.Ci.locale)},t.prototype.Gn=function(t){var i=this.kn;this.kn=t,Wt(i._n(),this.kn._n())||this.Sn.Rt(),Wt(i.wn(),this.kn.wn())||this.Nn.Rt(),this.Jn()},t.prototype.Jn=function(){this.Tn=null},t.prototype.En=function(){this.Jn(),this.yn.clear()},t.prototype.Fn=function(){var t=this.Ci.dateFormat;this.kt.timeVisible?this.$n=new Ft({Ii:t,Ui:this.kt.secondsVisible?"%h:%m:%s":"%h:%m",ji:"   ",qi:this.Ci.locale}):this.$n=new Bt(t,this.Ci.locale)},t.prototype.On=function(){if(this.kt.fixLeftEdge){var t=this.Wn();if(null!==t){var i=this.visibleStrictRange();if(null!==i){var n=i.left()-t;if(n<0){var s=this.An-n-1;this.setRightOffset(s)}this.Rn()}}}},t.prototype.Pn=function(){this.In(),this.Rn()},t}();function qt(t){return!d(t)&&!w(t)}function Ht(t){return d(t)}!function(t){t.Solid="solid",t.VerticalGradient="gradient"}(Ut||(Ut={}));var Yt="'Trebuchet MS', Roboto, Ubuntu, sans-serif";function Kt(t,i,n){return void 0!==n?n+=" ":n="",void 0===i&&(i=Yt),""+n+t+"px "+i}var Xt=function(){function t(t){this.hs={borderSize:1,tickLength:4,fontSize:NaN,font:"",fontFamily:"",color:"",paddingBottom:0,paddingInner:0,paddingOuter:0,paddingTop:0,baselineOffset:0,width:0},this.N=t}return t.prototype.options=function(){var t=this.hs,i=this.rs(),n=this.es();return t.fontSize===i&&t.fontFamily===n||(t.fontSize=i,t.fontFamily=n,t.font=Kt(i,n),t.paddingTop=Math.floor(i/3.5),t.paddingBottom=t.paddingTop,t.paddingInner=Math.max(Math.ceil(i/2-t.tickLength/2),0),t.paddingOuter=Math.ceil(i/2+t.tickLength/2),t.baselineOffset=Math.round(i/10)),t.color=this.us(),t.width=this.bn(),this.hs},t.prototype.bn=function(){return this.N.options().rightPriceScale.width},t.prototype.us=function(){return this.N.options().layout.textColor},t.prototype.rs=function(){return this.N.options().layout.fontSize},t.prototype.es=function(){return this.N.options().layout.fontFamily},t}();function $t(t){return"left"===t||"right"===t}var Zt=function(){function t(t){this.os=new Map,this.ls=!1,this.fs=[],this.cs=t}return t.prototype.invalidatePane=function(t,i){var n=function(t,i){return void 0===t?i:{level:Math.max(t.level,i.level),autoScale:t.autoScale||i.autoScale}}(this.os.get(t),i);this.os.set(t,n)},t.prototype.fullInvalidation=function(){return this.cs},t.prototype.invalidateForPane=function(t){var i=this.os.get(t);return void 0===i?{level:this.cs}:{level:Math.max(this.cs,i.level),autoScale:i.autoScale}},t.prototype.setFitContent=function(){this.fs=[{type:0}]},t.prototype.applyRange=function(t){this.fs=[{type:1,value:t}]},t.prototype.resetTimeScale=function(){this.fs=[{type:4}]},t.prototype.setBarSpacing=function(t){this.fs.push({type:2,value:t})},t.prototype.setRightOffset=function(t){this.fs.push({type:3,value:t})},t.prototype.timeScaleInvalidations=function(){return this.fs},t.prototype.merge=function(t){var i=this;this.ls=this.ls||t.ls,this.fs=this.fs.concat(t.fs);for(var n=0,s=t.fs;n<s.length;n++){var h=s[n];this.vs(h)}this.cs=Math.max(this.cs,t.cs),t.os.forEach((function(t,n){i.invalidatePane(n,t)}))},t.prototype.vs=function(t){switch(t.type){case 0:this.setFitContent();break;case 1:this.applyRange(t.value);break;case 2:this.setBarSpacing(t.value);break;case 3:this.setRightOffset(t.value);break;case 4:this.resetTimeScale()}},t}(),Jt=function(){function t(t){this.ds=t}return t.prototype.format=function(t){var i="";return t<0&&(i="-",t=-t),t<995?i+this._s(t):t<999995?i+this._s(t/1e3)+"K":t<999999995?(t=1e3*Math.round(t/1e3),i+this._s(t/1e6)+"M"):(t=1e6*Math.round(t/1e6),i+this._s(t/1e9)+"B")},t.prototype._s=function(t){var i=Math.pow(10,this.ds);return((t=Math.round(t*i)/i)>=1e-15&&t<1?t.toFixed(this.ds).replace(/\.?0+$/,""):String(t)).replace(/(\.[1-9]*)0+$/,(function(t,i){return i}))},t}();function Gt(t,i,n,s){if(0!==i.length){var h=s.from,r=i[h].x,e=i[h].y;if(t.moveTo(r,e),h++,1===n)for(;h<s.to;h++){var u=i[h],a=i[h-1].y;t.lineTo(u.x,a),t.lineTo(u.x,u.y)}else if(2===n)for(var o=!0;h<s.to;h++){null!==(u=i[h]).price?(o&&(t.moveTo(u.x,u.y),o=!1),t.lineTo(u.x,u.y)):o=!0}else for(;h<s.to;h++){u=i[h];t.lineTo(u.x,u.y)}}}var Qt=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.o=null,i}return e(i,t),i.prototype.l=function(t){this.o=t},i.prototype.h=function(t){if(null!==this.o&&0!==this.o._.length&&null!==this.o.v){if(t.lineCap="butt",t.lineJoin="round",t.lineWidth=this.o.R,s(t,this.o.U),t.lineWidth=1,t.beginPath(),1===this.o._.length){var i=this.o._[0],n=this.o.ws/2;t.moveTo(i.x-n,this.o.Ms),t.lineTo(i.x-n,i.y),t.lineTo(i.x+n,i.y),t.lineTo(i.x+n,this.o.Ms)}else t.moveTo(this.o._[this.o.v.from].x,this.o.Ms),t.lineTo(this.o._[this.o.v.from].x,this.o._[this.o.v.from].y),Gt(t,this.o._,this.o.bs,this.o.v),this.o.v.to>this.o.v.from&&(t.lineTo(this.o._[this.o.v.to-1].x,this.o.Ms),t.lineTo(this.o._[this.o.v.from].x,this.o.Ms));t.closePath(),t.fillStyle=this.gs(t),t.fill()}},i}(y),ti=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return e(i,t),i.prototype.gs=function(t){var i=this.o,n=t.createLinearGradient(0,0,0,i.ps);return n.addColorStop(0,i.ys),n.addColorStop(1,i.ks),n},i}(Qt),ii=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.o=null,i}return e(i,t),i.prototype.l=function(t){this.o=t},i.prototype.h=function(t){if(null!==this.o&&0!==this.o._.length&&null!==this.o.v){if(t.lineCap="butt",t.lineWidth=this.o.R,s(t,this.o.U),t.strokeStyle=this.Cs(t),t.lineJoin="round",t.beginPath(),1===this.o._.length){var i=this.o._[0];t.moveTo(i.x-this.o.ws/2,i.y),t.lineTo(i.x+this.o.ws/2,i.y)}else Gt(t,this.o._,this.o.bs,this.o.v);t.stroke()}},i}(y),ni=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return e(i,t),i.prototype.Cs=function(){return this.o.g},i}(ii);function si(t,i){return t.time<i}function hi(t,i){return t<i.time}function ri(t,i,n){var s=i.left(),h=i.right(),r=Et(t,s,si),e=Ot(t,h,hi);if(!n)return{from:r,to:e};var u=r,a=e;return r>0&&r<t.length&&t[r].time>=s&&(u=r-1),e>0&&e<t.length&&t[e-1].time<=h&&(a=e+1),{from:u,to:a}}var ei=function(){function t(t,i,n){this.Ss=!0,this.Ns=!0,this.xs=!0,this.Ds=[],this.Ts=null,this.Bs=t,this.As=i,this.Ls=n}return t.prototype.update=function(t){this.Ss=!0,"data"===t&&(this.Ns=!0),"options"===t&&(this.xs=!0)},t.prototype.Fs=function(){this.Ns&&(this.Es(),this.Ns=!1),this.Ss&&(this.Os(),this.Ss=!1),this.xs&&(this.Ps(),this.xs=!1)},t.prototype.Vs=function(){this.Ts=null},t.prototype.Os=function(){var t=this.Bs.priceScale(),i=this.As.timeScale();if(this.Vs(),!i.isEmpty()&&!t.isEmpty()){var n=i.visibleStrictRange();if(null!==n&&0!==this.Bs.bars().size()){var s=this.Bs.firstValue();null!==s&&(this.Ts=ri(this.Ds,n,this.Ls),this.Ws(t,i,s.value))}}},t}(),ui=function(t){function i(i,n){return t.call(this,i,n,!0)||this}return e(i,t),i.prototype.Ws=function(t,i,n){i.indexesToCoordinates(this.Ds,g(this.Ts)),t.pointsArrayToCoordinates(this.Ds,n,g(this.Ts))},i.prototype.zs=function(t,i){return{time:t,price:i,x:NaN,y:NaN}},i.prototype.Ps=function(){},i.prototype.Es=function(){var t=this,i=this.Bs.barColorer();this.Ds=this.Bs.bars().rows().map((function(n){var s=n.value[3];return t.Rs(n.index,s,i)}))},i}(ei),ai=function(t){function i(i,n){var s=t.call(this,i,n)||this;return s.q=new p,s.Is=new ti,s.Us=new ni,s.q.i([s.Is,s.Us]),s}return e(i,t),i.prototype.renderer=function(t,i){if(!this.Bs.visible())return null;var n=this.Bs.options();return this.Fs(),this.Is.l({bs:n.lineType,_:this.Ds,U:n.lineStyle,R:n.lineWidth,ys:n.topColor,ks:n.bottomColor,Ms:t,ps:t,v:this.Ts,ws:this.As.timeScale().barSpacing()}),this.Us.l({bs:n.lineType,_:this.Ds,g:n.lineColor,U:n.lineStyle,R:n.lineWidth,v:this.Ts,ws:this.As.timeScale().barSpacing()}),this.q},i.prototype.Rs=function(t,i){return this.zs(t,i)},i}(ui);var oi=function(){function t(){this.B=null,this.js=0,this.qs=0}return t.prototype.l=function(t){this.B=t},t.prototype.draw=function(t,i,n,s){if(null!==this.B&&0!==this.B.Hs.length&&null!==this.B.v){if(this.js=this.Ys(i),this.js>=2)Math.max(1,Math.floor(i))%2!=this.js%2&&this.js--;this.qs=this.B.Ks?Math.min(this.js,Math.floor(i)):this.js;for(var h=null,r=this.qs<=this.js&&this.B.Yn>=Math.floor(1.5*i),e=this.B.v.from;e<this.B.v.to;++e){var u=this.B.Hs[e];h!==u.I&&(t.fillStyle=u.I,h=u.I);var a=Math.floor(.5*this.qs),o=Math.round(u.x*i),l=o-a,f=this.qs,c=l+f-1,v=Math.min(u.highY,u.lowY),d=Math.max(u.highY,u.lowY),_=Math.round(v*i)-a,w=Math.round(d*i)+a,M=Math.max(w-_,this.qs);t.fillRect(l,_,f,M);var b=Math.ceil(1.5*this.js);if(r){if(this.B.Xs){var m=o-b,g=Math.max(_,Math.round(u.openY*i)-a),p=g+f-1;p>_+M-1&&(g=(p=_+M-1)-f+1),t.fillRect(m,g,l-m,p-g+1)}var y=o+b,k=Math.max(_,Math.round(u.closeY*i)-a),C=k+f-1;C>_+M-1&&(k=(C=_+M-1)-f+1),t.fillRect(c+1,k,y-c,C-k+1)}}}},t.prototype.Ys=function(t){var i=Math.floor(t);return Math.max(i,Math.floor(function(t,i){return Math.floor(.3*t*i)}(f(this.B).Yn,t)))},t}(),li=function(t){function i(i,n){return t.call(this,i,n,!1)||this}return e(i,t),i.prototype.Ws=function(t,i,n){i.indexesToCoordinates(this.Ds,g(this.Ts)),t.barPricesToCoordinates(this.Ds,n,g(this.Ts))},i.prototype.$s=function(t,i,n){return{time:t,open:i.value[0],high:i.value[1],low:i.value[2],close:i.value[3],x:NaN,openY:NaN,highY:NaN,lowY:NaN,closeY:NaN}},i.prototype.Es=function(){var t=this,i=this.Bs.barColorer();this.Ds=this.Bs.bars().rows().map((function(n){return t.Rs(n.index,n,i)}))},i}(ei),fi=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.q=new oi,i}return e(i,t),i.prototype.renderer=function(t,i){if(!this.Bs.visible())return null;var n=this.Bs.options();this.Fs();var s={Hs:this.Ds,Yn:this.As.timeScale().barSpacing(),Xs:n.openVisible,Ks:n.thinBars,v:this.Ts};return this.q.l(s),this.q},i.prototype.Ps=function(){var t=this;this.Ds.forEach((function(i){i.I=t.Bs.barColorer().barStyle(i.time).barColor}))},i.prototype.Rs=function(t,i,n){return u(u({},this.$s(t,i,n)),{I:n.barStyle(t).barColor})},i}(li),ci=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return e(i,t),i.prototype.gs=function(t){var i=this.o,n=t.createLinearGradient(0,0,0,i.ps),s=st(i.Ms/i.ps,0,1);return n.addColorStop(0,i.Zs),n.addColorStop(s,i.Js),n.addColorStop(s,i.Gs),n.addColorStop(1,i.Qs),n},i}(Qt),vi=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return e(i,t),i.prototype.Cs=function(t){var i=this.o,n=t.createLinearGradient(0,0,0,i.ps),s=st(i.Ms/i.ps,0,1);return n.addColorStop(0,i.ys),n.addColorStop(s,i.ys),n.addColorStop(s,i.ks),n.addColorStop(1,i.ks),n},i}(ii),di=function(t){function i(i,n){var s=t.call(this,i,n)||this;return s.th=new ci,s.ih=new vi,s.p=new p,s.p.i([s.th,s.ih]),s}return e(i,t),i.prototype.renderer=function(t,i){if(!this.Bs.visible())return null;var n=this.Bs.firstValue();if(null===n)return null;var s=this.Bs.options();this.Fs();var h=this.Bs.priceScale().priceToCoordinate(s.baseValue.price,n.value),r=this.As.timeScale().barSpacing();return this.th.l({_:this.Ds,Zs:s.topFillColor1,Js:s.topFillColor2,Gs:s.bottomFillColor1,Qs:s.bottomFillColor2,R:s.lineWidth,U:s.lineStyle,bs:0,Ms:h,ps:t,v:this.Ts,ws:r}),this.ih.l({_:this.Ds,ys:s.topLineColor,ks:s.bottomLineColor,R:s.lineWidth,U:s.lineStyle,bs:0,Ms:h,ps:t,v:this.Ts,ws:r}),this.p},i.prototype.Rs=function(t,i){return this.zs(t,i)},i}(ui),_i=function(){function t(){this.B=null,this.js=0}return t.prototype.l=function(t){this.B=t},t.prototype.draw=function(t,i,n,s){if(null!==this.B&&0!==this.B.Hs.length&&null!==this.B.v){if(this.js=function(t,i){if(t>=2.5&&t<=4)return Math.floor(3*i);var n=1-.2*Math.atan(Math.max(4,t)-4)/(.5*Math.PI),s=Math.floor(t*n*i),h=Math.floor(t*i),r=Math.min(s,h);return Math.max(Math.floor(i),r)}(this.B.Yn,i),this.js>=2)Math.floor(i)%2!=this.js%2&&this.js--;var h=this.B.Hs;this.B.nh&&this.sh(t,h,this.B.v,i),this.B.hh&&this.rh(t,h,this.B.v,this.B.Yn,i);var r=this.eh(i);(!this.B.hh||this.js>2*r)&&this.uh(t,h,this.B.v,i)}},t.prototype.sh=function(t,i,n,s){if(null!==this.B){var h="",r=Math.min(Math.floor(s),Math.floor(this.B.Yn*s));r=Math.max(Math.floor(s),Math.min(r,this.js));for(var e=Math.floor(.5*r),u=null,a=n.from;a<n.to;a++){var o=i[a];o.ah!==h&&(t.fillStyle=o.ah,h=o.ah);var l=Math.round(Math.min(o.openY,o.closeY)*s),f=Math.round(Math.max(o.openY,o.closeY)*s),c=Math.round(o.highY*s),v=Math.round(o.lowY*s),d=Math.round(s*o.x)-e,_=d+r-1;null!==u&&(d=Math.max(u+1,d),d=Math.min(d,_));var w=_-d+1;t.fillRect(d,c,w,l-c),t.fillRect(d,f+1,w,v-f),u=_}}},t.prototype.eh=function(t){var i=Math.floor(1*t);this.js<=2*i&&(i=Math.floor(.5*(this.js-1)));var n=Math.max(Math.floor(t),i);return this.js<=2*n?Math.max(Math.floor(t),Math.floor(1*t)):n},t.prototype.rh=function(t,i,n,s,h){if(null!==this.B)for(var r="",e=this.eh(h),u=null,a=n.from;a<n.to;a++){var o=i[a];o.oh!==r&&(t.fillStyle=o.oh,r=o.oh);var l=Math.round(o.x*h)-Math.floor(.5*this.js),f=l+this.js-1,c=Math.round(Math.min(o.openY,o.closeY)*h),v=Math.round(Math.max(o.openY,o.closeY)*h);if(null!==u&&(l=Math.max(u+1,l),l=Math.min(l,f)),this.B.Yn*h>2*e)W(t,l,c,f-l+1,v-c+1,e);else{var d=f-l+1;t.fillRect(l,c,d,v-c+1)}u=f}},t.prototype.uh=function(t,i,n,s){if(null!==this.B)for(var h="",r=this.eh(s),e=n.from;e<n.to;e++){var u=i[e],a=Math.round(Math.min(u.openY,u.closeY)*s),o=Math.round(Math.max(u.openY,u.closeY)*s),l=Math.round(u.x*s)-Math.floor(.5*this.js),f=l+this.js-1;if(u.I!==h){var c=u.I;t.fillStyle=c,h=c}this.B.hh&&(l+=r,a+=r,f-=r,o-=r),a>o||t.fillRect(l,a,f-l+1,o-a+1)}},t}(),wi=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.q=new _i,i}return e(i,t),i.prototype.renderer=function(t,i){if(!this.Bs.visible())return null;var n=this.Bs.options();this.Fs();var s={Hs:this.Ds,Yn:this.As.timeScale().barSpacing(),nh:n.wickVisible,hh:n.borderVisible,v:this.Ts};return this.q.l(s),this.q},i.prototype.Ps=function(){var t=this;this.Ds.forEach((function(i){var n=t.Bs.barColorer().barStyle(i.time);i.I=n.barColor,i.ah=n.barWickColor,i.oh=n.barBorderColor}))},i.prototype.Rs=function(t,i,n){var s=n.barStyle(t);return u(u({},this.$s(t,i,n)),{I:s.barColor,ah:s.barWickColor,oh:s.barBorderColor})},i}(li),Mi=function(){function t(){this.B=null,this.lh=[]}return t.prototype.l=function(t){this.B=t,this.lh=[]},t.prototype.draw=function(t,i,n,s){if(null!==this.B&&0!==this.B._.length&&null!==this.B.v){this.lh.length||this.fh(i);for(var h=Math.max(1,Math.floor(i)),r=Math.round(this.B.dh*i)-Math.floor(h/2),e=r+h,u=this.B.v.from;u<this.B.v.to;u++){var a=this.B._[u],o=this.lh[u-this.B.v.from],l=Math.round(a.y*i);t.fillStyle=a.I;var f=void 0,c=void 0;l<=r?(f=l,c=e):(f=r,c=l-Math.floor(h/2)+h),t.fillRect(o._h,f,o.wh-o._h+1,c-f)}}},t.prototype.fh=function(t){if(null!==this.B&&0!==this.B._.length&&null!==this.B.v){var i=Math.ceil(this.B.Yn*t)<=1?0:Math.max(1,Math.floor(t)),n=Math.round(this.B.Yn*t)-i;this.lh=new Array(this.B.v.to-this.B.v.from);for(var s=this.B.v.from;s<this.B.v.to;s++){var h,r=this.B._[s],e=Math.round(r.x*t),u=void 0,a=void 0;if(n%2)u=e-(h=(n-1)/2),a=e+h;else u=e-(h=n/2),a=e+h-1;this.lh[s-this.B.v.from]={_h:u,wh:a,Mh:e,bh:r.x*t,ot:r.time}}for(s=this.B.v.from+1;s<this.B.v.to;s++){var o=this.lh[s-this.B.v.from],l=this.lh[s-this.B.v.from-1];o.ot===l.ot+1&&(o._h-l.wh!==i+1&&(l.Mh>l.bh?l.wh=o._h-i-1:o._h=l.wh+i+1))}var f=Math.ceil(this.B.Yn*t);for(s=this.B.v.from;s<this.B.v.to;s++){(o=this.lh[s-this.B.v.from]).wh<o._h&&(o.wh=o._h);var c=o.wh-o._h+1;f=Math.min(c,f)}if(i>0&&f<4)for(s=this.B.v.from;s<this.B.v.to;s++){(c=(o=this.lh[s-this.B.v.from]).wh-o._h+1)>f&&(o.Mh>o.bh?o.wh-=1:o._h+=1)}}else this.lh=[]},t}();function bi(t){return{_:[],Yn:t,dh:NaN,v:null}}function mi(t,i,n){return{time:t,price:i,x:NaN,y:NaN,I:n}}var gi=function(t){function i(i,n){var s=t.call(this,i,n,!1)||this;return s.p=new p,s.mh=bi(0),s.q=new Mi,s}return e(i,t),i.prototype.renderer=function(t,i){return this.Bs.visible()?(this.Fs(),this.p):null},i.prototype.Es=function(){var t=this.As.timeScale().barSpacing();this.mh=bi(t);for(var i=0,n=0,s=this.Bs.options().color,h=0,r=this.Bs.bars().rows();h<r.length;h++){var e=r[h],u=e.value[3],a=void 0!==e.color?e.color:s,o=mi(e.index,u,a);++i<this.mh._.length?this.mh._[i]=o:this.mh._.push(o),this.Ds[n++]={time:e.index,x:0}}this.q.l(this.mh),this.p.i([this.q])},i.prototype.Ps=function(){},i.prototype.Vs=function(){t.prototype.Vs.call(this),this.mh.v=null},i.prototype.Ws=function(t,i,n){if(null!==this.Ts){var s=i.barSpacing(),h=f(i.visibleStrictRange()),r=t.priceToCoordinate(this.Bs.options().base,n);i.indexesToCoordinates(this.mh._),t.pointsArrayToCoordinates(this.mh._,n),this.mh.dh=r,this.mh.v=ri(this.mh._,h,!1),this.mh.Yn=s,this.q.l(this.mh)}},i}(ei),pi=function(t){function i(i,n){var s=t.call(this,i,n)||this;return s.Us=new ni,s}return e(i,t),i.prototype.renderer=function(t,i){if(!this.Bs.visible())return null;var n=this.Bs.options();this.Fs();var s={_:this.Ds,g:n.color,U:n.lineStyle,bs:n.lineType,R:n.lineWidth,v:this.Ts,ws:this.As.timeScale().barSpacing()};return this.Us.l(s),this.Us},i.prototype.Rs=function(t,i){return this.zs(t,i)},i}(ui),yi=/[2-9]/g,ki=function(){function t(t){void 0===t&&(t=50),this.Ji=new Map,this.gh=0,this.ph=Array.from(new Array(t))}return t.prototype.reset=function(){this.Ji.clear(),this.ph.fill(void 0)},t.prototype.measureText=function(t,i,n){var s=n||yi,h=String(i).replace(s,"0"),r=this.Ji.get(h);if(void 0===r){if(0===(r=t.measureText(h).width)&&0!==i.length)return 0;var e=this.ph[this.gh];void 0!==e&&this.Ji.delete(e),this.ph[this.gh]=h,this.gh=(this.gh+1)%this.ph.length,this.Ji.set(h,r)}return r},t}(),Ci=function(){function t(t){this.yh=null,this.hs=null,this.kh="right",this.bn=0,this.Ch=t}return t.prototype.Sh=function(t,i,n,s){this.yh=t,this.hs=i,this.bn=n,this.kh=s},t.prototype.draw=function(t,i){null!==this.hs&&null!==this.yh&&this.yh.draw(t,this.hs,this.Ch,this.bn,this.kh,i)},t}(),Si=function(){function t(t,i,n){this.Nh=t,this.Ch=new ki(50),this.xh=i,this.N=n,this.rs=-1,this.q=new Ci(this.Ch)}return t.prototype.renderer=function(t,i){var n=this.N.paneForSource(this.xh);if(null===n)return null;var s=n.isOverlay(this.xh)?n.defaultVisiblePriceScale():this.xh.priceScale();if(null===s)return null;var h=n.priceScalePosition(s);if("overlay"===h)return null;var r=this.N.priceAxisRendererOptions();return r.fontSize!==this.rs&&(this.rs=r.fontSize,this.Ch.reset()),this.q.Sh(this.Nh.paneRenderer(),r,i,h),this.q},t}(),Ni=function(){function t(){this.B=null}return t.prototype.l=function(t){this.B=t},t.prototype.draw=function(t,i,n,r){if(null!==this.B&&!1!==this.B.A){var e=Math.round(this.B.P*i);if(!(e<0||e>Math.ceil(this.B.Dh*i))){var u=Math.ceil(this.B.Th*i);t.lineCap="butt",t.strokeStyle=this.B.I,t.lineWidth=Math.floor(this.B.R*i),s(t,this.B.U),h(t,e,0,u)}}},t}(),xi=function(){function t(t){this.Bh={Th:0,Dh:0,P:0,I:"rgba(0, 0, 0, 0)",R:1,U:0,A:!1},this.Ah=new Ni,this.S=!0,this.Bs=t,this.As=t.model(),this.Ah.l(this.Bh)}return t.prototype.Y=function(){this.S=!0},t.prototype.renderer=function(t,i){return this.Bs.visible()?(this.S&&(this.Lh(t,i),this.S=!1),this.Ah):null},t}(),Di=function(t){function i(i){return t.call(this,i)||this}return e(i,t),i.prototype.Lh=function(t,i){this.Bh.A=!1;var n=this.Bs.priceScale(),s=n.mode().mode;if(2===s||3===s){var h=this.Bs.options();if(h.baseLineVisible&&this.Bs.visible()){var r=this.Bs.firstValue();null!==r&&(this.Bh.A=!0,this.Bh.P=n.priceToCoordinate(r.value,r.value),this.Bh.Th=i,this.Bh.Dh=t,this.Bh.I=h.baseLineColor,this.Bh.R=h.baseLineWidth,this.Bh.U=h.baseLineStyle)}}},i}(xi),Ti=function(){function t(){this.B=null}return t.prototype.l=function(t){this.B=t},t.prototype.Fh=function(){return this.B},t.prototype.draw=function(t,i,n,s){var h=this.B;if(null!==h){t.save();var r=Math.max(1,Math.floor(i)),e=r%2/2,u=Math.round(h.bh.x*i)+e,a=h.bh.y*i;t.fillStyle=h.Eh,t.beginPath();var o=Math.max(2,1.5*h.Oh)*i;t.arc(u,a,o,0,2*Math.PI,!1),t.fill(),t.fillStyle=h.Ph,t.beginPath(),t.arc(u,a,h.m*i,0,2*Math.PI,!1),t.fill(),t.lineWidth=r,t.strokeStyle=h.Vh,t.beginPath(),t.arc(u,a,h.m*i+r/2,0,2*Math.PI,!1),t.stroke(),t.restore()}},t}(),Bi=[{Wh:0,zh:.25,Rh:4,Ih:10,Uh:.25,jh:0,qh:.4,Hh:.8},{Wh:.25,zh:.525,Rh:10,Ih:14,Uh:0,jh:0,qh:.8,Hh:0},{Wh:.525,zh:1,Rh:14,Ih:14,Uh:0,jh:0,qh:0,Hh:0}];function Ai(t,i,n,s){return function(t,i){if("transparent"===t)return t;var n=P(t),s=n[3];return"rgba("+n[0]+", "+n[1]+", "+n[2]+", "+i*s+")"}(t,n+(s-n)*i)}function Li(t,i){for(var n,s=t%2600/2600,h=0,r=Bi;h<r.length;h++){var e=r[h];if(s>=e.Wh&&s<=e.zh){n=e;break}}o(void 0!==n,"Last price animation internal logic error");var u,a,l,f=(s-n.Wh)/(n.zh-n.Wh);return{Ph:Ai(i,f,n.Uh,n.jh),Vh:Ai(i,f,n.qh,n.Hh),m:(u=f,a=n.Rh,l=n.Ih,a+(l-a)*u)}}var Fi=function(){function t(t){this.q=new Ti,this.S=!0,this.Yh=!0,this.Kh=performance.now(),this.Xh=this.Kh-1,this.$h=t}return t.prototype.Zh=function(){this.Xh=this.Kh-1,this.update()},t.prototype.Jh=function(){if(this.update(),2===this.$h.options().lastPriceAnimation){var t=performance.now(),i=this.Xh-t;if(i>0)return void(i<650&&(this.Xh+=2600));this.Kh=t,this.Xh=t+2600}},t.prototype.update=function(){this.S=!0},t.prototype.Gh=function(){this.Yh=!0},t.prototype.A=function(){return 0!==this.$h.options().lastPriceAnimation},t.prototype.Qh=function(){switch(this.$h.options().lastPriceAnimation){case 0:return!1;case 1:return!0;case 2:return performance.now()<=this.Xh}},t.prototype.renderer=function(t,i){return this.S?(this.T(t,i),this.S=!1,this.Yh=!1):this.Yh&&(this.tr(),this.Yh=!1),this.q},t.prototype.T=function(t,i){this.q.l(null);var n=this.$h.model().timeScale(),s=n.visibleStrictRange(),h=this.$h.firstValue();if(null!==s&&null!==h){var r=this.$h.lastValueData(!0);if(!r.noData&&s.contains(r.index)){var e={x:n.indexToCoordinate(r.index),y:this.$h.priceScale().priceToCoordinate(r.price,h.value)},u=r.color,a=this.$h.options().lineWidth,o=Li(this.ir(),u);this.q.l({Eh:u,Oh:a,Ph:o.Ph,Vh:o.Vh,m:o.m,bh:e})}}},t.prototype.tr=function(){var t=this.q.Fh();if(null!==t){var i=Li(this.ir(),t.Eh);t.Ph=i.Ph,t.Vh=i.Vh,t.m=i.m}},t.prototype.ir=function(){return this.Qh()?performance.now()-this.Kh:2599},t}();function Ei(t,i){return ut(Math.min(Math.max(t,12),30)*i)}function Oi(t,i){switch(t){case"arrowDown":case"arrowUp":return Ei(i,1);case"circle":return Ei(i,.8);case"square":return Ei(i,.7);case"triangleDown":case"triangleUp":return Ei(i,.7)}}function Pi(t){return et(Ei(t,1))}function Vi(t){return Math.max(Ei(t,.1),3)}function Wi(t,i,n,s,h){var r=Oi("square",n),e=(r-1)/2,u=t-e,a=i-e;return s>=u&&s<=u+r&&h>=a&&h<=a+r}function zi(t,i,n,s,h,r,e){var u=i.fillStyle,a=(Oi("arrowUp",h)-1)/2,o=(ut(h/2)-1)/2;if(e&&(i.fillStyle=e),i.beginPath(),t?(i.moveTo(n-a,s),i.lineTo(n,s-a),i.lineTo(n+a,s),i.lineTo(n+o,s),i.lineTo(n+o,s+a),i.lineTo(n-o,s+a),i.lineTo(n-o,s)):(i.moveTo(n-a,s),i.lineTo(n,s+a),i.lineTo(n+a,s),i.lineTo(n+o,s),i.lineTo(n+o,s-a),i.lineTo(n-o,s-a),i.lineTo(n-o,s)),e){var l=r||2,f=2*l;i.fill(),i.beginPath(),i.fillStyle=u,t?(i.moveTo(n-a+f,s-l),i.lineTo(n,s-a+l),i.lineTo(n+a-f,s-l),i.lineTo(n+o-l,s-l),i.lineTo(n+o-l,s+a-l),i.lineTo(n-o+l,s+a-l),i.lineTo(n-o+l,s-l)):(i.moveTo(n-a+f,s+l),i.lineTo(n,s+a-l),i.lineTo(n+a-f,s+l),i.lineTo(n+o-l,s+l),i.lineTo(n+o-l,s-a+l),i.lineTo(n-o+l,s-a+l),i.lineTo(n-o+l,s+l))}i.fill()}function Ri(t,i,n,s,h,r){return Wi(i,n,s,h,r)}function Ii(t,i,n,s,h,r,e){var u=i.fillStyle,a=(Oi("triangleUp",h)-1)/2,o=n-a,l=n+a,f=s-a,c=s+a;if(i.beginPath(),e&&(i.fillStyle=e),t?(i.moveTo(o,c),i.lineTo(n,f),i.lineTo(l,c)):(i.moveTo(o,f),i.lineTo(n,c),i.lineTo(l,f)),e){var v=r||2,d=2*v;i.fill(),i.beginPath(),i.fillStyle=u,t?(i.moveTo(o+v,c-v),i.lineTo(n,f+d),i.lineTo(l-v,c-v)):(i.moveTo(o+v,f+v),i.lineTo(n,c-d),i.lineTo(l-v,f+v))}i.fill()}function Ui(t,i,n,s,h,r){return Wi(i,n,s,h,r)}var ji=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.B=null,i.Ch=new ki,i.rs=-1,i.es="",i.nr="",i}return e(i,t),i.prototype.l=function(t){this.B=t},i.prototype.Sh=function(t,i){this.rs===t&&this.es===i||(this.rs=t,this.es=i,this.nr=Kt(t,i),this.Ch.reset())},i.prototype.hitTest=function(t,i){if(null===this.B||null===this.B.v)return null;for(var n=this.B.v.from;n<this.B.v.to;n++){var s=this.B._[n];if(Hi(s,t,i))return{hitTestData:s.sr,externalId:s.hr}}return null},i.prototype.h=function(t,i,n){if(null!==this.B&&null!==this.B.v){t.textBaseline="middle",t.font=this.nr;for(var s=this.B.v.from;s<this.B.v.to;s++){var h=this.B._[s];void 0!==h.rr&&(h.rr.Th=this.Ch.measureText(t,h.rr.er),h.rr.Dh=this.rs),qi(h,t)}}},i}(y);function qi(t,i){i.fillStyle=t.I,void 0!==t.rr&&function(t,i,n,s){t.fillText(i,n,s)}(i,t.rr.er,t.x-t.rr.Th/2,t.rr.P),function(t,i){if(0===t.ur)return;switch(t.ar){case"arrowDown":return void zi(!1,i,t.x,t.P,t.ur,t.lr,t.oh);case"arrowUp":return void zi(!0,i,t.x,t.P,t.ur,t.lr,t.oh);case"triangleDown":return void Ii(!1,i,t.x,t.P,t.ur,t.lr,t.oh);case"triangleUp":return void Ii(!0,i,t.x,t.P,t.ur,t.lr,t.oh);case"circle":return void function(t,i,n,s,h,r){var e=t.fillStyle,u=(Oi("circle",s)-1)/2;if(r&&(t.fillStyle=r),t.beginPath(),t.arc(i,n,u,0,2*Math.PI,!1),r){var a=h||2;t.fill(),t.beginPath(),t.fillStyle=e,t.arc(i,n,u-a,0,2*Math.PI,!1)}t.fill()}(i,t.x,t.P,t.ur,t.lr,t.oh);case"square":return void function(t,i,n,s,h,r){var e=t.fillStyle,u=Oi("square",s),a=(u-1)/2,o=i-a,l=n-a;if(r&&(t.fillStyle=r),t.fillRect(o,l,u,u),r){var f=h||2,c=2*f;t.fillStyle=e,t.fillRect(o+f,l+f,u-c,u-c)}}(i,t.x,t.P,t.ur,t.lr,t.oh)}t.ar}(t,i)}function Hi(t,i,n){return!(void 0===t.rr||!function(t,i,n,s,h,r){var e=s/2;return h>=t&&h<=t+n&&r>=i-e&&r<=i+e}(t.x,t.rr.P,t.rr.Th,t.rr.Dh,i,n))||function(t,i,n){if(0===t.ur)return!1;switch(t.ar){case"arrowUp":case"arrowDown":return Ri(0,t.x,t.P,t.ur,i,n);case"triangleUp":case"triangleDown":return Ui(0,t.x,t.P,t.ur,i,n);case"circle":return function(t,i,n,s,h){var r=2+Oi("circle",n)/2,e=t-s,u=i-h;return Math.sqrt(e*e+u*u)<=r}(t.x,t.P,t.ur,i,n);case"square":return Wi(t.x,t.P,t.ur,i,n)}}(t,i,n)}function Yi(t,i,n,s,h,r,e,u,a){var o=d(n)?n:n.close,l=d(n)?n:n.high,f=d(n)?n:n.low,c=d(i.size)?Math.max(i.size,0):1,v=Pi(u.barSpacing())*c,_=v/2;if(t.ur=v,"number"==typeof i.position)return t.P=e.priceToCoordinate(i.position,a),void(void 0!==t.rr&&(t.rr.P=t.P+_+r+.6*h));switch(i.position){case"inBar":return t.P=e.priceToCoordinate(o,a),void(void 0!==t.rr&&(t.rr.P=t.P+_+r+.6*h));case"aboveBar":return t.P=e.priceToCoordinate(l,a)-_-s.cr,void 0!==t.rr&&(t.rr.P=t.P-_-.6*h,s.cr+=1.2*h),void(s.cr+=v+r);case"belowBar":return t.P=e.priceToCoordinate(f,a)+_+s.vr,void 0!==t.rr&&(t.rr.P=t.P+_+r+.6*h,s.vr+=1.2*h),void(s.vr+=v+r)}i.position}var Ki=function(){function t(t,i){this.S=!0,this.dr=!0,this._r=!0,this.wr=null,this.q=new ji,this.$h=t,this.at=i,this.B={_:[],v:null}}return t.prototype.update=function(t){this.S=!0,this._r=!0,"data"===t&&(this.dr=!0)},t.prototype.renderer=function(t,i,n){if(!this.$h.visible())return null;this.S&&this.Fs();var s=this.at.options().layout;return this.q.Sh(s.fontSize,s.fontFamily),this.q.l(this.B),this.q},t.prototype.Mr=function(){if(this._r){if(this.$h.indexedMarkers().length>0){var t=this.at.timeScale().barSpacing(),i=Vi(t),n=1.5*Pi(t)+2*i;this.wr={above:n,below:n}}else this.wr=null;this._r=!1}return this.wr},t.prototype.Fs=function(){var t=this.$h.priceScale(),i=this.at.timeScale(),n=this.$h.indexedMarkers();this.dr&&(this.B._=n.map((function(t){return{time:t.time,x:0,P:0,ur:0,ar:t.shape,I:t.color,sr:t.internalId,hr:t.id,rr:void 0,oh:t.borderColor,lr:t.borderSize}})),this.dr=!1);var s=this.at.options().layout;this.B.v=null;var h=i.visibleStrictRange();if(null!==h){var r=this.$h.firstValue();if(null!==r&&0!==this.B._.length){var e=NaN,u=Vi(i.barSpacing()),a={cr:u,vr:u};this.B.v=ri(this.B._,h,!0);for(var o=this.B.v.from;o<this.B.v.to;o++){var l=n[o];l.time!==e&&(a.cr=u,a.vr=u,e=l.time);var f=this.B._[o];f.x=i.indexToCoordinate(l.time),void 0!==l.text&&l.text.length>0&&(f.rr={er:l.text,P:0,Th:0,Dh:0});var c=this.$h.dataAt(l.time);null!==c&&Yi(f,l,c,a,s.fontSize,u,t,i,r.value)}this.S=!1}}},t}(),Xi=function(t){function i(i){return t.call(this,i)||this}return e(i,t),i.prototype.Lh=function(t,i){var n=this.Bh;n.A=!1;var s=this.Bs.options();if(s.priceLineVisible&&this.Bs.visible()){var h=this.Bs.lastValueData(0===s.priceLineSource);h.noData||(n.A=!0,n.P=h.coordinate,n.I=this.Bs.priceLineColor(h.color),n.Th=i,n.Dh=t,n.R=s.priceLineWidth,n.U=s.priceLineStyle)}},i}(xi),$i=function(t){function i(i){var n=t.call(this)||this;return n.H=i,n}return e(i,t),i.prototype.st=function(t,i,n){t.visible=!1,i.visible=!1;var s=this.H;if(s.visible()){var h=s.options(),r=h.lastValueVisible,e=""!==s.title(),u=0===h.seriesLastValueMode,a=s.lastValueData(0===h.priceLineSource);if(!a.noData){r&&(t.text=this.br(a,r,u),t.visible=0!==t.text.length),(e||u)&&(i.text=this.mr(a,r,e,u),i.visible=i.text.length>0);var o=s.priceLineColor(a.color),l=V(o);n.background=l.K,n.color=l.X,n.coordinate=a.coordinate,i.borderColor=s.model().backgroundColorAtYPercentFromTop(a.coordinate/s.priceScale().height()),t.borderColor=o}}},i.prototype.mr=function(t,i,n,s){var h="",r=this.H.title();return n&&0!==r.length&&(h+=r+" "),i&&s&&(h+=this.H.priceScale().isPercentage()?t.formattedPriceAbsolute:t.formattedPricePercentage),h.trim()},i.prototype.br=function(t,i,n){return i?n?this.H.priceScale().isPercentage()?t.formattedPricePercentage:t.formattedPriceAbsolute:t.text:""},i}(q),Zi=function(){function t(t,i){this.ei=t,this.gr=i||null}return t.prototype.priceRange=function(){return this.ei},t.prototype.margins=function(){return this.gr},t.prototype.toRaw=function(){return null===this.ei?null:{priceRange:this.ei.toRaw(),margins:this.gr||void 0}},t.fromRaw=function(i){return null===i?null:new t(nt.fromRaw(i.priceRange),i.margins)},t}(),Ji=function(t){function i(i,n){var s=t.call(this,i)||this;return s.pr=n,s}return e(i,t),i.prototype.Lh=function(t,i){var n=this.Bh;if(n.A=!1,this.Bs.visible()){var s=this.pr.yCoord();if(null!==s){var h=this.pr.options();n.A=!0,n.P=s,n.I=h.color,n.Th=i,n.Dh=t,n.R=h.lineWidth,n.U=h.lineStyle}}},i}(xi),Gi=function(t){function i(i,n){var s=t.call(this)||this;return s.$h=i,s.pr=n,s}return e(i,t),i.prototype.st=function(t,i,n){t.visible=!1,i.visible=!1;var s=this.pr.options(),h=s.axisLabelVisible,r=""!==s.title,e=this.$h;if(h&&e.visible()){var u=this.pr.yCoord();if(null!==u){r&&(i.text=s.title,i.visible=!0),i.borderColor=e.model().backgroundColorAtYPercentFromTop(u/e.priceScale().height()),t.text=e.priceScale().formatPriceAbsolute(s.price),t.visible=!0;var a=V(s.color);n.background=a.K,n.color=a.X,n.coordinate=u}}},i}(q),Qi=function(){function t(t,i){this.$h=t,this.kt=i,this.yr=new Ji(t,this),this.Nh=new Gi(t,this),this.kr=new Si(this.Nh,t,t.model())}return t.prototype.applyOptions=function(t){v(this.kt,t),this.update(),this.$h.model().lightUpdate()},t.prototype.options=function(){return this.kt},t.prototype.series=function(){return this.$h},t.prototype.paneViews=function(){return[this.yr,this.kr]},t.prototype.priceAxisView=function(){return this.Nh},t.prototype.update=function(){this.yr.Y(),this.Nh.update()},t.prototype.yCoord=function(){var t=this.$h,i=t.priceScale();if(t.model().timeScale().isEmpty()||i.isEmpty())return null;var n=t.firstValue();return null===n?null:i.priceToCoordinate(this.kt.price,n.value)},t}(),tn=function(t){function i(i){var n=t.call(this)||this;return n.at=i,n}return e(i,t),i.prototype.model=function(){return this.at},i}($),nn={barColor:"",barBorderColor:"",barWickColor:""},sn=function(){function t(t){this.$h=t}return t.prototype.barStyle=function(t,i){var n=this.$h.seriesType(),s=this.$h.options();switch(n){case"Line":return this.Cr(s);case"Area":return this.Sr(s);case"Baseline":return this.Nr(s,t,i);case"Bar":return this.Dr(s,t,i);case"Candlestick":return this.Tr(s,t,i);case"Histogram":return this.Br(s,t,i)}throw new Error("Unknown chart style")},t.prototype.Dr=function(t,i,n){var s=u({},nn),h=t.upColor,r=t.downColor,e=h,a=r,o=f(this.Ar(i,n)),l=c(o.value[0])<=c(o.value[3]);return s.barColor=l?h:r,s.barBorderColor=l?e:a,s},t.prototype.Tr=function(t,i,n){var s=u({},nn),h=t.upColor,r=t.downColor,e=t.borderUpColor,a=t.borderDownColor,o=t.wickUpColor,l=t.wickDownColor,v=f(this.Ar(i,n)),d=c(v.value[0])<=c(v.value[3]);return s.barColor=d?h:r,s.barBorderColor=d?e:a,s.barWickColor=d?o:l,s},t.prototype.Sr=function(t){return u(u({},nn),{barColor:t.lineColor})},t.prototype.Nr=function(t,i,n){var s=f(this.Ar(i,n)).value[3]>=t.baseValue.price;return u(u({},nn),{barColor:s?t.topLineColor:t.bottomLineColor})},t.prototype.Cr=function(t){return u(u({},nn),{barColor:t.color})},t.prototype.Br=function(t,i,n){var s=u({},nn),h=f(this.Ar(i,n));return s.barColor=void 0!==h.color?h.color:t.color,s},t.prototype.Ar=function(t,i){return void 0!==i?i.value:this.$h.bars().valueAt(t)},t}(),hn=function(){function t(){this.Lr=[],this.Fr=new Map,this.Er=new Map}return t.prototype.last=function(){return this.size()>0?this.Lr[this.Lr.length-1]:null},t.prototype.firstIndex=function(){return this.size()>0?this.Or(0):null},t.prototype.lastIndex=function(){return this.size()>0?this.Or(this.Lr.length-1):null},t.prototype.size=function(){return this.Lr.length},t.prototype.isEmpty=function(){return 0===this.size()},t.prototype.contains=function(t){return null!==this.Pr(t,0)},t.prototype.valueAt=function(t){return this.search(t)},t.prototype.search=function(t,i){void 0===i&&(i=0);var n=this.Pr(t,i);return null===n?null:u(u({},this.Vr(n)),{index:this.Or(n)})},t.prototype.rows=function(){return this.Lr},t.prototype.minMaxOnRangeCached=function(t,i,n){if(this.isEmpty())return null;for(var s=null,h=0,r=n;h<r.length;h++){var e=r[h];s=rn(s,this.Wr(t,i,e))}return s},t.prototype.setData=function(t){this.Er.clear(),this.Fr.clear(),this.Lr=t},t.prototype.Or=function(t){return this.Lr[t].index},t.prototype.Vr=function(t){return this.Lr[t]},t.prototype.Pr=function(t,i){var n=this.zr(t);if(null===n&&0!==i)switch(i){case-1:return this.Rr(t);case 1:return this.Ir(t);default:throw new TypeError("Unknown search mode")}return n},t.prototype.Rr=function(t){var i=this.Ur(t);return i>0&&(i-=1),i!==this.Lr.length&&this.Or(i)<t?i:null},t.prototype.Ir=function(t){var i=this.jr(t);return i!==this.Lr.length&&t<this.Or(i)?i:null},t.prototype.zr=function(t){var i=this.Ur(t);return i===this.Lr.length||t<this.Lr[i].index?null:i},t.prototype.Ur=function(t){return Et(this.Lr,t,(function(t,i){return t.index<i}))},t.prototype.jr=function(t){return Ot(this.Lr,t,(function(t,i){return i.index>t}))},t.prototype.qr=function(t,i,n){for(var s=null,h=t;h<i;h++){var r=this.Lr[h].value[n];Number.isNaN(r)||null===r||(null===s?s={min:r,max:r}:(r<s.min&&(s.min=r),r>s.max&&(s.max=r)))}return s},t.prototype.Wr=function(t,i,n){if(this.isEmpty())return null;var s=null,h=f(this.firstIndex()),r=f(this.lastIndex()),e=Math.max(t,h),u=Math.min(i,r),a=30*Math.ceil(e/30),o=Math.max(a,30*Math.floor(u/30)),l=this.Ur(e),c=this.jr(Math.min(u,a,i));s=rn(s,this.qr(l,c,n));var v=this.Fr.get(n);void 0===v&&(v=new Map,this.Fr.set(n,v));for(var d=Math.max(a+1,e);d<o;d+=30){var _=Math.floor(d/30),w=v.get(_);if(void 0===w){var M=this.Ur(30*_),b=this.jr(30*(_+1)-1);w=this.qr(M,b,n),v.set(_,w)}s=rn(s,w)}l=this.Ur(o),c=this.jr(u);return s=rn(s,this.qr(l,c,n))},t}();function rn(t,i){return null===t?i:null===i?t:{min:Math.min(t.min,i.min),max:Math.max(t.max,i.max)}}var en=function(t){function i(i,n,s){var h=t.call(this,i)||this;h.B=new hn,h.yr=new Xi(h),h.Hr=[],h.Yr=new Di(h),h.Kr=null,h.Xr=null,h.$r=[],h.Zr=[],h.Jr=null,h.kt=n,h.Gr=s;var r=new $i(h);return h._t=[r],h.kr=new Si(r,h,i),"Area"!==s&&"Line"!==s&&"Baseline"!==s||(h.Kr=new Fi(h)),h.Qr(),h.te(),h}return e(i,t),i.prototype.destroy=function(){null!==this.Jr&&clearTimeout(this.Jr)},i.prototype.priceLineColor=function(t){return this.kt.priceLineColor||t},i.prototype.lastValueData=function(t){var i={noData:!0},n=this.priceScale();if(this.model().timeScale().isEmpty()||n.isEmpty()||this.B.isEmpty())return i;var s,h,r=this.model().timeScale().visibleStrictRange(),e=this.firstValue();if(null===r||null===e)return i;if(t){var u=this.B.last();if(null===u)return i;s=u,h=u.index}else{var a=this.B.search(r.right(),-1);if(null===a)return i;if(null===(s=this.B.valueAt(a.index)))return i;h=a.index}var o=s.value[3],l=this.barColorer().barStyle(h,{value:s}),f=n.priceToCoordinate(o,e.value);return{noData:!1,price:o,text:n.formatPrice(o,e.value),formattedPriceAbsolute:n.formatPriceAbsolute(o),formattedPricePercentage:n.formatPricePercentage(o,e.value),color:l.barColor,coordinate:f,index:h}},i.prototype.barColorer=function(){return null!==this.Xr||(this.Xr=new sn(this)),this.Xr},i.prototype.options=function(){return this.kt},i.prototype.applyOptions=function(t){var i=t.priceScaleId;void 0!==i&&i!==this.kt.priceScaleId&&this.model().moveSeriesToScale(this,i),v(this.kt,t),null!==this._priceScale&&void 0!==t.scaleMargins&&this._priceScale.applyOptions({scaleMargins:t.scaleMargins}),void 0!==t.priceFormat&&this.Qr(),this.model().updateSource(this),this.model().updateCrosshair(),this.xt.update("options")},i.prototype.setData=function(t,i){this.B.setData(t),this.ie(),this.xt.update("data"),this.Ct.update("data"),null!==this.Kr&&(i&&i.lastBarUpdatedOrNewBarsAddedToTheRight?this.Kr.Jh():0===t.length&&this.Kr.Zh());var n=this.model().paneForSource(this);this.model().recalculatePane(n),this.model().updateSource(this),this.model().updateCrosshair(),this.model().lightUpdate()},i.prototype.setMarkers=function(t){this.$r=t.map((function(t){return u({},t)})),this.ie();var i=this.model().paneForSource(this);this.Ct.update("data"),this.model().recalculatePane(i),this.model().updateSource(this),this.model().updateCrosshair(),this.model().lightUpdate()},i.prototype.indexedMarkers=function(){return this.Zr},i.prototype.createPriceLine=function(t){var i=new Qi(this,t);return this.Hr.push(i),this.model().updateSource(this),i},i.prototype.removePriceLine=function(t){var i=this.Hr.indexOf(t);-1!==i&&this.Hr.splice(i,1),this.model().updateSource(this)},i.prototype.customPriceLines=function(){return this.Hr},i.prototype.seriesType=function(){return this.Gr},i.prototype.firstValue=function(){var t=this.firstBar();return null===t?null:{value:t.value[3],timePoint:t.time}},i.prototype.firstBar=function(){var t=this.model().timeScale().visibleStrictRange();if(null===t)return null;var i=t.left();return this.B.search(i,1)},i.prototype.bars=function(){return this.B},i.prototype.dataAt=function(t){var i=this.B.valueAt(t);return null===i?null:"Bar"===this.Gr||"Candlestick"===this.Gr?{open:i.value[0],high:i.value[1],low:i.value[2],close:i.value[3]}:i.value[3]},i.prototype.topPaneViews=function(t){var i=this,n=this.Kr;return null!==n&&n.A()?(null===this.Jr&&n.Qh()&&(this.Jr=setTimeout((function(){i.Jr=null,i.model().cursorUpdate()}),0)),n.Gh(),[n]):[]},i.prototype.paneViews=function(){var t=[];this.ne()||t.push(this.Yr);for(var i=0,n=this.Hr;i<n.length;i++){var s=n[i];t.push.apply(t,s.paneViews())}return t.push(this.xt,this.yr,this.kr,this.Ct),t},i.prototype.priceAxisViews=function(t,i){if(i!==this._priceScale&&!this.ne())return[];for(var n=a([],this._t),s=0,h=this.Hr;s<h.length;s++){var r=h[s];n.push(r.priceAxisView())}return n},i.prototype.autoscaleInfo=function(t,i){var n=this;if(void 0!==this.kt.autoscaleInfoProvider){var s=this.kt.autoscaleInfoProvider((function(){var s=n.se(t,i);return null===s?null:s.toRaw()}));return Zi.fromRaw(s)}return this.se(t,i)},i.prototype.minMove=function(){return this.kt.priceFormat.minMove},i.prototype.formatter=function(){return this.gi},i.prototype.updateAllViews=function(){var t;this.xt.update(),this.Ct.update();for(var i=0,n=this._t;i<n.length;i++){n[i].update()}for(var s=0,h=this.Hr;s<h.length;s++){h[s].update()}this.yr.Y(),this.Yr.Y(),null===(t=this.Kr)||void 0===t||t.update()},i.prototype.priceScale=function(){return f(t.prototype.priceScale.call(this))},i.prototype.markerDataAtIndex=function(t){if(!(("Line"===this.Gr||"Area"===this.Gr||"Baseline"===this.Gr)&&this.kt.crosshairMarkerVisible))return null;var i=this.B.valueAt(t);return null===i?null:{price:i.value[3],radius:this.he(),borderColor:this.re(),backgroundColor:this.ee(t)}},i.prototype.title=function(){return this.kt.title},i.prototype.visible=function(){return this.kt.visible},i.prototype.ne=function(){return!$t(this.priceScale().id())},i.prototype.se=function(t,i){if(!_(t)||!_(i)||this.B.isEmpty())return null;var n="Line"===this.Gr||"Area"===this.Gr||"Baseline"===this.Gr||"Histogram"===this.Gr?[3]:[2,1],s=this.B.minMaxOnRangeCached(t,i,n),h=null!==s?new nt(s.min,s.max):null;if("Histogram"===this.seriesType()){var r=this.kt.base,e=new nt(r,r);h=null!==h?h.merge(e):e}return new Zi(h,this.Ct.Mr())},i.prototype.he=function(){switch(this.Gr){case"Line":case"Area":case"Baseline":return this.kt.crosshairMarkerRadius}return 0},i.prototype.re=function(){switch(this.Gr){case"Line":case"Area":case"Baseline":var t=this.kt.crosshairMarkerBorderColor;if(0!==t.length)return t}return null},i.prototype.ee=function(t){switch(this.Gr){case"Line":case"Area":case"Baseline":var i=this.kt.crosshairMarkerBackgroundColor;if(0!==i.length)return i}return this.barColorer().barStyle(t).barColor},i.prototype.Qr=function(){switch(this.kt.priceFormat.type){case"custom":this.gi={format:this.kt.priceFormat.formatter};break;case"volume":this.gi=new Jt(this.kt.priceFormat.precision);break;case"percent":this.gi=new tt(this.kt.priceFormat.precision);break;default:var t=Math.pow(10,this.kt.priceFormat.precision);this.gi=new Q(t,this.kt.priceFormat.minMove*t)}null!==this._priceScale&&this._priceScale.updateFormatter()},i.prototype.ie=function(){var t=this,i=this.model().timeScale();if(i.isEmpty()||0===this.B.size())this.Zr=[];else{var n=f(this.B.firstIndex());this.Zr=this.$r.map((function(s,h){var r=f(i.timeToIndex(s.time,!0)),e=r<n?1:-1;return{time:f(t.B.search(r,e)).index,position:s.position,shape:s.shape,color:s.color,id:s.id,internalId:h,text:s.text,size:s.size,borderColor:s.borderColor,borderSize:s.borderSize}}))}},i.prototype.te=function(){switch(this.Ct=new Ki(this,this.model()),this.Gr){case"Bar":this.xt=new fi(this,this.model());break;case"Candlestick":this.xt=new wi(this,this.model());break;case"Line":this.xt=new pi(this,this.model());break;case"Area":this.xt=new ai(this,this.model());break;case"Baseline":this.xt=new di(this,this.model());break;case"Histogram":this.xt=new gi(this,this.model());break;default:throw Error("Unknown chart style assigned: "+this.Gr)}},i}(tn),un=function(){function t(t){this.kt=t}return t.prototype.ue=function(t,i,n){var s=t;if(0===this.kt.mode)return s;var h=n.defaultPriceScale(),r=h.firstValue();if(null===r)return s;var e=h.priceToCoordinate(t,r),u=n.dataSources().filter((function(t){return t instanceof en})).reduce((function(t,s){if(n.isOverlay(s)||!s.visible())return t;var h=s.priceScale(),r=s.bars();if(h.isEmpty()||!r.contains(i))return t;var e=r.valueAt(i);if(null===e)return t;var u=c(s.firstValue());return t.concat([h.priceToCoordinate(e.value[3],u.value)])}),[]);if(0===u.length)return s;u.sort((function(t,i){return Math.abs(t-e)-Math.abs(i-e)}));var a=u[0];return s=h.coordinateToPrice(a,r)},t}(),an=function(){function t(){this.B=null}return t.prototype.l=function(t){this.B=t},t.prototype.draw=function(t,i,n,h){var r=this;if(null!==this.B){var e=Math.max(1,Math.floor(i));t.lineWidth=e;var u=Math.ceil(this.B.W*i),a=Math.ceil(this.B.V*i);!function(t,i){t.save(),t.lineWidth%2&&t.translate(.5,.5),i(),t.restore()}(t,(function(){var n=f(r.B);if(n.ae){t.strokeStyle=n.oe,s(t,n.le),t.beginPath();for(var h=0,o=n.fe;h<o.length;h++){var l=o[h],c=Math.round(l.ce*i);t.moveTo(c,-e),t.lineTo(c,u+e)}t.stroke()}if(n.ve){t.strokeStyle=n.de,s(t,n._e),t.beginPath();for(var v=0,d=n.we;v<d.length;v++){var _=d[v],w=Math.round(_.coord*i);t.moveTo(-e,w),t.lineTo(a+e,w)}t.stroke()}}))}},t}(),on=function(){function t(t){this.q=new an,this.S=!0,this.ft=t}return t.prototype.update=function(){this.S=!0},t.prototype.renderer=function(t,i){if(this.S){var n=this.ft.model().options().grid,s={W:t,V:i,ve:n.horzLines.visible,ae:n.vertLines.visible,de:n.horzLines.color,oe:n.vertLines.color,_e:n.horzLines.style,le:n.vertLines.style,we:this.ft.defaultPriceScale().marks(),fe:this.ft.model().timeScale().marks()||[]};this.q.l(s),this.S=!1}return this.q},t}(),ln=function(){function t(t){this.xt=new on(t)}return t.prototype.paneView=function(){return this.xt},t}(),fn=function(){function t(t,i){this._i=[],this.Me=new Map,this.hi=0,this.bn=0,this.be=1e3,this.wi=null,this.me=new it,this.ge=t,this.at=i,this.pe=new ln(this);var n=i.options();this.ye=this.ke("left",n.leftPriceScale),this.Ce=this.ke("right",n.rightPriceScale),this.ye.modeChanged().subscribe(this.Se.bind(this,this.ye),this),this.Ce.modeChanged().subscribe(this.Se.bind(this,this.ye),this),this.applyScaleOptions(n)}return t.prototype.applyScaleOptions=function(t){if(t.leftPriceScale&&this.ye.applyOptions(t.leftPriceScale),t.rightPriceScale&&this.Ce.applyOptions(t.rightPriceScale),t.localization&&(this.ye.updateFormatter(),this.Ce.updateFormatter()),t.overlayPriceScales)for(var i=0,n=Array.from(this.Me.values());i<n.length;i++){var s=f(n[i][0].priceScale());s.applyOptions(t.overlayPriceScales),t.localization&&s.updateFormatter()}},t.prototype.priceScaleById=function(t){switch(t){case"left":return this.ye;case"right":return this.Ce}return this.Me.has(t)?l(this.Me.get(t))[0].priceScale():null},t.prototype.destroy=function(){this.model().priceScalesOptionsChanged().unsubscribeAll(this),this.ye.modeChanged().unsubscribeAll(this),this.Ce.modeChanged().unsubscribeAll(this),this._i.forEach((function(t){t.destroy&&t.destroy()})),this.me.Rt()},t.prototype.stretchFactor=function(){return this.be},t.prototype.setStretchFactor=function(t){this.be=t},t.prototype.model=function(){return this.at},t.prototype.width=function(){return this.bn},t.prototype.height=function(){return this.hi},t.prototype.setWidth=function(t){this.bn=t,this.updateAllSources()},t.prototype.setHeight=function(t){var i=this;this.hi=t,this.ye.setHeight(t),this.Ce.setHeight(t),this._i.forEach((function(n){if(i.isOverlay(n)){var s=n.priceScale();null!==s&&s.setHeight(t)}})),this.updateAllSources()},t.prototype.dataSources=function(){return this._i},t.prototype.isOverlay=function(t){var i=t.priceScale();return null===i||this.ye!==i&&this.Ce!==i},t.prototype.addDataSource=function(t,i,n){var s=void 0!==n?n:this.xe().Ne+1;this.De(t,i,s)},t.prototype.removeDataSource=function(t){var i=this._i.indexOf(t);o(-1!==i,"removeDataSource: invalid data source"),this._i.splice(i,1);var n=f(t.priceScale()).id();if(this.Me.has(n)){var s=l(this.Me.get(n)),h=s.indexOf(t);-1!==h&&(s.splice(h,1),0===s.length&&this.Me.delete(n))}var r=t.priceScale();r&&r.dataSources().indexOf(t)>=0&&r.removeDataSource(t),null!==r&&(r.invalidateSourcesCache(),this.recalculatePriceScale(r)),this.wi=null},t.prototype.priceScalePosition=function(t){return t===this.ye?"left":t===this.Ce?"right":"overlay"},t.prototype.leftPriceScale=function(){return this.ye},t.prototype.rightPriceScale=function(){return this.Ce},t.prototype.startScalePrice=function(t,i){t.startScale(i)},t.prototype.scalePriceTo=function(t,i){t.scaleTo(i),this.updateAllSources()},t.prototype.endScalePrice=function(t){t.endScale()},t.prototype.startScrollPrice=function(t,i){t.startScroll(i)},t.prototype.scrollPriceTo=function(t,i){t.scrollTo(i),this.updateAllSources()},t.prototype.endScrollPrice=function(t){t.endScroll()},t.prototype.updateAllSources=function(){this._i.forEach((function(t){t.updateAllViews()}))},t.prototype.defaultPriceScale=function(){var t=null;return this.at.options().rightPriceScale.visible&&0!==this.Ce.dataSources().length?t=this.Ce:this.at.options().leftPriceScale.visible&&0!==this.ye.dataSources().length?t=this.ye:0!==this._i.length&&(t=this._i[0].priceScale()),null===t&&(t=this.Ce),t},t.prototype.defaultVisiblePriceScale=function(){var t=null;return this.at.options().rightPriceScale.visible?t=this.Ce:this.at.options().leftPriceScale.visible&&(t=this.ye),t},t.prototype.recalculatePriceScale=function(t){null!==t&&t.isAutoScale()&&this.Te(t)},t.prototype.resetPriceScale=function(t){var i=this.ge.visibleStrictRange();t.setMode({autoScale:!0}),null!==i&&t.recalculatePriceRange(i),this.updateAllSources()},t.prototype.momentaryAutoScale=function(){this.Te(this.ye),this.Te(this.Ce)},t.prototype.recalculate=function(){var t=this;this.recalculatePriceScale(this.ye),this.recalculatePriceScale(this.Ce),this._i.forEach((function(i){t.isOverlay(i)&&t.recalculatePriceScale(i.priceScale())})),this.updateAllSources(),this.at.lightUpdate()},t.prototype.orderedSources=function(){return null===this.wi&&(this.wi=pt(this._i)),this.wi},t.prototype.onDestroyed=function(){return this.me},t.prototype.grid=function(){return this.pe},t.prototype.Te=function(t){var i=t.sourcesForAutoScale();if(i&&i.length>0&&!this.ge.isEmpty()){var n=this.ge.visibleStrictRange();null!==n&&t.recalculatePriceRange(n)}t.updateAllViews()},t.prototype.xe=function(){var t=this.orderedSources();if(0===t.length)return{Be:0,Ne:0};for(var i=0,n=0,s=0;s<t.length;s++){var h=t[s].zorder();null!==h&&(h<i&&(i=h),h>n&&(n=h))}return{Be:i,Ne:n}},t.prototype.De=function(t,i,n){var s=this.priceScaleById(i);if(null===s&&(s=this.ke(i,this.at.options().overlayPriceScales)),this._i.push(t),!$t(i)){var h=this.Me.get(i)||[];h.push(t),this.Me.set(i,h)}s.addDataSource(t),t.setPriceScale(s),t.setZorder(n),this.recalculatePriceScale(s),this.wi=null},t.prototype.Se=function(t,i,n){i.mode!==n.mode&&this.Te(t)},t.prototype.ke=function(t,i){var n=u({visible:!0,autoScale:!0},b(i)),s=new Nt(t,n,this.at.options().layout,this.at.options().localization);return s.setHeight(this.height()),s},t}(),cn=function(t){function i(i){var n=t.call(this)||this;return n.Ae=new Map,n.B=i,n}return e(i,t),i.prototype.h=function(t){},i.prototype.u=function(t){if(this.B.A){t.save();for(var i=0,n=0,s=this.B.Le;n<s.length;n++){if(0!==(a=s[n]).rr.length){t.font=a.Fe;var h=this.Ee(t,a.rr);h>this.B.Th?a.Oe=this.B.Th/h:a.Oe=1,i+=a.Pe*a.Oe}}var r=0;switch(this.B.Ve){case"top":r=0;break;case"center":r=Math.max((this.B.Dh-i)/2,0);break;case"bottom":r=Math.max(this.B.Dh-i,0)}t.fillStyle=this.B.I;for(var e=0,u=this.B.Le;e<u.length;e++){var a=u[e];t.save();var o=0;switch(this.B.We){case"left":t.textAlign="left",o=a.Pe/2;break;case"center":t.textAlign="center",o=this.B.Th/2;break;case"right":t.textAlign="right",o=this.B.Th-1-a.Pe/2}t.translate(o,r),t.textBaseline="top",t.font=a.Fe,t.scale(a.Oe,a.Oe),t.fillText(a.rr,0,a.ze),t.restore(),r+=a.Pe*a.Oe}t.restore()}},i.prototype.Ee=function(t,i){var n=this.Re(t.font),s=n.get(i);return void 0===s&&(s=t.measureText(i).width,n.set(i,s)),s},i.prototype.Re=function(t){var i=this.Ae.get(t);return void 0===i&&(i=new Map,this.Ae.set(t,i)),i},i}(y),vn=function(){function t(t){this.S=!0,this.j={A:!1,I:"",Dh:0,Th:0,Le:[],Ve:"center",We:"center"},this.q=new cn(this.j),this.H=t}return t.prototype.update=function(){this.S=!0},t.prototype.renderer=function(t,i){return this.S&&(this.T(t,i),this.S=!1),this.q},t.prototype.T=function(t,i){var n=this.H.options(),s=this.j;s.A=n.visible,s.A&&(s.I=n.color,s.Th=i,s.Dh=t,s.We=n.horzAlign,s.Ve=n.vertAlign,s.Le=[{rr:n.text,Fe:Kt(n.fontSize,n.fontFamily,n.fontStyle),Pe:1.2*n.fontSize,ze:0,Oe:0}])},t}(),dn=function(t){function i(i,n){var s=t.call(this)||this;return s.kt=n,s.xt=new vn(s),s}return e(i,t),i.prototype.priceAxisViews=function(){return[]},i.prototype.paneViews=function(){return[this.xt]},i.prototype.options=function(){return this.kt},i.prototype.updateAllViews=function(){this.xt.update()},i}($),_n=function(){function t(t,i){this.Ie=[],this.Ue=[],this.bn=0,this.je=null,this.qe=null,this.He=new it,this.Ye=new it,this.Ke=new it,this.Xe=null,this.$e=t,this.kt=i,this.Ze=new Xt(this),this.ge=new jt(this,i.timeScale,this.kt.localization),this.D=new Z(this,i.crosshair),this.Je=new un(i.crosshair),this.Ge=new dn(this,i.watermark),this.createPane(),this.Ie[0].setStretchFactor(2e3),this.Qe=this.tu(0),this.iu=this.tu(1)}return t.prototype.fullUpdate=function(){this.nu(new Zt(3))},t.prototype.lightUpdate=function(){this.nu(new Zt(2))},t.prototype.cursorUpdate=function(){this.nu(new Zt(1))},t.prototype.updateSource=function(t){var i=this.su(t);this.nu(i)},t.prototype.hoveredSource=function(){return this.qe},t.prototype.setHoveredSource=function(t){var i=this.qe;this.qe=t,null!==i&&this.updateSource(i.source),null!==t&&this.updateSource(t.source)},t.prototype.options=function(){return this.kt},t.prototype.applyOptions=function(t){v(this.kt,t),this.Ie.forEach((function(i){return i.applyScaleOptions(t)})),void 0!==t.timeScale&&this.ge.applyOptions(t.timeScale),void 0!==t.localization&&this.ge.applyLocalizationOptions(t.localization),(t.leftPriceScale||t.rightPriceScale)&&this.He.Rt(),this.Qe=this.tu(0),this.iu=this.tu(1),this.fullUpdate()},t.prototype.applyPriceScaleOptions=function(t,i){if("left"!==t)if("right"!==t){var n=this.findPriceScale(t);null!==n&&(n.priceScale.applyOptions(i),this.He.Rt())}else this.applyOptions({rightPriceScale:i});else this.applyOptions({leftPriceScale:i})},t.prototype.findPriceScale=function(t){for(var i=0,n=this.Ie;i<n.length;i++){var s=n[i],h=s.priceScaleById(t);if(null!==h)return{pane:s,priceScale:h}}return null},t.prototype.timeScale=function(){return this.ge},t.prototype.panes=function(){return this.Ie},t.prototype.watermarkSource=function(){return this.Ge},t.prototype.crosshairSource=function(){return this.D},t.prototype.crosshairMoved=function(){return this.Ye},t.prototype.customPriceLineDragged=function(){return this.Ke},t.prototype.setPaneHeight=function(t,i){t.setHeight(i),this.recalculateAllPanes()},t.prototype.setWidth=function(t){this.bn=t,this.ge.setWidth(this.bn),this.Ie.forEach((function(i){return i.setWidth(t)})),this.recalculateAllPanes()},t.prototype.createPane=function(t){var i=new fn(this.ge,this);void 0!==t?this.Ie.splice(t,0,i):this.Ie.push(i);var n=void 0===t?this.Ie.length-1:t,s=new Zt(3);return s.invalidatePane(n,{level:0,autoScale:!0}),this.nu(s),i},t.prototype.startScalePrice=function(t,i,n){t.startScalePrice(i,n)},t.prototype.scalePriceTo=function(t,i,n){t.scalePriceTo(i,n),this.updateCrosshair(),this.nu(this.hu(t,2))},t.prototype.endScalePrice=function(t,i){t.endScalePrice(i),this.nu(this.hu(t,2))},t.prototype.startScrollPrice=function(t,i,n){i.isAutoScale()||t.startScrollPrice(i,n)},t.prototype.scrollPriceTo=function(t,i,n){i.isAutoScale()||(t.scrollPriceTo(i,n),this.updateCrosshair(),this.nu(this.hu(t,2)))},t.prototype.endScrollPrice=function(t,i){i.isAutoScale()||(t.endScrollPrice(i),this.nu(this.hu(t,2)))},t.prototype.resetPriceScale=function(t,i){t.resetPriceScale(i),this.nu(this.hu(t,2))},t.prototype.startScaleTime=function(t){this.ge.startScale(t)},t.prototype.zoomTime=function(t,i){var n=this.timeScale();if(!n.isEmpty()&&0!==i){var s=n.width();t=Math.max(1,Math.min(t,s)),n.zoom(t,i),this.recalculateAllPanes()}},t.prototype.scrollChart=function(t){this.startScrollTime(0),this.scrollTimeTo(t),this.endScrollTime()},t.prototype.scaleTimeTo=function(t){this.ge.scaleTo(t),this.recalculateAllPanes()},t.prototype.endScaleTime=function(){this.ge.endScale(),this.lightUpdate()},t.prototype.startScrollTime=function(t){this.je=t,this.ge.startScroll(t)},t.prototype.scrollTimeTo=function(t){var i=!1;return null!==this.je&&Math.abs(t-this.je)>20&&(this.je=null,i=!0),this.ge.scrollTo(t),this.recalculateAllPanes(),i},t.prototype.endScrollTime=function(){this.ge.endScroll(),this.lightUpdate(),this.je=null},t.prototype.serieses=function(){return this.Ue},t.prototype.setAndSaveCurrentPosition=function(t,i,n){this.D.saveOriginCoord(t,i);var s=NaN,h=this.ge.coordinateToIndex(t),r=this.ge.visibleStrictRange();null!==r&&(h=Math.min(Math.max(r.left(),h),r.right()));var e=n.defaultPriceScale(),u=e.firstValue();null!==u&&(s=e.coordinateToPrice(i,u)),s=this.Je.ue(s,h,n),this.D.setPosition(h,s,n),this.cursorUpdate(),this.Ye.Rt(this.D.appliedIndex(),{x:t,y:i})},t.prototype.clearCurrentPosition=function(){this.crosshairSource().clearPosition(),this.cursorUpdate(),this.Ye.Rt(null,null)},t.prototype.updateCrosshair=function(){var t=this.D.pane();if(null!==t){var i=this.D.originCoordX(),n=this.D.originCoordY();this.setAndSaveCurrentPosition(i,n,t)}this.D.updateAllViews()},t.prototype.updateTimeScale=function(t,i,n){var s=this.ge.indexToTime(0);void 0!==i&&void 0!==n&&this.ge.update(i,n);var h=this.ge.indexToTime(0),r=this.ge.baseIndex(),e=this.ge.visibleStrictRange();if(null!==e&&null!==s&&null!==h){var u=e.contains(r),a=s.timestamp>h.timestamp,o=null!==t&&t>r&&!a,l=u&&this.ge.options().shiftVisibleRangeOnNewBar;if(null!==t&&o&&!l){var f=t-r;this.ge.setRightOffset(this.ge.rightOffset()-f)}}this.ge.setBaseIndex(t)},t.prototype.recalculatePane=function(t){null!==t&&t.recalculate()},t.prototype.paneForSource=function(t){var i=this.Ie.find((function(i){return i.orderedSources().includes(t)}));return void 0===i?null:i},t.prototype.recalculateAllPanes=function(){this.Ge.updateAllViews(),this.Ie.forEach((function(t){return t.recalculate()})),this.updateCrosshair()},t.prototype.fireCustomPriceLineDragged=function(t,i){this.Ke.Rt(t,i)},t.prototype.destroy=function(){this.Ie.forEach((function(t){return t.destroy()})),this.Ie.length=0,this.kt.localization.priceFormatter=void 0,this.kt.localization.timeFormatter=void 0},t.prototype.rendererOptionsProvider=function(){return this.Ze},t.prototype.priceAxisRendererOptions=function(){return this.Ze.options()},t.prototype.priceScalesOptionsChanged=function(){return this.He},t.prototype.createSeries=function(t,i){var n=this.Ie[0],s=this.ru(i,t,n);return this.Ue.push(s),1===this.Ue.length?this.fullUpdate():this.lightUpdate(),s},t.prototype.removeSeries=function(t){var i=this.paneForSource(t),n=this.Ue.indexOf(t);o(-1!==n,"Series not found"),this.Ue.splice(n,1),f(i).removeDataSource(t),t.destroy&&t.destroy()},t.prototype.moveSeriesToScale=function(t,i){var n=f(this.paneForSource(t));n.removeDataSource(t);var s=this.findPriceScale(i);if(null===s){var h=t.zorder();n.addDataSource(t,i,h)}else{h=s.pane===n?t.zorder():void 0;s.pane.addDataSource(t,i,h)}},t.prototype.fitContent=function(){var t=new Zt(2);t.setFitContent(),this.nu(t)},t.prototype.setTargetLogicalRange=function(t){var i=new Zt(2);i.applyRange(t),this.nu(i)},t.prototype.resetTimeScale=function(){var t=new Zt(2);t.resetTimeScale(),this.nu(t)},t.prototype.setBarSpacing=function(t){var i=new Zt(2);i.setBarSpacing(t),this.nu(i)},t.prototype.setRightOffset=function(t){var i=new Zt(2);i.setRightOffset(t),this.nu(i)},t.prototype.defaultVisiblePriceScaleId=function(){return this.kt.rightPriceScale.visible?"right":"left"},t.prototype.backgroundBottomColor=function(){return this.iu},t.prototype.backgroundTopColor=function(){return this.Qe},t.prototype.backgroundColorAtYPercentFromTop=function(t){var i=this.iu,n=this.Qe;if(i===n)return i;if(t=Math.max(0,Math.min(100,Math.round(100*t))),null===this.Xe||this.Xe.ys!==n||this.Xe.ks!==i)this.Xe={ys:n,ks:i,eu:new Map};else{var s=this.Xe.eu.get(t);if(void 0!==s)return s}var h=function(t,i,n){var s=P(t),h=s[0],r=s[1],e=s[2],u=s[3],a=P(i),o=a[0],l=a[1],f=a[2],c=a[3],v=[B(h+n*(o-h)),B(r+n*(l-r)),B(e+n*(f-e)),A(u+n*(c-u))];return"rgba("+v[0]+", "+v[1]+", "+v[2]+", "+v[3]+")"}(n,i,t/100);return this.Xe.eu.set(t,h),h},t.prototype.hu=function(t,i){var n=new Zt(i);if(null!==t){var s=this.Ie.indexOf(t);n.invalidatePane(s,{level:i})}return n},t.prototype.su=function(t,i){return void 0===i&&(i=2),this.hu(this.paneForSource(t),i)},t.prototype.nu=function(t){this.$e&&this.$e(t),this.Ie.forEach((function(t){return t.grid().paneView().update()}))},t.prototype.ru=function(t,i,n){var s=new en(this,t,i),h=void 0!==t.priceScaleId?t.priceScaleId:this.defaultVisiblePriceScaleId();return n.addDataSource(s,h),$t(h)||s.applyOptions(t),s},t.prototype.tu=function(t){var i=this.kt.layout;return"gradient"===i.background.type?0===t?i.background.topColor:i.background.bottomColor:i.background.color},t}(),wn=function(){function t(t,i){this.V=t,this.W=i}return t.prototype.uu=function(t){return this.V===t.V&&this.W===t.W},t}();function Mn(t){return t.ownerDocument&&t.ownerDocument.defaultView&&t.ownerDocument.defaultView.devicePixelRatio||1}function bn(t){var i=f(t.getContext("2d"));return i.setTransform(1,0,0,1,0,0),i}function mn(t,i){var n=t.createElement("canvas"),s=Mn(n);return n.style.width=i.V+"px",n.style.height=i.W+"px",n.width=i.V*s,n.height=i.W*s,n}function gn(i,n){var s=f(i.ownerDocument).createElement("canvas");i.appendChild(s);var h=t(s);return h.resizeCanvas({width:n.V,height:n.W}),h}function pn(t,i){return t.au-i.au}function yn(t,i,n){var s=(t.au-i.au)/(t.ot-i.ot);return Math.sign(s)*Math.min(Math.abs(s),n)}var kn=function(){function t(t,i,n,s){this.ou=null,this.lu=null,this.fu=null,this.cu=null,this.vu=null,this.du=0,this._u=0,this.wu=!1,this.Mu=t,this.bu=i,this.mu=n,this.Ft=s}return t.prototype.gu=function(t,i){if(null!==this.ou){if(this.ou.ot===i)return void(this.ou.au=t);if(Math.abs(this.ou.au-t)<this.Ft)return}this.cu=this.fu,this.fu=this.lu,this.lu=this.ou,this.ou={ot:i,au:t}},t.prototype.Wh=function(t,i){if(null!==this.ou&&null!==this.lu&&!(i-this.ou.ot>50)){var n=0,s=yn(this.ou,this.lu,this.bu),h=pn(this.ou,this.lu),r=[s],e=[h];if(n+=h,null!==this.fu){var u=yn(this.lu,this.fu,this.bu);if(Math.sign(u)===Math.sign(s)){var a=pn(this.lu,this.fu);if(r.push(u),e.push(a),n+=a,null!==this.cu){var o=yn(this.fu,this.cu,this.bu);if(Math.sign(o)===Math.sign(s)){var l=pn(this.fu,this.cu);r.push(o),e.push(l),n+=l}}}}for(var f,c,v,d=0,_=0;_<r.length;++_)d+=e[_]/n*r[_];if(!(Math.abs(d)<this.Mu))this.vu={au:t,ot:i},this._u=d,this.du=(f=Math.abs(d),c=this.mu,v=Math.log(c),Math.log(1*v/-f)/v)}},t.prototype.pu=function(t){var i=f(this.vu),n=t-i.ot;return i.au+this._u*(Math.pow(this.mu,n)-1)/Math.log(this.mu)},t.prototype.yu=function(t){return null===this.vu||this.ku(t)===this.du},t.prototype.Cu=function(){return this.wu},t.prototype.Su=function(){this.wu=!0},t.prototype.ku=function(t){var i=t-f(this.vu).ot;return Math.min(i,this.du)},t}(),Cn="undefined"!=typeof window;var Sn=function(){if(!Cn)return!1;var t=!!navigator.maxTouchPoints||!!navigator.msMaxTouchPoints||!!Cn&&("ontouchstart"in window||Boolean(window.DocumentTouch&&document instanceof window.DocumentTouch));return"onorientationchange"in window&&t}();var Nn=function(){if(!Cn)return!1;var t=/Android/i.test(navigator.userAgent),i=/iPhone|iPad|iPod|AppleWebKit.+Mobile/i.test(navigator.userAgent);return t||i}(),xn=function(){function t(t,i,n){this.Nu=0,this.xu=null,this.Du=null,this.Tu=!1,this.Bu=null,this.Au=!1,this.Lu=!1,this.Fu=null,this.Eu=null,this.Ou=null,this.Pu=null,this.Vu=0,this.Wu=!1,this.zu=!1,this.Ru=!1,this.Iu=t,this.Uu=i,this.kt=n,this.ju()}return t.prototype.destroy=function(){null!==this.Fu&&(this.Fu(),this.Fu=null),null!==this.Eu&&(this.Eu(),this.Eu=null),null!==this.Ou&&(this.Ou(),this.Ou=null),this.qu(),this.Hu()},t.prototype.Yu=function(t){var i=this;this.Eu&&this.Eu();var n=this.Ku.bind(this);this.Eu=function(){i.Iu.removeEventListener("mousemove",n)},this.Iu.addEventListener("mousemove",n),Bn(t)&&this.Ku(t);var s=this.Xu(t);this.$u(s,this.Uu.Zu)},t.prototype.Hu=function(){null!==this.xu&&clearTimeout(this.xu),this.Nu=0,this.xu=null},t.prototype.Ku=function(t){if(!this.Ru||Bn(t)){var i=this.Xu(t);this.$u(i,this.Uu.Ju)}},t.prototype.Gu=function(t){if((!("button"in t)||0===t.button)&&null===this.Pu){var i=Bn(t);if(!this.zu||!i){this.Wu=!0;var n=this.Xu(t),s=c(this.Bu),h=Math.abs(s.O-n.Qu),r=Math.abs(s.P-n.ta),e=h+r>5;if(e||!i){if(e&&!this.Au&&i){var u=.5*h,a=r>=u&&!this.kt.ia,o=u>r&&!this.kt.na;a||o||(this.zu=!0)}e&&(this.Au=!0,this.Lu=!0,i&&this.qu()),this.zu||(this.$u(n,this.Uu.sa),i&&An(t))}}}},t.prototype.ha=function(t){if(!("button"in t)||0===t.button){var i=this.Xu(t);this.qu(),this.Bu=null,this.Ru=!1,this.Ou&&(this.Ou(),this.Ou=null),Bn(t)&&this.ra(t),this.$u(i,this.Uu.ea),++this.Nu,this.xu&&this.Nu>1?(this.$u(i,this.Uu.ua),this.Hu()):this.Lu||this.$u(i,this.Uu.aa),Bn(t)&&(An(t),this.ra(t),0===t.touches.length&&(this.Tu=!1))}},t.prototype.qu=function(){null!==this.Du&&(clearTimeout(this.Du),this.Du=null)},t.prototype.oa=function(t){if(!("button"in t)||0===t.button){var i=this.Xu(t);this.Lu=!1,this.Au=!1,this.zu=!1,Bn(t)&&this.Yu(t),this.Bu={O:i.Qu,P:i.ta},this.Ou&&(this.Ou(),this.Ou=null);var n=this.Gu.bind(this),s=this.ha.bind(this),h=this.Iu.ownerDocument.documentElement;this.Ou=function(){h.removeEventListener("touchmove",n),h.removeEventListener("touchend",s),h.removeEventListener("mousemove",n),h.removeEventListener("mouseup",s)},h.addEventListener("touchmove",n,{passive:!1}),h.addEventListener("touchend",s,{passive:!1}),this.qu(),Bn(t)&&1===t.touches.length?this.Du=setTimeout(this.la.bind(this,t),240):(h.addEventListener("mousemove",n),h.addEventListener("mouseup",s)),this.Ru=!0,this.$u(i,this.Uu.fa),this.xu||(this.Nu=0,this.xu=setTimeout(this.Hu.bind(this),500))}},t.prototype.ju=function(){var t=this;this.Iu.addEventListener("mouseenter",this.Yu.bind(this)),this.Iu.addEventListener("touchcancel",this.qu.bind(this));var i=this.Iu.ownerDocument,n=function(i){t.Uu.ca&&(i.composed&&t.Iu.contains(i.composedPath()[0])||i.target&&t.Iu.contains(i.target)||t.Uu.ca())};this.Fu=function(){i.removeEventListener("mousedown",n),i.removeEventListener("touchstart",n)},i.addEventListener("mousedown",n),i.addEventListener("touchstart",n,{passive:!0}),this.Iu.addEventListener("mouseleave",this.ra.bind(this)),this.Iu.addEventListener("touchstart",this.oa.bind(this),{passive:!0}),Sn||this.Iu.addEventListener("mousedown",this.oa.bind(this)),this.va(),this.Iu.addEventListener("touchmove",(function(){}),{passive:!1})},t.prototype.va=function(){var t=this;void 0===this.Uu.da&&void 0===this.Uu._a&&void 0===this.Uu.wa||(this.Iu.addEventListener("touchstart",(function(i){return t.Ma(i.touches)}),{passive:!0}),this.Iu.addEventListener("touchmove",(function(i){if(2===i.touches.length&&null!==t.Pu&&void 0!==t.Uu._a){var n=Tn(i.touches[0],i.touches[1])/t.Vu;t.Uu._a(t.Pu,n),An(i)}}),{passive:!1}),this.Iu.addEventListener("touchend",(function(i){t.Ma(i.touches)})))},t.prototype.Ma=function(t){1===t.length&&(this.Wu=!1),2!==t.length||this.Wu||this.Tu?this.ba():this.ma(t)},t.prototype.ma=function(t){var i=Dn(this.Iu);this.Pu={O:(t[0].clientX-i.left+(t[1].clientX-i.left))/2,P:(t[0].clientY-i.top+(t[1].clientY-i.top))/2},this.Vu=Tn(t[0],t[1]),void 0!==this.Uu.da&&this.Uu.da(),this.qu()},t.prototype.ba=function(){null!==this.Pu&&(this.Pu=null,void 0!==this.Uu.wa&&this.Uu.wa())},t.prototype.ra=function(t){this.Eu&&this.Eu();var i=this.Xu(t);this.$u(i,this.Uu.ga)},t.prototype.la=function(t){var i=this.Xu(t);this.$u(i,this.Uu.pa),this.Lu=!0,this.Tu=!0},t.prototype.$u=function(t,i){i&&i.call(this.Uu,t)},t.prototype.Xu=function(t){var i;i="touches"in t&&t.touches.length?t.touches[0]:"changedTouches"in t&&t.changedTouches.length?t.changedTouches[0]:t;var n=Dn(this.Iu);return{ya:i.clientX,ka:i.clientY,Qu:i.pageX,ta:i.pageY,Ca:i.screenX,Sa:i.screenY,Na:i.clientX-n.left,xa:i.clientY-n.top,Da:t.ctrlKey,Ta:t.altKey,Ba:t.shiftKey,Aa:t.metaKey,La:t.type.startsWith("mouse")?"mouse":"touch",Fa:t.view}},t}();function Dn(t){return t.getBoundingClientRect()||{left:0,top:0}}function Tn(t,i){var n=t.clientX-i.clientX,s=t.clientY-i.clientY;return Math.sqrt(n*n+s*s)}function Bn(t){return Boolean(t.touches)}function An(t){t.cancelable&&t.preventDefault()}var Ln=function(){function t(t,i,n,s){this.Ch=new ki(200),this.rs=0,this.Ea="",this.nr="",this.ph=[],this.Oa=new Map,this.rs=t,this.Ea=i,this.nr=Kt(t,n,s)}return t.prototype.destroy=function(){this.Ch.reset(),this.ph=[],this.Oa.clear()},t.prototype.Pa=function(t,i,n,s,h){var r=this.Va(t,i);if("left"!==h){var e=Mn(t.canvas);n-=Math.floor(r.Wa*e)}s-=Math.floor(r.Dh/2),t.drawImage(r.za,n,s,r.Th,r.Dh)},t.prototype.Va=function(t,i){var n,s=this;if(this.Oa.has(i))n=l(this.Oa.get(i));else{if(this.ph.length>=200){var h=l(this.ph.shift());this.Oa.delete(h)}var r=Mn(t.canvas),e=Math.ceil(this.rs/4.5),u=Math.round(this.rs/10),a=Math.ceil(this.Ch.measureText(t,i)),o=et(Math.round(a+2*e)),f=et(this.rs+2*e),c=mn(document,new wn(o,f));n={rr:i,Wa:Math.round(Math.max(1,a)),Th:Math.ceil(o*r),Dh:Math.ceil(f*r),za:c},0!==a&&(this.ph.push(n.rr),this.Oa.set(n.rr,n)),z(t=bn(n.za),r,(function(){t.font=s.nr,t.fillStyle=s.Ea,t.fillText(i,0,f-e-u)}))}return n},t}(),Fn=function(){function t(t,i,n,s){var h=this;this.ht=null,this.Ra=null,this.Ia=null,this.Ua=!1,this.ja=null,this.qa="",this.Ha=new ki(50),this.Ya=new Ln(11,"#000"),this.Ea=null,this.nr=null,this.Ka=0,this.Xa=function(){h.$a(h.Ze.options()),h.ft.Ja().Za().lightUpdate()},this.Ga=function(){h.ft.Ja().Za().lightUpdate()},this.ft=t,this.kt=i,this.Ze=n,this.Qa="left"===s,this.io=document.createElement("div"),this.io.style.height="100%",this.io.style.overflow="hidden",this.io.style.width="25px",this.io.style.left="0",this.io.style.position="relative",this.no=gn(this.io,new wn(16,16)),this.no.subscribeCanvasConfigured(this.Xa);var r=this.no.canvas;r.style.position="absolute",r.style.zIndex="1",r.style.left="0",r.style.top="0",this.so=gn(this.io,new wn(16,16)),this.so.subscribeCanvasConfigured(this.Ga);var e=this.so.canvas;e.style.position="absolute",e.style.zIndex="2",e.style.left="0",e.style.top="0";var u={Ju:this.ho.bind(this),fa:this.ro.bind(this),sa:this.eo.bind(this),ca:this.uo.bind(this),ea:this.ao.bind(this),ua:this.oo.bind(this),Zu:this.lo.bind(this),ga:this.fo.bind(this)};this.co=new xn(this.so.canvas,u,{ia:!1,na:!0})}return t.prototype.destroy=function(){this.co.destroy(),this.so.unsubscribeCanvasConfigured(this.Ga),this.so.destroy(),this.no.unsubscribeCanvasConfigured(this.Xa),this.no.destroy(),null!==this.ht&&this.ht.onMarksChanged().unsubscribeAll(this),this.ht=null,null!==this.Ia&&(clearTimeout(this.Ia),this.Ia=null),this.Ya.destroy()},t.prototype.vo=function(){return this.io},t.prototype.g=function(){return f(this.ht).options().borderColor},t.prototype.do=function(){return this.kt.textColor},t.prototype._o=function(){return this.kt.fontSize},t.prototype.wo=function(){return Kt(this._o(),this.kt.fontFamily)},t.prototype.Mo=function(){var t=this.Ze.options(),i=this.Ea!==t.color,n=this.nr!==t.font;return(i||n)&&(this.$a(t),this.Ea=t.color),n&&(this.Ha.reset(),this.nr=t.font),t},t.prototype.bo=function(){if(null===this.ht)return 0;var t=34,i=this.Mo(),n=bn(this.no.canvas),s=this.ht.marks();n.font=this.wo(),s.length>0&&(t=Math.max(this.Ha.measureText(n,s[0].label),this.Ha.measureText(n,s[s.length-1].label)));for(var h=this.mo(),r=h.length;r--;){var e=this.Ha.measureText(n,h[r].text());e>t&&(t=e)}var u=this.ht.firstValue();if(null!==u&&null!==this.Ra){var a=this.ht.coordinateToPrice(1,u),o=this.ht.coordinateToPrice(this.Ra.W-2,u);t=Math.max(t,this.Ha.measureText(n,this.ht.formatPrice(Math.floor(Math.min(a,o))+.11111111111111,u)),this.Ha.measureText(n,this.ht.formatPrice(Math.ceil(Math.max(a,o))-.11111111111111,u)))}t=Math.max(t,i.width);var l=Math.ceil(i.borderSize+i.tickLength+i.paddingInner+i.paddingOuter+t);return l+=l%2},t.prototype.po=function(t){if(t.V<0||t.W<0)throw new Error("Try to set invalid size to PriceAxisWidget "+JSON.stringify(t));null!==this.Ra&&this.Ra.uu(t)||(this.Ra=t,this.no.resizeCanvas({width:t.V,height:t.W}),this.so.resizeCanvas({width:t.V,height:t.W}),this.io.style.width=t.V+"px",this.io.style.height=t.W+"px",this.io.style.minWidth=t.V+"px")},t.prototype.yo=function(){return f(this.Ra).V},t.prototype.ko=function(t){this.ht!==t&&(null!==this.ht&&this.ht.onMarksChanged().unsubscribeAll(this),this.ht=t,t.onMarksChanged().subscribe(this.vi.bind(this),this))},t.prototype.Co=function(){return this.ht},t.prototype.So=function(){var t=this.ft.No();this.ft.Ja().Za().resetPriceScale(t,f(this.Co()))},t.prototype.xo=function(t){if(null!==this.Ra){if(1!==t){var i=bn(this.no.canvas);this.Do(),this.To(i,this.no.pixelRatio),this.rh(i,this.no.pixelRatio),this.Bo(i,this.no.pixelRatio),this.Ao(i,this.no.pixelRatio)}var n=bn(this.so.canvas),s=this.Ra.V,h=this.Ra.W;z(n,this.so.pixelRatio,(function(){n.clearRect(0,0,s,h)})),this.Lo(n,this.so.pixelRatio)}},t.prototype.Fo=function(){return this.no.canvas},t.prototype.Eo=function(){for(var t=[],i=0,n=this.ft.No().orderedSources();i<n.length;i++){var s=n[i];s instanceof en&&t.push.apply(t,s.customPriceLines().filter((function(t){return t.options().draggable&&t.priceAxisView().isAxisLabelVisible()})))}return t},t.prototype.Oo=function(t){for(var i=this.Mo(),n=0,s=this.Eo();n<s.length;n++){var h=s[n],r=h.priceAxisView(),e=r.height(i,!1),u=r.getFixedCoordinate();if(u-e/2<=t&&t<=u+e/2)return h}return null},t.prototype.ho=function(t){null!==this.Oo(t.xa)?this.Po(2):this.Po(1)},t.prototype.ro=function(t){if(null!==this.ht&&!this.ht.isEmpty()){this.Ua=!0;var i=this.Oo(t.xa);if(i){this.ja=i;var n=i.options().price,s=f(this.ht.firstValue());return this.qa=this.ht.formatPrice(n,s),void this.Po(3)}if(this.ft.Ja().Vo().handleScale.axisPressedMouseMove.price){var h=this.ft.Ja().Za(),r=this.ft.No();h.startScalePrice(r,this.ht,t.xa)}}},t.prototype.eo=function(t){if(null!==this.ht){var i=this.ht;if(this.ja){var n=f(i.firstValue()),s=i.coordinateToPrice(t.xa,n);this.ja.applyOptions({price:s})}else if(this.ft.Ja().Vo().handleScale.axisPressedMouseMove.price){var h=this.ft.Ja().Za(),r=this.ft.No();h.scalePriceTo(r,i,t.xa)}}},t.prototype.uo=function(){if(null!==this.ht&&this.Ua){if(this.Ua=!1,this.ja=null,this.qa="",!this.ft.Ja().Vo().handleScale.axisPressedMouseMove.price)return;var t=this.ft.Ja().Za(),i=this.ft.No(),n=this.ht;t.endScalePrice(i,n)}},t.prototype.ao=function(t){if(null!==this.ht){var i=this.ft.Ja().Za();if(this.Ua=!1,this.ja)return i.fireCustomPriceLineDragged(this.ja,this.qa),this.ja=null,this.qa="",void this.Po(2);if(this.ft.Ja().Vo().handleScale.axisPressedMouseMove.price){var n=this.ft.No();i.endScalePrice(n,this.ht)}}},t.prototype.oo=function(t){null===this.Oo(t.xa)&&this.ft.Ja().Vo().handleScale.axisDoubleClickReset&&this.So()},t.prototype.lo=function(t){null!==this.ht&&(null===this.ja?null===this.Oo(t.xa)?!this.ft.Ja().Za().options().handleScale.axisPressedMouseMove.price||this.ht.isPercentage()||this.ht.isIndexedTo100()||this.Po(1):this.Po(2):this.Po(3))},t.prototype.fo=function(t){this.Po(0)},t.prototype.mo=function(){var t=this,i=[],n=null===this.ht?void 0:this.ht;return function(s){for(var h=0;h<s.length;++h)for(var r=s[h].priceAxisViews(t.ft.No(),n),e=0;e<r.length;e++)i.push(r[e])}(this.ft.No().orderedSources()),i},t.prototype.To=function(t,i){var n=this;if(null!==this.Ra){var s=this.Ra.V,h=this.Ra.W;z(t,i,(function(){var i=n.ft.No().model(),r=i.backgroundTopColor(),e=i.backgroundBottomColor();r===e?R(t,0,0,s,h,r):I(t,0,0,s,h,r,e)}))}},t.prototype.rh=function(t,i){if(null!==this.Ra&&null!==this.ht&&this.ht.options().borderVisible){t.save(),t.fillStyle=this.g();var n,s=Math.max(1,Math.floor(this.Mo().borderSize*i));n=this.Qa?Math.floor(this.Ra.V*i)-s:0,t.fillRect(n,0,s,Math.ceil(this.Ra.W*i)),t.restore()}},t.prototype.Bo=function(t,i){if(null!==this.Ra&&null!==this.ht){var n=this.ht.marks();t.save(),t.strokeStyle=this.g(),t.font=this.wo(),t.fillStyle=this.g();var s=this.Mo(),h=this.ht.options().borderVisible&&this.ht.options().drawTicks,r=this.Qa?Math.floor((this.Ra.V-s.tickLength)*i-s.borderSize*i):Math.floor(s.borderSize*i),e=this.Qa?Math.round(r-s.paddingInner*i):Math.round(r+s.tickLength*i+s.paddingInner*i),u=this.Qa?"right":"left",a=Math.max(1,Math.floor(i)),o=Math.floor(.5*i);if(h){var l=Math.round(s.tickLength*i);t.beginPath();for(var f=0,c=n;f<c.length;f++){var v=c[f];t.rect(r,Math.round(v.coord*i)-o,l,a)}t.fill()}t.fillStyle=this.do();for(var d=0,_=n;d<_.length;d++){v=_[d];this.Ya.Pa(t,v.label,e,Math.round(v.coord*i),u)}t.restore()}},t.prototype.Do=function(){if(null!==this.Ra&&null!==this.ht){var t=this.Ra.W/2,i=[],n=this.ht.orderedSources().slice(),s=this.ft.No(),h=this.Mo();this.ht===s.defaultVisiblePriceScale()&&this.ft.No().orderedSources().forEach((function(t){s.isOverlay(t)&&n.push(t)}));var r=this.ht.dataSources()[0],e=this.ht;n.forEach((function(n){var h=n.priceAxisViews(s,e);h.forEach((function(t){t.setFixedCoordinate(null),t.isVisible()&&i.push(t)})),r===n&&h.length>0&&(t=h[0].coordinate())}));var u=i.filter((function(i){return i.coordinate()<=t})),a=i.filter((function(i){return i.coordinate()>t}));if(u.sort((function(t,i){return i.coordinate()-t.coordinate()})),u.length&&a.length&&a.push(u[0]),a.sort((function(t,i){return t.coordinate()-i.coordinate()})),i.forEach((function(t){return t.setFixedCoordinate(t.coordinate())})),this.ht.options().alignLabels){for(var o=1;o<u.length;o++){var l=u[o],f=(v=u[o-1]).height(h,!1);l.coordinate()>(d=v.getFixedCoordinate())-f&&l.setFixedCoordinate(d-f)}for(var c=1;c<a.length;c++){var v,d;l=a[c],f=(v=a[c-1]).height(h,!0);l.coordinate()<(d=v.getFixedCoordinate())+f&&l.setFixedCoordinate(d+f)}}}},t.prototype.Ao=function(t,i){var n=this;if(null!==this.Ra){t.save();var s=this.Ra,h=this.mo(),r=this.Mo(),e=this.Qa?"right":"left";h.forEach((function(h){if(h.isAxisLabelVisible()){var u=h.renderer(f(n.ht));t.save(),u.draw(t,r,n.Ha,s.V,e,i),t.restore()}})),t.restore()}},t.prototype.Lo=function(t,i){var n=this;if(null!==this.Ra&&null!==this.ht){t.save();var s=this.Ra,h=this.ft.Ja().Za(),r=[],e=this.ft.No(),u=h.crosshairSource().priceAxisViews(e,this.ht);u.length&&r.push(u);var a=this.Mo(),o=this.Qa?"right":"left";r.forEach((function(h){h.forEach((function(h){t.save(),h.renderer(f(n.ht)).draw(t,a,n.Ha,s.V,o,i),t.restore()}))})),t.restore()}},t.prototype.Po=function(t){var i="default";1===t?i="ns-resize":2===t?i="grab":3===t&&(i="grabbing"),this.io.style.cursor=i},t.prototype.vi=function(){var t=this,i=this.bo();if(this.Ka<i){var n=this.ft.Ja();null===this.Ia&&(this.Ia=setTimeout((function(){n&&n.Za().fullUpdate(),t.Ia=null}),100))}this.Ka=i},t.prototype.$a=function(t){this.Ya.destroy(),this.Ya=new Ln(t.fontSize,t.color,t.fontFamily)},t}(),En=Nn;function On(t,i,n,s,h){t.drawBackground&&t.drawBackground(i,n,s,h)}function Pn(t,i,n,s,h){t.draw(i,n,s,h)}function Vn(t,i){return t.paneViews(i)}function Wn(t,i){return void 0!==t.topPaneViews?t.topPaneViews(i):[]}var zn=function(){function t(t,i){var n=this;this.Ra=new wn(0,0),this.Wo=null,this.zo=null,this.Ro=null,this.Io=!1,this.Uo=new it,this.jo=0,this.qo=!1,this.Ho=null,this.Yo=!1,this.Ko=null,this.Xo=null,this.Xa=function(){return n.$o&&n.at().lightUpdate()},this.Ga=function(){return n.$o&&n.at().lightUpdate()},this.Zo=t,this.$o=i,this.$o.onDestroyed().subscribe(this.Jo.bind(this),this,!0),this.Go=document.createElement("td"),this.Go.style.padding="0",this.Go.style.position="relative";var s=document.createElement("div");s.style.width="100%",s.style.height="100%",s.style.position="relative",s.style.overflow="hidden",this.Qo=document.createElement("td"),this.Qo.style.padding="0",this.tl=document.createElement("td"),this.tl.style.padding="0",this.Go.appendChild(s),this.no=gn(s,new wn(16,16)),this.no.subscribeCanvasConfigured(this.Xa);var h=this.no.canvas;h.style.position="absolute",h.style.zIndex="1",h.style.left="0",h.style.top="0",this.so=gn(s,new wn(16,16)),this.so.subscribeCanvasConfigured(this.Ga);var r=this.so.canvas;r.style.position="absolute",r.style.zIndex="2",r.style.left="0",r.style.top="0",this.il=document.createElement("tr"),this.il.appendChild(this.Qo),this.il.appendChild(this.Go),this.il.appendChild(this.tl),this.nl();var e=this.Ja().Vo().handleScroll;this.co=new xn(this.so.canvas,this,{ia:!e.vertTouchDrag,na:!e.horzTouchDrag})}return t.prototype.destroy=function(){null!==this.Wo&&this.Wo.destroy(),null!==this.zo&&this.zo.destroy(),this.so.unsubscribeCanvasConfigured(this.Ga),this.so.destroy(),this.no.unsubscribeCanvasConfigured(this.Xa),this.no.destroy(),null!==this.$o&&this.$o.onDestroyed().unsubscribeAll(this),this.co.destroy()},t.prototype.No=function(){return f(this.$o)},t.prototype.sl=function(i){null!==this.$o&&this.$o.onDestroyed().unsubscribeAll(this),this.$o=i,null!==this.$o&&this.$o.onDestroyed().subscribe(t.prototype.Jo.bind(this),this,!0),this.nl()},t.prototype.Ja=function(){return this.Zo},t.prototype.vo=function(){return this.il},t.prototype.nl=function(){if(null!==this.$o&&(this.hl(),0!==this.at().serieses().length)){if(null!==this.Wo){var t=this.$o.leftPriceScale();this.Wo.ko(f(t))}if(null!==this.zo){var i=this.$o.rightPriceScale();this.zo.ko(f(i))}}},t.prototype.rl=function(){return null!==this.$o?this.$o.stretchFactor():0},t.prototype.el=function(t){this.$o&&this.$o.setStretchFactor(t)},t.prototype.Zu=function(t){if(this.$o){var i=t.Na,n=t.xa;Sn||this.ul(i,n)}},t.prototype.fa=function(t){if(this.qo=!1,this.Yo=null!==this.Ho,this.$o){if(this.al(),document.activeElement!==document.body&&document.activeElement!==document.documentElement)f(document.activeElement).blur();else{var i=document.getSelection();null!==i&&i.removeAllRanges()}var n=this.at();if(!this.$o.defaultPriceScale().isEmpty()&&!n.timeScale().isEmpty()){if(null!==this.Ho){var s=n.crosshairSource();this.Ko={x:s.appliedX(),y:s.appliedY()},this.Ho={x:t.Na,y:t.xa}}Sn||this.ul(t.Na,t.xa)}}},t.prototype.Ju=function(t){if(this.$o){var i=t.Na,n=t.xa;if(this.ol()&&this.ll(),!Sn){this.ul(i,n);var s=this.fl(i,n);this.at().setHoveredSource(s&&{source:s.cl,object:s.vl})}}},t.prototype.aa=function(t){if(null!==this.$o){var i=t.Na,n=t.xa;if(this.Uo.It()){var s=this.at().crosshairSource().appliedIndex();this.Uo.Rt(s,{x:i,y:n})}this.dl()}},t.prototype.sa=function(t){if(null!==this.$o){var i=this.at(),n=t.Na,s=t.xa;if(null!==this.Ho){this.Yo=!1;var h=f(this.Ko),r=h.x+(n-this.Ho.x),e=h.y+(s-this.Ho.y);this.ul(r,e)}else this.ol()||this.ul(n,s);if(!i.timeScale().isEmpty()){var u=this.Zo.Vo(),a=u.handleScroll,o=u.kineticScroll;if(a.pressedMouseMove&&"touch"!==t.La||(a.horzTouchDrag||a.vertTouchDrag)&&"mouse"!==t.La){var l=this.$o.defaultPriceScale(),c=performance.now();null!==this.Ro||this._l()||(this.Ro={x:t.ya,y:t.ka,wl:c,Na:t.Na,xa:t.xa}),null!==this.Xo&&this.Xo.gu(t.Na,c),null===this.Ro||this.Io||this.Ro.x===t.ya&&this.Ro.y===t.ka||(null===this.Xo&&("touch"===t.La&&o.touch||"mouse"===t.La&&o.mouse)&&(this.Xo=new kn(.2,7,.997,15),this.Xo.gu(this.Ro.Na,this.Ro.wl),this.Xo.gu(t.Na,c)),l.isEmpty()||i.startScrollPrice(this.$o,l,t.xa),i.startScrollTime(t.Na),this.Io=!0),this.Io&&(l.isEmpty()||i.scrollPriceTo(this.$o,l,t.xa),i.scrollTimeTo(t.Na))}}}},t.prototype.ea=function(t){null!==this.$o&&(this.qo=!1,this.Ml(t))},t.prototype.pa=function(t){if(this.qo=!0,null===this.Ho&&En){var i={x:t.Na,y:t.xa};this.bl(i,i)}},t.prototype.ga=function(t){null!==this.$o&&(this.$o.model().setHoveredSource(null),Nn||this.ll())},t.prototype.ml=function(){return this.Uo},t.prototype.da=function(){this.jo=1,this.al()},t.prototype._a=function(t,i){if(this.Zo.Vo().handleScale.pinch){var n=5*(i-this.jo);this.jo=i,this.at().zoomTime(t.O,n)}},t.prototype.fl=function(t,i){var n=this.$o;if(null===n)return null;for(var s=0,h=n.orderedSources();s<h.length;s++){var r=h[s],e=this.gl(r.paneViews(n),t,i);if(null!==e)return{cl:r,Fa:e.Fa,vl:e.vl}}return null},t.prototype.pl=function(t,i){f("left"===i?this.Wo:this.zo).po(new wn(t,this.Ra.W))},t.prototype.yl=function(){return this.Ra},t.prototype.po=function(t){if(t.V<0||t.W<0)throw new Error("Try to set invalid size to PaneWidget "+JSON.stringify(t));this.Ra.uu(t)||(this.Ra=t,this.no.resizeCanvas({width:t.V,height:t.W}),this.so.resizeCanvas({width:t.V,height:t.W}),this.Go.style.width=t.V+"px",this.Go.style.height=t.W+"px")},t.prototype.kl=function(){var t=f(this.$o);t.recalculatePriceScale(t.leftPriceScale()),t.recalculatePriceScale(t.rightPriceScale());for(var i=0,n=t.dataSources();i<n.length;i++){var s=n[i];if(t.isOverlay(s)){var h=s.priceScale();null!==h&&t.recalculatePriceScale(h),s.updateAllViews()}}},t.prototype.Fo=function(){return this.no.canvas},t.prototype.xo=function(t){if(0!==t&&null!==this.$o){if(t>1&&this.kl(),null!==this.Wo&&this.Wo.xo(t),null!==this.zo&&this.zo.xo(t),1!==t){var i=bn(this.no.canvas);i.save(),this.To(i,this.no.pixelRatio),this.$o&&(this.Cl(i,this.no.pixelRatio),this.Sl(i,this.no.pixelRatio),this.Nl(i,this.no.pixelRatio,Vn)),i.restore()}var n=bn(this.so.canvas);n.clearRect(0,0,Math.ceil(this.Ra.V*this.so.pixelRatio),Math.ceil(this.Ra.W*this.so.pixelRatio)),this.Nl(n,this.no.pixelRatio,Wn),this.xl(n,this.so.pixelRatio)}},t.prototype.Dl=function(){return this.Wo},t.prototype.Tl=function(){return this.zo},t.prototype.Jo=function(){null!==this.$o&&this.$o.onDestroyed().unsubscribeAll(this),this.$o=null},t.prototype.To=function(t,i){var n=this;z(t,i,(function(){var i=n.at(),s=i.backgroundTopColor(),h=i.backgroundBottomColor();s===h?R(t,0,0,n.Ra.V,n.Ra.W,h):I(t,0,0,n.Ra.V,n.Ra.W,s,h)}))},t.prototype.Cl=function(t,i){var n=f(this.$o),s=n.grid().paneView().renderer(n.height(),n.width());null!==s&&(t.save(),s.draw(t,i,!1),t.restore())},t.prototype.Sl=function(t,i){var n=this.at().watermarkSource();this.Bl(t,i,Vn,On,n),this.Bl(t,i,Vn,Pn,n)},t.prototype.xl=function(t,i){this.Bl(t,i,Vn,Pn,this.at().crosshairSource())},t.prototype.Nl=function(t,i,n){for(var s=f(this.$o).orderedSources(),h=0,r=s;h<r.length;h++){var e=r[h];this.Bl(t,i,n,On,e)}for(var u=0,a=s;u<a.length;u++){e=a[u];this.Bl(t,i,n,Pn,e)}},t.prototype.Bl=function(t,i,n,s,h){for(var r=f(this.$o),e=n(h,r),u=r.height(),a=r.width(),o=r.model().hoveredSource(),l=null!==o&&o.source===h,c=null!==o&&l&&void 0!==o.object?o.object.hitTestData:void 0,v=0,d=e;v<d.length;v++){var _=d[v].renderer(u,a);null!==_&&(t.save(),s(_,t,i,l,c),t.restore())}},t.prototype.gl=function(t,i,n){for(var s=0,h=t;s<h.length;s++){var r=h[s],e=r.renderer(this.Ra.W,this.Ra.V);if(null!==e&&e.hitTest){var u=e.hitTest(i,n);if(null!==u)return{Fa:r,vl:u}}}return null},t.prototype.hl=function(){if(null!==this.$o){var t=this.Zo,i=this.$o.leftPriceScale().options().visible,n=this.$o.rightPriceScale().options().visible;i||null===this.Wo||(this.Qo.removeChild(this.Wo.vo()),this.Wo.destroy(),this.Wo=null),n||null===this.zo||(this.tl.removeChild(this.zo.vo()),this.zo.destroy(),this.zo=null);var s=t.Za().rendererOptionsProvider();i&&null===this.Wo&&(this.Wo=new Fn(this,t.Vo().layout,s,"left"),this.Qo.appendChild(this.Wo.vo())),n&&null===this.zo&&(this.zo=new Fn(this,t.Vo().layout,s,"right"),this.tl.appendChild(this.zo.vo()))}},t.prototype.ol=function(){return En&&null===this.Ho},t.prototype._l=function(){return En&&this.qo||null!==this.Ho},t.prototype.Al=function(t){return Math.max(0,Math.min(t,this.Ra.V-1))},t.prototype.Ll=function(t){return Math.max(0,Math.min(t,this.Ra.W-1))},t.prototype.ul=function(t,i){this.at().setAndSaveCurrentPosition(this.Al(t),this.Ll(i),f(this.$o))},t.prototype.ll=function(){this.at().clearCurrentPosition()},t.prototype.dl=function(){this.Yo&&(this.Ho=null,this.ll())},t.prototype.bl=function(t,i){this.Ho=t,this.Yo=!1,this.ul(i.x,i.y);var n=this.at().crosshairSource();this.Ko={x:n.appliedX(),y:n.appliedY()}},t.prototype.at=function(){return this.Zo.Za()},t.prototype.Fl=function(){var t=this.at(),i=this.No(),n=i.defaultPriceScale();t.endScrollPrice(i,n),t.endScrollTime(),this.Ro=null,this.Io=!1},t.prototype.Ml=function(t){var i=this;if(this.Io){var n=performance.now();if(null!==this.Xo&&this.Xo.Wh(t.Na,n),null===this.Xo||this.Xo.yu(n))this.Fl();else{var s=this.at(),h=s.timeScale(),r=this.Xo,e=function(){if(!r.Cu()){var t=performance.now(),n=r.yu(t);if(!r.Cu()){var u=h.rightOffset();s.scrollTimeTo(r.pu(t)),u===h.rightOffset()&&(n=!0,i.Xo=null)}n?i.Fl():requestAnimationFrame(e)}};requestAnimationFrame(e)}}},t.prototype.al=function(){var t=performance.now(),i=null===this.Xo||this.Xo.yu(t);null!==this.Xo&&(i||this.Fl()),null!==this.Xo&&(this.Xo.Su(),this.Xo=null)},t}(),Rn=function(){function t(t,i,n,s,h){var r=this;this.S=!0,this.Ra=new wn(0,0),this.Xa=function(){return r.xo(3)},this.Qa="left"===t,this.Ze=n.El,this.kt=i,this.Ol=s,this.Pl=h,this.io=document.createElement("div"),this.io.style.width="25px",this.io.style.height="100%",this.io.style.overflow="hidden",this.no=gn(this.io,new wn(16,16)),this.no.subscribeCanvasConfigured(this.Xa)}return t.prototype.destroy=function(){this.no.unsubscribeCanvasConfigured(this.Xa),this.no.destroy()},t.prototype.vo=function(){return this.io},t.prototype.yl=function(){return this.Ra},t.prototype.po=function(t){if(t.V<0||t.W<0)throw new Error("Try to set invalid size to PriceAxisStub "+JSON.stringify(t));this.Ra.uu(t)||(this.Ra=t,this.no.resizeCanvas({width:t.V,height:t.W}),this.io.style.width=t.V+"px",this.io.style.minWidth=t.V+"px",this.io.style.height=t.W+"px",this.S=!0)},t.prototype.xo=function(t){if((!(t<3)||this.S)&&0!==this.Ra.V&&0!==this.Ra.W){this.S=!1;var i=bn(this.no.canvas);this.To(i,this.no.pixelRatio),this.rh(i,this.no.pixelRatio)}},t.prototype.Fo=function(){return this.no.canvas},t.prototype.rh=function(t,i){if(this.Ol()){var n=this.Ra.V;t.save(),t.fillStyle=this.kt.timeScale.borderColor;var s=Math.floor(this.Ze.options().borderSize*i),h=this.Qa?Math.round(n*i)-s:0;t.fillRect(h,0,s,s),t.restore()}},t.prototype.To=function(t,i){var n=this;z(t,i,(function(){R(t,0,0,n.Ra.V,n.Ra.W,n.Pl())}))},t}();function In(t,i){return t.weight>i.weight?t:i}var Un=function(){function t(t){var i=this;this.Vl=null,this.Wl=null,this.hs=null,this.zl=!1,this.Ra=new wn(0,0),this.Rl=new it,this.Ha=new ki(5),this.Xa=function(){return i.Zo.Za().lightUpdate()},this.Ga=function(){return i.Zo.Za().lightUpdate()},this.Zo=t,this.kt=t.Vo().layout,this.Il=document.createElement("tr"),this.Ul=document.createElement("td"),this.Ul.style.padding="0",this.jl=document.createElement("td"),this.jl.style.padding="0",this.io=document.createElement("td"),this.io.style.height="25px",this.io.style.padding="0",this.ql=document.createElement("div"),this.ql.style.width="100%",this.ql.style.height="100%",this.ql.style.position="relative",this.ql.style.overflow="hidden",this.io.appendChild(this.ql),this.no=gn(this.ql,new wn(16,16)),this.no.subscribeCanvasConfigured(this.Xa);var n=this.no.canvas;n.style.position="absolute",n.style.zIndex="1",n.style.left="0",n.style.top="0",this.so=gn(this.ql,new wn(16,16)),this.so.subscribeCanvasConfigured(this.Ga);var s=this.so.canvas;s.style.position="absolute",s.style.zIndex="2",s.style.left="0",s.style.top="0",this.Il.appendChild(this.Ul),this.Il.appendChild(this.io),this.Il.appendChild(this.jl),this.Hl(),this.Zo.Za().priceScalesOptionsChanged().subscribe(this.Hl.bind(this),this),this.co=new xn(this.so.canvas,this,{ia:!0,na:!1})}return t.prototype.destroy=function(){this.co.destroy(),null!==this.Vl&&this.Vl.destroy(),null!==this.Wl&&this.Wl.destroy(),this.so.unsubscribeCanvasConfigured(this.Ga),this.so.destroy(),this.no.unsubscribeCanvasConfigured(this.Xa),this.no.destroy()},t.prototype.vo=function(){return this.Il},t.prototype.Yl=function(){return this.Vl},t.prototype.Kl=function(){return this.Wl},t.prototype.fa=function(t){if(!this.zl){this.zl=!0;var i=this.Zo.Za();!i.timeScale().isEmpty()&&this.Zo.Vo().handleScale.axisPressedMouseMove.time&&i.startScaleTime(t.Na)}},t.prototype.ca=function(){var t=this.Zo.Za();!t.timeScale().isEmpty()&&this.zl&&(this.zl=!1,this.Zo.Vo().handleScale.axisPressedMouseMove.time&&t.endScaleTime())},t.prototype.sa=function(t){var i=this.Zo.Za();!i.timeScale().isEmpty()&&this.Zo.Vo().handleScale.axisPressedMouseMove.time&&i.scaleTimeTo(t.Na)},t.prototype.ea=function(t){this.zl=!1;var i=this.Zo.Za();i.timeScale().isEmpty()&&!this.Zo.Vo().handleScale.axisPressedMouseMove.time||i.endScaleTime()},t.prototype.ua=function(){this.Zo.Vo().handleScale.axisDoubleClickReset&&this.Zo.Za().resetTimeScale()},t.prototype.Zu=function(t){this.Zo.Za().options().handleScale.axisPressedMouseMove.time&&this.Po(1)},t.prototype.ga=function(t){this.Po(0)},t.prototype.yl=function(){return this.Ra},t.prototype.Xl=function(){return this.Rl},t.prototype.$l=function(t,i,n){this.Ra&&this.Ra.uu(t)||(this.Ra=t,this.no.resizeCanvas({width:t.V,height:t.W}),this.so.resizeCanvas({width:t.V,height:t.W}),this.io.style.width=t.V+"px",this.io.style.height=t.W+"px",this.Rl.Rt(t)),null!==this.Vl&&this.Vl.po(new wn(i,t.W)),null!==this.Wl&&this.Wl.po(new wn(n,t.W))},t.prototype.Zl=function(){var t=this.Jl();return Math.ceil(t.borderSize+t.tickLength+t.fontSize+t.paddingTop+t.paddingBottom)},t.prototype.Y=function(){this.Zo.Za().timeScale().marks()},t.prototype.Fo=function(){return this.no.canvas},t.prototype.xo=function(t){if(0!==t){if(1!==t){var i=bn(this.no.canvas);this.To(i,this.no.pixelRatio),this.rh(i,this.no.pixelRatio),this.Bo(i,this.no.pixelRatio),null!==this.Vl&&this.Vl.xo(t),null!==this.Wl&&this.Wl.xo(t)}var n=bn(this.so.canvas),s=this.so.pixelRatio;n.clearRect(0,0,Math.ceil(this.Ra.V*s),Math.ceil(this.Ra.W*s)),this.Gl([this.Zo.Za().crosshairSource()],n,s)}},t.prototype.To=function(t,i){var n=this;z(t,i,(function(){R(t,0,0,n.Ra.V,n.Ra.W,n.Zo.Za().backgroundBottomColor())}))},t.prototype.rh=function(t,i){if(this.Zo.Vo().timeScale.borderVisible){t.save(),t.fillStyle=this.Ql();var n=Math.max(1,Math.floor(this.Jl().borderSize*i));t.fillRect(0,0,Math.ceil(this.Ra.V*i),n),t.restore()}},t.prototype.Bo=function(t,i){var n=this,s=this.Zo.Za().timeScale().marks();if(s&&0!==s.length){var h=s.reduce(In,s[0]).weight;h>30&&h<50&&(h=30),t.save(),t.strokeStyle=this.Ql();var r=this.Jl(),e=r.borderSize+r.tickLength+r.paddingTop+r.fontSize-r.baselineOffset;t.textAlign="center",t.fillStyle=this.Ql();var u=Math.floor(this.Jl().borderSize*i),a=Math.max(1,Math.floor(i)),o=Math.floor(.5*i);if(this.Zo.Za().timeScale().options().borderVisible){t.beginPath();for(var l=Math.round(r.tickLength*i),f=s.length;f--;){var c=Math.round(s[f].coord*i);t.rect(c-o,u,a,l)}t.fill()}t.fillStyle=this.us(),z(t,i,(function(){t.font=n.tf();for(var i=0,r=s;i<r.length;i++){if((l=r[i]).weight<h){var u=l.needAlignCoordinate?n.if(t,l.coord,l.label):l.coord;t.fillText(l.label,u,e)}}t.font=n.nf();for(var a=0,o=s;a<o.length;a++){var l;if((l=o[a]).weight>=h){u=l.needAlignCoordinate?n.if(t,l.coord,l.label):l.coord;t.fillText(l.label,u,e)}}}))}},t.prototype.if=function(t,i,n){var s=this.Ha.measureText(t,n),h=s/2,r=Math.floor(i-h)+.5;return r<0?i+=Math.abs(0-r):r+s>this.Ra.V&&(i-=Math.abs(this.Ra.V-(r+s))),i},t.prototype.Gl=function(t,i,n){for(var s=this.Jl(),h=0,r=t;h<r.length;h++)for(var e=0,u=r[h].timeAxisViews();e<u.length;e++){var a=u[e];i.save(),a.renderer().draw(i,s,n),i.restore()}},t.prototype.Ql=function(){return this.Zo.Vo().timeScale.borderColor},t.prototype.us=function(){return this.kt.textColor},t.prototype.rs=function(){return this.kt.fontSize},t.prototype.tf=function(){return Kt(this.rs(),this.kt.fontFamily)},t.prototype.nf=function(){return Kt(this.rs(),this.kt.fontFamily,"bold")},t.prototype.Jl=function(){null===this.hs&&(this.hs={borderSize:1,baselineOffset:NaN,paddingTop:NaN,paddingBottom:NaN,paddingHorizontal:NaN,tickLength:3,fontSize:NaN,font:"",widthCache:new ki});var t=this.hs,i=this.tf();if(t.font!==i){var n=this.rs();t.fontSize=n,t.font=i,t.paddingTop=Math.ceil(n/2.5),t.paddingBottom=t.paddingTop,t.paddingHorizontal=Math.ceil(n/2),t.baselineOffset=Math.round(this.rs()/5),t.widthCache.reset()}return this.hs},t.prototype.Po=function(t){this.io.style.cursor=1===t?"ew-resize":"default"},t.prototype.Hl=function(){var t=this.Zo.Za(),i=t.options();i.leftPriceScale.visible||null===this.Vl||(this.Ul.removeChild(this.Vl.vo()),this.Vl.destroy(),this.Vl=null),i.rightPriceScale.visible||null===this.Wl||(this.jl.removeChild(this.Wl.vo()),this.Wl.destroy(),this.Wl=null);var n={El:this.Zo.Za().rendererOptionsProvider()},s=function(){return i.leftPriceScale.borderVisible&&t.timeScale().options().borderVisible},h=function(){return t.backgroundBottomColor()};i.leftPriceScale.visible&&null===this.Vl&&(this.Vl=new Rn("left",i,n,s,h),this.Ul.appendChild(this.Vl.vo())),i.rightPriceScale.visible&&null===this.Wl&&(this.Wl=new Rn("right",i,n,s,h),this.jl.appendChild(this.Wl.vo()))},t}(),jn=function(){function t(t,i){var n;this.sf=[],this.hf=0,this.hi=0,this.bn=0,this.rf=0,this.ef=0,this.uf=null,this.af=!1,this.Uo=new it,this.Ye=new it,this.Ke=new it,this.kt=i,this.Il=document.createElement("div"),this.Il.classList.add("tv-lightweight-charts"),this.Il.style.overflow="hidden",this.Il.style.width="100%",this.Il.style.height="100%",(n=this.Il).style.userSelect="none",n.style.webkitUserSelect="none",n.style.msUserSelect="none",n.style.MozUserSelect="none",n.style.webkitTapHighlightColor="transparent",this.lf=document.createElement("table"),this.lf.setAttribute("cellspacing","0"),this.Il.appendChild(this.lf),this.ff=this.cf.bind(this),this.Il.addEventListener("wheel",this.ff,{passive:!1}),this.at=new _n(this.$e.bind(this),this.kt),this.Za().crosshairMoved().subscribe(this.vf.bind(this),this),this.Za().customPriceLineDragged().subscribe(this.df.bind(this),this),this._f=new Un(this),this.lf.appendChild(this._f.vo());var s=this.kt.width,h=this.kt.height;if(0===s||0===h){var r=t.getBoundingClientRect();0===s&&(s=Math.floor(r.width),s-=s%2),0===h&&(h=Math.floor(r.height),h-=h%2)}this.wf(s,h),this.Mf(),t.appendChild(this.Il),this.bf(),this.at.timeScale().optionsApplied().subscribe(this.at.fullUpdate.bind(this.at),this),this.at.priceScalesOptionsChanged().subscribe(this.at.fullUpdate.bind(this.at),this)}return t.prototype.Za=function(){return this.at},t.prototype.Vo=function(){return this.kt},t.prototype.mf=function(){return this.sf},t.prototype.gf=function(){return this._f},t.prototype.destroy=function(){this.Il.removeEventListener("wheel",this.ff),0!==this.hf&&window.cancelAnimationFrame(this.hf),this.at.crosshairMoved().unsubscribeAll(this),this.at.customPriceLineDragged().unsubscribeAll(this),this.at.timeScale().optionsApplied().unsubscribeAll(this),this.at.priceScalesOptionsChanged().unsubscribeAll(this),this.at.destroy();for(var t=0,i=this.sf;t<i.length;t++){var n=i[t];this.lf.removeChild(n.vo()),n.ml().unsubscribeAll(this),n.destroy()}this.sf=[],f(this._f).destroy(),null!==this.Il.parentElement&&this.Il.parentElement.removeChild(this.Il),this.Ye.Ut(),this.Uo.Ut()},t.prototype.wf=function(t,i,n){if(void 0===n&&(n=!1),this.hi!==i||this.bn!==t){this.hi=i,this.bn=t;var s=i+"px",h=t+"px";f(this.Il).style.height=s,f(this.Il).style.width=h,this.lf.style.height=s,this.lf.style.width=h,n?this.pf(new Zt(3)):this.at.fullUpdate()}},t.prototype.xo=function(t){void 0===t&&(t=new Zt(3));for(var i=0;i<this.sf.length;i++)this.sf[i].xo(t.invalidateForPane(i).level);this.kt.timeScale.visible&&this._f.xo(t.fullInvalidation())},t.prototype.yf=function(t){this.at.applyOptions(t),this.bf();var i=t.width||this.bn,n=t.height||this.hi;this.wf(i,n)},t.prototype.ml=function(){return this.Uo},t.prototype.kf=function(){return this.Ye},t.prototype.Cf=function(){return this.Ke},t.prototype.Sf=function(){var t=this;null!==this.uf&&(this.pf(this.uf),this.uf=null);var i=this.sf[0],n=mn(document,new wn(this.bn,this.hi)),s=bn(n),h=Mn(n);return z(s,h,(function(){var n=0,h=0,r=function(i){for(var r=0;r<t.sf.length;r++){var e=t.sf[r],u=e.yl().W,a=f("left"===i?e.Dl():e.Tl()),o=a.Fo();s.drawImage(o,n,h,a.yo(),u),h+=u}};t.Nf()&&(r("left"),n=f(i.Dl()).yo()),h=0;for(var e=0;e<t.sf.length;e++){var u=t.sf[e],a=u.yl(),o=u.Fo();s.drawImage(o,n,h,a.V,a.W),h+=a.W}n+=i.yl().V,t.xf()&&(h=0,r("right"));var l=function(i){var r=f("left"===i?t._f.Yl():t._f.Kl()),e=r.yl(),u=r.Fo();s.drawImage(u,n,h,e.V,e.W)};if(t.kt.timeScale.visible){n=0,t.Nf()&&(l("left"),n=f(i.Dl()).yo());var c=t._f.yl();o=t._f.Fo();s.drawImage(o,n,h,c.V,c.W),t.xf()&&(n+=i.yl().V,l("right"),s.restore())}})),n},t.prototype.Df=function(t){return"none"===t?0:("left"!==t||this.Nf())&&("right"!==t||this.xf())?0===this.sf.length?0:f("left"===t?this.sf[0].Dl():this.sf[0].Tl()).yo():0},t.prototype.Tf=function(){for(var t=0,i=0,n=0,s=0,h=this.sf;s<h.length;s++){var r=h[s];this.Nf()&&(i=Math.max(i,f(r.Dl()).bo())),this.xf()&&(n=Math.max(n,f(r.Tl()).bo())),t+=r.rl()}var e=this.bn,u=this.hi,a=Math.max(e-i-n,0),o=this.kt.timeScale.visible,l=o?this._f.Zl():0;l%2&&(l+=1);for(var c=0+l,v=u<c?0:u-c,d=v/t,_=0,w=0;w<this.sf.length;++w){(r=this.sf[w]).sl(this.at.panes()[w]);var M,b=0;b=w===this.sf.length-1?v-_:Math.round(r.rl()*d),_+=M=Math.max(b,2),r.po(new wn(a,M)),this.Nf()&&r.pl(i,"left"),this.xf()&&r.pl(n,"right"),r.No()&&this.at.setPaneHeight(r.No(),M)}this._f.$l(new wn(o?a:0,l),o?i:0,o?n:0),this.at.setWidth(a),this.rf!==i&&(this.rf=i),this.ef!==n&&(this.ef=n)},t.prototype.cf=function(t){var i=t.deltaX/100,n=-t.deltaY/100;if(0!==i&&this.kt.handleScroll.mouseWheel||0!==n&&this.kt.handleScale.mouseWheel){switch(t.cancelable&&t.preventDefault(),t.deltaMode){case t.DOM_DELTA_PAGE:i*=120,n*=120;break;case t.DOM_DELTA_LINE:i*=32,n*=32}if(0!==n&&this.kt.handleScale.mouseWheel){var s=Math.sign(n)*Math.min(1,Math.abs(n)),h=t.clientX-this.Il.getBoundingClientRect().left;this.Za().zoomTime(h,s)}0!==i&&this.kt.handleScroll.mouseWheel&&this.Za().scrollChart(-80*i)}},t.prototype.pf=function(t){var i=t.fullInvalidation();if(3===i&&this.Bf(),3===i||2===i){for(var n=this.at.panes(),s=0;s<n.length;s++)t.invalidateForPane(s).autoScale&&n[s].momentaryAutoScale();for(var h=t.timeScaleInvalidations(),r=0,e=h;r<e.length;r++){var u=e[r];this.vs(u)}h.length>0&&(this.at.recalculateAllPanes(),this.at.updateCrosshair(),this.at.lightUpdate()),this._f.Y()}this.xo(t)},t.prototype.vs=function(t){var i=this.at.timeScale();switch(t.type){case 0:i.fitContent();break;case 1:i.setLogicalRange(t.value);break;case 2:i.setBarSpacing(t.value);break;case 3:i.setRightOffset(t.value);break;case 4:i.restoreDefault()}},t.prototype.$e=function(t){var i=this;null!==this.uf?this.uf.merge(t):this.uf=t,this.af||(this.af=!0,this.hf=window.requestAnimationFrame((function(){i.af=!1,i.hf=0,null!==i.uf&&(i.pf(i.uf),i.uf=null)})))},t.prototype.Bf=function(){this.Mf()},t.prototype.Mf=function(){for(var t=this.at.panes(),i=t.length,n=this.sf.length,s=i;s<n;s++){var h=l(this.sf.pop());this.lf.removeChild(h.vo()),h.ml().unsubscribeAll(this),h.destroy()}for(s=n;s<i;s++){(h=new zn(this,t[s])).ml().subscribe(this.Af.bind(this),this),this.sf.push(h),this.lf.insertBefore(h.vo(),this._f.vo())}for(s=0;s<i;s++){var r=t[s];(h=this.sf[s]).No()!==r?h.sl(r):h.nl()}this.bf(),this.Tf()},t.prototype.Lf=function(t,i){var n,s=new Map;null!==t&&this.at.serieses().forEach((function(i){var n=i.dataAt(t);null!==n&&s.set(i,n)}));if(null!==t){var h=this.at.timeScale().indexToTime(t);null!==h&&(n=h)}var r=this.Za().hoveredSource(),e=null!==r&&r.source instanceof en?r.source:void 0,u=null!==r&&void 0!==r.object?r.object.externalId:void 0;return{ot:n,Ff:i||void 0,Ef:e,Of:s,Pf:u}},t.prototype.Vf=function(t,i){return{Wf:t,zf:i}},t.prototype.Af=function(t,i){var n=this;this.Uo.Rt((function(){return n.Lf(t,i)}))},t.prototype.vf=function(t,i){var n=this;this.Ye.Rt((function(){return n.Lf(t,i)}))},t.prototype.df=function(t,i){var n=this;this.Ke.Rt((function(){return n.Vf(t,i)}))},t.prototype.bf=function(){var t=this.kt.timeScale.visible?"":"none";this._f.vo().style.display=t},t.prototype.Nf=function(){return this.sf[0].No().leftPriceScale().options().visible},t.prototype.xf=function(){return this.sf[0].No().rightPriceScale().options().visible},t}();function qn(t,i,n){var s=n.value,h={index:i,time:t,value:[s,s,s,s]};return"color"in n&&void 0!==n.color&&(h.color=n.color),h}function Hn(t,i,n){return{index:i,time:t,value:[n.open,n.high,n.low,n.close]}}function Yn(t){return void 0!==t.value}function Kn(t){return function(i,n,s){return void 0===(h=s).open&&void 0===h.value?{time:i,index:n}:t(i,n,s);var h}}var Xn={Candlestick:Kn(Hn),Bar:Kn(Hn),Area:Kn(qn),Baseline:Kn(qn),Histogram:Kn(qn),Line:Kn(qn)};function $n(t){return Xn[t]}function Zn(t){return 60*t*60*1e3}function Jn(t){return 60*t*1e3}var Gn,Qn=[{Rf:(Gn=1,1e3*Gn),ln:10},{Rf:Jn(1),ln:20},{Rf:Jn(5),ln:21},{Rf:Jn(30),ln:22},{Rf:Zn(1),ln:30},{Rf:Zn(3),ln:31},{Rf:Zn(6),ln:32},{Rf:Zn(12),ln:33}];function ts(t,i){if(t.getUTCFullYear()!==i.getUTCFullYear())return 70;if(t.getUTCMonth()!==i.getUTCMonth())return 60;if(t.getUTCDate()!==i.getUTCDate())return 50;for(var n=Qn.length-1;n>=0;--n)if(Math.floor(i.getTime()/Qn[n].Rf)!==Math.floor(t.getTime()/Qn[n].Rf))return Qn[n].ln;return 0}function is(t,i){if(void 0===i&&(i=0),0!==t.length){for(var n=0===i?null:t[i-1].time.timestamp,s=null!==n?new Date(1e3*n):null,h=0,r=i;r<t.length;++r){var e=t[r],u=new Date(1e3*e.time.timestamp);null!==s&&(e.timeWeight=ts(u,s)),h+=e.time.timestamp-(n||e.time.timestamp),n=e.time.timestamp,s=u}if(0===i&&t.length>1){var a=Math.ceil(h/(t.length-1)),o=new Date(1e3*(t[0].time.timestamp-a));t[0].timeWeight=ts(new Date(1e3*t[0].time.timestamp),o)}}}function ns(t){if(!qt(t))throw new Error("time must be of type BusinessDay");var i=new Date(Date.UTC(t.year,t.month-1,t.day,0,0,0,0));return{timestamp:Math.round(i.getTime()/1e3),businessDay:t}}function ss(t){if(!Ht(t))throw new Error("time must be of type isUTCTimestamp");return{timestamp:t}}function hs(t){return 0===t.length?null:qt(t[0].time)?ns:ss}function rs(t){return Ht(t)?ss(t):qt(t)?ns(t):ns(es(t))}function es(t){var i=new Date(t);if(isNaN(i.getTime()))throw new Error("Invalid date string="+t+", expected format=yyyy-mm-dd");return{day:i.getUTCDate(),month:i.getUTCMonth()+1,year:i.getUTCFullYear()}}function us(t){w(t.time)&&(t.time=es(t.time))}function as(t){return{on:0,If:new Map,Uf:t}}function os(t){if(void 0!==t&&0!==t.length)return{jf:t[0].time.timestamp,qf:t[t.length-1].time.timestamp}}var ls=function(){function t(){this.Hf=new Map,this.Yf=new Map,this.Kf=new Map,this.Xf=[]}return t.prototype.Ut=function(){this.Hf.clear(),this.Yf.clear(),this.Kf.clear(),this.Xf=[]},t.prototype.$f=function(t,i){var n=this,s=0!==this.Hf.size,h=!1,r=this.Yf.get(t);if(void 0!==r)if(1===this.Yf.size)s=!1,h=!0,this.Hf.clear();else for(var e=0,u=this.Xf;e<u.length;e++){u[e].pointData.If.delete(t)&&(h=!0)}var a=[];if(0!==i.length){!function(t){t.forEach(us)}(i);var o=f(hs(i)),l=$n(t.seriesType());a=i.map((function(i){var s=o(i.time),r=n.Hf.get(s.timestamp);void 0===r&&(r=as(s),n.Hf.set(s.timestamp,r),h=!0);var e=l(s,r.on,i);return r.If.set(t,e),e}))}s&&this.Zf(),this.Jf(t,a);var c=-1;if(h){var v=[];this.Hf.forEach((function(t){v.push({timeWeight:0,time:t.Uf,pointData:t})})),v.sort((function(t,i){return t.time.timestamp-i.time.timestamp})),c=this.Gf(v)}return this.Qf(t,c,function(t,i){var n=os(t),s=os(i);if(void 0!==n&&void 0!==s)return{lastBarUpdatedOrNewBarsAddedToTheRight:n.qf>=s.qf&&n.jf>=s.jf}}(this.Yf.get(t),r))},t.prototype.tc=function(t){return this.$f(t,[])},t.prototype.ic=function(t,i){us(i);var n=f(hs([i]))(i.time),s=this.Kf.get(t);if(void 0!==s&&n.timestamp<s.timestamp)throw new Error("Cannot update oldest data, last time="+s.timestamp+", new time="+n.timestamp);var h=this.Hf.get(n.timestamp),r=void 0===h;void 0===h&&(h=as(n),this.Hf.set(n.timestamp,h));var e=$n(t.seriesType())(n,h.on,i);h.If.set(t,e),this.nc(t,e);var u={lastBarUpdatedOrNewBarsAddedToTheRight:Yn(e)};if(!r)return this.Qf(t,-1,u);var a={timeWeight:0,time:h.Uf,pointData:h},o=Et(this.Xf,a.time.timestamp,(function(t,i){return t.time.timestamp<i}));this.Xf.splice(o,0,a);for(var l=o;l<this.Xf.length;++l)fs(this.Xf[l].pointData,l);return is(this.Xf,o),this.Qf(t,o,u)},t.prototype.nc=function(t,i){var n=this.Yf.get(t);void 0===n&&(n=[],this.Yf.set(t,n));var s=0!==n.length?n[n.length-1]:null;null===s||i.time.timestamp>s.time.timestamp?Yn(i)&&n.push(i):Yn(i)?n[n.length-1]=i:n.splice(-1,1),this.Kf.set(t,i.time)},t.prototype.Jf=function(t,i){0!==i.length?(this.Yf.set(t,i.filter(Yn)),this.Kf.set(t,i[i.length-1].time)):(this.Yf.delete(t),this.Kf.delete(t))},t.prototype.Zf=function(){for(var t=0,i=this.Xf;t<i.length;t++){var n=i[t];0===n.pointData.If.size&&this.Hf.delete(n.time.timestamp)}},t.prototype.Gf=function(t){for(var i=-1,n=0;n<this.Xf.length&&n<t.length;++n){var s=this.Xf[n],h=t[n];if(s.time.timestamp!==h.time.timestamp){i=n;break}h.timeWeight=s.timeWeight,fs(h.pointData,n)}if(-1===i&&this.Xf.length!==t.length&&(i=Math.min(this.Xf.length,t.length)),-1===i)return-1;for(n=i;n<t.length;++n)fs(t[n].pointData,n);return is(t,i),this.Xf=t,i},t.prototype.sc=function(){if(0===this.Yf.size)return null;var t=0;return this.Yf.forEach((function(i){0!==i.length&&(t=Math.max(t,i[i.length-1].index))})),t},t.prototype.Qf=function(t,i,n){var s={hc:new Map,rc:{ec:this.sc()}};if(-1!==i)this.Yf.forEach((function(i,h){s.hc.set(h,{Fh:i,uc:h===t?n:void 0})})),this.Yf.has(t)||s.hc.set(t,{Fh:[],uc:n}),s.rc.ac=this.Xf,s.rc.oc=i;else{var h=this.Yf.get(t);s.hc.set(t,{Fh:h||[],uc:n})}return s},t}();function fs(t,i){t.on=i,t.If.forEach((function(t){t.index=i}))}var cs={color:"#FF0000",price:0,lineStyle:2,lineWidth:1,axisLabelVisible:!0,title:"",draggable:!1},vs=function(){function t(t){this.pr=t}return t.prototype.applyOptions=function(t){this.pr.applyOptions(t)},t.prototype.options=function(){return this.pr.options()},t.prototype.lc=function(){return this.pr},t}();function ds(t){var i=t.overlay,n=function(t,i){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&i.indexOf(s)<0&&(n[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var h=0;for(s=Object.getOwnPropertySymbols(t);h<s.length;h++)i.indexOf(s[h])<0&&Object.prototype.propertyIsEnumerable.call(t,s[h])&&(n[s[h]]=t[s[h]])}return n}(t,["overlay"]);return i&&(n.priceScaleId=""),n}var _s=function(){function t(t,i,n){this.Bs=t,this.fc=i,this.cc=n}return t.prototype.priceFormatter=function(){return this.Bs.formatter()},t.prototype.priceToCoordinate=function(t){var i=this.Bs.firstValue();return null===i?null:this.Bs.priceScale().priceToCoordinate(t,i.value)},t.prototype.coordinateToPrice=function(t){var i=this.Bs.firstValue();return null===i?null:this.Bs.priceScale().coordinateToPrice(t,i.value)},t.prototype.barsInLogicalRange=function(t){if(null===t)return null;var i=new It(new Vt(t.from,t.to))._n(),n=this.Bs.bars();if(n.isEmpty())return null;var s=n.search(i.left(),1),h=n.search(i.right(),-1),r=f(n.firstIndex()),e=f(n.lastIndex());if(null!==s&&null!==h&&s.index>h.index)return{barsBefore:t.from-r,barsAfter:e-t.to};var u={barsBefore:null===s||s.index===r?t.from-r:s.index-r,barsAfter:null===h||h.index===e?e-t.to:e-h.index};return null!==s&&null!==h&&(u.from=s.time.businessDay||s.time.timestamp,u.to=h.time.businessDay||h.time.timestamp),u},t.prototype.setData=function(t){this.Bs.seriesType(),this.fc.vc(this.Bs,t)},t.prototype.update=function(t){this.Bs.seriesType(),this.fc.dc(this.Bs,t)},t.prototype.setMarkers=function(t){var i=t.map((function(t){return u(u({},t),{time:rs(t.time)})}));this.Bs.setMarkers(i)},t.prototype.applyOptions=function(t){var i=ds(t);this.Bs.applyOptions(i)},t.prototype.options=function(){return b(this.Bs.options())},t.prototype.priceScale=function(){return this.cc.priceScale(this.Bs.priceScale().id())},t.prototype.createPriceLine=function(t){var i=v(b(cs),t),n=this.Bs.createPriceLine(i);return new vs(n)},t.prototype.removePriceLine=function(t){this.Bs.removePriceLine(t.lc())},t.prototype.seriesType=function(){return this.Bs.seriesType()},t}(),ws=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return e(i,t),i.prototype.applyOptions=function(i){xt(i),t.prototype.applyOptions.call(this,i)},i}(_s),Ms={autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,borderVisible:!0,borderColor:"#2B2B43",entireTextOnly:!1,visible:!1,drawTicks:!0,scaleMargins:{bottom:.1,top:.2},width:0},bs={color:"rgba(0, 0, 0, 0)",visible:!1,fontSize:48,fontFamily:Yt,fontStyle:"",text:"",horzAlign:"center",vertAlign:"center"},ms={width:0,height:0,layout:{background:{type:"solid",color:"#FFFFFF"},textColor:"#191919",fontSize:11,fontFamily:Yt},crosshair:{vertLine:{color:"#758696",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#4c525e"},horzLine:{color:"#758696",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#4c525e"},mode:1},grid:{vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}},overlayPriceScales:u({},Ms),leftPriceScale:u(u({},Ms),{visible:!1}),rightPriceScale:u(u({},Ms),{visible:!0}),timeScale:{rightOffset:0,barSpacing:6,minBarSpacing:.5,fixLeftEdge:!1,fixRightEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",visible:!0,timeVisible:!1,secondsVisible:!0,shiftVisibleRangeOnNewBar:!0},watermark:bs,localization:{locale:Cn?navigator.language:"",dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:{time:!0,price:!0},axisDoubleClickReset:!0,mouseWheel:!0,pinch:!0},kineticScroll:{mouse:!1,touch:!0}},gs={upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"},ps={upColor:"#26a69a",downColor:"#ef5350",openVisible:!0,thinBars:!0},ys={color:"#2196f3",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},ks={topColor:"rgba( 46, 220, 135, 0.4)",bottomColor:"rgba( 40, 221, 100, 0)",lineColor:"#33D778",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Cs={baseValue:{type:"price",price:0},topFillColor1:"rgba(38, 166, 154, 0.28)",topFillColor2:"rgba(38, 166, 154, 0.05)",topLineColor:"rgba(38, 166, 154, 1)",bottomFillColor1:"rgba(239, 83, 80, 0.05)",bottomFillColor2:"rgba(239, 83, 80, 0.28)",bottomLineColor:"rgba(239, 83, 80, 1)",lineWidth:3,lineStyle:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Ss={color:"#26a69a",base:0},Ns={title:"",visible:!0,lastValueVisible:!0,priceLineVisible:!0,priceLineSource:0,priceLineWidth:1,priceLineColor:"",priceLineStyle:2,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01}},xs=function(){function t(t,i){this._c=t,this.wc=i}return t.prototype.applyOptions=function(t){this._c.Za().applyPriceScaleOptions(this.wc,t)},t.prototype.options=function(){return this.ht().options()},t.prototype.width=function(){return $t(this.wc)?this._c.Df("left"===this.wc?"left":"right"):0},t.prototype.formatPrice=function(t,i){return void 0===i&&(i=0),this.ht().formatPrice(t,i)},t.prototype.ht=function(){return f(this._c.Za().findPriceScale(this.wc)).priceScale},t}(),Ds=function(){function t(t,i){this.Mc=new it,this.Nn=new it,this.Rl=new it,this.at=t,this.ge=t.timeScale(),this._f=i,this.ge.visibleBarsChanged().subscribe(this.bc.bind(this)),this.ge.logicalRangeChanged().subscribe(this.mc.bind(this)),this._f.Xl().subscribe(this.gc.bind(this))}return t.prototype.destroy=function(){this.ge.visibleBarsChanged().unsubscribeAll(this),this.ge.logicalRangeChanged().unsubscribeAll(this),this._f.Xl().unsubscribeAll(this),this.Mc.Ut(),this.Nn.Ut(),this.Rl.Ut()},t.prototype.scrollPosition=function(){return this.ge.rightOffset()},t.prototype.scrollToPosition=function(t,i){i?this.ge.scrollToOffsetAnimated(t,1e3):this.at.setRightOffset(t)},t.prototype.scrollToRealTime=function(){this.ge.scrollToRealTime()},t.prototype.getVisibleRange=function(){var t,i,n=this.ge.visibleTimeRange();return null===n?null:{from:null!==(t=n.from.businessDay)&&void 0!==t?t:n.from.timestamp,to:null!==(i=n.to.businessDay)&&void 0!==i?i:n.to.timestamp}},t.prototype.setVisibleRange=function(t){var i={from:rs(t.from),to:rs(t.to)},n=this.ge.logicalRangeForTimeRange(i);this.at.setTargetLogicalRange(n)},t.prototype.getVisibleLogicalRange=function(){var t=this.ge.visibleLogicalRange();return null===t?null:{from:t.left(),to:t.right()}},t.prototype.setVisibleLogicalRange=function(t){o(t.from<=t.to,"The from index cannot be after the to index."),this.at.setTargetLogicalRange(t)},t.prototype.resetTimeScale=function(){this.at.resetTimeScale()},t.prototype.fitContent=function(){this.at.fitContent()},t.prototype.logicalToCoordinate=function(t){var i=this.at.timeScale();return i.isEmpty()?null:i.indexToCoordinate(t)},t.prototype.coordinateToLogical=function(t){return this.ge.isEmpty()?null:this.ge.coordinateToIndex(t)},t.prototype.timeToCoordinate=function(t){var i=rs(t),n=this.ge.timeToIndex(i,!1);return null===n?null:this.ge.indexToCoordinate(n)},t.prototype.coordinateToTime=function(t){var i,n=this.at.timeScale(),s=n.coordinateToIndex(t),h=n.indexToTime(s);return null===h?null:null!==(i=h.businessDay)&&void 0!==i?i:h.timestamp},t.prototype.width=function(){return this._f.yl().V},t.prototype.height=function(){return this._f.yl().W},t.prototype.subscribeVisibleTimeRangeChange=function(t){this.Mc.subscribe(t)},t.prototype.unsubscribeVisibleTimeRangeChange=function(t){this.Mc.unsubscribe(t)},t.prototype.subscribeVisibleLogicalRangeChange=function(t){this.Nn.subscribe(t)},t.prototype.unsubscribeVisibleLogicalRangeChange=function(t){this.Nn.unsubscribe(t)},t.prototype.subscribeSizeChange=function(t){this.Rl.subscribe(t)},t.prototype.unsubscribeSizeChange=function(t){this.Rl.unsubscribe(t)},t.prototype.applyOptions=function(t){this.ge.applyOptions(t)},t.prototype.options=function(){return b(this.ge.options())},t.prototype.bc=function(){this.Mc.It()&&this.Mc.Rt(this.getVisibleRange())},t.prototype.mc=function(){this.Nn.It()&&this.Nn.Rt(this.getVisibleLogicalRange())},t.prototype.gc=function(t){this.Rl.Rt(t.V,t.W)},t}();function Ts(t){if(void 0!==t&&"custom"!==t.type){var i=t;void 0!==i.minMove&&void 0===i.precision&&(i.precision=function(t){if(t>=1)return 0;for(var i=0;i<8;i++){var n=Math.round(t);if(Math.abs(n-t)<1e-8)return i;t*=10}return i}(i.minMove))}}function Bs(t){return function(t){if(M(t.handleScale)){var i=t.handleScale;t.handleScale={axisDoubleClickReset:i,axisPressedMouseMove:{time:i,price:i},mouseWheel:i,pinch:i}}else if(void 0!==t.handleScale&&M(t.handleScale.axisPressedMouseMove)){var n=t.handleScale.axisPressedMouseMove;t.handleScale.axisPressedMouseMove={time:n,price:n}}var s=t.handleScroll;M(s)&&(t.handleScroll={horzTouchDrag:s,vertTouchDrag:s,mouseWheel:s,pressedMouseMove:s})}(t),function(t){if(t.priceScale){t.leftPriceScale=t.leftPriceScale||{},t.rightPriceScale=t.rightPriceScale||{};var i=t.priceScale.position;delete t.priceScale.position,t.leftPriceScale=v(t.leftPriceScale,t.priceScale),t.rightPriceScale=v(t.rightPriceScale,t.priceScale),"left"===i&&(t.leftPriceScale.visible=!0,t.rightPriceScale.visible=!1),"right"===i&&(t.leftPriceScale.visible=!1,t.rightPriceScale.visible=!0),"none"===i&&(t.leftPriceScale.visible=!1,t.rightPriceScale.visible=!1),t.overlayPriceScales=t.overlayPriceScales||{},void 0!==t.priceScale.invertScale&&(t.overlayPriceScales.invertScale=t.priceScale.invertScale),void 0!==t.priceScale.scaleMargins&&(t.overlayPriceScales.scaleMargins=t.priceScale.scaleMargins)}}(t),function(t){t.layout&&t.layout.backgroundColor&&!t.layout.background&&(t.layout.background={type:"solid",color:t.layout.backgroundColor})}(t),t}var As=function(){function t(t,i){var n=this;this.yc=new ls,this.kc=new Map,this.Cc=new Map,this.Sc=new it,this.Nc=new it,this.xc=new it;var s=void 0===i?b(ms):v(b(ms),Bs(i));this._c=new jn(t,s),this._c.ml().subscribe((function(t){n.Sc.It()&&n.Sc.Rt(n.Dc(t()))}),this),this._c.kf().subscribe((function(t){n.Nc.It()&&n.Nc.Rt(n.Dc(t()))}),this),this._c.Cf().subscribe((function(t){n.xc.It()&&n.xc.Rt(n.Tc(t()))}),this);var h=this._c.Za();this.Bc=new Ds(h,this._c.gf())}return t.prototype.remove=function(){this._c.ml().unsubscribeAll(this),this._c.kf().unsubscribeAll(this),this._c.Cf().unsubscribeAll(this),this.Bc.destroy(),this._c.destroy(),this.kc.clear(),this.Cc.clear(),this.Sc.Ut(),this.Nc.Ut(),this.xc.Ut(),this.yc.Ut()},t.prototype.resize=function(t,i,n){this._c.wf(t,i,n)},t.prototype.addAreaSeries=function(t){void 0===t&&(t={}),Ts((t=ds(t)).priceFormat);var i=v(b(Ns),ks,t),n=this._c.Za().createSeries("Area",i),s=new _s(n,this,this);return this.kc.set(s,n),this.Cc.set(n,s),s},t.prototype.addBaselineSeries=function(t){void 0===t&&(t={}),Ts((t=ds(t)).priceFormat);var i=v(b(Ns),b(Cs),t),n=this._c.Za().createSeries("Baseline",i),s=new _s(n,this,this);return this.kc.set(s,n),this.Cc.set(n,s),s},t.prototype.addBarSeries=function(t){void 0===t&&(t={}),Ts((t=ds(t)).priceFormat);var i=v(b(Ns),ps,t),n=this._c.Za().createSeries("Bar",i),s=new _s(n,this,this);return this.kc.set(s,n),this.Cc.set(n,s),s},t.prototype.addCandlestickSeries=function(t){void 0===t&&(t={}),xt(t=ds(t)),Ts(t.priceFormat);var i=v(b(Ns),gs,t),n=this._c.Za().createSeries("Candlestick",i),s=new ws(n,this,this);return this.kc.set(s,n),this.Cc.set(n,s),s},t.prototype.addHistogramSeries=function(t){void 0===t&&(t={}),Ts((t=ds(t)).priceFormat);var i=v(b(Ns),Ss,t),n=this._c.Za().createSeries("Histogram",i),s=new _s(n,this,this);return this.kc.set(s,n),this.Cc.set(n,s),s},t.prototype.addLineSeries=function(t){void 0===t&&(t={}),Ts((t=ds(t)).priceFormat);var i=v(b(Ns),ys,t),n=this._c.Za().createSeries("Line",i),s=new _s(n,this,this);return this.kc.set(s,n),this.Cc.set(n,s),s},t.prototype.removeSeries=function(t){var i=l(this.kc.get(t)),n=this.yc.tc(i);this._c.Za().removeSeries(i),this.Ac(n),this.kc.delete(t),this.Cc.delete(i)},t.prototype.vc=function(t,i){this.Ac(this.yc.$f(t,i))},t.prototype.dc=function(t,i){this.Ac(this.yc.ic(t,i))},t.prototype.subscribeClick=function(t){this.Sc.subscribe(t)},t.prototype.unsubscribeClick=function(t){this.Sc.unsubscribe(t)},t.prototype.moveCrosshair=function(t){if(t){var i=this._c.mf(),n={Na:t.x,xa:t.y};i[0].Ju(n)}},t.prototype.subscribeCrosshairMove=function(t){this.Nc.subscribe(t)},t.prototype.unsubscribeCrosshairMove=function(t){this.Nc.unsubscribe(t)},t.prototype.subscribeCustomPriceLineDragged=function(t){this.xc.subscribe(t)},t.prototype.unsubscribeCustomPriceLineDragged=function(t){this.xc.unsubscribe(t)},t.prototype.priceScale=function(t){return void 0===t&&(t=this._c.Za().defaultVisiblePriceScaleId()),new xs(this._c,t)},t.prototype.timeScale=function(){return this.Bc},t.prototype.applyOptions=function(t){this._c.yf(Bs(t))},t.prototype.options=function(){return this._c.Vo()},t.prototype.takeScreenshot=function(){return this._c.Sf()},t.prototype.Ac=function(t){var i=this._c.Za();i.updateTimeScale(t.rc.ec,t.rc.ac,t.rc.oc),t.hc.forEach((function(t,i){return i.setData(t.Fh,t.uc)})),i.recalculateAllPanes()},t.prototype.Lc=function(t){return l(this.Cc.get(t))},t.prototype.Dc=function(t){var i=this,n=new Map;t.Of.forEach((function(t,s){n.set(i.Lc(s),t)}));var s=void 0===t.Ef?void 0:this.Lc(t.Ef);return{time:t.ot&&(t.ot.businessDay||t.ot.timestamp),point:t.Ff,hoveredSeries:s,hoveredMarkerId:t.Pf,seriesPrices:n}},t.prototype.Tc=function(t){return{customPriceLine:t.Wf,fromPriceString:t.zf}},t}();function Ls(t,i){var n;if(w(t)){var s=document.getElementById(t);o(null!==s,"Cannot find element in DOM with id="+t),n=s}else n=t;return new As(n,i)}function Fs(){return"3.8.0-dev+202112190350"}export{Ut as ColorType,U as CrosshairMode,yt as LasPriceAnimationMode,yt as LastPriceAnimationMode,n as LineStyle,i as LineType,Q as PriceFormatter,kt as PriceLineSource,bt as PriceScaleMode,zt as TickMarkType,Ls as createChart,qt as isBusinessDay,Ht as isUTCTimestamp,Fs as version};
