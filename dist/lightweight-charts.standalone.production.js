/*!
 * @license
 * TradingView Lightweight Charts v3.4.0-dev+202107100546
 * Copyright (c) 2020 TradingView, Inc.
 * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
 */
!function(){"use strict";var t,i;function n(t,i){var n,h=((n={})[0]=[],n[1]=[t.lineWidth,t.lineWidth],n[2]=[2*t.lineWidth,2*t.lineWidth],n[3]=[6*t.lineWidth,6*t.lineWidth],n[4]=[t.lineWidth,4*t.lineWidth],n)[i];t.setLineDash(h)}function h(t,i,n,h){t.beginPath();var s=t.lineWidth%2?.5:0;t.moveTo(n,i+s),t.lineTo(h,i+s),t.stroke()}!function(t){t[t.Simple=0]="Simple",t[t.WithSteps=1]="WithSteps",t[t.WithGaps=2]="WithGaps"}(t||(t={})),function(t){t[t.Solid=0]="Solid",t[t.Dotted=1]="Dotted",t[t.Dashed=2]="Dashed",t[t.LargeDashed=3]="LargeDashed",t[t.SparseDotted=4]="SparseDotted"}(i||(i={}));var s=function(t,i){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])})(t,i)};function r(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}s(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}var u=function(){return(u=Object.assign||function(t){for(var i,n=1,h=arguments.length;n<h;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)};function e(t,i){for(var n=0,h=i.length,s=t.length;n<h;n++,s++)t[s]=i[n];return t}function o(t,i){if(!t)throw new Error("Assertion failed"+(i?": "+i:""))}function a(t){if(void 0===t)throw new Error("Value is undefined");return t}function f(t){if(null===t)throw new Error("Value is null");return t}function l(t){return f(a(t))}function c(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];for(var h=0,s=i;h<s.length;h++){var r=s[h];for(var u in r)void 0!==r[u]&&("object"!=typeof r[u]||void 0===t[u]?t[u]=r[u]:c(t[u],r[u]))}return t}function v(t){return"number"==typeof t&&isFinite(t)}function d(t){return"number"==typeof t&&t%1==0}function _(t){return"string"==typeof t}function w(t){return"boolean"==typeof t}function M(t){var i,n,h,s=t;if(!s||"object"!=typeof s)return s;for(n in i=Array.isArray(s)?[]:{},s)s.hasOwnProperty(n)&&(h=s[n],i[n]=h&&"object"==typeof h?M(h):h);return i}function b(t){return null!==t}function m(t){return null===t?void 0:t}var g=function(){function t(){this.t=[]}return t.prototype.i=function(t){this.t=t},t.prototype.draw=function(t,i,n,h){this.t.forEach((function(s){t.save(),s.draw(t,i,n,h),t.restore()}))},t}(),p=function(){function t(){}return t.prototype.draw=function(t,i,n,h){t.save(),t.scale(i,i),this.h(t,n,h),t.restore()},t.prototype.drawBackground=function(t,i,n,h){t.save(),t.scale(i,i),this.u(t,n,h),t.restore()},t.prototype.u=function(t,i,n){},t}(),y=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.o=null,i}return r(i,t),i.prototype.l=function(t){this.o=t},i.prototype.h=function(t){if(null!==this.o&&null!==this.o.v){var i=this.o.v,n=this.o,h=function(h){t.beginPath();for(var s=i.to-1;s>=i.from;--s){var r=n._[s];t.moveTo(r.x,r.y),t.arc(r.x,r.y,h,0,2*Math.PI)}t.fill()};t.fillStyle=n.M,h(n.m+2),t.fillStyle=n.g,h(n.m)}},i}(p);var k={from:0,to:1},x=function(){function t(t,i){this.p=new g,this.k=[],this.N=[],this.S=!0,this.C=t,this.D=i,this.p.i(this.k)}return t.prototype.update=function(t){var i=this,n=this.C.serieses();n.length!==this.k.length&&(this.N=n.map((function(){return{_:[{x:0,y:0,time:0,price:0}],g:"",M:i.C.options().layout.backgroundColor,m:0,v:null}})),this.k=this.N.map((function(t){var i=new y;return i.l(t),i})),this.p.i(this.k)),this.S=!0},t.prototype.renderer=function(t,i,n){return this.S&&(this.T(),this.S=!1),this.p},t.prototype.T=function(){var t=this,i=this.C.serieses(),n=this.D.appliedIndex(),h=this.C.timeScale();i.forEach((function(i,s){var r=t.N[s],u=i.markerDataAtIndex(n);if(null!==u&&i.visible()){var e=f(i.firstValue());r.g=u.backgroundColor,r.M=u.borderColor,r.m=u.radius,r._[0].price=u.price,r._[0].y=i.priceScale().priceToCoordinate(u.price,e.value),r._[0].time=n,r._[0].x=h.indexToCoordinate(n),r.v=k}else r.v=null}))},t}(),N=function(){function t(t){this.L=t}return t.prototype.draw=function(t,i,s,r){if(null!==this.L){var u=this.L.A.B,e=this.L.O.B;if(u||e){t.save();var o=Math.round(this.L.V*i),a=Math.round(this.L.P*i),f=Math.ceil(this.L.F*i),l=Math.ceil(this.L.I*i);t.lineCap="butt",u&&o>=0&&(t.lineWidth=Math.floor(this.L.A.W*i),t.strokeStyle=this.L.A.R,t.fillStyle=this.L.A.R,n(t,this.L.A.U),function(t,i,n,h){t.beginPath();var s=t.lineWidth%2?.5:0;t.moveTo(i+s,n),t.lineTo(i+s,h),t.stroke()}(t,o,0,l)),e&&a>=0&&(t.lineWidth=Math.floor(this.L.O.W*i),t.strokeStyle=this.L.O.R,t.fillStyle=this.L.O.R,n(t,this.L.O.U),h(t,a,0,f)),t.restore()}}},t}(),S=function(){function t(t){this.S=!0,this.j={A:{W:1,U:0,R:"",B:!1},O:{W:1,U:0,R:"",B:!1},F:0,I:0,V:0,P:0},this.q=new N(this.j),this.H=t}return t.prototype.Y=function(){this.S=!0},t.prototype.renderer=function(t,i){return this.S&&(this.T(),this.S=!1),this.q},t.prototype.T=function(){var t=this.H.visible(),i=f(this.H.pane()),n=i.model().options().crosshair,h=this.j;h.O.B=t&&this.H.horzLineVisible(i),h.A.B=t&&this.H.vertLineVisible(),h.O.W=n.horzLine.width,h.O.U=n.horzLine.style,h.O.R=n.horzLine.color,h.A.W=n.vertLine.width,h.A.U=n.vertLine.style,h.A.R=n.vertLine.color,h.F=i.width(),h.I=i.height(),h.V=this.H.appliedX(),h.P=this.H.appliedY()},t}(),C={khaki:"#f0e68c",azure:"#f0ffff",aliceblue:"#f0f8ff",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",gray:"#808080",green:"#008000",honeydew:"#f0fff0",floralwhite:"#fffaf0",lightblue:"#add8e6",lightcoral:"#f08080",lemonchiffon:"#fffacd",hotpink:"#ff69b4",lightyellow:"#ffffe0",greenyellow:"#adff2f",lightgoldenrodyellow:"#fafad2",limegreen:"#32cd32",linen:"#faf0e6",lightcyan:"#e0ffff",magenta:"#f0f",maroon:"#800000",olive:"#808000",orange:"#ffa500",oldlace:"#fdf5e6",mediumblue:"#0000cd",transparent:"#0000",lime:"#0f0",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",midnightblue:"#191970",orchid:"#da70d6",mediumorchid:"#ba55d3",mediumturquoise:"#48d1cc",orangered:"#ff4500",royalblue:"#4169e1",powderblue:"#b0e0e6",red:"#f00",coral:"#ff7f50",turquoise:"#40e0d0",white:"#fff",whitesmoke:"#f5f5f5",wheat:"#f5deb3",teal:"#008080",steelblue:"#4682b4",bisque:"#ffe4c4",aquamarine:"#7fffd4",aqua:"#0ff",sienna:"#a0522d",silver:"#c0c0c0",springgreen:"#00ff7f",antiquewhite:"#faebd7",burlywood:"#deb887",brown:"#a52a2a",beige:"#f5f5dc",chocolate:"#d2691e",chartreuse:"#7fff00",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cadetblue:"#5f9ea0",tomato:"#ff6347",fuchsia:"#f0f",blue:"#00f",salmon:"#fa8072",blanchedalmond:"#ffebcd",slateblue:"#6a5acd",slategray:"#708090",thistle:"#d8bfd8",tan:"#d2b48c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",blueviolet:"#8a2be2",black:"#000",darkmagenta:"#8b008b",darkslateblue:"#483d8b",darkkhaki:"#bdb76b",darkorchid:"#9932cc",darkorange:"#ff8c00",darkgreen:"#006400",darkred:"#8b0000",dodgerblue:"#1e90ff",darkslategray:"#2f4f4f",dimgray:"#696969",deepskyblue:"#00bfff",firebrick:"#b22222",forestgreen:"#228b22",indigo:"#4b0082",ivory:"#fffff0",lavenderblush:"#fff0f5",feldspar:"#d19275",indianred:"#cd5c5c",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightskyblue:"#87cefa",lightslategray:"#789",lightslateblue:"#8470ff",snow:"#fffafa",lightseagreen:"#20b2aa",lightsalmon:"#ffa07a",darksalmon:"#e9967a",darkviolet:"#9400d3",mediumpurple:"#9370d8",mediumaquamarine:"#66cdaa",skyblue:"#87ceeb",lavender:"#e6e6fa",lightsteelblue:"#b0c4de",mediumvioletred:"#c71585",mintcream:"#f5fffa",navajowhite:"#ffdead",navy:"#000080",olivedrab:"#6b8e23",palevioletred:"#d87093",violetred:"#d02090",yellow:"#ff0",yellowgreen:"#9acd32",lawngreen:"#7cfc00",pink:"#ffc0cb",paleturquoise:"#afeeee",palegoldenrod:"#eee8aa",darkolivegreen:"#556b2f",darkseagreen:"#8fbc8f",darkturquoise:"#00ced1",peachpuff:"#ffdab9",deeppink:"#ff1493",violet:"#ee82ee",palegreen:"#98fb98",mediumseagreen:"#3cb371",peru:"#cd853f",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",purple:"#800080",seagreen:"#2e8b57",seashell:"#fff5ee",papayawhip:"#ffefd5",mediumslateblue:"#7b68ee",plum:"#dda0dd",mediumspringgreen:"#00fa9a"};function D(t){return t<0?0:t>255?255:Math.round(t)||0}var T=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,E=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,L=/^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/,B=/^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?[\d]{0,10}(?:\.\d+)?)\s*\)$/;function A(t){var i,n=function(t){var i;if((t=t.toLowerCase())in C&&(t=C[t]),i=B.exec(t)||L.exec(t))return[D(parseInt(i[1],10)),D(parseInt(i[2],10)),D(parseInt(i[3],10))];if(i=E.exec(t))return[D(parseInt(i[1],16)),D(parseInt(i[2],16)),D(parseInt(i[3],16))];if(i=T.exec(t))return[D(17*parseInt(i[1],16)),D(17*parseInt(i[2],16)),D(17*parseInt(i[3],16))];throw new Error("Cannot parse color: "+t)}(t);return{K:"rgb("+n[0]+", "+n[1]+", "+n[2]+")",$:(i=n,.199*i[0]+.687*i[1]+.114*i[2]>160?"black":"white")}}function O(t,i,n,h,s,r){t.fillRect(i+r,n,h-2*r,r),t.fillRect(i+r,n+s-r,h-2*r,r),t.fillRect(i,n,r,s),t.fillRect(i+h-r,n,r,s)}function V(t,i,n){t.save(),t.scale(i,i),n(),t.restore()}function z(t,i,n,h,s,r){t.save(),t.globalCompositeOperation="copy",t.fillStyle=r,t.fillRect(i,n,h,s),t.restore()}var P,F=function(){function t(t,i){this.setData(t,i)}return t.prototype.setData=function(t,i){this.L=t,this.X=i},t.prototype.draw=function(t,i,n,h,s,r){if(this.L.visible){t.font=i.font;var u=this.L.tickVisible||!this.L.moveTextToInvisibleTick?i.tickLength:0,e=i.borderSize,o=i.paddingTop,a=i.paddingBottom,f=i.paddingInner,l=i.paddingOuter,c=this.L.text,v=Math.ceil(n.measureText(t,c)),d=i.baselineOffset,_=i.fontSize+o+a,w=Math.ceil(.5*_),M=e+v+f+l+u,b=this.X.coordinate;this.X.fixedCoordinate&&(b=this.X.fixedCoordinate);var m,g,p=(b=Math.round(b))-w,y=p+_,k="right"===s,x=k?h:0,N=Math.ceil(h*r),S=x;if(t.fillStyle=this.X.background,t.lineWidth=1,t.lineCap="butt",c){k?(m=x-u,g=(S=x-M)+l):(S=x+M,m=x+u,g=x+e+u+f);var C=Math.max(1,Math.floor(r)),D=Math.max(1,Math.floor(e*r)),T=k?N:0,E=Math.round(p*r),L=Math.round(S*r),B=Math.round(b*r)-Math.floor(.5*r),A=B+C+(B-E),O=Math.round(m*r);t.save(),t.beginPath(),t.moveTo(T,E),t.lineTo(L,E),t.lineTo(L,A),t.lineTo(T,A),t.fill(),t.fillStyle=this.L.borderColor,t.fillRect(k?N-D:0,E,D,A-E),this.L.tickVisible&&(t.fillStyle=this.X.color,t.fillRect(T,B,O-T,C)),t.textAlign="left",t.fillStyle=this.X.color,V(t,r,(function(){t.fillText(c,g,y-a-d)})),t.restore()}}},t.prototype.height=function(t,i){return this.L.visible?t.fontSize+t.paddingTop+t.paddingBottom:0},t}(),I=function(){function t(t){this.Z={coordinate:0,color:"#FFF",background:"#000"},this.J={text:"",visible:!1,tickVisible:!0,moveTextToInvisibleTick:!1,borderColor:""},this.G={text:"",visible:!1,tickVisible:!1,moveTextToInvisibleTick:!0,borderColor:""},this.S=!0,this.tt=new(t||F)(this.J,this.Z),this.it=new(t||F)(this.G,this.Z)}return t.prototype.text=function(){return this.J.text},t.prototype.coordinate=function(){return this.nt(),this.Z.coordinate},t.prototype.update=function(){this.S=!0},t.prototype.height=function(t,i){return void 0===i&&(i=!1),Math.max(this.tt.height(t,i),this.it.height(t,i))},t.prototype.getFixedCoordinate=function(){return this.Z.fixedCoordinate||0},t.prototype.setFixedCoordinate=function(t){this.Z.fixedCoordinate=t},t.prototype.isVisible=function(){return this.nt(),this.J.visible||this.G.visible},t.prototype.isAxisLabelVisible=function(){return this.nt(),this.J.visible},t.prototype.renderer=function(t){return this.nt(),this.J.tickVisible=this.J.tickVisible&&t.options().drawTicks,this.G.tickVisible=this.G.tickVisible&&t.options().drawTicks,this.tt.setData(this.J,this.Z),this.it.setData(this.G,this.Z),this.tt},t.prototype.paneRenderer=function(){return this.nt(),this.tt.setData(this.J,this.Z),this.it.setData(this.G,this.Z),this.it},t.prototype.nt=function(){this.S&&(this.J.tickVisible=!0,this.G.tickVisible=!1,this.ht(this.J,this.G,this.Z))},t}(),W=function(t){function i(i,n,h){var s=t.call(this)||this;return s.H=i,s.st=n,s.rt=h,s}return r(i,t),i.prototype.ht=function(t,i,n){t.visible=!1;var h=this.H.options().horzLine;if(h.labelVisible){var s=this.st.firstValue();if(this.H.visible()&&!this.st.isEmpty()&&null!==s){var r=A(h.labelBackgroundColor);n.background=r.K,n.color=r.$;var u=this.rt(this.st);n.coordinate=u.ut,t.text=this.st.formatPrice(u.et,s),t.visible=!0}}},i}(I),R=/[1-9]/g,U=function(){function t(){this.L=null}return t.prototype.setData=function(t){this.L=t},t.prototype.draw=function(t,i,n){var h=this;if(null!==this.L&&!1!==this.L.visible&&0!==this.L.text.length){t.font=i.font;var s=Math.round(i.widthCache.measureText(t,this.L.text,R));if(!(s<=0)){t.save();var r=i.paddingHorizontal,u=s+2*r,e=u/2,o=this.L.width,a=this.L.coordinate,l=Math.floor(a-e)+.5;l<0?(a+=Math.abs(0-l),l=Math.floor(a-e)+.5):l+u>o&&(a-=Math.abs(o-(l+u)),l=Math.floor(a-e)+.5);var c=l+u,v=0+i.borderSize+i.paddingTop+i.fontSize+i.paddingBottom;t.fillStyle=this.L.background;var d=Math.round(l*n),_=Math.round(0*n),w=Math.round(c*n),M=Math.round(v*n);t.fillRect(d,_,w-d,M-_);var b=Math.round(this.L.coordinate*n),m=_,g=Math.round((m+i.borderSize+i.tickLength)*n);t.fillStyle=this.L.color;var p=Math.max(1,Math.floor(n)),y=Math.floor(.5*n);t.fillRect(b-y,m,p,g-m);var k=v-i.baselineOffset-i.paddingBottom;t.textAlign="left",t.fillStyle=this.L.color,V(t,n,(function(){t.fillText(f(h.L).text,l+r,k)})),t.restore()}}},t}(),j=function(){function t(t,i,n){this.S=!0,this.q=new U,this.j={visible:!1,background:"#4c525e",color:"white",text:"",width:0,coordinate:NaN},this.D=t,this.ot=i,this.rt=n}return t.prototype.Y=function(){this.S=!0},t.prototype.renderer=function(){return this.S&&(this.T(),this.S=!1),this.q.setData(this.j),this.q},t.prototype.T=function(){var t=this.j;t.visible=!1;var i=this.D.options().vertLine;if(i.labelVisible){var n=this.ot.timeScale();if(!n.isEmpty()){var h=n.indexToTime(this.D.appliedIndex());t.width=n.width();var s=this.rt();if(s.at){t.coordinate=s.ut,t.text=n.formatDateTime(f(h)),t.visible=!0;var r=A(i.labelBackgroundColor);t.background=r.K,t.color=r.$}}}},t}(),q=function(){function t(){this._priceScale=null,this.ft=0}return t.prototype.zorder=function(){return this.ft},t.prototype.setZorder=function(t){this.ft=t},t.prototype.priceScale=function(){return this._priceScale},t.prototype.setPriceScale=function(t){this._priceScale=t},t.prototype.priceAxisViews=function(t,i){return[]},t.prototype.paneViews=function(t){return[]},t.prototype.timeAxisViews=function(){return[]},t.prototype.visible=function(){return!0},t}();!function(t){t[t.Normal=0]="Normal",t[t.Magnet=1]="Magnet"}(P||(P={}));var H=function(t){function i(i,n){var h=t.call(this)||this;h.lt=null,h.ct=NaN,h.vt=0,h.dt=!0,h._t=new Map,h.wt=!1,h.Mt=NaN,h.bt=NaN,h.gt=NaN,h.yt=NaN,h.ot=i,h.kt=n,h.xt=new x(i,h);var s,r;h.Nt=(s=function(){return h.ct},r=function(){return h.bt},function(t){var i=r(),n=s();if(t===f(h.lt).defaultPriceScale())return{et:n,ut:i};var u=f(t.firstValue());return{et:t.coordinateToPrice(i,u),ut:i}});var u=function(t,i){return function(){return{at:h.ot.timeScale().indexToTime(t()),ut:i()}}}((function(){return h.vt}),(function(){return h.appliedX()}));return h.St=new j(h,i,u),h.Ct=new S(h),h}return r(i,t),i.prototype.options=function(){return this.kt},i.prototype.saveOriginCoord=function(t,i){this.gt=t,this.yt=i},i.prototype.clearOriginCoord=function(){this.gt=NaN,this.yt=NaN},i.prototype.originCoordX=function(){return this.gt},i.prototype.originCoordY=function(){return this.yt},i.prototype.setPosition=function(t,i,n){this.wt||(this.wt=!0),this.dt=!0,this.Dt(t,i,n)},i.prototype.appliedIndex=function(){return this.vt},i.prototype.appliedX=function(){return this.Mt},i.prototype.appliedY=function(){return this.bt},i.prototype.visible=function(){return this.dt},i.prototype.clearPosition=function(){this.dt=!1,this.Tt(),this.ct=NaN,this.Mt=NaN,this.bt=NaN,this.lt=null,this.clearOriginCoord()},i.prototype.paneViews=function(t){return null!==this.lt?[this.Ct,this.xt]:[]},i.prototype.horzLineVisible=function(t){return t===this.lt&&this.kt.horzLine.visible},i.prototype.vertLineVisible=function(){return this.kt.vertLine.visible},i.prototype.priceAxisViews=function(t,i){this.dt&&this.lt===t||this._t.clear();var n=[];return this.lt===t&&n.push(this.Et(this._t,i,this.Nt)),n},i.prototype.timeAxisViews=function(){return this.dt?[this.St]:[]},i.prototype.pane=function(){return this.lt},i.prototype.updateAllViews=function(){this.Ct.Y(),this._t.forEach((function(t){return t.update()})),this.St.Y(),this.xt.update()},i.prototype.Lt=function(t){return t&&!t.defaultPriceScale().isEmpty()?t.defaultPriceScale():null},i.prototype.Dt=function(t,i,n){this.Bt(t,i,n)&&this.updateAllViews()},i.prototype.Bt=function(t,i,n){var h=this.Mt,s=this.bt,r=this.ct,u=this.vt,e=this.lt,o=this.Lt(n);this.vt=t,this.Mt=isNaN(t)?NaN:this.ot.timeScale().indexToCoordinate(t),this.lt=n;var a=null!==o?o.firstValue():null;return null!==o&&null!==a?(this.ct=i,this.bt=o.priceToCoordinate(i,a)):(this.ct=NaN,this.bt=NaN),h!==this.Mt||s!==this.bt||u!==this.vt||r!==this.ct||e!==this.lt},i.prototype.Tt=function(){var t=this.ot.serieses().map((function(t){return t.bars().lastIndex()})).filter(b),i=0===t.length?null:Math.max.apply(Math,t);this.vt=null!==i?i:NaN},i.prototype.Et=function(t,i,n){var h=t.get(i);return void 0===h&&(h=new W(this,i,n),t.set(i,h)),h},i}(q),Y=".";function K(t,i){if(!v(t))return"n/a";if(!d(i))throw new TypeError("invalid length");if(i<0||i>16)throw new TypeError("invalid length");if(0===i)return t.toString();return("0000000000000000"+t.toString()).slice(-i)}var $=function(){function t(t,i){if(i||(i=1),v(t)&&d(t)||(t=100),t<0)throw new TypeError("invalid base");this.st=t,this.At=i,this.Ot()}return t.prototype.format=function(t){var i=t<0?"−":"";return t=Math.abs(t),i+this.Vt(t)},t.prototype.Ot=function(){if(this._fractionalLength=0,this.st>0&&this.At>0)for(var t=this.st;t>1;)t/=10,this._fractionalLength++},t.prototype.Vt=function(t){var i=this.st/this.At,n=Math.floor(t),h="",s=void 0!==this._fractionalLength?this._fractionalLength:NaN;if(i>1){var r=+(Math.round(t*i)-n*i).toFixed(this._fractionalLength);r>=i&&(r-=i,n+=1),h=Y+K(+r.toFixed(this._fractionalLength)*this.At,s)}else n=Math.round(n*i)/i,s>0&&(h=Y+K(0,s));return n.toFixed(0)+h},t}(),X=function(t){function i(i){return void 0===i&&(i=100),t.call(this,i)||this}return r(i,t),i.prototype.format=function(i){return t.prototype.format.call(this,i)+"%"},i}($),Z=function(){function t(){this.zt=[]}return t.prototype.subscribe=function(t,i,n){var h={Pt:t,Ft:i,It:!0===n};this.zt.push(h)},t.prototype.unsubscribe=function(t){var i=this.zt.findIndex((function(i){return t===i.Pt}));i>-1&&this.zt.splice(i,1)},t.prototype.unsubscribeAll=function(t){this.zt=this.zt.filter((function(i){return i.Ft===t}))},t.prototype.Wt=function(t,i){var n=e([],this.zt);this.zt=this.zt.filter((function(t){return!t.It})),n.forEach((function(n){return n.Pt(t,i)}))},t.prototype.Rt=function(){return this.zt.length>0},t.prototype.Ut=function(){this.zt=[]},t}(),J=function(){function t(t,i){this.jt=t,this.qt=i}return t.prototype.equals=function(t){return null!==t&&(this.jt===t.jt&&this.qt===t.qt)},t.prototype.clone=function(){return new t(this.jt,this.qt)},t.prototype.minValue=function(){return this.jt},t.prototype.maxValue=function(){return this.qt},t.prototype.length=function(){return this.qt-this.jt},t.prototype.isEmpty=function(){return this.qt===this.jt||Number.isNaN(this.qt)||Number.isNaN(this.jt)},t.prototype.merge=function(i){return null===i?this:new t(Math.min(this.minValue(),i.minValue()),Math.max(this.maxValue(),i.maxValue()))},t.prototype.scaleAroundCenter=function(t){if(v(t)&&0!==this.qt-this.jt){var i=.5*(this.qt+this.jt),n=this.qt-i,h=this.jt-i;n*=t,h*=t,this.qt=i+n,this.jt=i+h}},t.prototype.shift=function(t){v(t)&&(this.qt+=t,this.jt+=t)},t.prototype.toRaw=function(){return{minValue:this.jt,maxValue:this.qt}},t.fromRaw=function(i){return null===i?null:new t(i.minValue,i.maxValue)},t}();function G(t,i,n){return Math.min(Math.max(t,i),n)}function Q(t,i,n){return i-t<=n}function tt(t){return t<=0?NaN:Math.log(t)/Math.log(10)}function it(t){var i=Math.ceil(t);return i%2!=0?i-1:i}function nt(t){var i=Math.ceil(t);return i%2==0?i-1:i}function ht(t,i){var n=100*(t-i)/i;return i<0?-n:n}function st(t,i){var n=ht(t.minValue(),i),h=ht(t.maxValue(),i);return new J(n,h)}function rt(t,i){var n=100*(t-i)/i+100;return i<0?-n:n}function ut(t,i){var n=rt(t.minValue(),i),h=rt(t.maxValue(),i);return new J(n,h)}function et(t){var i=Math.abs(t);if(i<1e-8)return 0;var n=tt(i+1e-4)+4;return t<0?-n:n}function ot(t){var i=Math.abs(t);if(i<1e-8)return 0;var n=Math.pow(10,i-4)-1e-4;return t<0?-n:n}function at(t){if(null===t)return null;var i=et(t.minValue()),n=et(t.maxValue());return new J(i,n)}var ft,lt=function(){function t(t,i){if(this.Ht=t,this.Yt=i,function(t){if(t<0)return!1;for(var i=t;i>1;i/=10)if(i%10!=0)return!1;return!0}(this.Ht))this.Kt=[2,2.5,2];else{this.Kt=[];for(var n=this.Ht;1!==n;){if(n%2==0)this.Kt.push(2),n/=2;else{if(n%5!=0)throw new Error("unexpected base");this.Kt.push(2,2.5),n/=5}if(this.Kt.length>100)throw new Error("something wrong with base")}}}return t.prototype.$t=function(t,i,n){for(var h,s,r,u=0===this.Ht?0:1/this.Ht,e=1e-9,o=Math.pow(10,Math.max(0,Math.ceil(tt(t-i)))),a=0,f=this.Yt[0];;){var l=Q(o,u,e)&&o>u+e,c=Q(o,n*f,e),v=Q(o,1,e);if(!(l&&c&&v))break;o/=f,f=this.Yt[++a%this.Yt.length]}if(o<=u+e&&(o=u),o=Math.max(1,o),this.Kt.length>0&&(h=o,s=1,r=e,Math.abs(h-s)<r))for(a=0,f=this.Kt[0];Q(o,n*f,e)&&o>u+e;)o/=f,f=this.Kt[++a%this.Kt.length];return o},t}(),ct=function(){function t(t,i,n,h){this.Xt=[],this.st=t,this.Ht=i,this.Zt=n,this.Jt=h}return t.prototype.$t=function(t,i){if(t<i)throw new Error("high < low");var n=this.st.height(),h=(t-i)*this.Gt()/n,s=new lt(this.Ht,[2,2.5,2]),r=new lt(this.Ht,[2,2,2.5]),u=new lt(this.Ht,[2.5,2,2]),e=[];return e.push(s.$t(t,i,h),r.$t(t,i,h),u.$t(t,i,h)),function(t){if(t.length<1)throw Error("array is empty");for(var i=t[0],n=1;n<t.length;++n)t[n]<i&&(i=t[n]);return i}(e)},t.prototype.Qt=function(){var t=this.st,i=t.firstValue();if(null!==i){var n=t.height(),h=this.Zt(n-1,i),s=this.Zt(0,i),r=this.st.options().entireTextOnly?this.ti()/2:0,u=r,e=n-1-r,o=Math.max(h,s),a=Math.min(h,s);if(o!==a){for(var f=this.$t(o,a),l=o%f,c=o>=a?1:-1,v=null,d=0,_=o-(l+=l<0?f:0);_>a;_-=f){var w=this.Jt(_,i,!0);null!==v&&Math.abs(w-v)<this.Gt()||(w<u||w>e||(d<this.Xt.length?(this.Xt[d].coord=w,this.Xt[d].label=t.formatLogical(_)):this.Xt.push({coord:w,label:t.formatLogical(_)}),d++,v=w,t.isLog()&&(f=this.$t(_*c,a))))}this.Xt.length=d}else this.Xt=[]}else this.Xt=[]},t.prototype.ii=function(){return this.Xt},t.prototype.ti=function(){return this.st.fontSize()},t.prototype.Gt=function(){return Math.ceil(2.5*this.ti())},t}();function vt(t){return t.slice().sort((function(t,i){return f(t.zorder())-f(i.zorder())}))}!function(t){t[t.Normal=0]="Normal",t[t.Logarithmic=1]="Logarithmic",t[t.Percentage=2]="Percentage",t[t.IndexedTo100=3]="IndexedTo100"}(ft||(ft={}));var dt,_t=new X,wt=new $(100,1),Mt=function(){function t(t,i,n,h){this.ni=0,this.hi=null,this.si=null,this.ri=null,this.ui={ei:!1,oi:null},this.ai=0,this.fi=0,this.li=new Z,this.ci=new Z,this.vi=[],this.di=null,this._i=null,this.wi=null,this.Mi=null,this.bi=wt,this.mi=t,this.kt=i,this.gi=n,this.pi=h,this.yi=new ct(this,100,this.ki.bind(this),this.xi.bind(this))}return t.prototype.id=function(){return this.mi},t.prototype.options=function(){return this.kt},t.prototype.applyOptions=function(t){if(c(this.kt,t),this.updateFormatter(),void 0!==t.mode&&this.setMode({mode:t.mode}),void 0!==t.scaleMargins){var i=a(t.scaleMargins.top),n=a(t.scaleMargins.bottom);if(i<0||i>1)throw new Error("Invalid top margin - expect value between 0 and 1, given="+i);if(n<0||n>1||i+n>1)throw new Error("Invalid bottom margin - expect value between 0 and 1, given="+n);if(i+n>1)throw new Error("Invalid margins - sum of margins must be less than 1, given="+(i+n));this.Ni(),this._i=null}},t.prototype.isAutoScale=function(){return this.kt.autoScale},t.prototype.isLog=function(){return 1===this.kt.mode},t.prototype.isPercentage=function(){return 2===this.kt.mode},t.prototype.isIndexedTo100=function(){return 3===this.kt.mode},t.prototype.mode=function(){return{autoScale:this.kt.autoScale,isInverted:this.kt.invertScale,mode:this.kt.mode}},t.prototype.setMode=function(t){var i=this.mode(),n=null;void 0!==t.autoScale&&(this.kt.autoScale=t.autoScale),void 0!==t.mode&&(this.kt.mode=t.mode,2!==t.mode&&3!==t.mode||(this.kt.autoScale=!0),this.ui.ei=!1),1===i.mode&&t.mode!==i.mode&&(!function(t){if(null===t)return!1;var i=ot(t.minValue()),n=ot(t.maxValue());return isFinite(i)&&isFinite(n)}(this.si)?this.kt.autoScale=!0:null!==(n=function(t){if(null===t)return null;var i=ot(t.minValue()),n=ot(t.maxValue());return new J(i,n)}(this.si))&&this.setPriceRange(n)),1===t.mode&&t.mode!==i.mode&&null!==(n=at(this.si))&&this.setPriceRange(n);var h=i.mode!==this.kt.mode;h&&(2===i.mode||this.isPercentage())&&this.updateFormatter(),h&&(3===i.mode||this.isIndexedTo100())&&this.updateFormatter(),void 0!==t.isInverted&&i.isInverted!==t.isInverted&&(this.kt.invertScale=t.isInverted,this.Si()),this.ci.Wt(i,this.mode())},t.prototype.modeChanged=function(){return this.ci},t.prototype.fontSize=function(){return this.gi.fontSize},t.prototype.height=function(){return this.ni},t.prototype.setHeight=function(t){this.ni!==t&&(this.ni=t,this.Ni(),this._i=null)},t.prototype.internalHeight=function(){if(this.hi)return this.hi;var t=this.height()-this.Ci()-this.Di();return this.hi=t,t},t.prototype.priceRange=function(){return this.Ti(),this.si},t.prototype.setPriceRange=function(t,i){var n=this.si;(i||null===n&&null!==t||null!==n&&!n.equals(t))&&(this._i=null,this.si=t)},t.prototype.isEmpty=function(){return this.Ti(),0===this.ni||!this.si||this.si.isEmpty()},t.prototype.invertedCoordinate=function(t){return this.isInverted()?t:this.height()-1-t},t.prototype.priceToCoordinate=function(t,i){return this.isPercentage()?t=ht(t,i):this.isIndexedTo100()&&(t=rt(t,i)),this.xi(t,i)},t.prototype.pointsArrayToCoordinates=function(t,i,n){this.Ti();for(var h=this.Di(),s=f(this.priceRange()),r=s.minValue(),u=s.maxValue(),e=this.internalHeight()-1,o=this.isInverted(),a=e/(u-r),l=void 0===n?0:n.from,c=void 0===n?t.length:n.to,v=this.Ei(),d=l;d<c;d++){var _=t[d],w=_.price;if(!isNaN(w)){var M=w;null!==v&&(M=v(_.price,i));var b=h+a*(M-r),m=o?b:this.ni-1-b;_.y=m}}},t.prototype.barPricesToCoordinates=function(t,i,n){this.Ti();for(var h=this.Di(),s=f(this.priceRange()),r=s.minValue(),u=s.maxValue(),e=this.internalHeight()-1,o=this.isInverted(),a=e/(u-r),l=void 0===n?0:n.from,c=void 0===n?t.length:n.to,v=this.Ei(),d=l;d<c;d++){var _=t[d],w=_.open,M=_.high,b=_.low,m=_.close;null!==v&&(w=v(_.open,i),M=v(_.high,i),b=v(_.low,i),m=v(_.close,i));var g=h+a*(w-r),p=o?g:this.ni-1-g;_.openY=p,g=h+a*(M-r),p=o?g:this.ni-1-g,_.highY=p,g=h+a*(b-r),p=o?g:this.ni-1-g,_.lowY=p,g=h+a*(m-r),p=o?g:this.ni-1-g,_.closeY=p}},t.prototype.coordinateToPrice=function(t,i){var n=this.ki(t,i);return this.logicalToPrice(n,i)},t.prototype.logicalToPrice=function(t,i){var n=t;return this.isPercentage()?n=function(t,i){return i<0&&(t=-t),t/100*i+i}(n,i):this.isIndexedTo100()&&(n=function(t,i){return t-=100,i<0&&(t=-t),t/100*i+i}(n,i)),n},t.prototype.dataSources=function(){return this.vi},t.prototype.orderedSources=function(){if(this.di)return this.di;for(var t=[],i=0;i<this.vi.length;i++){var n=this.vi[i];null===n.zorder()&&n.setZorder(i+1),t.push(n)}return t=vt(t),this.di=t,this.di},t.prototype.addDataSource=function(t){-1===this.vi.indexOf(t)&&(this.vi.push(t),this.updateFormatter(),this.invalidateSourcesCache())},t.prototype.removeDataSource=function(t){var i=this.vi.indexOf(t);if(-1===i)throw new Error("source is not attached to scale");this.vi.splice(i,1),0===this.vi.length&&(this.setMode({autoScale:!0}),this.setPriceRange(null)),this.updateFormatter(),this.invalidateSourcesCache()},t.prototype.firstValue=function(){for(var t=null,i=0,n=this.vi;i<n.length;i++){var h=n[i].firstValue();null!==h&&null!==h.value&&((null===t||h.timePoint<t.timePoint)&&(t=h))}return null===t?null:t.value},t.prototype.isInverted=function(){return this.kt.invertScale},t.prototype.marks=function(){return this._i||(this.yi.Qt(),this._i=this.yi.ii(),this.li.Wt()),this._i},t.prototype.onMarksChanged=function(){return this.li},t.prototype.startScale=function(t){this.isPercentage()||this.isIndexedTo100()||null===this.wi&&null===this.ri&&(this.isEmpty()||(this.wi=this.ni-t,this.ri=f(this.priceRange()).clone()))},t.prototype.scaleTo=function(t){if(!this.isPercentage()&&!this.isIndexedTo100()&&null!==this.wi){this.setMode({autoScale:!1}),(t=this.ni-t)<0&&(t=0);var i=(this.wi+.2*(this.ni-1))/(t+.2*(this.ni-1)),n=f(this.ri).clone();i=Math.max(i,.1),n.scaleAroundCenter(i),this.setPriceRange(n)}},t.prototype.endScale=function(){this.isPercentage()||this.isIndexedTo100()||(this.wi=null,this.ri=null)},t.prototype.startScroll=function(t){this.isAutoScale()||null===this.Mi&&null===this.ri&&(this.isEmpty()||(this.Mi=t,this.ri=f(this.priceRange()).clone()))},t.prototype.scrollTo=function(t){if(!this.isAutoScale()&&null!==this.Mi){var i=f(this.priceRange()).length()/(this.internalHeight()-1),n=t-this.Mi;this.isInverted()&&(n*=-1);var h=n*i,s=f(this.ri).clone();s.shift(h),this.setPriceRange(s,!0),this._i=null}},t.prototype.endScroll=function(){this.isAutoScale()||null!==this.Mi&&(this.Mi=null,this.ri=null)},t.prototype.formatter=function(){return this.bi||this.updateFormatter(),this.bi},t.prototype.formatPrice=function(t,i){switch(this.kt.mode){case 2:return this.formatter().format(ht(t,i));case 3:return this.formatter().format(rt(t,i));default:return this.Li(t)}},t.prototype.formatLogical=function(t){switch(this.kt.mode){case 2:case 3:return this.formatter().format(t);default:return this.Li(t)}},t.prototype.formatPriceAbsolute=function(t){return this.Li(t,f(this.Bi()).formatter())},t.prototype.formatPricePercentage=function(t,i){return t=ht(t,i),_t.format(t)},t.prototype.sourcesForAutoScale=function(){return this.vi},t.prototype.recalculatePriceRange=function(t){this.ui={oi:t,ei:!1}},t.prototype.updateAllViews=function(){this.vi.forEach((function(t){return t.updateAllViews()}))},t.prototype.updateFormatter=function(){this._i=null;var t=this.Bi(),i=100;null!==t&&(i=Math.round(1/t.minMove())),this.bi=wt,this.isPercentage()?(this.bi=_t,i=100):this.isIndexedTo100()?(this.bi=new $(100,1),i=100):null!==t&&(this.bi=t.formatter()),this.yi=new ct(this,i,this.ki.bind(this),this.xi.bind(this)),this.yi.Qt()},t.prototype.invalidateSourcesCache=function(){this.di=null},t.prototype.Bi=function(){return this.vi[0]||null},t.prototype.Ci=function(){return this.isInverted()?this.kt.scaleMargins.bottom*this.height()+this.fi:this.kt.scaleMargins.top*this.height()+this.ai},t.prototype.Di=function(){return this.isInverted()?this.kt.scaleMargins.top*this.height()+this.ai:this.kt.scaleMargins.bottom*this.height()+this.fi},t.prototype.Ti=function(){this.ui.ei||(this.ui.ei=!0,this.Ai())},t.prototype.Ni=function(){this.hi=null},t.prototype.xi=function(t,i){if(this.Ti(),this.isEmpty())return 0;t=this.isLog()&&t?et(t):t;var n=f(this.priceRange()),h=this.Di()+(this.internalHeight()-1)*(t-n.minValue())/n.length();return this.invertedCoordinate(h)},t.prototype.ki=function(t,i){if(this.Ti(),this.isEmpty())return 0;var n=this.invertedCoordinate(t),h=f(this.priceRange()),s=h.minValue()+h.length()*((n-this.Di())/(this.internalHeight()-1));return this.isLog()?ot(s):s},t.prototype.Si=function(){this._i=null,this.yi.Qt()},t.prototype.Ai=function(){var t=this.ui.oi;if(null!==t){for(var i=null,n=0,h=0,s=0,r=this.sourcesForAutoScale();s<r.length;s++){var u=r[s];if(u.visible()){var e=u.firstValue();if(null!==e){var o=u.autoscaleInfo(t.left(),t.right()),a=o&&o.priceRange();if(null!==a){switch(this.kt.mode){case 1:a=at(a);break;case 2:a=st(a,e.value);break;case 3:a=ut(a,e.value)}if(i=null===i?a:i.merge(f(a)),null!==o){var l=o.margins();null!==l&&(n=Math.max(n,l.above),h=Math.max(n,l.below))}}}}}if(n===this.ai&&h===this.fi||(this.ai=n,this.fi=h,this._i=null,this.Ni()),null!==i){if(i.minValue()===i.maxValue()){var c=this.Bi(),v=5*(null===c||this.isPercentage()||this.isIndexedTo100()?1:c.minMove());i=new J(i.minValue()-v,i.maxValue()+v)}this.setPriceRange(i)}else null===this.si&&this.setPriceRange(new J(-.5,.5));this.ui.ei=!0}},t.prototype.Ei=function(){return this.isPercentage()?ht:this.isIndexedTo100()?rt:this.isLog()?et:null},t.prototype.Li=function(t,i){return void 0===this.pi.priceFormatter?(void 0===i&&(i=this.formatter()),i.format(t)):this.pi.priceFormatter(t)},t}();function bt(t){void 0!==t.borderColor&&(t.borderUpColor=t.borderColor,t.borderDownColor=t.borderColor),void 0!==t.wickColor&&(t.wickUpColor=t.wickColor,t.wickDownColor=t.wickColor)}!function(t){t[t.LastBar=0]="LastBar",t[t.LastVisible=1]="LastVisible"}(dt||(dt={}));var mt=function(t){return t.getUTCFullYear()};function gt(t,i,n){return i.replace(/yyyy/g,function(t){return K(mt(t),4)}(t)).replace(/yy/g,function(t){return K(mt(t)%100,2)}(t)).replace(/MMMM/g,function(t,i){return new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"long"})}(t,n)).replace(/MMM/g,function(t,i){return new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"short"})}(t,n)).replace(/MM/g,function(t){return K(function(t){return t.getUTCMonth()+1}(t),2)}(t)).replace(/dd/g,function(t){return K(function(t){return t.getUTCDate()}(t),2)}(t))}var pt=function(){function t(t,i){void 0===t&&(t="yyyy-MM-dd"),void 0===i&&(i="default"),this.Oi=t,this.Vi=i}return t.prototype.format=function(t){return gt(t,this.Oi,this.Vi)},t}(),yt=function(){function t(t){this.zi=t||"%h:%m:%s"}return t.prototype.format=function(t){return this.zi.replace("%h",K(t.getUTCHours(),2)).replace("%m",K(t.getUTCMinutes(),2)).replace("%s",K(t.getUTCSeconds(),2))},t}(),kt={Pi:"yyyy-MM-dd",Fi:"%h:%m:%s",Ii:" ",Wi:"default"},xt=function(){function t(t){void 0===t&&(t={});var i=u(u({},kt),t);this.Ri=new pt(i.Pi,i.Wi),this.Ui=new yt(i.Fi),this.ji=i.Ii}return t.prototype.format=function(t){return""+this.Ri.format(t)+this.ji+this.Ui.format(t)},t}();var Nt=function(){function t(t,i){void 0===i&&(i=50),this.qi=0,this.Hi=1,this.Yi=1,this.Ki=new Map,this.$i=new Map,this.Xi=t,this.Zi=i}return t.prototype.Ji=function(t){var i=void 0===t.businessDay?new Date(1e3*t.timestamp).getTime():new Date(Date.UTC(t.businessDay.year,t.businessDay.month-1,t.businessDay.day)).getTime(),n=this.Ki.get(i);if(void 0!==n)return n.Gi;if(this.qi===this.Zi){var h=this.$i.get(this.Yi);this.$i.delete(this.Yi),this.Ki.delete(a(h)),this.Yi++,this.qi--}var s=this.Xi(t);return this.Ki.set(i,{Gi:s,Qi:this.Hi}),this.$i.set(this.Hi,i),this.qi++,this.Hi++,s},t}(),St=function(){function t(t,i){o(t<=i,"right should be >= left"),this.tn=t,this.nn=i}return t.prototype.left=function(){return this.tn},t.prototype.right=function(){return this.nn},t.prototype.count=function(){return this.nn-this.tn+1},t.prototype.contains=function(t){return this.tn<=t&&t<=this.nn},t.prototype.equals=function(t){return this.tn===t.left()&&this.nn===t.right()},t}();function Ct(t,i){return null===t||null===i?t===i:t.equals(i)}var Dt,Tt=function(){function t(){this.hn=new Map,this.Ki=null}return t.prototype.setTimeScalePoints=function(t){var i=this;this.Ki=null,this.hn.clear(),t.forEach((function(t,n){var h=i.hn.get(t.timeWeight);void 0===h&&(h=[],i.hn.set(t.timeWeight,h)),h.push({index:n,time:t.time,weight:t.timeWeight})}))},t.prototype.build=function(t,i){var n=Math.ceil(i/t);return null!==this.Ki&&this.Ki.sn===n||(this.Ki={ii:this.rn(n),sn:n}),this.Ki.ii},t.prototype.rn=function(t){for(var i=[],n=0,h=Array.from(this.hn.keys()).sort((function(t,i){return i-t}));n<h.length;n++){var s=h[n];if(this.hn.get(s)){var r=i;i=[];for(var u=r.length,e=0,o=a(this.hn.get(s)),f=o.length,l=1/0,c=-1/0,v=0;v<f;v++){for(var d=o[v],_=d.index;e<u;){var w=r[e],M=w.index;if(!(M<_)){l=M;break}e++,i.push(w),c=M,l=1/0}l-_>=t&&_-c>=t&&(i.push(d),c=_)}for(;e<u;e++)i.push(r[e])}}return i},t}(),Et=function(){function t(t){this.un=t}return t.prototype.en=function(){return null===this.un?null:new St(Math.floor(this.un.left()),Math.ceil(this.un.right()))},t.prototype.on=function(){return this.un},t.an=function(){return new t(null)},t}();!function(t){t[t.Year=0]="Year",t[t.Month=1]="Month",t[t.DayOfMonth=2]="DayOfMonth",t[t.Time=3]="Time",t[t.TimeWithSeconds=4]="TimeWithSeconds"}(Dt||(Dt={}));var Lt=function(){function t(t,i,n){this.fn=0,this.ln=null,this.cn=[],this.Mi=null,this.wi=null,this.vn=new Tt,this.dn=new Map,this._n=Et.an(),this.wn=!0,this.Mn=new Z,this.bn=new Z,this.mn=new Z,this.gn=null,this.pn=null,this.yn=[],this.kt=i,this.pi=n,this.kn=i.rightOffset,this.xn=i.barSpacing,this.ot=t,this.Nn()}return t.prototype.options=function(){return this.kt},t.prototype.applyLocalizationOptions=function(t){c(this.pi,t),this.Sn(),this.Nn()},t.prototype.applyOptions=function(t,i){var n;c(this.kt,t),this.kt.fixLeftEdge&&this.Cn(),this.kt.fixRightEdge&&this.Dn(),void 0!==t.barSpacing&&this.ot.setBarSpacing(t.barSpacing),void 0!==t.rightOffset&&this.ot.setRightOffset(t.rightOffset),void 0!==t.minBarSpacing&&this.ot.setBarSpacing(null!==(n=t.barSpacing)&&void 0!==n?n:this.xn),this.Sn(),this.Nn(),this.mn.Wt()},t.prototype.indexToTime=function(t){var i;return(null===(i=this.cn[t])||void 0===i?void 0:i.time)||null},t.prototype.timeToIndex=function(t,i){if(this.cn.length<1)return null;if(t.timestamp>this.cn[this.cn.length-1].time.timestamp)return i?this.cn.length-1:null;for(var n=0;n<this.cn.length;++n){if(t.timestamp===this.cn[n].time.timestamp)return n;if(t.timestamp<this.cn[n].time.timestamp)return i?n:null}return null},t.prototype.isEmpty=function(){return 0===this.fn||0===this.cn.length},t.prototype.visibleStrictRange=function(){return this.Tn(),this._n.en()},t.prototype.visibleLogicalRange=function(){return this.Tn(),this._n.on()},t.prototype.visibleTimeRange=function(){var t=this.visibleStrictRange();if(null===t)return null;var i={from:t.left(),to:t.right()};return this.timeRangeForLogicalRange(i)},t.prototype.timeRangeForLogicalRange=function(t){var i=Math.round(t.from),n=Math.round(t.to),h=f(this.En()),s=f(this.Ln());return{from:f(this.indexToTime(Math.max(h,i))),to:f(this.indexToTime(Math.min(s,n)))}},t.prototype.logicalRangeForTimeRange=function(t){return{from:f(this.timeToIndex(t.from,!0)),to:f(this.timeToIndex(t.to,!0))}},t.prototype.tickMarks=function(){return this.vn},t.prototype.width=function(){return this.fn},t.prototype.setWidth=function(t){if(isFinite(t)&&!(t<=0)&&this.fn!==t){if(this.kt.lockVisibleTimeRangeOnResize&&this.fn){var i=this.xn*t/this.fn;this.Bn(i)}if(this.kt.fixLeftEdge){var n=this.visibleStrictRange();if(null!==n)if(n.left()<=0){var h=this.fn-t;this.kn-=Math.round(h/this.xn)+1}}this.fn=t,this.wn=!0,this.An(),this.On()}},t.prototype.indexToCoordinate=function(t){if(this.isEmpty()||!d(t))return 0;var i=this.baseIndex()+this.kn-t;return this.fn-(i+.5)*this.xn-1},t.prototype.indexesToCoordinates=function(t,i){for(var n=this.baseIndex(),h=void 0===i?0:i.from,s=void 0===i?t.length:i.to,r=h;r<s;r++){var u=t[r].time,e=n+this.kn-u,o=this.fn-(e+.5)*this.xn-1;t[r].x=o}},t.prototype.coordinateToIndex=function(t){return Math.ceil(this.Vn(t))},t.prototype.setRightOffset=function(t){this.wn=!0,this.kn=t,this.On(),this.ot.recalculateAllPanes(),this.ot.lightUpdate()},t.prototype.barSpacing=function(){return this.xn},t.prototype.setBarSpacing=function(t){this.Bn(t),this.On(),this.ot.recalculateAllPanes(),this.ot.lightUpdate()},t.prototype.rightOffset=function(){return this.kn},t.prototype.marks=function(){if(this.isEmpty())return null;if(null!==this.pn)return this.pn;for(var t=this.xn,i=5*(this.ot.options().layout.fontSize+4),n=Math.round(i/t),h=f(this.visibleStrictRange()),s=Math.max(h.left(),h.left()-n),r=Math.max(h.right(),h.right()-n),u=0,e=0,o=this.vn.build(t,i);e<o.length;e++){var a=o[e];if(s<=a.index&&a.index<=r){var l=this.indexToTime(a.index);if(null!==l){if(u<this.yn.length){var c=this.yn[u];c.coord=this.indexToCoordinate(a.index),c.label=this.zn(l,a.weight),c.weight=a.weight}else this.yn.push({coord:this.indexToCoordinate(a.index),label:this.zn(l,a.weight),weight:a.weight});u++}}}return this.yn.length=u,this.pn=this.yn,this.yn},t.prototype.restoreDefault=function(){this.wn=!0,this.setBarSpacing(this.kt.barSpacing),this.setRightOffset(this.kt.rightOffset)},t.prototype.setBaseIndex=function(t){this.wn=!0,this.ln=t,this.On(),this.Cn()},t.prototype.zoom=function(t,i){var n=this.Vn(t),h=this.barSpacing(),s=h+i*(h/10);this.setBarSpacing(s),this.kt.rightBarStaysOnScroll||this.setRightOffset(this.rightOffset()+(n-this.Vn(t)))},t.prototype.startScale=function(t){this.Mi&&this.endScroll(),null===this.wi&&null===this.gn&&(this.isEmpty()||(this.wi=t,this.Pn()))},t.prototype.scaleTo=function(t){if(null!==this.gn){var i=G(this.fn-t,0,this.fn),n=G(this.fn-f(this.wi),0,this.fn);0!==i&&0!==n&&this.setBarSpacing(this.gn.Fn*i/n)}},t.prototype.endScale=function(){null!==this.wi&&(this.wi=null,this.In())},t.prototype.startScroll=function(t){null===this.Mi&&null===this.gn&&(this.isEmpty()||(this.Mi=t,this.Pn()))},t.prototype.scrollTo=function(t){if(null!==this.Mi){var i=(this.Mi-t)/this.barSpacing();this.kn=f(this.gn).Wn+i,this.wn=!0,this.On()}},t.prototype.endScroll=function(){null!==this.Mi&&(this.Mi=null,this.In())},t.prototype.scrollToRealTime=function(){this.scrollToOffsetAnimated(this.kt.rightOffset)},t.prototype.scrollToOffsetAnimated=function(t,i){var n=this;if(void 0===i&&(i=400),!isFinite(t))throw new RangeError("offset is required and must be finite number");if(!isFinite(i)||i<=0)throw new RangeError("animationDuration (optional) must be finite positive number");var h=this.kn,s=Date.now(),r=function(){var u=(Date.now()-s)/i,e=u>=1,o=e?t:h+(t-h)*u;n.setRightOffset(o),e||setTimeout(r,20)};r()},t.prototype.update=function(t){this.wn=!0,this.cn=t,this.vn.setTimeScalePoints(t),this.On()},t.prototype.visibleBarsChanged=function(){return this.Mn},t.prototype.logicalRangeChanged=function(){return this.bn},t.prototype.optionsApplied=function(){return this.mn},t.prototype.baseIndex=function(){return this.ln||0},t.prototype.setVisibleRange=function(t){var i=t.count();this.Bn(this.fn/i),this.kn=t.right()-this.baseIndex(),this.On(),this.wn=!0,this.ot.recalculateAllPanes(),this.ot.lightUpdate()},t.prototype.fitContent=function(){var t=this.En(),i=this.Ln();null!==t&&null!==i&&this.setVisibleRange(new St(t,i+this.kt.rightOffset))},t.prototype.setLogicalRange=function(t){var i=new St(t.from,t.to);this.setVisibleRange(i)},t.prototype.formatDateTime=function(t){return void 0!==this.pi.timeFormatter?this.pi.timeFormatter(t.businessDay||t.timestamp):this.Rn.format(new Date(1e3*t.timestamp))},t.prototype.En=function(){return 0===this.cn.length?null:0},t.prototype.Ln=function(){return 0===this.cn.length?null:this.cn.length-1},t.prototype.Un=function(t){return(this.fn-1-t)/this.xn},t.prototype.Vn=function(t){var i=this.Un(t),n=this.baseIndex()+this.kn-i;return Math.round(1e6*n)/1e6},t.prototype.Bn=function(t){var i=this.xn;this.xn=t,this.An(),i!==this.xn&&(this.wn=!0,this.jn())},t.prototype.Tn=function(){if(this.wn)if(this.wn=!1,this.isEmpty())this.qn(Et.an());else{var t=this.baseIndex(),i=this.fn/this.xn,n=this.kn+t,h=new St(n-i+1,n);this.qn(new Et(h))}},t.prototype.An=function(){var t=this.Hn();if(this.xn<t&&(this.xn=t,this.wn=!0),0!==this.fn){var i=.5*this.fn;this.xn>i&&(this.xn=i,this.wn=!0)}},t.prototype.Hn=function(){return this.kt.fixLeftEdge&&this.kt.fixRightEdge?this.fn/this.cn.length:this.kt.minBarSpacing},t.prototype.On=function(){var t=this.Yn();this.kn>t&&(this.kn=t,this.wn=!0);var i=this.Kn();null!==i&&this.kn<i&&(this.kn=i,this.wn=!0)},t.prototype.Kn=function(){var t=this.En(),i=this.ln;return null===t||null===i?null:t-i-1+(this.kt.fixLeftEdge?this.fn/this.xn:Math.min(2,this.cn.length))},t.prototype.Yn=function(){return this.kt.fixRightEdge?0:this.fn/this.xn-Math.min(2,this.cn.length)},t.prototype.Pn=function(){this.gn={Fn:this.barSpacing(),Wn:this.rightOffset()}},t.prototype.In=function(){this.gn=null},t.prototype.zn=function(t,i){var n=this,h=this.dn.get(i);return void 0===h&&(h=new Nt((function(t){return n.$n(t,i)})),this.dn.set(i,h)),h.Ji(t)},t.prototype.$n=function(t,i){var n,h,s=this.kt.timeVisible;return h=i<20&&s?this.kt.secondsVisible?4:3:i<40&&s?3:i<50||i<60?2:i<70?1:0,void 0!==this.kt.tickMarkFormatter?this.kt.tickMarkFormatter(null!==(n=t.businessDay)&&void 0!==n?n:t.timestamp,h,this.pi.locale):function(t,i,n){var h={};switch(i){case 0:h.year="numeric";break;case 1:h.month="short";break;case 2:h.day="numeric";break;case 3:h.hour12=!1,h.hour="2-digit",h.minute="2-digit";break;case 4:h.hour12=!1,h.hour="2-digit",h.minute="2-digit",h.second="2-digit"}var s=void 0===t.businessDay?new Date(1e3*t.timestamp):new Date(Date.UTC(t.businessDay.year,t.businessDay.month-1,t.businessDay.day));return new Date(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate(),s.getUTCHours(),s.getUTCMinutes(),s.getUTCSeconds(),s.getUTCMilliseconds()).toLocaleString(n,h)}(t,h,this.pi.locale)},t.prototype.qn=function(t){var i=this._n;this._n=t,Ct(i.en(),this._n.en())||this.Mn.Wt(),Ct(i.on(),this._n.on())||this.bn.Wt(),this.jn()},t.prototype.jn=function(){this.pn=null},t.prototype.Sn=function(){this.jn(),this.dn.clear()},t.prototype.Nn=function(){var t=this.pi.dateFormat;this.kt.timeVisible?this.Rn=new xt({Pi:t,Fi:this.kt.secondsVisible?"%h:%m:%s":"%h:%m",Ii:"   ",Wi:this.pi.locale}):this.Rn=new pt(t,this.pi.locale)},t.prototype.Cn=function(){if(this.kt.fixLeftEdge){var t=this.En();if(null!==t){var i=f(this.visibleStrictRange()).left()-t;if(i<0){var n=this.kn-i-1;this.setRightOffset(n)}this.An()}}},t.prototype.Dn=function(){this.On(),this.An()},t}();function Bt(t){return!v(t)&&!_(t)}function At(t){return v(t)}var Ot="'Trebuchet MS', Roboto, Ubuntu, sans-serif";function Vt(t,i,n){return void 0!==n?n+=" ":n="",void 0===i&&(i=Ot),""+n+t+"px "+i}var zt=function(){function t(t){this.Xn={borderSize:1,tickLength:4,fontSize:NaN,font:"",fontFamily:"",color:"",paddingBottom:0,paddingInner:0,paddingOuter:0,paddingTop:0,baselineOffset:0,width:0},this.C=t}return t.prototype.options=function(){var t=this.Xn,i=this.Zn(),n=this.Jn();return t.fontSize===i&&t.fontFamily===n||(t.fontSize=i,t.fontFamily=n,t.font=Vt(i,n),t.paddingTop=Math.floor(i/3.5),t.paddingBottom=t.paddingTop,t.paddingInner=Math.max(Math.ceil(i/2-t.tickLength/2),0),t.paddingOuter=Math.ceil(i/2+t.tickLength/2),t.baselineOffset=Math.round(i/10)),t.color=this.Gn(),t.width=this.fn(),this.Xn},t.prototype.fn=function(){return this.C.options().rightPriceScale.width},t.prototype.Gn=function(){return this.C.options().layout.textColor},t.prototype.Zn=function(){return this.C.options().layout.fontSize},t.prototype.Jn=function(){return this.C.options().layout.fontFamily},t}();function Pt(t){return"left"===t||"right"===t}var Ft=function(){function t(t){this.Qn=new Map,this.th=!1,this.ih=[],this.nh=t}return t.prototype.invalidatePane=function(t,i){var n=function(t,i){return void 0===t?i:{level:Math.max(t.level,i.level),autoScale:t.autoScale||i.autoScale}}(this.Qn.get(t),i);this.Qn.set(t,n)},t.prototype.fullInvalidation=function(){return this.nh},t.prototype.invalidateForPane=function(t){var i=this.Qn.get(t);return void 0===i?{level:this.nh}:{level:Math.max(this.nh,i.level),autoScale:i.autoScale}},t.prototype.setFitContent=function(){this.ih=[{type:0}]},t.prototype.applyRange=function(t){this.ih=[{type:1,value:t}]},t.prototype.resetTimeScale=function(){this.ih=[{type:4}]},t.prototype.setBarSpacing=function(t){this.ih.push({type:2,value:t})},t.prototype.setRightOffset=function(t){this.ih.push({type:3,value:t})},t.prototype.timeScaleInvalidations=function(){return this.ih},t.prototype.merge=function(t){var i=this;this.th=this.th||t.th,this.ih=this.ih.concat(t.ih);for(var n=0,h=t.ih;n<h.length;n++){var s=h[n];this.hh(s)}this.nh=Math.max(this.nh,t.nh),t.Qn.forEach((function(t,n){i.invalidatePane(n,t)}))},t.prototype.hh=function(t){switch(t.type){case 0:this.setFitContent();break;case 1:this.applyRange(t.value);break;case 2:this.setBarSpacing(t.value);break;case 3:this.setRightOffset(t.value);break;case 4:this.resetTimeScale()}},t}(),It=function(){function t(t){this.sh=t}return t.prototype.format=function(t){var i="";return t<0&&(i="-",t=-t),t<995?i+this.rh(t):t<999995?i+this.rh(t/1e3)+"K":t<999999995?(t=1e3*Math.round(t/1e3),i+this.rh(t/1e6)+"M"):(t=1e6*Math.round(t/1e6),i+this.rh(t/1e9)+"B")},t.prototype.rh=function(t){var i=Math.pow(10,this.sh);return((t=Math.round(t*i)/i)>=1e-15&&t<1?t.toFixed(this.sh).replace(/\.?0+$/,""):String(t)).replace(/(\.[1-9]*)0+$/,(function(t,i){return i}))},t}();function Wt(t,i,n,h){if(0!==i.length){var s=h.from,r=i[s].x,u=i[s].y;if(t.moveTo(r,u),s++,1===n)for(;s<h.to;s++){var e=i[s],o=i[s-1].y;t.lineTo(e.x,o),t.lineTo(e.x,e.y)}else if(2===n)for(var a=!0;s<h.to;s++){null!==(e=i[s]).price?(a&&(t.moveTo(e.x,e.y),a=!1),t.lineTo(e.x,e.y)):a=!0}else for(;s<h.to;s++){e=i[s];t.lineTo(e.x,e.y)}}}var Rt=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.o=null,i}return r(i,t),i.prototype.l=function(t){this.o=t},i.prototype.h=function(t){if(null!==this.o&&0!==this.o._.length&&null!==this.o.v){if(t.lineCap="butt",t.lineJoin="round",t.strokeStyle=this.o.g,t.lineWidth=this.o.W,n(t,this.o.U),t.lineWidth=1,t.beginPath(),1===this.o._.length){var i=this.o._[0],h=this.o.uh/2;t.moveTo(i.x-h,this.o.eh),t.lineTo(i.x-h,i.y),t.lineTo(i.x+h,i.y),t.lineTo(i.x+h,this.o.eh)}else t.moveTo(this.o._[this.o.v.from].x,this.o.eh),t.lineTo(this.o._[this.o.v.from].x,this.o._[this.o.v.from].y),Wt(t,this.o._,this.o.oh,this.o.v),this.o.v.to>this.o.v.from&&(t.lineTo(this.o._[this.o.v.to-1].x,this.o.eh),t.lineTo(this.o._[this.o.v.from].x,this.o.eh));t.closePath();var s=t.createLinearGradient(0,0,0,this.o.eh);s.addColorStop(0,this.o.ah),s.addColorStop(1,this.o.fh),t.fillStyle=s,t.fill()}},i}(p),Ut=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.o=null,i}return r(i,t),i.prototype.l=function(t){this.o=t},i.prototype.h=function(t){if(null!==this.o&&0!==this.o._.length&&null!==this.o.v){if(t.lineCap="butt",t.lineWidth=this.o.W,n(t,this.o.U),t.strokeStyle=this.o.g,t.lineJoin="round",t.beginPath(),1===this.o._.length){var i=this.o._[0];t.moveTo(i.x-this.o.uh/2,i.y),t.lineTo(i.x+this.o.uh/2,i.y)}else Wt(t,this.o._,this.o.oh,this.o.v);t.stroke()}},i}(p);function jt(t,i,n,h,s){void 0===h&&(h=0),void 0===s&&(s=t.length);for(var r=s-h;0<r;){var u=r>>1,e=h+u;n(t[e],i)?(h=e+1,r-=u+1):r=u}return h}function qt(t,i,n,h,s){void 0===h&&(h=0),void 0===s&&(s=t.length);for(var r=s-h;0<r;){var u=r>>1,e=h+u;n(i,t[e])?r=u:(h=e+1,r-=u+1)}return h}function Ht(t,i){return t.time<i}function Yt(t,i){return t<i.time}function Kt(t,i,n){var h=i.left(),s=i.right(),r=jt(t,h,Ht),u=qt(t,s,Yt);if(!n)return{from:r,to:u};var e=r,o=u;return r>0&&r<t.length&&t[r].time>=h&&(e=r-1),u>0&&u<t.length&&t[u-1].time<=s&&(o=u+1),{from:e,to:o}}var $t=function(){function t(t,i,n){this.lh=!0,this.dh=!0,this._h=!0,this.wh=[],this.Mh=null,this.bh=t,this.mh=i,this.gh=n}return t.prototype.update=function(t){this.lh=!0,"data"===t&&(this.dh=!0),"options"===t&&(this._h=!0)},t.prototype.ph=function(){this.dh&&(this.yh(),this.dh=!1),this.lh&&(this.kh(),this.lh=!1),this._h&&(this.xh(),this._h=!1)},t.prototype.Nh=function(){this.Mh=null},t.prototype.kh=function(){var t=this.bh.priceScale(),i=this.mh.timeScale();if(this.Nh(),!i.isEmpty()&&!t.isEmpty()){var n=i.visibleStrictRange();if(null!==n&&0!==this.bh.bars().size()){var h=this.bh.firstValue();null!==h&&(this.Mh=Kt(this.wh,n,this.gh),this.Sh(t,i,h.value))}}},t}(),Xt=function(t){function i(i,n){return t.call(this,i,n,!0)||this}return r(i,t),i.prototype.Sh=function(t,i,n){i.indexesToCoordinates(this.wh,m(this.Mh)),t.pointsArrayToCoordinates(this.wh,n,m(this.Mh))},i.prototype.Ch=function(t,i){return{time:t,price:i,x:NaN,y:NaN}},i.prototype.xh=function(){},i.prototype.yh=function(){var t=this,i=this.bh.barColorer();this.wh=this.bh.bars().rows().map((function(n){var h=n.value[3];return t.Dh(n.index,h,i)}))},i}($t),Zt=function(t){function i(i,n){var h=t.call(this,i,n)||this;return h.q=new g,h.Th=new Rt,h.Eh=new Ut,h.q.i([h.Th,h.Eh]),h}return r(i,t),i.prototype.renderer=function(t,i){if(!this.bh.visible())return null;var n=this.bh.options();this.ph();var h={oh:n.lineType,_:this.wh,g:n.lineColor,U:n.lineStyle,W:n.lineWidth,ah:n.topColor,fh:n.bottomColor,eh:t,v:this.Mh,uh:this.mh.timeScale().barSpacing()};return this.Th.l(h),this.Eh.l(h),this.q},i.prototype.Dh=function(t,i){return this.Ch(t,i)},i}(Xt);var Jt=function(){function t(){this.L=null,this.Lh=0,this.Bh=0}return t.prototype.l=function(t){this.L=t},t.prototype.draw=function(t,i,n,h){if(null!==this.L&&0!==this.L.Ah.length&&null!==this.L.v){if(this.Lh=this.Oh(i),this.Lh>=2)Math.max(1,Math.floor(i))%2!=this.Lh%2&&this.Lh--;this.Bh=this.L.Vh?Math.min(this.Lh,Math.floor(i)):this.Lh;for(var s=null,r=this.Bh<=this.Lh&&this.L.Fn>=Math.floor(1.5*i),u=this.L.v.from;u<this.L.v.to;++u){var e=this.L.Ah[u];s!==e.R&&(t.fillStyle=e.R,s=e.R);var o=Math.floor(.5*this.Bh),a=Math.round(e.x*i),f=a-o,l=this.Bh,c=f+l-1,v=Math.min(e.highY,e.lowY),d=Math.max(e.highY,e.lowY),_=Math.round(v*i)-o,w=Math.round(d*i)+o,M=Math.max(w-_,this.Bh);t.fillRect(f,_,l,M);var b=Math.ceil(1.5*this.Lh);if(r){if(this.L.zh){var m=a-b,g=Math.max(_,Math.round(e.openY*i)-o),p=g+l-1;p>_+M-1&&(g=(p=_+M-1)-l+1),t.fillRect(m,g,f-m,p-g+1)}var y=a+b,k=Math.max(_,Math.round(e.closeY*i)-o),x=k+l-1;x>_+M-1&&(k=(x=_+M-1)-l+1),t.fillRect(c+1,k,y-c,x-k+1)}}}},t.prototype.Oh=function(t){var i=Math.floor(t);return Math.max(i,Math.floor(function(t,i){return Math.floor(.3*t*i)}(f(this.L).Fn,t)))},t}(),Gt=function(t){function i(i,n){return t.call(this,i,n,!1)||this}return r(i,t),i.prototype.Sh=function(t,i,n){i.indexesToCoordinates(this.wh,m(this.Mh)),t.barPricesToCoordinates(this.wh,n,m(this.Mh))},i.prototype.Ph=function(t,i,n){return{time:t,open:i.value[0],high:i.value[1],low:i.value[2],close:i.value[3],x:NaN,openY:NaN,highY:NaN,lowY:NaN,closeY:NaN}},i.prototype.yh=function(){var t=this,i=this.bh.barColorer();this.wh=this.bh.bars().rows().map((function(n){return t.Dh(n.index,n,i)}))},i}($t),Qt=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.q=new Jt,i}return r(i,t),i.prototype.renderer=function(t,i){if(!this.bh.visible())return null;var n=this.bh.options();this.ph();var h={Ah:this.wh,Fn:this.mh.timeScale().barSpacing(),zh:n.openVisible,Vh:n.thinBars,v:this.Mh};return this.q.l(h),this.q},i.prototype.xh=function(){var t=this;this.wh.forEach((function(i){i.R=t.bh.barColorer().barStyle(i.time).barColor}))},i.prototype.Dh=function(t,i,n){return u(u({},this.Ph(t,i,n)),{R:n.barStyle(t).barColor})},i}(Gt),ti=function(){function t(){this.L=null,this.Lh=0}return t.prototype.l=function(t){this.L=t},t.prototype.draw=function(t,i,n,h){if(null!==this.L&&0!==this.L.Ah.length&&null!==this.L.v){if(this.Lh=function(t,i){if(t>=2.5&&t<=4)return Math.floor(3*i);var n=1-.2*Math.atan(Math.max(4,t)-4)/(.5*Math.PI),h=Math.floor(t*n*i),s=Math.floor(t*i),r=Math.min(h,s);return Math.max(Math.floor(i),r)}(this.L.Fn,i),this.Lh>=2)Math.floor(i)%2!=this.Lh%2&&this.Lh--;var s=this.L.Ah;this.L.Fh&&this.Ih(t,s,this.L.v,i),this.L.Wh&&this.Rh(t,s,this.L.v,this.L.Fn,i);var r=this.Uh(i);(!this.L.Wh||this.Lh>2*r)&&this.jh(t,s,this.L.v,i)}},t.prototype.Ih=function(t,i,n,h){if(null!==this.L){var s="",r=Math.min(Math.floor(h),Math.floor(this.L.Fn*h));r=Math.max(Math.floor(h),Math.min(r,this.Lh));for(var u=Math.floor(.5*r),e=null,o=n.from;o<n.to;o++){var a=i[o];a.qh!==s&&(t.fillStyle=a.qh,s=a.qh);var f=Math.round(Math.min(a.openY,a.closeY)*h),l=Math.round(Math.max(a.openY,a.closeY)*h),c=Math.round(a.highY*h),v=Math.round(a.lowY*h),d=Math.round(h*a.x)-u,_=d+r-1;null!==e&&(d=Math.max(e+1,d),d=Math.min(d,_));var w=_-d+1;t.fillRect(d,c,w,f-c),t.fillRect(d,l+1,w,v-l),e=_}}},t.prototype.Uh=function(t){var i=Math.floor(1*t);this.Lh<=2*i&&(i=Math.floor(.5*(this.Lh-1)));var n=Math.max(Math.floor(t),i);return this.Lh<=2*n?Math.max(Math.floor(t),Math.floor(1*t)):n},t.prototype.Rh=function(t,i,n,h,s){if(null!==this.L)for(var r="",u=this.Uh(s),e=null,o=n.from;o<n.to;o++){var a=i[o];a.Hh!==r&&(t.fillStyle=a.Hh,r=a.Hh);var f=Math.round(a.x*s)-Math.floor(.5*this.Lh),l=f+this.Lh-1,c=Math.round(Math.min(a.openY,a.closeY)*s),v=Math.round(Math.max(a.openY,a.closeY)*s);if(null!==e&&(f=Math.max(e+1,f),f=Math.min(f,l)),this.L.Fn*s>2*u)O(t,f,c,l-f+1,v-c+1,u);else{var d=l-f+1;t.fillRect(f,c,d,v-c+1)}e=l}},t.prototype.jh=function(t,i,n,h){if(null!==this.L)for(var s="",r=this.Uh(h),u=n.from;u<n.to;u++){var e=i[u],o=Math.round(Math.min(e.openY,e.closeY)*h),a=Math.round(Math.max(e.openY,e.closeY)*h),f=Math.round(e.x*h)-Math.floor(.5*this.Lh),l=f+this.Lh-1;if(e.R!==s){var c=e.R;t.fillStyle=c,s=c}this.L.Wh&&(f+=r,o+=r,l-=r,a-=r),o>a||t.fillRect(f,o,l-f+1,a-o+1)}},t}(),ii=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.q=new ti,i}return r(i,t),i.prototype.renderer=function(t,i){if(!this.bh.visible())return null;var n=this.bh.options();this.ph();var h={Ah:this.wh,Fn:this.mh.timeScale().barSpacing(),Fh:n.wickVisible,Wh:n.borderVisible,v:this.Mh};return this.q.l(h),this.q},i.prototype.xh=function(){var t=this;this.wh.forEach((function(i){var n=t.bh.barColorer().barStyle(i.time);i.R=n.barColor,i.qh=n.barWickColor,i.Hh=n.barBorderColor}))},i.prototype.Dh=function(t,i,n){var h=n.barStyle(t);return u(u({},this.Ph(t,i,n)),{R:h.barColor,qh:h.barWickColor,Hh:h.barBorderColor})},i}(Gt),ni=function(){function t(){this.L=null,this.Yh=[]}return t.prototype.l=function(t){this.L=t,this.Yh=[]},t.prototype.draw=function(t,i,n,h){if(null!==this.L&&0!==this.L._.length&&null!==this.L.v){this.Yh.length||this.Kh(i);for(var s=Math.max(1,Math.floor(i)),r=Math.round(this.L.$h*i)-Math.floor(s/2),u=r+s,e=this.L.v.from;e<this.L.v.to;e++){var o=this.L._[e],a=this.Yh[e-this.L.v.from],f=Math.round(o.y*i);t.fillStyle=o.R;var l=void 0,c=void 0;f<=r?(l=f,c=u):(l=r,c=f-Math.floor(s/2)+s),t.fillRect(a.Xh,l,a.Zh-a.Xh+1,c-l)}}},t.prototype.Kh=function(t){if(null!==this.L&&0!==this.L._.length&&null!==this.L.v){var i=Math.ceil(this.L.Fn*t)<=1?0:Math.max(1,Math.floor(t)),n=Math.round(this.L.Fn*t)-i;this.Yh=new Array(this.L.v.to-this.L.v.from);for(var h=this.L.v.from;h<this.L.v.to;h++){var s,r=this.L._[h],u=Math.round(r.x*t),e=void 0,o=void 0;if(n%2)e=u-(s=(n-1)/2),o=u+s;else e=u-(s=n/2),o=u+s-1;this.Yh[h-this.L.v.from]={Xh:e,Zh:o,Jh:u,Gh:r.x*t,at:r.time}}for(h=this.L.v.from+1;h<this.L.v.to;h++){var a=this.Yh[h-this.L.v.from],f=this.Yh[h-this.L.v.from-1];a.at===f.at+1&&(a.Xh-f.Zh!==i+1&&(f.Jh>f.Gh?f.Zh=a.Xh-i-1:a.Xh=f.Zh+i+1))}var l=Math.ceil(this.L.Fn*t);for(h=this.L.v.from;h<this.L.v.to;h++){(a=this.Yh[h-this.L.v.from]).Zh<a.Xh&&(a.Zh=a.Xh);var c=a.Zh-a.Xh+1;l=Math.min(c,l)}if(i>0&&l<4)for(h=this.L.v.from;h<this.L.v.to;h++){(c=(a=this.Yh[h-this.L.v.from]).Zh-a.Xh+1)>l&&(a.Jh>a.Gh?a.Zh-=1:a.Xh+=1)}}else this.Yh=[]},t}();function hi(t){return{_:[],Fn:t,$h:NaN,v:null}}function si(t,i,n){return{time:t,price:i,x:NaN,y:NaN,R:n}}var ri=function(t){function i(i,n){var h=t.call(this,i,n,!1)||this;return h.p=new g,h.Qh=hi(0),h.q=new ni,h}return r(i,t),i.prototype.renderer=function(t,i){return this.bh.visible()?(this.ph(),this.p):null},i.prototype.yh=function(){var t=this.mh.timeScale().barSpacing();this.Qh=hi(t);for(var i=0,n=0,h=this.bh.options().color,s=0,r=this.bh.bars().rows();s<r.length;s++){var u=r[s],e=u.value[3],o=void 0!==u.color?u.color:h,a=si(u.index,e,o);++i<this.Qh._.length?this.Qh._[i]=a:this.Qh._.push(a),this.wh[n++]={time:u.index,x:0}}this.q.l(this.Qh),this.p.i([this.q])},i.prototype.xh=function(){},i.prototype.Nh=function(){t.prototype.Nh.call(this),this.Qh.v=null},i.prototype.Sh=function(t,i,n){if(null!==this.Mh){var h=i.barSpacing(),s=f(i.visibleStrictRange()),r=t.priceToCoordinate(this.bh.options().base,n);i.indexesToCoordinates(this.Qh._),t.pointsArrayToCoordinates(this.Qh._,n),this.Qh.$h=r,this.Qh.v=Kt(this.Qh._,s,!1),this.Qh.Fn=h,this.q.l(this.Qh)}},i}($t),ui=function(t){function i(i,n){var h=t.call(this,i,n)||this;return h.Eh=new Ut,h}return r(i,t),i.prototype.renderer=function(t,i){if(!this.bh.visible())return null;var n=this.bh.options();this.ph();var h={_:this.wh,g:n.color,U:n.lineStyle,oh:n.lineType,W:n.lineWidth,v:this.Mh,uh:this.mh.timeScale().barSpacing()};return this.Eh.l(h),this.Eh},i.prototype.Dh=function(t,i){return this.Ch(t,i)},i}(Xt),ei=/[2-9]/g,oi=function(){function t(t){void 0===t&&(t=50),this.Ki=new Map,this.ts=0,this.ns=Array.from(new Array(t))}return t.prototype.reset=function(){this.Ki.clear(),this.ns.fill(void 0)},t.prototype.measureText=function(t,i,n){var h=n||ei,s=String(i).replace(h,"0"),r=this.Ki.get(s);if(void 0===r){if(0===(r=t.measureText(s).width)&&0!==i.length)return 0;var u=this.ns[this.ts];void 0!==u&&this.Ki.delete(u),this.ns[this.ts]=s,this.ts=(this.ts+1)%this.ns.length,this.Ki.set(s,r)}return r},t}(),ai=function(){function t(t){this.hs=null,this.Xn=null,this.ss="right",this.fn=0,this.rs=t}return t.prototype.us=function(t,i,n,h){this.hs=t,this.Xn=i,this.fn=n,this.ss=h},t.prototype.draw=function(t,i){null!==this.Xn&&null!==this.hs&&this.hs.draw(t,this.Xn,this.rs,this.fn,this.ss,i)},t}(),fi=function(){function t(t,i,n){this.es=t,this.rs=new oi(50),this.os=i,this.C=n,this.Zn=-1,this.q=new ai(this.rs)}return t.prototype.renderer=function(t,i){var n=this.C.paneForSource(this.os);if(null===n)return null;var h=n.isOverlay(this.os)?n.defaultPriceScale():this.os.priceScale();if(null===h)return null;var s=n.priceScalePosition(h);if("overlay"===s)return null;var r=this.C.priceAxisRendererOptions();return r.fontSize!==this.Zn&&(this.Zn=r.fontSize,this.rs.reset()),this.q.us(this.es.paneRenderer(),r,i,s),this.q},t}(),li=function(){function t(){this.L=null}return t.prototype.l=function(t){this.L=t},t.prototype.draw=function(t,i,s,r){if(null!==this.L&&!1!==this.L.B){var u=Math.round(this.L.P*i);if(!(u<0||u>Math.ceil(this.L.fs*i))){var e=Math.ceil(this.L.ls*i);t.lineCap="butt",t.strokeStyle=this.L.R,t.lineWidth=Math.floor(this.L.W*i),n(t,this.L.U),h(t,u,0,e)}}},t}(),ci=function(){function t(t){this.cs={ls:0,fs:0,P:0,R:"rgba(0, 0, 0, 0)",W:1,U:0,B:!1},this.vs=new li,this.S=!0,this.bh=t,this.mh=t.model(),this.vs.l(this.cs)}return t.prototype.Y=function(){this.S=!0},t.prototype.renderer=function(t,i){return this.bh.visible()?(this.S&&(this.ds(t,i),this.S=!1),this.vs):null},t}(),vi=function(t){function i(i){return t.call(this,i)||this}return r(i,t),i.prototype.ds=function(t,i){this.cs.B=!1;var n=this.bh.priceScale(),h=n.mode().mode;if(2===h||3===h){var s=this.bh.options();if(s.baseLineVisible&&this.bh.visible()){var r=this.bh.firstValue();null!==r&&(this.cs.B=!0,this.cs.P=n.priceToCoordinate(r.value,r.value),this.cs.ls=i,this.cs.fs=t,this.cs.R=s.baseLineColor,this.cs.W=s.baseLineWidth,this.cs.U=s.baseLineStyle)}}},i}(ci);function di(t,i){return nt(Math.min(Math.max(t,12),30)*i)}function _i(t,i){switch(t){case"arrowDown":case"arrowUp":return di(i,1);case"circle":return di(i,.8);case"square":return di(i,.7);case"triangleDown":case"triangleUp":return di(i,.7)}}function wi(t){return it(di(t,1))}function Mi(t){return Math.max(di(t,.1),3)}function bi(t,i,n,h,s){var r=_i("square",n),u=(r-1)/2,e=t-u,o=i-u;return h>=e&&h<=e+r&&s>=o&&s<=o+r}function mi(t,i,n,h,s,r,u){var e=i.fillStyle,o=(_i("arrowUp",s)-1)/2,a=(nt(s/2)-1)/2;if(u&&(i.fillStyle=u),i.beginPath(),t?(i.moveTo(n-o,h),i.lineTo(n,h-o),i.lineTo(n+o,h),i.lineTo(n+a,h),i.lineTo(n+a,h+o),i.lineTo(n-a,h+o),i.lineTo(n-a,h)):(i.moveTo(n-o,h),i.lineTo(n,h+o),i.lineTo(n+o,h),i.lineTo(n+a,h),i.lineTo(n+a,h-o),i.lineTo(n-a,h-o),i.lineTo(n-a,h)),u){var f=r||2,l=2*f;i.fill(),i.beginPath(),i.fillStyle=e,t?(i.moveTo(n-o+l,h-f),i.lineTo(n,h-o+f),i.lineTo(n+o-l,h-f),i.lineTo(n+a-f,h-f),i.lineTo(n+a-f,h+o-f),i.lineTo(n-a+f,h+o-f),i.lineTo(n-a+f,h-f)):(i.moveTo(n-o+l,h+f),i.lineTo(n,h+o-f),i.lineTo(n+o-l,h+f),i.lineTo(n+a-f,h+f),i.lineTo(n+a-f,h-o+f),i.lineTo(n-a+f,h-o+f),i.lineTo(n-a+f,h+f))}i.fill()}function gi(t,i,n,h,s,r){return bi(i,n,h,s,r)}function pi(t,i,n,h,s,r,u){var e=i.fillStyle,o=(_i("triangleUp",s)-1)/2,a=n-o,f=n+o,l=h-o,c=h+o;if(i.beginPath(),u&&(i.fillStyle=u),t?(i.moveTo(a,c),i.lineTo(n,l),i.lineTo(f,c)):(i.moveTo(a,l),i.lineTo(n,c),i.lineTo(f,l)),u){var v=r||2,d=2*v;i.fill(),i.beginPath(),i.fillStyle=e,t?(i.moveTo(a+v,c-v),i.lineTo(n,l+d),i.lineTo(f-v,c-v)):(i.moveTo(a+v,l+v),i.lineTo(n,c-d),i.lineTo(f-v,l+v))}i.fill()}function yi(t,i,n,h,s,r){return bi(i,n,h,s,r)}var ki=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.L=null,i.rs=new oi,i.Zn=-1,i.Jn="",i._s="",i}return r(i,t),i.prototype.l=function(t){this.L=t},i.prototype.us=function(t,i){this.Zn===t&&this.Jn===i||(this.Zn=t,this.Jn=i,this._s=Vt(t,i),this.rs.reset())},i.prototype.hitTest=function(t,i){if(null===this.L||null===this.L.v)return null;for(var n=this.L.v.from;n<this.L.v.to;n++){var h=this.L._[n];if(Ni(h,t,i))return{hitTestData:h.ws,externalId:h.Ms}}return null},i.prototype.h=function(t,i,n){if(null!==this.L&&null!==this.L.v){t.textBaseline="middle",t.font=this._s;for(var h=this.L.v.from;h<this.L.v.to;h++){var s=this.L._[h];void 0!==s.bs&&(s.bs.ls=this.rs.measureText(t,s.bs.gs),s.bs.fs=this.Zn),xi(s,t)}}},i}(p);function xi(t,i){i.fillStyle=t.R,void 0!==t.bs&&function(t,i,n,h){t.fillText(i,n,h)}(i,t.bs.gs,t.x-t.bs.ls/2,t.bs.P),function(t,i){if(0===t.ps)return;switch(t.ys){case"arrowDown":return void mi(!1,i,t.x,t.P,t.ps,t.ks,t.Hh);case"arrowUp":return void mi(!0,i,t.x,t.P,t.ps,t.ks,t.Hh);case"triangleDown":return void pi(!1,i,t.x,t.P,t.ps,t.ks,t.Hh);case"triangleUp":return void pi(!0,i,t.x,t.P,t.ps,t.ks,t.Hh);case"circle":return void function(t,i,n,h,s,r){var u=t.fillStyle,e=(_i("circle",h)-1)/2;if(r&&(t.fillStyle=r),t.beginPath(),t.arc(i,n,e,0,2*Math.PI,!1),r){var o=s||2;t.fill(),t.beginPath(),t.fillStyle=u,t.arc(i,n,e-o,0,2*Math.PI,!1)}t.fill()}(i,t.x,t.P,t.ps,t.ks,t.Hh);case"square":return void function(t,i,n,h,s,r){var u=t.fillStyle,e=_i("square",h),o=(e-1)/2,a=i-o,f=n-o;if(r&&(t.fillStyle=r),t.fillRect(a,f,e,e),r){var l=s||2,c=2*l;t.fillStyle=u,t.fillRect(a+l,f+l,e-c,e-c)}}(i,t.x,t.P,t.ps,t.ks,t.Hh)}t.ys}(t,i)}function Ni(t,i,n){return!(void 0===t.bs||!function(t,i,n,h,s,r){var u=h/2;return s>=t&&s<=t+n&&r>=i-u&&r<=i+u}(t.x,t.bs.P,t.bs.ls,t.bs.fs,i,n))||function(t,i,n){if(0===t.ps)return!1;switch(t.ys){case"arrowUp":case"arrowDown":return gi(0,t.x,t.P,t.ps,i,n);case"triangleUp":case"triangleDown":return yi(0,t.x,t.P,t.ps,i,n);case"circle":return function(t,i,n,h,s){var r=2+_i("circle",n)/2,u=t-h,e=i-s;return Math.sqrt(u*u+e*e)<=r}(t.x,t.P,t.ps,i,n);case"square":return bi(t.x,t.P,t.ps,i,n)}t.ys}(t,i,n)}function Si(t,i,n,h,s,r,u,e,o){var a=v(n)?n:n.close,f=v(n)?n:n.high,l=v(n)?n:n.low,c=v(i.size)?Math.max(i.size,0):1,d=wi(e.barSpacing())*c,_=d/2;if(t.ps=d,"number"==typeof i.position)return t.P=u.priceToCoordinate(i.position,o),void(void 0!==t.bs&&(t.bs.P=t.P+_+r+.6*s));switch(i.position){case"inBar":return t.P=u.priceToCoordinate(a,o),void(void 0!==t.bs&&(t.bs.P=t.P+_+r+.6*s));case"aboveBar":return t.P=u.priceToCoordinate(f,o)-_-h.xs,void 0!==t.bs&&(t.bs.P=t.P-_-.6*s,h.xs+=1.2*s),void(h.xs+=d+r);case"belowBar":return t.P=u.priceToCoordinate(l,o)+_+h.Ns,void 0!==t.bs&&(t.bs.P=t.P+_+r+.6*s,h.Ns+=1.2*s),void(h.Ns+=d+r)}i.position}var Ci=function(){function t(t,i){this.S=!0,this.Ss=!0,this.Cs=!0,this.Ds=null,this.q=new ki,this.Ts=t,this.ot=i,this.L={_:[],v:null}}return t.prototype.update=function(t){this.S=!0,this.Cs=!0,"data"===t&&(this.Ss=!0)},t.prototype.renderer=function(t,i,n){if(!this.Ts.visible())return null;this.S&&this.ph();var h=this.ot.options().layout;return this.q.us(h.fontSize,h.fontFamily),this.q.l(this.L),this.q},t.prototype.Es=function(){if(this.Cs){if(this.Ts.indexedMarkers().length>0){var t=this.ot.timeScale().barSpacing(),i=Mi(t),n=1.5*wi(t)+2*i;this.Ds={above:n,below:n}}else this.Ds=null;this.Cs=!1}return this.Ds},t.prototype.ph=function(){var t=this.Ts.priceScale(),i=this.ot.timeScale(),n=this.Ts.indexedMarkers();this.Ss&&(this.L._=n.map((function(t){return{time:t.time,x:0,P:0,ps:0,ys:t.shape,R:t.color,ws:t.internalId,Ms:t.id,bs:void 0,Hh:t.borderColor,ks:t.borderSize}})),this.Ss=!1);var h=this.ot.options().layout;this.L.v=null;var s=i.visibleStrictRange();if(null!==s){var r=this.Ts.firstValue();if(null!==r&&0!==this.L._.length){var u=NaN,e=Mi(i.barSpacing()),o={xs:e,Ns:e};this.L.v=Kt(this.L._,s,!0);for(var a=this.L.v.from;a<this.L.v.to;a++){var f=n[a];f.time!==u&&(o.xs=e,o.Ns=e,u=f.time);var l=this.L._[a];l.x=i.indexToCoordinate(f.time),void 0!==f.text&&f.text.length>0&&(l.bs={gs:f.text,P:0,ls:0,fs:0});var c=this.Ts.dataAt(f.time);null!==c&&Si(l,f,c,o,h.fontSize,e,t,i,r.value)}this.S=!1}}},t}(),Di=function(t){function i(i){return t.call(this,i)||this}return r(i,t),i.prototype.ds=function(t,i){var n=this.cs;n.B=!1;var h=this.bh.options();if(h.priceLineVisible&&this.bh.visible()){var s=this.bh.lastValueData(0===h.priceLineSource);s.noData||(n.B=!0,n.P=s.coordinate,n.R=this.bh.priceLineColor(s.color),n.ls=i,n.fs=t,n.W=h.priceLineWidth,n.U=h.priceLineStyle)}},i}(ci),Ti=function(t){function i(i){var n=t.call(this)||this;return n.H=i,n}return r(i,t),i.prototype.ht=function(t,i,n){if(t.visible=!1,i.visible=!1,this.H.visible()){var h=this.H.options(),s=h.lastValueVisible,r=""!==this.H.title(),u=0===h.seriesLastValueMode,e=this.H.lastValueData(0===h.priceLineSource);if(!e.noData){s&&(t.text=this.Ls(e,s,u),t.visible=0!==t.text.length),(r||u)&&(i.text=this.Bs(e,s,r,u),i.visible=i.text.length>0);var o=this.H.priceLineColor(e.color),a=A(o);n.background=a.K,n.color=a.$,n.coordinate=e.coordinate,i.borderColor=this.H.model().options().layout.backgroundColor,t.borderColor=o}}},i.prototype.Bs=function(t,i,n,h){var s="",r=this.H.title();return n&&0!==r.length&&(s+=r+" "),i&&h&&(s+=this.H.priceScale().isPercentage()?t.formattedPriceAbsolute:t.formattedPricePercentage),s.trim()},i.prototype.Ls=function(t,i,n){return i?n?this.H.priceScale().isPercentage()?t.formattedPricePercentage:t.formattedPriceAbsolute:t.text:""},i}(I),Ei=function(){function t(t,i){this.si=t,this.As=i||null}return t.prototype.priceRange=function(){return this.si},t.prototype.margins=function(){return this.As},t.prototype.toRaw=function(){return null===this.si?null:{priceRange:this.si.toRaw(),margins:this.As||void 0}},t.fromRaw=function(i){return null===i?null:new t(J.fromRaw(i.priceRange),i.margins)},t}(),Li=function(t){function i(i,n){var h=t.call(this,i)||this;return h.Os=n,h}return r(i,t),i.prototype.ds=function(t,i){var n=this.cs;if(n.B=!1,this.bh.visible()){var h=this.Os.yCoord();if(null!==h){var s=this.Os.options();n.B=!0,n.P=h,n.R=s.color,n.ls=i,n.fs=t,n.W=s.lineWidth,n.U=s.lineStyle}}},i}(ci),Bi=function(t){function i(i,n){var h=t.call(this)||this;return h.Ts=i,h.Os=n,h}return r(i,t),i.prototype.ht=function(t,i,n){t.visible=!1,i.visible=!1;var h=this.Os.options(),s=h.axisLabelVisible,r=""!==h.title;if(s&&this.Ts.visible()){var u=this.Os.yCoord();if(null!==u){r&&(i.text=h.title,i.visible=!0),i.borderColor=this.Ts.model().options().layout.backgroundColor,t.text=this.Ts.priceScale().formatPriceAbsolute(h.price),t.visible=!0;var e=A(h.color);n.background=e.K,n.color=e.$,n.coordinate=u}}},i}(I),Ai=function(){function t(t,i){this.Ts=t,this.kt=i,this.Vs=new Li(t,this),this.es=new Bi(t,this),this.zs=new fi(this.es,t,t.model())}return t.prototype.applyOptions=function(t){c(this.kt,t),this.update(),this.Ts.model().lightUpdate()},t.prototype.options=function(){return this.kt},t.prototype.series=function(){return this.Ts},t.prototype.paneViews=function(){return[this.Vs,this.zs]},t.prototype.priceAxisView=function(){return this.es},t.prototype.update=function(){this.Vs.Y(),this.es.update()},t.prototype.yCoord=function(){var t=this.Ts,i=t.priceScale();if(t.model().timeScale().isEmpty()||i.isEmpty())return null;var n=t.firstValue();return null===n?null:i.priceToCoordinate(this.kt.price,n.value)},t}(),Oi=function(t){function i(i){var n=t.call(this)||this;return n.ot=i,n}return r(i,t),i.prototype.model=function(){return this.ot},i}(q),Vi={barColor:"",barBorderColor:"",barWickColor:""},zi=function(){function t(t){this.Ts=t}return t.prototype.barStyle=function(t,i){var n=this.Ts.seriesType(),h=this.Ts.options();switch(n){case"Line":return this.Ps(h);case"Area":return this.Fs(h);case"Bar":return this.Is(h,t,i);case"Candlestick":return this.Ws(h,t,i);case"Histogram":return this.Rs(h,t,i)}throw new Error("Unknown chart style")},t.prototype.Is=function(t,i,n){var h=u({},Vi),s=t.upColor,r=t.downColor,e=s,o=r,a=f(this.Us(i,n)),c=l(a.value[0])<=l(a.value[3]);return h.barColor=c?s:r,h.barBorderColor=c?e:o,h},t.prototype.Ws=function(t,i,n){var h=u({},Vi),s=t.upColor,r=t.downColor,e=t.borderUpColor,o=t.borderDownColor,a=t.wickUpColor,c=t.wickDownColor,v=f(this.Us(i,n)),d=l(v.value[0])<=l(v.value[3]);return h.barColor=d?s:r,h.barBorderColor=d?e:o,h.barWickColor=d?a:c,h},t.prototype.Fs=function(t){return u(u({},Vi),{barColor:t.lineColor})},t.prototype.Ps=function(t){return u(u({},Vi),{barColor:t.color})},t.prototype.Rs=function(t,i,n){var h=u({},Vi),s=f(this.Us(i,n));return h.barColor=void 0!==s.color?s.color:t.color,h},t.prototype.Us=function(t,i){return void 0!==i?i.value:this.Ts.bars().valueAt(t)},t}(),Pi=30,Fi=function(){function t(){this.js=[],this.qs=new Map,this.Hs=new Map}return t.prototype.clear=function(){this.js=[],this.qs.clear(),this.Hs.clear()},t.prototype.last=function(){return this.size()>0?this.js[this.js.length-1]:null},t.prototype.firstIndex=function(){return this.size()>0?this.Ys(0):null},t.prototype.lastIndex=function(){return this.size()>0?this.Ys(this.js.length-1):null},t.prototype.size=function(){return this.js.length},t.prototype.isEmpty=function(){return 0===this.size()},t.prototype.contains=function(t){return null!==this.Ks(t,0)},t.prototype.valueAt=function(t){return this.search(t)},t.prototype.search=function(t,i){void 0===i&&(i=0);var n=this.Ks(t,i);return null===n?null:u(u({},this.$s(n)),{index:this.Ys(n)})},t.prototype.rows=function(){return this.js},t.prototype.minMaxOnRangeCached=function(t,i,n){if(this.isEmpty())return null;for(var h=null,s=0,r=n;s<r.length;s++){var u=r[s];h=Ii(h,this.Xs(t,i,u))}return h},t.prototype.merge=function(t){0!==t.length&&(this.isEmpty()||t[t.length-1].index<this.js[0].index?this.Zs(t):t[0].index>this.js[this.js.length-1].index?this.Js(t):1!==t.length||t[0].index!==this.js[this.js.length-1].index?this.Gs(t):this.Qs(t[0]))},t.prototype.Ys=function(t){return this.js[t].index},t.prototype.$s=function(t){return this.js[t]},t.prototype.Ks=function(t,i){var n=this.tr(t);if(null===n&&0!==i)switch(i){case-1:return this.ir(t);case 1:return this.nr(t);default:throw new TypeError("Unknown search mode")}return n},t.prototype.ir=function(t){var i=this.hr(t);return i>0&&(i-=1),i!==this.js.length&&this.Ys(i)<t?i:null},t.prototype.nr=function(t){var i=this.sr(t);return i!==this.js.length&&t<this.Ys(i)?i:null},t.prototype.tr=function(t){var i=this.hr(t);return i===this.js.length||t<this.js[i].index?null:i},t.prototype.hr=function(t){return jt(this.js,t,(function(t,i){return t.index<i}))},t.prototype.sr=function(t){return qt(this.js,t,(function(t,i){return i.index>t}))},t.prototype.rr=function(t,i,n){for(var h=null,s=t;s<i;s++){var r=this.js[s].value[n];Number.isNaN(r)||null===r||(null===h?h={min:r,max:r}:(r<h.min&&(h.min=r),r>h.max&&(h.max=r)))}return h},t.prototype.ur=function(t){var i=Math.floor(t.index/Pi);this.qs.forEach((function(t){return t.delete(i)}))},t.prototype.Zs=function(t){o(0!==t.length,"plotRows should not be empty"),this.Hs.clear(),this.qs.clear(),this.js=t.concat(this.js)},t.prototype.Js=function(t){o(0!==t.length,"plotRows should not be empty"),this.Hs.clear(),this.qs.clear(),this.js=this.js.concat(t)},t.prototype.Qs=function(t){o(!this.isEmpty(),"plot list should not be empty"),o(this.js[this.js.length-1].index===t.index,"last row index should match new row index"),this.ur(t),this.Hs.delete(t.index),this.js[this.js.length-1]=t},t.prototype.Gs=function(t){o(0!==t.length,"plot rows should not be empty"),this.Hs.clear(),this.qs.clear(),this.js=function(t,i){var n=function(t,i){var n=t.length,h=i.length,s=n+h,r=0,u=0;for(;r<n&&u<h;)t[r].index<i[u].index?r++:t[r].index>i[u].index?u++:(r++,u++,s--);return s}(t,i),h=new Array(n),s=0,r=0,u=t.length,e=i.length,o=0;for(;s<u&&r<e;)t[s].index<i[r].index?(h[o]=t[s],s++):t[s].index>i[r].index?(h[o]=i[r],r++):(h[o]=i[r],s++,r++),o++;for(;s<u;)h[o]=t[s],s++,o++;for(;r<e;)h[o]=i[r],r++,o++;return h}(this.js,t)},t.prototype.Xs=function(t,i,n){if(this.isEmpty())return null;var h=null,s=f(this.firstIndex()),r=f(this.lastIndex()),u=Math.max(t,s),e=Math.min(i,r),o=Math.ceil(u/Pi)*Pi,a=Math.max(o,Math.floor(e/Pi)*Pi),l=this.hr(u),c=this.sr(Math.min(e,o,i));h=Ii(h,this.rr(l,c,n));var v=this.qs.get(n);void 0===v&&(v=new Map,this.qs.set(n,v));for(var d=Math.max(o+1,u);d<a;d+=Pi){var _=Math.floor(d/Pi),w=v.get(_);if(void 0===w){var M=this.hr(_*Pi),b=this.sr((_+1)*Pi-1);w=this.rr(M,b,n),v.set(_,w)}h=Ii(h,w)}l=this.hr(a),c=this.sr(e);return h=Ii(h,this.rr(l,c,n))},t}();function Ii(t,i){return null===t?i:null===i?t:{min:Math.min(t.min,i.min),max:Math.max(t.max,i.max)}}var Wi=function(t){function i(i,n,h){var s=t.call(this,i)||this;s.L=new Fi,s.Vs=new Di(s),s.er=[],s.ar=new vi(s),s.lr=null,s.cr=[],s.vr=[],s.kt=n,s.dr=h;var r=new Ti(s);return s._t=[r],s.zs=new fi(r,s,i),s._r(),s.wr(),s}return r(i,t),i.prototype.destroy=function(){},i.prototype.priceLineColor=function(t){return this.kt.priceLineColor||t},i.prototype.lastValueData=function(t,i){var n={noData:!0},h=this.priceScale();if(this.model().timeScale().isEmpty()||h.isEmpty()||this.L.isEmpty())return n;var s,r,u=this.model().timeScale().visibleStrictRange(),e=this.firstValue();if(null===u||null===e)return n;if(t){var o=this.L.last();if(null===o)return n;s=o,r=o.index}else{var a=this.L.search(u.right(),-1);if(null===a)return n;if(null===(s=this.L.valueAt(a.index)))return n;r=a.index}var f=s.value[3],l=this.barColorer().barStyle(r,{value:s}),c=h.priceToCoordinate(f,e.value);return{noData:!1,price:i?f:void 0,text:h.formatPrice(f,e.value),formattedPriceAbsolute:h.formatPriceAbsolute(f),formattedPricePercentage:h.formatPricePercentage(f,e.value),color:l.barColor,coordinate:c,index:r}},i.prototype.barColorer=function(){return null!==this.lr||(this.lr=new zi(this)),this.lr},i.prototype.options=function(){return this.kt},i.prototype.applyOptions=function(t){var i=t.priceScaleId;void 0!==i&&i!==this.kt.priceScaleId&&this.model().moveSeriesToScale(this,i),c(this.kt,t),null!==this._priceScale&&void 0!==t.scaleMargins&&this._priceScale.applyOptions({scaleMargins:t.scaleMargins}),void 0!==t.priceFormat&&this._r(),this.model().updateSource(this),this.model().updateCrosshair(),this.Ct.update("options")},i.prototype.clearData=function(){this.L.clear(),this.wr()},i.prototype.updateData=function(t,i){i&&this.L.clear(),this.L.merge(t),this.Mr(),this.Ct.update("data"),this.xt.update("data");var n=this.model().paneForSource(this);this.model().recalculatePane(n),this.model().updateSource(this),this.model().updateCrosshair(),this.model().lightUpdate()},i.prototype.setMarkers=function(t){this.cr=t.map((function(t){return u({},t)})),this.Mr();var i=this.model().paneForSource(this);this.xt.update("data"),this.model().recalculatePane(i),this.model().updateSource(this),this.model().updateCrosshair(),this.model().lightUpdate()},i.prototype.indexedMarkers=function(){return this.vr},i.prototype.createPriceLine=function(t){var i=new Ai(this,t);return this.er.push(i),this.model().updateSource(this),i},i.prototype.removePriceLine=function(t){var i=this.er.indexOf(t);-1!==i&&this.er.splice(i,1),this.model().updateSource(this)},i.prototype.customPriceLines=function(){return this.er},i.prototype.seriesType=function(){return this.dr},i.prototype.firstValue=function(){var t=this.firstBar();return null===t?null:{value:t.value[3],timePoint:t.time}},i.prototype.firstBar=function(){var t=this.model().timeScale().visibleStrictRange();if(null===t)return null;var i=t.left();return this.L.search(i,1)},i.prototype.bars=function(){return this.L},i.prototype.dataAt=function(t){var i=this.L.valueAt(t);return null===i?null:"Bar"===this.dr||"Candlestick"===this.dr?{open:i.value[0],high:i.value[1],low:i.value[2],close:i.value[3]}:i.value[3]},i.prototype.paneViews=function(){var t=[];this.br()||t.push(this.ar);for(var i=0,n=this.er;i<n.length;i++){var h=n[i];t.push.apply(t,h.paneViews())}return t.push(this.Ct,this.Vs,this.zs,this.xt),t},i.prototype.priceAxisViews=function(t,i){for(var n=i===this._priceScale||this.br()?e([],this._t):[],h=0,s=this.er;h<s.length;h++){var r=s[h];n.push(r.priceAxisView())}return n},i.prototype.autoscaleInfo=function(t,i){var n=this;if(void 0!==this.kt.autoscaleInfoProvider){var h=this.kt.autoscaleInfoProvider((function(){var h=n.mr(t,i);return null===h?null:h.toRaw()}));return Ei.fromRaw(h)}return this.mr(t,i)},i.prototype.minMove=function(){return this.kt.priceFormat.minMove},i.prototype.formatter=function(){return this.bi},i.prototype.updateAllViews=function(){this.Ct.update(),this.xt.update();for(var t=0,i=this._t;t<i.length;t++){i[t].update()}for(var n=0,h=this.er;n<h.length;n++){h[n].update()}this.Vs.Y(),this.ar.Y()},i.prototype.priceScale=function(){return f(this._priceScale)},i.prototype.markerDataAtIndex=function(t){if(!(("Line"===this.dr||"Area"===this.dr)&&this.kt.crosshairMarkerVisible))return null;var i=this.L.valueAt(t);return null===i?null:{price:i.value[3],radius:this.gr(),borderColor:this.pr(),backgroundColor:this.yr(t)}},i.prototype.title=function(){return this.kt.title},i.prototype.visible=function(){return this.kt.visible},i.prototype.br=function(){return!Pt(this.priceScale().id())},i.prototype.mr=function(t,i){if(!d(t)||!d(i)||this.L.isEmpty())return null;var n="Line"===this.dr||"Area"===this.dr||"Histogram"===this.dr?[3]:[2,1],h=this.L.minMaxOnRangeCached(t,i,n),s=null!==h?new J(h.min,h.max):null;if("Histogram"===this.seriesType()){var r=this.kt.base,u=new J(r,r);s=null!==s?s.merge(u):u}return new Ei(s,this.xt.Es())},i.prototype.gr=function(){switch(this.dr){case"Line":case"Area":return this.kt.crosshairMarkerRadius}return 0},i.prototype.pr=function(){switch(this.dr){case"Line":case"Area":var t=this.kt.crosshairMarkerBorderColor;if(0!==t.length)return t}return this.model().options().layout.backgroundColor},i.prototype.yr=function(t){switch(this.dr){case"Line":case"Area":var i=this.kt.crosshairMarkerBackgroundColor;if(0!==i.length)return i}return this.barColorer().barStyle(t).barColor},i.prototype._r=function(){switch(this.kt.priceFormat.type){case"custom":this.bi={format:this.kt.priceFormat.formatter};break;case"volume":this.bi=new It(this.kt.priceFormat.precision);break;case"percent":this.bi=new X(this.kt.priceFormat.precision);break;default:var t=Math.pow(10,this.kt.priceFormat.precision);this.bi=new $(t,this.kt.priceFormat.minMove*t)}null!==this._priceScale&&this._priceScale.updateFormatter()},i.prototype.Mr=function(){var t=this,i=this.model().timeScale();if(i.isEmpty()||0===this.L.size())this.vr=[];else{var n=f(this.L.firstIndex());this.vr=this.cr.map((function(h,s){var r=f(i.timeToIndex(h.time,!0)),u=r<n?1:-1;return{time:f(t.L.search(r,u)).index,position:h.position,shape:h.shape,color:h.color,id:h.id,internalId:s,text:h.text,size:h.size,borderColor:h.borderColor,borderSize:h.borderSize}}))}},i.prototype.wr=function(){switch(this.xt=new Ci(this,this.model()),this.dr){case"Bar":this.Ct=new Qt(this,this.model());break;case"Candlestick":this.Ct=new ii(this,this.model());break;case"Line":this.Ct=new ui(this,this.model());break;case"Area":this.Ct=new Zt(this,this.model());break;case"Histogram":this.Ct=new ri(this,this.model());break;default:throw Error("Unknown chart style assigned: "+this.dr)}},i}(Oi),Ri=function(){function t(t){this.kt=t}return t.prototype.kr=function(t,i,n){var h=t;if(0===this.kt.mode)return h;var s=n.defaultPriceScale(),r=s.firstValue();if(null===r)return h;var u=s.priceToCoordinate(t,r),e=n.dataSources().filter((function(t){return t instanceof Wi})).reduce((function(t,h){if(n.isOverlay(h)||!h.visible())return t;var s=h.priceScale(),r=h.bars();if(s.isEmpty()||!r.contains(i))return t;var u=r.valueAt(i);if(null===u)return t;var e=l(h.firstValue());return t.concat([s.priceToCoordinate(u.value[3],e.value)])}),[]);if(0===e.length)return h;e.sort((function(t,i){return Math.abs(t-u)-Math.abs(i-u)}));var o=e[0];return h=s.coordinateToPrice(o,r)},t}(),Ui=function(){function t(){this.L=null}return t.prototype.l=function(t){this.L=t},t.prototype.draw=function(t,i,h,s){var r=this;if(null!==this.L){var u=Math.max(1,Math.floor(i));t.lineWidth=u;var e=Math.ceil(this.L.I*i),o=Math.ceil(this.L.F*i);!function(t,i){t.save(),t.lineWidth%2&&t.translate(.5,.5),i(),t.restore()}(t,(function(){var h=f(r.L);if(h.Nr){t.strokeStyle=h.Sr,n(t,h.Cr),t.beginPath();for(var s=0,a=h.Dr;s<a.length;s++){var l=a[s],c=Math.round(l.Tr*i);t.moveTo(c,-u),t.lineTo(c,e+u)}t.stroke()}if(h.Er){t.strokeStyle=h.Lr,n(t,h.Br),t.beginPath();for(var v=0,d=h.Ar;v<d.length;v++){var _=d[v],w=Math.round(_.coord*i);t.moveTo(-u,w),t.lineTo(o+u,w)}t.stroke()}}))}},t}(),ji=function(){function t(t){this.q=new Ui,this.S=!0,this.lt=t}return t.prototype.update=function(){this.S=!0},t.prototype.renderer=function(t,i){if(this.S){var n=this.lt.model().options().grid,h={I:t,F:i,Er:n.horzLines.visible,Nr:n.vertLines.visible,Lr:n.horzLines.color,Sr:n.vertLines.color,Br:n.horzLines.style,Cr:n.vertLines.style,Ar:this.lt.defaultPriceScale().marks(),Dr:this.lt.model().timeScale().marks()||[]};this.q.l(h),this.S=!1}return this.q},t}(),qi=function(){function t(t){this.Ct=new ji(t)}return t.prototype.paneView=function(){return this.Ct},t}(),Hi=function(){function t(t,i){this.vi=[],this.Or=new Map,this.ni=0,this.fn=0,this.Vr=1e3,this.di=null,this.zr=new Z,this.Pr=t,this.ot=i,this.Fr=new qi(this);var n=i.options();this.Ir=this.Wr("left",n.leftPriceScale),this.Rr=this.Wr("right",n.rightPriceScale),this.Ir.modeChanged().subscribe(this.Ur.bind(this,this.Ir),this),this.Rr.modeChanged().subscribe(this.Ur.bind(this,this.Ir),this),this.applyScaleOptions(n)}return t.prototype.applyScaleOptions=function(t){if(t.leftPriceScale&&this.Ir.applyOptions(t.leftPriceScale),t.rightPriceScale&&this.Rr.applyOptions(t.rightPriceScale),t.localization&&(this.Ir.updateFormatter(),this.Rr.updateFormatter()),t.overlayPriceScales)for(var i=0,n=Array.from(this.Or.values());i<n.length;i++){var h=f(n[i][0].priceScale());h.applyOptions(t.overlayPriceScales),t.localization&&h.updateFormatter()}},t.prototype.priceScaleById=function(t){switch(t){case"left":return this.Ir;case"right":return this.Rr}return this.Or.has(t)?a(this.Or.get(t))[0].priceScale():null},t.prototype.destroy=function(){this.model().priceScalesOptionsChanged().unsubscribeAll(this),this.Ir.modeChanged().unsubscribeAll(this),this.Rr.modeChanged().unsubscribeAll(this),this.vi.forEach((function(t){t.destroy&&t.destroy()})),this.zr.Wt()},t.prototype.stretchFactor=function(){return this.Vr},t.prototype.setStretchFactor=function(t){this.Vr=t},t.prototype.model=function(){return this.ot},t.prototype.width=function(){return this.fn},t.prototype.height=function(){return this.ni},t.prototype.setWidth=function(t){this.fn=t,this.updateAllSources()},t.prototype.setHeight=function(t){var i=this;this.ni=t,this.Ir.setHeight(t),this.Rr.setHeight(t),this.vi.forEach((function(n){if(i.isOverlay(n)){var h=n.priceScale();null!==h&&h.setHeight(t)}})),this.updateAllSources()},t.prototype.dataSources=function(){return this.vi},t.prototype.isOverlay=function(t){var i=t.priceScale();return null===i||this.Ir!==i&&this.Rr!==i},t.prototype.addDataSource=function(t,i,n){var h=void 0!==n?n:this.qr().jr-1;this.Hr(t,i,h)},t.prototype.removeDataSource=function(t){var i=this.vi.indexOf(t);o(-1!==i,"removeDataSource: invalid data source"),this.vi.splice(i,1);var n=f(t.priceScale()).id();if(this.Or.has(n)){var h=a(this.Or.get(n)),s=h.indexOf(t);-1!==s&&(h.splice(s,1),0===h.length&&this.Or.delete(n))}var r=t.priceScale();r&&r.dataSources().indexOf(t)>=0&&r.removeDataSource(t),null!==r&&(r.invalidateSourcesCache(),this.recalculatePriceScale(r)),this.di=null},t.prototype.priceScalePosition=function(t){return t===this.Ir?"left":t===this.Rr?"right":"overlay"},t.prototype.leftPriceScale=function(){return this.Ir},t.prototype.rightPriceScale=function(){return this.Rr},t.prototype.startScalePrice=function(t,i){t.startScale(i)},t.prototype.scalePriceTo=function(t,i){t.scaleTo(i),this.updateAllSources()},t.prototype.endScalePrice=function(t){t.endScale()},t.prototype.startScrollPrice=function(t,i){t.startScroll(i)},t.prototype.scrollPriceTo=function(t,i){t.scrollTo(i),this.updateAllSources()},t.prototype.endScrollPrice=function(t){t.endScroll()},t.prototype.updateAllSources=function(){this.vi.forEach((function(t){t.updateAllViews()}))},t.prototype.defaultPriceScale=function(){var t=null;return this.ot.options().rightPriceScale.visible&&0!==this.Rr.dataSources().length?t=this.Rr:this.ot.options().leftPriceScale.visible&&0!==this.Ir.dataSources().length?t=this.Ir:0!==this.vi.length&&(t=this.vi[0].priceScale()),null===t&&(t=this.Rr),t},t.prototype.recalculatePriceScale=function(t){null!==t&&t.isAutoScale()&&this.Yr(t)},t.prototype.resetPriceScale=function(t){var i=this.Pr.visibleStrictRange();t.setMode({autoScale:!0}),null!==i&&t.recalculatePriceRange(i),this.updateAllSources()},t.prototype.momentaryAutoScale=function(){this.Yr(this.Ir),this.Yr(this.Rr)},t.prototype.recalculate=function(){var t=this;this.recalculatePriceScale(this.Ir),this.recalculatePriceScale(this.Rr),this.vi.forEach((function(i){t.isOverlay(i)&&t.recalculatePriceScale(i.priceScale())})),this.updateAllSources(),this.ot.lightUpdate()},t.prototype.orderedSources=function(){return null===this.di&&(this.di=vt(this.vi)),this.di},t.prototype.onDestroyed=function(){return this.zr},t.prototype.grid=function(){return this.Fr},t.prototype.Yr=function(t){var i=t.sourcesForAutoScale();if(i&&i.length>0&&!this.Pr.isEmpty()){var n=this.Pr.visibleStrictRange();null!==n&&t.recalculatePriceRange(n)}t.updateAllViews()},t.prototype.qr=function(){var t=this.orderedSources();if(0===t.length)return{jr:0,Kr:0};for(var i=0,n=0,h=0;h<t.length;h++){var s=t[h].zorder();null!==s&&(s<i&&(i=s),s>n&&(n=s))}return{jr:i,Kr:n}},t.prototype.Hr=function(t,i,n){var h=this.priceScaleById(i);if(null===h&&(h=this.Wr(i,this.ot.options().overlayPriceScales)),this.vi.push(t),!Pt(i)){var s=this.Or.get(i)||[];s.push(t),this.Or.set(i,s)}h.addDataSource(t),t.setPriceScale(h),t.setZorder(n),this.recalculatePriceScale(h),this.di=null},t.prototype.Ur=function(t,i,n){i.mode!==n.mode&&this.Yr(t)},t.prototype.Wr=function(t,i){var n=u({visible:!0,autoScale:!0},M(i)),h=new Mt(t,n,this.ot.options().layout,this.ot.options().localization);return h.setHeight(this.height()),h},t}(),Yi=function(t){function i(i){var n=t.call(this)||this;return n.$r=new Map,n.L=i,n}return r(i,t),i.prototype.h=function(t){},i.prototype.u=function(t){if(this.L.B){t.save();for(var i=0,n=0,h=this.L.Xr;n<h.length;n++){if(0!==(o=h[n]).bs.length){t.font=o.Zr;var s=this.Jr(t,o.bs);s>this.L.ls?o.Gr=this.L.ls/s:o.Gr=1,i+=o.Qr*o.Gr}}var r=0;switch(this.L.tu){case"top":r=0;break;case"center":r=Math.max((this.L.fs-i)/2,0);break;case"bottom":r=Math.max(this.L.fs-i,0)}t.fillStyle=this.L.R;for(var u=0,e=this.L.Xr;u<e.length;u++){var o=e[u];t.save();var a=0;switch(this.L.iu){case"left":t.textAlign="left",a=o.Qr/2;break;case"center":t.textAlign="center",a=this.L.ls/2;break;case"right":t.textAlign="right",a=this.L.ls-1-o.Qr/2}t.translate(a,r),t.textBaseline="top",t.font=o.Zr,t.scale(o.Gr,o.Gr),t.fillText(o.bs,0,o.nu),t.restore(),r+=o.Qr*o.Gr}t.restore()}},i.prototype.Jr=function(t,i){var n=this.hu(t.font),h=n.get(i);return void 0===h&&(h=t.measureText(i).width,n.set(i,h)),h},i.prototype.hu=function(t){var i=this.$r.get(t);return void 0===i&&(i=new Map,this.$r.set(t,i)),i},i}(p),Ki=function(){function t(t){this.S=!0,this.j={B:!1,R:"",fs:0,ls:0,Xr:[],tu:"center",iu:"center"},this.q=new Yi(this.j),this.H=t}return t.prototype.update=function(){this.S=!0},t.prototype.renderer=function(t,i){return this.S&&(this.T(t,i),this.S=!1),this.q},t.prototype.T=function(t,i){var n=this.H.options(),h=this.j;h.B=n.visible,h.B&&(h.R=n.color,h.ls=i,h.fs=t,h.iu=n.horzAlign,h.tu=n.vertAlign,h.Xr=[{bs:n.text,Zr:Vt(n.fontSize,n.fontFamily,n.fontStyle),Qr:1.2*n.fontSize,nu:0,Gr:0}])},t}(),$i=function(t){function i(i,n){var h=t.call(this)||this;return h.kt=n,h.Ct=new Ki(h),h}return r(i,t),i.prototype.paneViews=function(){return[this.Ct]},i.prototype.options=function(){return this.kt},i.prototype.updateAllViews=function(){this.Ct.update()},i}(q),Xi=function(){function t(t,i){this.su=[],this.ru=[],this.fn=0,this.uu=null,this.eu=null,this.ou=new Z,this.au=new Z,this.fu=new Z,this.lu=t,this.kt=i,this.cu=new zt(this),this.Pr=new Lt(this,i.timeScale,this.kt.localization),this.D=new H(this,i.crosshair),this.vu=new Ri(i.crosshair),this.du=new $i(this,i.watermark),this.createPane(),this.su[0].setStretchFactor(2e3)}return t.prototype.fullUpdate=function(){this._u(new Ft(3))},t.prototype.lightUpdate=function(){this._u(new Ft(2))},t.prototype.updateSource=function(t){var i=this.wu(t);this._u(i)},t.prototype.hoveredSource=function(){return this.eu},t.prototype.setHoveredSource=function(t){var i=this.eu;this.eu=t,null!==i&&this.updateSource(i.source),null!==t&&this.updateSource(t.source)},t.prototype.options=function(){return this.kt},t.prototype.applyOptions=function(t){c(this.kt,t),this.su.forEach((function(i){return i.applyScaleOptions(t)})),void 0!==t.timeScale&&this.Pr.applyOptions(t.timeScale),void 0!==t.localization&&this.Pr.applyLocalizationOptions(t.localization),(t.leftPriceScale||t.rightPriceScale)&&this.ou.Wt(),this.fullUpdate()},t.prototype.applyPriceScaleOptions=function(t,i){var n=this.findPriceScale(t);null!==n&&(n.priceScale.applyOptions(i),this.ou.Wt())},t.prototype.findPriceScale=function(t){for(var i=0,n=this.su;i<n.length;i++){var h=n[i],s=h.priceScaleById(t);if(null!==s)return{pane:h,priceScale:s}}return null},t.prototype.timeScale=function(){return this.Pr},t.prototype.panes=function(){return this.su},t.prototype.watermarkSource=function(){return this.du},t.prototype.crosshairSource=function(){return this.D},t.prototype.crosshairMoved=function(){return this.au},t.prototype.customPriceLineDragged=function(){return this.fu},t.prototype.setPaneHeight=function(t,i){t.setHeight(i),this.recalculateAllPanes()},t.prototype.setWidth=function(t){this.fn=t,this.Pr.setWidth(this.fn),this.su.forEach((function(i){return i.setWidth(t)})),this.recalculateAllPanes()},t.prototype.createPane=function(t){var i=new Hi(this.Pr,this);void 0!==t?this.su.splice(t,0,i):this.su.push(i);var n=void 0===t?this.su.length-1:t,h=new Ft(3);return h.invalidatePane(n,{level:0,autoScale:!0}),this._u(h),i},t.prototype.startScalePrice=function(t,i,n){t.startScalePrice(i,n)},t.prototype.scalePriceTo=function(t,i,n){t.scalePriceTo(i,n),this.updateCrosshair(),this._u(this.Mu(t,2))},t.prototype.endScalePrice=function(t,i){t.endScalePrice(i),this._u(this.Mu(t,2))},t.prototype.startScrollPrice=function(t,i,n){i.isAutoScale()||t.startScrollPrice(i,n)},t.prototype.scrollPriceTo=function(t,i,n){i.isAutoScale()||(t.scrollPriceTo(i,n),this.updateCrosshair(),this._u(this.Mu(t,2)))},t.prototype.endScrollPrice=function(t,i){i.isAutoScale()||(t.endScrollPrice(i),this._u(this.Mu(t,2)))},t.prototype.resetPriceScale=function(t,i){t.resetPriceScale(i),this._u(this.Mu(t,2))},t.prototype.startScaleTime=function(t){this.Pr.startScale(t)},t.prototype.zoomTime=function(t,i){var n=this.timeScale();if(!n.isEmpty()&&0!==i){var h=n.width();t=Math.max(1,Math.min(t,h)),n.zoom(t,i),this.recalculateAllPanes()}},t.prototype.scrollChart=function(t){this.startScrollTime(0),this.scrollTimeTo(t),this.endScrollTime()},t.prototype.scaleTimeTo=function(t){this.Pr.scaleTo(t),this.recalculateAllPanes()},t.prototype.endScaleTime=function(){this.Pr.endScale(),this.lightUpdate()},t.prototype.startScrollTime=function(t){this.uu=t,this.Pr.startScroll(t)},t.prototype.scrollTimeTo=function(t){var i=!1;return null!==this.uu&&Math.abs(t-this.uu)>20&&(this.uu=null,i=!0),this.Pr.scrollTo(t),this.recalculateAllPanes(),i},t.prototype.endScrollTime=function(){this.Pr.endScroll(),this.lightUpdate(),this.uu=null},t.prototype.serieses=function(){return this.ru},t.prototype.setAndSaveCurrentPosition=function(t,i,n){this.D.saveOriginCoord(t,i);var h=NaN,s=this.Pr.coordinateToIndex(t),r=this.Pr.visibleStrictRange();null!==r&&(s=Math.min(Math.max(r.left(),s),r.right()));var u=n.defaultPriceScale(),e=u.firstValue();null!==e&&(h=u.coordinateToPrice(i,e)),h=this.vu.kr(h,s,n),this.D.setPosition(s,h,n),this.bu(),this.au.Wt(this.D.appliedIndex(),{x:t,y:i})},t.prototype.clearCurrentPosition=function(){this.crosshairSource().clearPosition(),this.bu(),this.au.Wt(null,null)},t.prototype.updateCrosshair=function(){var t=this.D.pane();if(null!==t){var i=this.D.originCoordX(),n=this.D.originCoordY();this.setAndSaveCurrentPosition(i,n,t)}this.D.updateAllViews()},t.prototype.updateTimeScale=function(t,i){var n=this.Pr.indexToTime(0);void 0!==i&&this.Pr.update(i);var h=this.Pr.indexToTime(0),s=this.Pr.baseIndex(),r=this.Pr.visibleStrictRange();if(null!==r&&null!==n&&null!==h){var u=r.contains(s),e=n.timestamp>h.timestamp,o=null!==t&&t>s&&!e,a=u&&this.Pr.options().shiftVisibleRangeOnNewBar;if(o&&!a&&null!==t){var f=t-s;this.Pr.setRightOffset(this.Pr.rightOffset()-f)}}this.Pr.setBaseIndex(t)},t.prototype.recalculatePane=function(t){null!==t&&t.recalculate()},t.prototype.paneForSource=function(t){var i=this.su.find((function(i){return i.orderedSources().includes(t)}));return void 0===i?null:i},t.prototype.recalculateAllPanes=function(){this.du.updateAllViews(),this.su.forEach((function(t){return t.recalculate()})),this.updateCrosshair()},t.prototype.fireCustomPriceLineDragged=function(t,i){this.fu.Wt(t,i)},t.prototype.destroy=function(){this.su.forEach((function(t){return t.destroy()})),this.su.length=0,this.kt.localization.priceFormatter=void 0,this.kt.localization.timeFormatter=void 0},t.prototype.rendererOptionsProvider=function(){return this.cu},t.prototype.priceAxisRendererOptions=function(){return this.cu.options()},t.prototype.priceScalesOptionsChanged=function(){return this.ou},t.prototype.createSeries=function(t,i){var n=this.su[0],h=this.mu(i,t,n);return this.ru.push(h),1===this.ru.length?this.fullUpdate():this.lightUpdate(),h},t.prototype.removeSeries=function(t){var i=this.paneForSource(t),n=this.ru.indexOf(t);o(-1!==n,"Series not found"),this.ru.splice(n,1),f(i).removeDataSource(t),t.destroy&&t.destroy()},t.prototype.moveSeriesToScale=function(t,i){var n=f(this.paneForSource(t));n.removeDataSource(t);var h=this.findPriceScale(i);if(null===h){var s=t.zorder();n.addDataSource(t,i,s)}else{s=h.pane===n?t.zorder():void 0;h.pane.addDataSource(t,i,s)}},t.prototype.fitContent=function(){var t=new Ft(2);t.setFitContent(),this._u(t)},t.prototype.setTargetLogicalRange=function(t){var i=new Ft(2);i.applyRange(t),this._u(i)},t.prototype.resetTimeScale=function(){var t=new Ft(2);t.resetTimeScale(),this._u(t)},t.prototype.setBarSpacing=function(t){var i=new Ft(2);i.setBarSpacing(t),this._u(i)},t.prototype.setRightOffset=function(t){var i=new Ft(2);i.setRightOffset(t),this._u(i)},t.prototype.defaultVisiblePriceScaleId=function(){return this.kt.rightPriceScale.visible?"right":"left"},t.prototype.Mu=function(t,i){var n=new Ft(i);if(null!==t){var h=this.su.indexOf(t);n.invalidatePane(h,{level:i})}return n},t.prototype.wu=function(t,i){return void 0===i&&(i=2),this.Mu(this.paneForSource(t),i)},t.prototype._u=function(t){this.lu&&this.lu(t),this.su.forEach((function(t){return t.grid().paneView().update()}))},t.prototype.bu=function(){this._u(new Ft(1))},t.prototype.mu=function(t,i,n){var h=new Wi(this,t,i),s=void 0!==t.priceScaleId?t.priceScaleId:this.defaultVisiblePriceScaleId();return n.addDataSource(h,s),Pt(s)||h.applyOptions(t),h},t}(),Zi={allowDownsampling:!0};var Ji=function(){function t(t,i){var n=this;this._resolutionMediaQueryList=null,this._resolutionListener=function(t){return n._onResolutionChanged()},this._canvasConfiguredListeners=[],this.canvas=t,this._canvasSize={width:this.canvas.clientWidth,height:this.canvas.clientHeight},this._options=i,this._configureCanvas(),this._installResolutionListener()}return t.prototype.destroy=function(){this._canvasConfiguredListeners.length=0,this._uninstallResolutionListener(),this.canvas=null},Object.defineProperty(t.prototype,"canvasSize",{get:function(){return{width:this._canvasSize.width,height:this._canvasSize.height}},enumerable:!0,configurable:!0}),t.prototype.resizeCanvas=function(t){this._canvasSize={width:t.width,height:t.height},this._configureCanvas()},Object.defineProperty(t.prototype,"pixelRatio",{get:function(){var t=this.canvas.ownerDocument.defaultView;if(null==t)throw new Error("No window is associated with the canvas");return t.devicePixelRatio>1||this._options.allowDownsampling?t.devicePixelRatio:1},enumerable:!0,configurable:!0}),t.prototype.subscribeCanvasConfigured=function(t){this._canvasConfiguredListeners.push(t)},t.prototype.unsubscribeCanvasConfigured=function(t){this._canvasConfiguredListeners=this._canvasConfiguredListeners.filter((function(i){return i!=t}))},t.prototype._configureCanvas=function(){var t=this.pixelRatio;this.canvas.style.width=this._canvasSize.width+"px",this.canvas.style.height=this._canvasSize.height+"px",this.canvas.width=this._canvasSize.width*t,this.canvas.height=this._canvasSize.height*t,this._emitCanvasConfigured()},t.prototype._emitCanvasConfigured=function(){var t=this;this._canvasConfiguredListeners.forEach((function(i){return i.call(t)}))},t.prototype._installResolutionListener=function(){if(null!==this._resolutionMediaQueryList)throw new Error("Resolution listener is already installed");var t=this.canvas.ownerDocument.defaultView;if(null==t)throw new Error("No window is associated with the canvas");var i=t.devicePixelRatio;this._resolutionMediaQueryList=t.matchMedia("all and (resolution: "+i+"dppx)"),this._resolutionMediaQueryList.addListener(this._resolutionListener)},t.prototype._uninstallResolutionListener=function(){null!==this._resolutionMediaQueryList&&(this._resolutionMediaQueryList.removeListener(this._resolutionListener),this._resolutionMediaQueryList=null)},t.prototype._reinstallResolutionListener=function(){this._uninstallResolutionListener(),this._installResolutionListener()},t.prototype._onResolutionChanged=function(){this._configureCanvas(),this._reinstallResolutionListener()},t}(),Gi=function(){function t(t,i){this.F=t,this.I=i}return t.prototype.gu=function(t){return this.F===t.F&&this.I===t.I},t}();function Qi(t){return t.ownerDocument&&t.ownerDocument.defaultView&&t.ownerDocument.defaultView.devicePixelRatio||1}function tn(t){var i=f(t.getContext("2d"));return i.setTransform(1,0,0,1,0,0),i}function nn(t,i){var n=t.createElement("canvas"),h=Qi(n);return n.style.width=i.F+"px",n.style.height=i.I+"px",n.width=i.F*h,n.height=i.I*h,n}function hn(t,i){var n=f(t.ownerDocument).createElement("canvas");t.appendChild(n);var h=function(t,i){return void 0===i&&(i=Zi),new Ji(t,i)}(n);return h.resizeCanvas({width:i.F,height:i.I}),h}var sn="undefined"!=typeof window;var rn=function(){if(!sn)return!1;var t=!!navigator.maxTouchPoints||!!navigator.msMaxTouchPoints||!!sn&&("ontouchstart"in window||Boolean(window.DocumentTouch&&document instanceof window.DocumentTouch));return"onorientationchange"in window&&t}();var un=function(){if(!sn)return!1;var t=/Android/i.test(navigator.userAgent),i=/iPhone|iPad|iPod|AppleWebKit.+Mobile/i.test(navigator.userAgent);return t||i}(),en=function(){function t(t,i,n){this.pu=0,this.yu=null,this.ku=null,this.xu=!1,this.Nu=null,this.Su=!1,this.Cu=!1,this.Du=null,this.Tu=null,this.Eu=null,this.Lu=null,this.Bu=0,this.Au=!1,this.Ou=!1,this.Vu=!1,this.zu=t,this.Pu=i,this.kt=n,this.Fu()}return t.prototype.destroy=function(){null!==this.Du&&(this.Du(),this.Du=null),null!==this.Tu&&(this.Tu(),this.Tu=null),null!==this.Eu&&(this.Eu(),this.Eu=null),this.Iu(),this.Wu()},t.prototype.Ru=function(t){var i=this;this.Tu&&this.Tu();var n=this.Uu.bind(this);this.Tu=function(){i.zu.removeEventListener("mousemove",n)},this.zu.addEventListener("mousemove",n),fn(t)&&this.Uu(t);var h=this.ju(t);this.qu(h,this.Pu.Hu)},t.prototype.Wu=function(){null!==this.yu&&clearTimeout(this.yu),this.pu=0,this.yu=null},t.prototype.Uu=function(t){if(!this.Vu||fn(t)){var i=this.ju(t);this.qu(i,this.Pu.Yu)}},t.prototype.Ku=function(t){if((!("button"in t)||0===t.button)&&null===this.Lu){var i=fn(t);if(!this.Ou||!i){this.Au=!0;var n=this.ju(t),h=l(this.Nu),s=Math.abs(h.V-n.$u),r=Math.abs(h.P-n.Xu),u=s+r>5;if(u||!i){if(u&&!this.Su&&i){var e=.5*s,o=r>=e&&!this.kt.Zu,a=e>r&&!this.kt.Ju;o||a||(this.Ou=!0)}u&&(this.Su=!0,this.Cu=!0,i&&this.Iu()),this.Ou||(this.qu(n,this.Pu.Gu),i&&ln(t))}}}},t.prototype.Qu=function(t){if(!("button"in t)||0===t.button){var i=this.ju(t);this.Iu(),this.Nu=null,this.Vu=!1,this.Eu&&(this.Eu(),this.Eu=null),fn(t)&&this.te(t),this.qu(i,this.Pu.ie),++this.pu,this.yu&&this.pu>1?(this.qu(i,this.Pu.ne),this.Wu()):this.Cu||this.qu(i,this.Pu.he),fn(t)&&(ln(t),this.te(t),0===t.touches.length&&(this.xu=!1))}},t.prototype.Iu=function(){null!==this.ku&&(clearTimeout(this.ku),this.ku=null)},t.prototype.se=function(t){if(!("button"in t)||0===t.button){var i=this.ju(t);this.Cu=!1,this.Su=!1,this.Ou=!1,fn(t)&&this.Ru(t),this.Nu={V:i.$u,P:i.Xu},this.Eu&&(this.Eu(),this.Eu=null);var n=this.Ku.bind(this),h=this.Qu.bind(this),s=this.zu.ownerDocument.documentElement;this.Eu=function(){s.removeEventListener("touchmove",n),s.removeEventListener("touchend",h),s.removeEventListener("mousemove",n),s.removeEventListener("mouseup",h)},s.addEventListener("touchmove",n,{passive:!1}),s.addEventListener("touchend",h,{passive:!1}),this.Iu(),fn(t)&&1===t.touches.length?this.ku=setTimeout(this.re.bind(this,t),240):(s.addEventListener("mousemove",n),s.addEventListener("mouseup",h)),this.Vu=!0,this.qu(i,this.Pu.ue),this.yu||(this.pu=0,this.yu=setTimeout(this.Wu.bind(this),500))}},t.prototype.Fu=function(){var t=this;this.zu.addEventListener("mouseenter",this.Ru.bind(this)),this.zu.addEventListener("touchcancel",this.Iu.bind(this));var i=this.zu.ownerDocument,n=function(i){t.Pu.ee&&(i.composed&&t.zu.contains(i.composedPath()[0])||i.target&&t.zu.contains(i.target)||t.Pu.ee())};this.Du=function(){i.removeEventListener("mousedown",n),i.removeEventListener("touchstart",n)},i.addEventListener("mousedown",n),i.addEventListener("touchstart",n,{passive:!0}),this.zu.addEventListener("mouseleave",this.te.bind(this)),this.zu.addEventListener("touchstart",this.se.bind(this),{passive:!0}),rn||this.zu.addEventListener("mousedown",this.se.bind(this)),this.oe(),this.zu.addEventListener("touchmove",(function(){}),{passive:!1})},t.prototype.oe=function(){var t=this;void 0===this.Pu.ae&&void 0===this.Pu.fe&&void 0===this.Pu.le||(this.zu.addEventListener("touchstart",(function(i){return t.ce(i.touches)}),{passive:!0}),this.zu.addEventListener("touchmove",(function(i){if(2===i.touches.length&&null!==t.Lu&&void 0!==t.Pu.fe){var n=an(i.touches[0],i.touches[1])/t.Bu;t.Pu.fe(t.Lu,n),ln(i)}}),{passive:!1}),this.zu.addEventListener("touchend",(function(i){t.ce(i.touches)})))},t.prototype.ce=function(t){1===t.length&&(this.Au=!1),2!==t.length||this.Au||this.xu?this.ve():this.de(t)},t.prototype.de=function(t){var i=on(this.zu);this.Lu={V:(t[0].clientX-i.left+(t[1].clientX-i.left))/2,P:(t[0].clientY-i.top+(t[1].clientY-i.top))/2},this.Bu=an(t[0],t[1]),void 0!==this.Pu.ae&&this.Pu.ae(),this.Iu()},t.prototype.ve=function(){null!==this.Lu&&(this.Lu=null,void 0!==this.Pu.le&&this.Pu.le())},t.prototype.te=function(t){this.Tu&&this.Tu();var i=this.ju(t);this.qu(i,this.Pu._e)},t.prototype.re=function(t){var i=this.ju(t);this.qu(i,this.Pu.we),this.Cu=!0,this.xu=!0},t.prototype.qu=function(t,i){i&&i.call(this.Pu,t)},t.prototype.ju=function(t){var i;i="touches"in t&&t.touches.length?t.touches[0]:"changedTouches"in t&&t.changedTouches.length?t.changedTouches[0]:t;var n=on(this.zu);return{Me:i.clientX,be:i.clientY,$u:i.pageX,Xu:i.pageY,me:i.screenX,ge:i.screenY,pe:i.clientX-n.left,ye:i.clientY-n.top,ke:t.ctrlKey,xe:t.altKey,Ne:t.shiftKey,Se:t.metaKey,Ce:t.type.startsWith("mouse")?"mouse":"touch",De:t.view}},t}();function on(t){return t.getBoundingClientRect()||{left:0,top:0}}function an(t,i){var n=t.clientX-i.clientX,h=t.clientY-i.clientY;return Math.sqrt(n*n+h*h)}function fn(t){return Boolean(t.touches)}function ln(t){t.cancelable&&t.preventDefault()}var cn=function(){function t(t,i,n,h){this.rs=new oi(200),this.Zn=0,this.Te="",this._s="",this.ns=[],this.Ee=new Map,this.Zn=t,this.Te=i,this._s=Vt(t,n,h)}return t.prototype.destroy=function(){this.rs.reset(),this.ns=[],this.Ee.clear()},t.prototype.Le=function(t,i,n,h,s){var r=this.Be(t,i);if("left"!==s){var u=Qi(t.canvas);n-=Math.floor(r.Ae*u)}h-=Math.floor(r.fs/2),t.drawImage(r.Oe,n,h,r.ls,r.fs)},t.prototype.Be=function(t,i){var n,h=this;if(this.Ee.has(i))n=a(this.Ee.get(i));else{if(this.ns.length>=200){var s=a(this.ns.shift());this.Ee.delete(s)}var r=Qi(t.canvas),u=Math.ceil(this.Zn/4.5),e=Math.round(this.Zn/10),o=Math.ceil(this.rs.measureText(t,i)),f=it(Math.round(o+2*u)),l=it(this.Zn+2*u),c=nn(document,new Gi(f,l));n={bs:i,Ae:Math.round(Math.max(1,o)),ls:Math.ceil(f*r),fs:Math.ceil(l*r),Oe:c},0!==o&&(this.ns.push(n.bs),this.Ee.set(n.bs,n)),V(t=tn(n.Oe),r,(function(){t.font=h._s,t.fillStyle=h.Te,t.fillText(i,0,l-u-e)}))}return n},t}(),vn=function(){function t(t,i,n,h){var s=this;this.st=null,this.Ve=null,this.ze=null,this.Pe=!1,this.Fe=null,this.Ie="",this.We=new oi(50),this.Re=new cn(11,"#000"),this.Te=null,this._s=null,this.Ue=0,this.je=function(){s.qe(s.cu.options()),s.lt.Ye().He().lightUpdate()},this.Ke=function(){s.lt.Ye().He().lightUpdate()},this.lt=t,this.kt=i,this.cu=n,this.$e="left"===h,this.Xe=document.createElement("div"),this.Xe.style.height="100%",this.Xe.style.overflow="hidden",this.Xe.style.width="25px",this.Xe.style.left="0",this.Xe.style.position="relative",this.Ze=hn(this.Xe,new Gi(16,16)),this.Ze.subscribeCanvasConfigured(this.je);var r=this.Ze.canvas;r.style.position="absolute",r.style.zIndex="1",r.style.left="0",r.style.top="0",this.Je=hn(this.Xe,new Gi(16,16)),this.Je.subscribeCanvasConfigured(this.Ke);var u=this.Je.canvas;u.style.position="absolute",u.style.zIndex="2",u.style.left="0",u.style.top="0";var e={Yu:this.Ge.bind(this),ue:this.Qe.bind(this),Gu:this.io.bind(this),ee:this.no.bind(this),ie:this.ho.bind(this),ne:this.so.bind(this),Hu:this.ro.bind(this),_e:this.uo.bind(this)};this.eo=new en(this.Je.canvas,e,{Zu:!1,Ju:!0})}return t.prototype.destroy=function(){this.eo.destroy(),this.Je.unsubscribeCanvasConfigured(this.Ke),this.Je.destroy(),this.Ze.unsubscribeCanvasConfigured(this.je),this.Ze.destroy(),null!==this.st&&this.st.onMarksChanged().unsubscribeAll(this),this.st=null,null!==this.ze&&(clearTimeout(this.ze),this.ze=null),this.Re.destroy()},t.prototype.oo=function(){return this.Xe},t.prototype.ao=function(){return this.kt.backgroundColor},t.prototype.g=function(){return f(this.st).options().borderColor},t.prototype.fo=function(){return this.kt.textColor},t.prototype.lo=function(){return this.kt.fontSize},t.prototype.co=function(){return Vt(this.lo(),this.kt.fontFamily)},t.prototype.vo=function(){var t=this.cu.options(),i=this.Te!==t.color,n=this._s!==t.font;return(i||n)&&(this.qe(t),this.Te=t.color),n&&(this.We.reset(),this._s=t.font),t},t.prototype.do=function(){if(null===this.st)return 0;var t=34,i=this.vo(),n=tn(this.Ze.canvas),h=this.st.marks();n.font=this.co(),h.length>0&&(t=Math.max(this.We.measureText(n,h[0].label),this.We.measureText(n,h[h.length-1].label)));for(var s=this._o(),r=s.length;r--;){var u=this.We.measureText(n,s[r].text());u>t&&(t=u)}t=Math.max(t,i.width);var e=Math.ceil(i.borderSize+i.tickLength+i.paddingInner+i.paddingOuter+t);return e+=e%2},t.prototype.wo=function(t){if(t.F<0||t.I<0)throw new Error("Try to set invalid size to PriceAxisWidget "+JSON.stringify(t));null!==this.Ve&&this.Ve.gu(t)||(this.Ve=t,this.Ze.resizeCanvas({width:t.F,height:t.I}),this.Je.resizeCanvas({width:t.F,height:t.I}),this.Xe.style.width=t.F+"px",this.Xe.style.height=t.I+"px",this.Xe.style.minWidth=t.F+"px")},t.prototype.Mo=function(){return f(this.Ve).F},t.prototype.bo=function(t){this.st!==t&&(null!==this.st&&this.st.onMarksChanged().unsubscribeAll(this),this.st=t,t.onMarksChanged().subscribe(this.li.bind(this),this))},t.prototype.mo=function(){return this.st},t.prototype.po=function(){var t=this.lt.yo();this.lt.Ye().He().resetPriceScale(t,f(this.mo()))},t.prototype.ko=function(t){if(null!==this.Ve){if(1!==t){var i=tn(this.Ze.canvas);this.xo(),this.No(i,this.Ze.pixelRatio),this.Rh(i,this.Ze.pixelRatio),this.So(i,this.Ze.pixelRatio),this.Co(i,this.Ze.pixelRatio)}var n=tn(this.Je.canvas),h=this.Ve.F,s=this.Ve.I;V(n,this.Je.pixelRatio,(function(){n.clearRect(0,0,h,s)})),this.Do(n,this.Je.pixelRatio)}},t.prototype.To=function(){return this.Ze.canvas},t.prototype.Eo=function(){for(var t=[],i=0,n=this.lt.yo().orderedSources();i<n.length;i++){var h=n[i];h instanceof Wi&&t.push.apply(t,h.customPriceLines().filter((function(t){return t.options().draggable&&t.priceAxisView().isAxisLabelVisible()})))}return t},t.prototype.Lo=function(t){for(var i=this.vo(),n=0,h=this.Eo();n<h.length;n++){var s=h[n],r=s.priceAxisView(),u=r.height(i,!1),e=r.getFixedCoordinate();if(e-u/2<=t&&t<=e+u/2)return s}return null},t.prototype.Ge=function(t){null!==this.Lo(t.ye)?this.Bo(2):this.Bo(1)},t.prototype.Qe=function(t){if(null!==this.st&&!this.st.isEmpty()){this.Pe=!0;var i=this.Lo(t.ye);if(i){this.Fe=i;var n=i.options().price,h=f(this.st.firstValue());return this.Ie=this.st.formatPrice(n,h),void this.Bo(3)}if(this.lt.Ye().Ao().handleScale.axisPressedMouseMove.price){var s=this.lt.Ye().He(),r=this.lt.yo();s.startScalePrice(r,this.st,t.ye)}}},t.prototype.io=function(t){if(null!==this.st){var i=this.st;if(this.Fe){var n=f(i.firstValue()),h=i.coordinateToPrice(t.ye,n);this.Fe.applyOptions({price:h})}else if(this.lt.Ye().Ao().handleScale.axisPressedMouseMove.price){var s=this.lt.Ye().He(),r=this.lt.yo();s.scalePriceTo(r,i,t.ye)}}},t.prototype.no=function(){if(null!==this.st&&this.Pe){if(this.Pe=!1,this.Fe=null,this.Ie="",!this.lt.Ye().Ao().handleScale.axisPressedMouseMove.price)return;var t=this.lt.Ye().He(),i=this.lt.yo(),n=this.st;t.endScalePrice(i,n)}},t.prototype.ho=function(t){if(null!==this.st){var i=this.lt.Ye().He();if(this.Pe=!1,this.Fe)return i.fireCustomPriceLineDragged(this.Fe,this.Ie),this.Fe=null,this.Ie="",void this.Bo(2);if(this.lt.Ye().Ao().handleScale.axisPressedMouseMove.price){var n=this.lt.yo();i.endScalePrice(n,this.st)}}},t.prototype.so=function(t){null===this.Lo(t.ye)&&this.lt.Ye().Ao().handleScale.axisDoubleClickReset&&this.po()},t.prototype.ro=function(t){null!==this.st&&(null===this.Fe?null===this.Lo(t.ye)?!this.lt.Ye().He().options().handleScale.axisPressedMouseMove.price||this.st.isPercentage()||this.st.isIndexedTo100()||this.Bo(1):this.Bo(2):this.Bo(3))},t.prototype.uo=function(t){this.Bo(0)},t.prototype._o=function(){var t=this,i=[],n=null===this.st?void 0:this.st;return function(h){for(var s=0;s<h.length;++s)for(var r=h[s].priceAxisViews(t.lt.yo(),n),u=0;u<r.length;u++)i.push(r[u])}(this.lt.yo().orderedSources()),i},t.prototype.No=function(t,i){var n=this;if(null!==this.Ve){var h=this.Ve.F,s=this.Ve.I;V(t,i,(function(){z(t,0,0,h,s,n.ao())}))}},t.prototype.Rh=function(t,i){if(null!==this.Ve&&null!==this.st&&this.st.options().borderVisible){t.save(),t.fillStyle=this.g();var n,h=Math.max(1,Math.floor(this.vo().borderSize*i));n=this.$e?Math.floor(this.Ve.F*i)-h:0,t.fillRect(n,0,h,Math.ceil(this.Ve.I*i)),t.restore()}},t.prototype.So=function(t,i){if(null!==this.Ve&&null!==this.st){var n=this.st.marks();t.save(),t.strokeStyle=this.g(),t.font=this.co(),t.fillStyle=this.g();var h=this.vo(),s=this.st.options().borderVisible&&this.st.options().drawTicks,r=this.$e?Math.floor((this.Ve.F-h.tickLength)*i-h.borderSize*i):Math.floor(h.borderSize*i),u=this.$e?Math.round(r-h.paddingInner*i):Math.round(r+h.tickLength*i+h.paddingInner*i),e=this.$e?"right":"left",o=Math.max(1,Math.floor(i)),a=Math.floor(.5*i);if(s){var f=Math.round(h.tickLength*i);t.beginPath();for(var l=0,c=n;l<c.length;l++){var v=c[l];t.rect(r,Math.round(v.coord*i)-a,f,o)}t.fill()}t.fillStyle=this.fo();for(var d=0,_=n;d<_.length;d++){v=_[d];this.Re.Le(t,v.label,u,Math.round(v.coord*i),e)}t.restore()}},t.prototype.xo=function(){if(null!==this.Ve&&null!==this.st){var t=this.Ve.I/2,i=[],n=this.st.orderedSources().slice(),h=this.lt.yo(),s=this.vo();this.st===h.defaultPriceScale()&&this.lt.yo().orderedSources().forEach((function(t){h.isOverlay(t)&&n.push(t)}));var r=this.st.dataSources()[0],u=this.st;n.forEach((function(n){var s=n.priceAxisViews(h,u);s.forEach((function(t){t.setFixedCoordinate(null),t.isVisible()&&i.push(t)})),r===n&&s.length>0&&(t=s[0].coordinate())}));var e=i.filter((function(i){return i.coordinate()<=t})),o=i.filter((function(i){return i.coordinate()>t}));if(e.sort((function(t,i){return i.coordinate()-t.coordinate()})),e.length&&o.length&&o.push(e[0]),o.sort((function(t,i){return t.coordinate()-i.coordinate()})),i.forEach((function(t){return t.setFixedCoordinate(t.coordinate())})),this.st.options().alignLabels){for(var a=1;a<e.length;a++){var f=e[a],l=(v=e[a-1]).height(s,!1);f.coordinate()>(d=v.getFixedCoordinate())-l&&f.setFixedCoordinate(d-l)}for(var c=1;c<o.length;c++){var v,d;f=o[c],l=(v=o[c-1]).height(s,!0);f.coordinate()<(d=v.getFixedCoordinate())+l&&f.setFixedCoordinate(d+l)}}}},t.prototype.Co=function(t,i){var n=this;if(null!==this.Ve){t.save();var h=this.Ve,s=this._o(),r=this.vo(),u=this.$e?"right":"left";s.forEach((function(s){if(s.isAxisLabelVisible()){var e=s.renderer(f(n.st));t.save(),e.draw(t,r,n.We,h.F,u,i),t.restore()}})),t.restore()}},t.prototype.Do=function(t,i){var n=this;if(null!==this.Ve&&null!==this.st){t.save();var h=this.Ve,s=this.lt.Ye().He(),r=[],u=this.lt.yo(),e=s.crosshairSource().priceAxisViews(u,this.st);e.length&&r.push(e);var o=this.vo(),a=this.$e?"right":"left";r.forEach((function(s){s.forEach((function(s){t.save(),s.renderer(f(n.st)).draw(t,o,n.We,h.F,a,i),t.restore()}))})),t.restore()}},t.prototype.Bo=function(t){var i="default";1===t?i="ns-resize":2===t?i="grab":3===t&&(i="grabbing"),this.Xe.style.cursor=i},t.prototype.li=function(){var t=this,i=this.do();if(this.Ue<i){var n=this.lt.Ye();null===this.ze&&(this.ze=setTimeout((function(){n&&n.He().fullUpdate(),t.ze=null}),100))}this.Ue=i},t.prototype.qe=function(t){this.Re.destroy(),this.Re=new cn(t.fontSize,t.color,t.fontFamily)},t}(),dn=un,_n=function(){function t(t,i){var n=this;this.Ve=new Gi(0,0),this.Oo=null,this.Vo=null,this.zo=null,this.Po=!1,this.Fo=new Z,this.Io=0,this.Wo=!1,this.Ro=null,this.Uo=!1,this.jo=null,this.je=function(){return n.qo&&n.ot().lightUpdate()},this.Ke=function(){return n.qo&&n.ot().lightUpdate()},this.Ho=t,this.qo=i,this.qo.onDestroyed().subscribe(this.Yo.bind(this),this,!0),this.Ko=document.createElement("td"),this.Ko.style.padding="0",this.Ko.style.position="relative";var h=document.createElement("div");h.style.width="100%",h.style.height="100%",h.style.position="relative",h.style.overflow="hidden",this.$o=document.createElement("td"),this.$o.style.padding="0",this.Xo=document.createElement("td"),this.Xo.style.padding="0",this.Ko.appendChild(h),this.Ze=hn(h,new Gi(16,16)),this.Ze.subscribeCanvasConfigured(this.je);var s=this.Ze.canvas;s.style.position="absolute",s.style.zIndex="1",s.style.left="0",s.style.top="0",this.Je=hn(h,new Gi(16,16)),this.Je.subscribeCanvasConfigured(this.Ke);var r=this.Je.canvas;r.style.position="absolute",r.style.zIndex="2",r.style.left="0",r.style.top="0",this.Zo=document.createElement("tr"),this.Zo.appendChild(this.$o),this.Zo.appendChild(this.Ko),this.Zo.appendChild(this.Xo),this.Jo();var u=this.Ye().Ao().handleScroll;this.eo=new en(this.Je.canvas,this,{Zu:!u.vertTouchDrag,Ju:!u.horzTouchDrag})}return t.prototype.destroy=function(){null!==this.Oo&&this.Oo.destroy(),null!==this.Vo&&this.Vo.destroy(),this.Je.unsubscribeCanvasConfigured(this.Ke),this.Je.destroy(),this.Ze.unsubscribeCanvasConfigured(this.je),this.Ze.destroy(),null!==this.qo&&this.qo.onDestroyed().unsubscribeAll(this),this.eo.destroy()},t.prototype.yo=function(){return f(this.qo)},t.prototype.Go=function(i){null!==this.qo&&this.qo.onDestroyed().unsubscribeAll(this),this.qo=i,null!==this.qo&&this.qo.onDestroyed().subscribe(t.prototype.Yo.bind(this),this,!0),this.Jo()},t.prototype.Ye=function(){return this.Ho},t.prototype.oo=function(){return this.Zo},t.prototype.Jo=function(){if(null!==this.qo&&(this.Qo(),0!==this.ot().serieses().length)){if(null!==this.Oo){var t=this.qo.leftPriceScale();this.Oo.bo(f(t))}if(null!==this.Vo){var i=this.qo.rightPriceScale();this.Vo.bo(f(i))}}},t.prototype.ta=function(){return null!==this.qo?this.qo.stretchFactor():0},t.prototype.ia=function(t){this.qo&&this.qo.setStretchFactor(t)},t.prototype.Hu=function(t){if(this.qo){var i=t.pe,n=t.ye;rn||this.na(i,n)}},t.prototype.ue=function(t){if(this.Wo=!1,this.Uo=null!==this.Ro,this.qo){if(document.activeElement!==document.body&&document.activeElement!==document.documentElement)f(document.activeElement).blur();else{var i=document.getSelection();null!==i&&i.removeAllRanges()}var n=this.ot();if(!this.qo.defaultPriceScale().isEmpty()&&!n.timeScale().isEmpty()){if(null!==this.Ro){var h=n.crosshairSource();this.jo={x:h.appliedX(),y:h.appliedY()},this.Ro={x:t.pe,y:t.ye}}rn||this.na(t.pe,t.ye)}}},t.prototype.Yu=function(t){if(this.qo){var i=t.pe,n=t.ye;if(this.ha()&&this.sa(),!rn){this.na(i,n);var h=this.ra(i,n);this.ot().setHoveredSource(h&&{source:h.ua,object:h.ea}),null!==h&&void 0!==h.De.moveHandler&&h.De.moveHandler(i,n)}}},t.prototype.he=function(t){if(null!==this.qo){var i=t.pe,n=t.ye,h=this.ra(i,n);if(null!==h&&void 0!==h.De.clickHandler&&h.De.clickHandler(i,n),this.Fo.Rt()){var s=this.ot().crosshairSource().appliedIndex();this.Fo.Wt(s,{x:i,y:n})}this.oa()}},t.prototype.Gu=function(t){if(null!==this.qo){var i=this.ot(),n=t.pe,h=t.ye;if(null!==this.Ro){this.Uo=!1;var s=f(this.jo),r=s.x+(n-this.Ro.x),u=s.y+(h-this.Ro.y);this.na(r,u)}else this.ha()||this.na(n,h);if(!i.timeScale().isEmpty()){var e=this.Ho.Ao().handleScroll;if(e.pressedMouseMove&&"touch"!==t.Ce||(e.horzTouchDrag||e.vertTouchDrag)&&"mouse"!==t.Ce){var o=this.qo.defaultPriceScale();null!==this.zo||this.aa()||(this.zo={x:t.Me,y:t.be}),null===this.zo||this.zo.x===t.Me&&this.zo.y===t.be||this.Po||(o.isEmpty()||i.startScrollPrice(this.qo,o,t.ye),i.startScrollTime(t.pe),this.Po=!0),this.Po&&(o.isEmpty()||i.scrollPriceTo(this.qo,o,t.ye),i.scrollTimeTo(t.pe))}}}},t.prototype.ie=function(t){if(null!==this.qo){this.Wo=!1;var i=this.ot();if(this.Po){var n=this.qo.defaultPriceScale();i.endScrollPrice(this.qo,n),i.endScrollTime(),this.zo=null,this.Po=!1}}},t.prototype.we=function(t){if(this.Wo=!0,null===this.Ro&&dn){var i={x:t.pe,y:t.ye};this.fa(i,i)}},t.prototype._e=function(t){null!==this.qo&&(this.qo.model().setHoveredSource(null),un||this.sa())},t.prototype.la=function(){return this.Fo},t.prototype.ae=function(){this.Io=1},t.prototype.fe=function(t,i){if(this.Ho.Ao().handleScale.pinch){var n=5*(i-this.Io);this.Io=i,this.ot().zoomTime(t.V,n)}},t.prototype.ra=function(t,i){var n=this.qo;if(null===n)return null;for(var h=0,s=n.orderedSources();h<s.length;h++){var r=s[h],u=this.ca(r.paneViews(n),t,i);if(null!==u)return{ua:r,De:u.De,ea:u.ea}}return null},t.prototype.va=function(t,i){f("left"===i?this.Oo:this.Vo).wo(new Gi(t,this.Ve.I))},t.prototype.da=function(){return this.Ve},t.prototype.wo=function(t){if(t.F<0||t.I<0)throw new Error("Try to set invalid size to PaneWidget "+JSON.stringify(t));this.Ve.gu(t)||(this.Ve=t,this.Ze.resizeCanvas({width:t.F,height:t.I}),this.Je.resizeCanvas({width:t.F,height:t.I}),this.Ko.style.width=t.F+"px",this.Ko.style.height=t.I+"px")},t.prototype._a=function(){var t=f(this.qo);t.recalculatePriceScale(t.leftPriceScale()),t.recalculatePriceScale(t.rightPriceScale());for(var i=0,n=t.dataSources();i<n.length;i++){var h=n[i];if(t.isOverlay(h)){var s=h.priceScale();null!==s&&t.recalculatePriceScale(s),h.updateAllViews()}}},t.prototype.To=function(){return this.Ze.canvas},t.prototype.ko=function(t){if(0!==t&&null!==this.qo){if(t>1&&this._a(),null!==this.Oo&&this.Oo.ko(t),null!==this.Vo&&this.Vo.ko(t),1!==t){var i=tn(this.Ze.canvas);i.save(),this.No(i,this.wa(),this.Ze.pixelRatio),this.qo&&(this.Ma(i,this.Ze.pixelRatio),this.ba(i,this.Ze.pixelRatio),this.ma(i,this.Ze.pixelRatio)),i.restore()}var n=tn(this.Je.canvas);n.clearRect(0,0,Math.ceil(this.Ve.F*this.Je.pixelRatio),Math.ceil(this.Ve.I*this.Je.pixelRatio)),this.ga(n,this.Je.pixelRatio)}},t.prototype.pa=function(){return this.Oo},t.prototype.ya=function(){return this.Vo},t.prototype.wa=function(){return this.Ho.Ao().layout.backgroundColor},t.prototype.Yo=function(){null!==this.qo&&this.qo.onDestroyed().unsubscribeAll(this),this.qo=null},t.prototype.No=function(t,i,n){var h=this;V(t,n,(function(){z(t,0,0,h.Ve.F,h.Ve.I,i)}))},t.prototype.Ma=function(t,i){var n=f(this.qo),h=n.grid().paneView().renderer(n.height(),n.width());null!==h&&(t.save(),h.draw(t,i,!1),t.restore())},t.prototype.ba=function(t,i){var n=this.ot().watermarkSource();this.ka(n,t,i),this.xa(n,t,i)},t.prototype.ga=function(t,i){this.xa(this.ot().crosshairSource(),t,i)},t.prototype.ma=function(t,i){for(var n=f(this.qo).orderedSources(),h=0,s=n;h<s.length;h++){var r=s[h];this.ka(r,t,i)}for(var u=0,e=n;u<e.length;u++){r=e[u];this.xa(r,t,i)}},t.prototype.xa=function(t,i,n){for(var h=f(this.qo),s=t.paneViews(h),r=h.height(),u=h.width(),e=h.model().hoveredSource(),o=null!==e&&e.source===t,a=null!==e&&o&&void 0!==e.object?e.object.hitTestData:void 0,l=0,c=s;l<c.length;l++){var v=c[l].renderer(r,u);null!==v&&(i.save(),v.draw(i,n,o,a),i.restore())}},t.prototype.ka=function(t,i,n){for(var h=f(this.qo),s=t.paneViews(h),r=h.height(),u=h.width(),e=h.model().hoveredSource(),o=null!==e&&e.source===t,a=null!==e&&o&&void 0!==e.object?e.object.hitTestData:void 0,l=0,c=s;l<c.length;l++){var v=c[l].renderer(r,u);null!==v&&void 0!==v.drawBackground&&(i.save(),v.drawBackground(i,n,o,a),i.restore())}},t.prototype.ca=function(t,i,n){for(var h=0,s=t;h<s.length;h++){var r=s[h],u=r.renderer(this.Ve.I,this.Ve.F);if(null!==u&&u.hitTest){var e=u.hitTest(i,n);if(null!==e)return{De:r,ea:e}}}return null},t.prototype.Qo=function(){if(null!==this.qo){var t=this.Ho;t.Ao().leftPriceScale.visible||null===this.Oo||(this.$o.removeChild(this.Oo.oo()),this.Oo.destroy(),this.Oo=null),t.Ao().rightPriceScale.visible||null===this.Vo||(this.Xo.removeChild(this.Vo.oo()),this.Vo.destroy(),this.Vo=null);var i=t.He().rendererOptionsProvider();t.Ao().leftPriceScale.visible&&null===this.Oo&&(this.Oo=new vn(this,t.Ao().layout,i,"left"),this.$o.appendChild(this.Oo.oo())),t.Ao().rightPriceScale.visible&&null===this.Vo&&(this.Vo=new vn(this,t.Ao().layout,i,"right"),this.Xo.appendChild(this.Vo.oo()))}},t.prototype.ha=function(){return dn&&null===this.Ro},t.prototype.aa=function(){return dn&&this.Wo||null!==this.Ro},t.prototype.Na=function(t){return Math.max(0,Math.min(t,this.Ve.F-1))},t.prototype.Sa=function(t){return Math.max(0,Math.min(t,this.Ve.I-1))},t.prototype.na=function(t,i){this.ot().setAndSaveCurrentPosition(this.Na(t),this.Sa(i),f(this.qo))},t.prototype.sa=function(){this.ot().clearCurrentPosition()},t.prototype.oa=function(){this.Uo&&(this.Ro=null,this.sa())},t.prototype.fa=function(t,i){this.Ro=t,this.Uo=!1,this.na(i.x,i.y);var n=this.ot().crosshairSource();this.jo={x:n.appliedX(),y:n.appliedY()}},t.prototype.ot=function(){return this.Ho.He()},t}(),wn=function(){function t(t,i,n,h){var s=this;this.S=!0,this.Ve=new Gi(0,0),this.je=function(){return s.ko(3)},this.$e="left"===t,this.cu=n.Ca,this.kt=i,this.Da=h,this.Xe=document.createElement("div"),this.Xe.style.width="25px",this.Xe.style.height="100%",this.Xe.style.overflow="hidden",this.Ze=hn(this.Xe,new Gi(16,16)),this.Ze.subscribeCanvasConfigured(this.je)}return t.prototype.destroy=function(){this.Ze.unsubscribeCanvasConfigured(this.je),this.Ze.destroy()},t.prototype.oo=function(){return this.Xe},t.prototype.da=function(){return this.Ve},t.prototype.wo=function(t){if(t.F<0||t.I<0)throw new Error("Try to set invalid size to PriceAxisStub "+JSON.stringify(t));this.Ve.gu(t)||(this.Ve=t,this.Ze.resizeCanvas({width:t.F,height:t.I}),this.Xe.style.width=t.F+"px",this.Xe.style.minWidth=t.F+"px",this.Xe.style.height=t.I+"px",this.S=!0)},t.prototype.ko=function(t){if((!(t<3)||this.S)&&0!==this.Ve.F&&0!==this.Ve.I){this.S=!1;var i=tn(this.Ze.canvas);this.No(i,this.Ze.pixelRatio),this.Rh(i,this.Ze.pixelRatio)}},t.prototype.To=function(){return this.Ze.canvas},t.prototype.Rh=function(t,i){if(this.Da()){var n=this.Ve.F;t.save(),t.fillStyle=this.kt.timeScale.borderColor;var h=Math.floor(this.cu.options().borderSize*i),s=this.$e?Math.round(n*i)-h:0;t.fillRect(s,0,h,h),t.restore()}},t.prototype.No=function(t,i){var n=this;V(t,i,(function(){z(t,0,0,n.Ve.F,n.Ve.I,n.kt.layout.backgroundColor)}))},t}();function Mn(t,i){return t.weight>i.weight?t:i}var bn=function(){function t(t){var i=this;this.Ta=null,this.Ea=null,this.Xn=null,this.La=!1,this.Ve=new Gi(0,0),this.je=function(){return i.Ho.He().lightUpdate()},this.Ke=function(){return i.Ho.He().lightUpdate()},this.Ho=t,this.kt=t.Ao().layout,this.Ba=document.createElement("tr"),this.Aa=document.createElement("td"),this.Aa.style.padding="0",this.Oa=document.createElement("td"),this.Oa.style.padding="0",this.Xe=document.createElement("td"),this.Xe.style.height="25px",this.Xe.style.padding="0",this.Va=document.createElement("div"),this.Va.style.width="100%",this.Va.style.height="100%",this.Va.style.position="relative",this.Va.style.overflow="hidden",this.Xe.appendChild(this.Va),this.Ze=hn(this.Va,new Gi(16,16)),this.Ze.subscribeCanvasConfigured(this.je);var n=this.Ze.canvas;n.style.position="absolute",n.style.zIndex="1",n.style.left="0",n.style.top="0",this.Je=hn(this.Va,new Gi(16,16)),this.Je.subscribeCanvasConfigured(this.Ke);var h=this.Je.canvas;h.style.position="absolute",h.style.zIndex="2",h.style.left="0",h.style.top="0",this.Ba.appendChild(this.Aa),this.Ba.appendChild(this.Xe),this.Ba.appendChild(this.Oa),this.za(),this.Ho.He().priceScalesOptionsChanged().subscribe(this.za.bind(this),this),this.eo=new en(this.Je.canvas,this,{Zu:!0,Ju:!1})}return t.prototype.destroy=function(){this.eo.destroy(),null!==this.Ta&&this.Ta.destroy(),null!==this.Ea&&this.Ea.destroy(),this.Je.unsubscribeCanvasConfigured(this.Ke),this.Je.destroy(),this.Ze.unsubscribeCanvasConfigured(this.je),this.Ze.destroy()},t.prototype.oo=function(){return this.Ba},t.prototype.Pa=function(){return this.Ta},t.prototype.Fa=function(){return this.Ea},t.prototype.ue=function(t){if(!this.La){this.La=!0;var i=this.Ho.He();!i.timeScale().isEmpty()&&this.Ho.Ao().handleScale.axisPressedMouseMove.time&&i.startScaleTime(t.pe)}},t.prototype.ee=function(){var t=this.Ho.He();!t.timeScale().isEmpty()&&this.La&&(this.La=!1,this.Ho.Ao().handleScale.axisPressedMouseMove.time&&t.endScaleTime())},t.prototype.Gu=function(t){var i=this.Ho.He();!i.timeScale().isEmpty()&&this.Ho.Ao().handleScale.axisPressedMouseMove.time&&i.scaleTimeTo(t.pe)},t.prototype.ie=function(t){this.La=!1;var i=this.Ho.He();i.timeScale().isEmpty()&&!this.Ho.Ao().handleScale.axisPressedMouseMove.time||i.endScaleTime()},t.prototype.ne=function(){this.Ho.Ao().handleScale.axisDoubleClickReset&&this.Ho.He().resetTimeScale()},t.prototype.Hu=function(t){this.Ho.He().options().handleScale.axisPressedMouseMove.time&&this.Bo(1)},t.prototype._e=function(t){this.Bo(0)},t.prototype.da=function(){return this.Ve},t.prototype.Ia=function(t,i,n){this.Ve&&this.Ve.gu(t)||(this.Ve=t,this.Ze.resizeCanvas({width:t.F,height:t.I}),this.Je.resizeCanvas({width:t.F,height:t.I}),this.Xe.style.width=t.F+"px",this.Xe.style.height=t.I+"px"),null!==this.Ta&&this.Ta.wo(new Gi(i,t.I)),null!==this.Ea&&this.Ea.wo(new Gi(n,t.I))},t.prototype.Wa=function(){var t=this.Ra();return Math.ceil(t.borderSize+t.tickLength+t.fontSize+t.paddingTop+t.paddingBottom)},t.prototype.Y=function(){this.Ho.He().timeScale().marks()},t.prototype.To=function(){return this.Ze.canvas},t.prototype.ko=function(t){if(0!==t){if(1!==t){var i=tn(this.Ze.canvas);this.No(i,this.Ze.pixelRatio),this.Rh(i,this.Ze.pixelRatio),this.So(i,this.Ze.pixelRatio),null!==this.Ta&&this.Ta.ko(t),null!==this.Ea&&this.Ea.ko(t)}var n=tn(this.Je.canvas),h=this.Je.pixelRatio;n.clearRect(0,0,Math.ceil(this.Ve.F*h),Math.ceil(this.Ve.I*h)),this.Ua([this.Ho.He().crosshairSource()],n,h)}},t.prototype.No=function(t,i){var n=this;V(t,i,(function(){z(t,0,0,n.Ve.F,n.Ve.I,n.wa())}))},t.prototype.Rh=function(t,i){if(this.Ho.Ao().timeScale.borderVisible){t.save(),t.fillStyle=this.ja();var n=Math.max(1,Math.floor(this.Ra().borderSize*i));t.fillRect(0,0,Math.ceil(this.Ve.F*i),n),t.restore()}},t.prototype.So=function(t,i){var n=this,h=this.Ho.He().timeScale().marks();if(h&&0!==h.length){var s=h.reduce(Mn,h[0]).weight;s>30&&s<40&&(s=30),t.save(),t.strokeStyle=this.ja();var r=this.Ra(),u=r.borderSize+r.tickLength+r.paddingTop+r.fontSize-r.baselineOffset;t.textAlign="center",t.fillStyle=this.ja();var e=Math.floor(this.Ra().borderSize*i),o=Math.max(1,Math.floor(i)),a=Math.floor(.5*i);if(this.Ho.He().timeScale().options().borderVisible){t.beginPath();for(var f=Math.round(r.tickLength*i),l=h.length;l--;){var c=Math.round(h[l].coord*i);t.rect(c-a,e,o,f)}t.fill()}t.fillStyle=this.Gn(),V(t,i,(function(){t.font=n.qa();for(var i=0,r=h;i<r.length;i++){(a=r[i]).weight<s&&t.fillText(a.label,a.coord,u)}t.font=n.Ha();for(var e=0,o=h;e<o.length;e++){var a;(a=o[e]).weight>=s&&t.fillText(a.label,a.coord,u)}}))}},t.prototype.Ua=function(t,i,n){for(var h=this.Ra(),s=0,r=t;s<r.length;s++)for(var u=0,e=r[s].timeAxisViews();u<e.length;u++){var o=e[u];i.save(),o.renderer().draw(i,h,n),i.restore()}},t.prototype.wa=function(){return this.kt.backgroundColor},t.prototype.ja=function(){return this.Ho.Ao().timeScale.borderColor},t.prototype.Gn=function(){return this.kt.textColor},t.prototype.Zn=function(){return this.kt.fontSize},t.prototype.qa=function(){return Vt(this.Zn(),this.kt.fontFamily)},t.prototype.Ha=function(){return Vt(this.Zn(),this.kt.fontFamily,"bold")},t.prototype.Ra=function(){null===this.Xn&&(this.Xn={borderSize:1,baselineOffset:NaN,paddingTop:NaN,paddingBottom:NaN,paddingHorizontal:NaN,tickLength:3,fontSize:NaN,font:"",widthCache:new oi});var t=this.Xn,i=this.qa();if(t.font!==i){var n=this.Zn();t.fontSize=n,t.font=i,t.paddingTop=Math.ceil(n/2.5),t.paddingBottom=t.paddingTop,t.paddingHorizontal=Math.ceil(n/2),t.baselineOffset=Math.round(this.Zn()/5),t.widthCache.reset()}return this.Xn},t.prototype.Bo=function(t){this.Xe.style.cursor=1===t?"ew-resize":"default"},t.prototype.za=function(){var t=this.Ho.He(),i=t.options();i.leftPriceScale.visible||null===this.Ta||(this.Aa.removeChild(this.Ta.oo()),this.Ta.destroy(),this.Ta=null),i.rightPriceScale.visible||null===this.Ea||(this.Oa.removeChild(this.Ea.oo()),this.Ea.destroy(),this.Ea=null);var n={Ca:this.Ho.He().rendererOptionsProvider()};if(i.leftPriceScale.visible&&null===this.Ta){var h=function(){return i.leftPriceScale.borderVisible&&t.timeScale().options().borderVisible};this.Ta=new wn("left",this.Ho.Ao(),n,h),this.Aa.appendChild(this.Ta.oo())}if(i.rightPriceScale.visible&&null===this.Ea){h=function(){return i.rightPriceScale.borderVisible&&t.timeScale().options().borderVisible};this.Ea=new wn("right",this.Ho.Ao(),n,h),this.Oa.appendChild(this.Ea.oo())}},t}(),mn=function(){function t(t,i){var n;this.Ya=[],this.Ka=0,this.ni=0,this.fn=0,this.$a=0,this.Xa=0,this.Za=null,this.Ja=!1,this.Fo=new Z,this.au=new Z,this.fu=new Z,this.kt=i,this.Ba=document.createElement("div"),this.Ba.classList.add("tv-lightweight-charts"),this.Ba.style.overflow="hidden",this.Ba.style.width="100%",this.Ba.style.height="100%",(n=this.Ba).style.userSelect="none",n.style.webkitUserSelect="none",n.style.msUserSelect="none",n.style.MozUserSelect="none",n.style.webkitTapHighlightColor="transparent",this.Ga=document.createElement("table"),this.Ga.setAttribute("cellspacing","0"),this.Ba.appendChild(this.Ga),this.Qa=this.tf.bind(this),this.Ba.addEventListener("wheel",this.Qa,{passive:!1}),this.ot=new Xi(this.lu.bind(this),this.kt),this.He().crosshairMoved().subscribe(this.if.bind(this),this),this.He().customPriceLineDragged().subscribe(this.nf.bind(this),this),this.hf=new bn(this),this.Ga.appendChild(this.hf.oo());var h=this.kt.width,s=this.kt.height;if(0===h||0===s){var r=t.getBoundingClientRect();0===h&&(h=Math.floor(r.width),h-=h%2),0===s&&(s=Math.floor(r.height),s-=s%2)}this.sf(h,s),this.rf(),t.appendChild(this.Ba),this.uf(),this.ot.timeScale().optionsApplied().subscribe(this.ot.fullUpdate.bind(this.ot),this),this.ot.priceScalesOptionsChanged().subscribe(this.ot.fullUpdate.bind(this.ot),this)}return t.prototype.He=function(){return this.ot},t.prototype.Ao=function(){return this.kt},t.prototype.ef=function(){return this.Ya},t.prototype.destroy=function(){this.Ba.removeEventListener("wheel",this.Qa),0!==this.Ka&&window.cancelAnimationFrame(this.Ka),this.ot.crosshairMoved().unsubscribeAll(this),this.ot.customPriceLineDragged().unsubscribeAll(this),this.ot.timeScale().optionsApplied().unsubscribeAll(this),this.ot.priceScalesOptionsChanged().unsubscribeAll(this),this.ot.destroy();for(var t=0,i=this.Ya;t<i.length;t++){var n=i[t];this.Ga.removeChild(n.oo()),n.la().unsubscribeAll(this),n.destroy()}this.Ya=[],f(this.hf).destroy(),null!==this.Ba.parentElement&&this.Ba.parentElement.removeChild(this.Ba),this.au.Ut(),this.Fo.Ut()},t.prototype.sf=function(t,i,n){if(void 0===n&&(n=!1),this.ni!==i||this.fn!==t){this.ni=i,this.fn=t;var h=i+"px",s=t+"px";f(this.Ba).style.height=h,f(this.Ba).style.width=s,this.Ga.style.height=h,this.Ga.style.width=s,n?this.af(new Ft(3)):this.ot.fullUpdate()}},t.prototype.ko=function(t){void 0===t&&(t=new Ft(3));for(var i=0;i<this.Ya.length;i++)this.Ya[i].ko(t.invalidateForPane(i).level);this.hf.ko(t.fullInvalidation())},t.prototype.ff=function(t){this.ot.applyOptions(t),this.uf();var i=t.width||this.fn,n=t.height||this.ni;this.sf(i,n)},t.prototype.la=function(){return this.Fo},t.prototype.lf=function(){return this.au},t.prototype.cf=function(){return this.fu},t.prototype.vf=function(){var t=this;null!==this.Za&&(this.af(this.Za),this.Za=null);var i=this.Ya[0],n=nn(document,new Gi(this.fn,this.ni)),h=tn(n),s=Qi(n);return V(h,s,(function(){var n=0,s=0,r=function(i){for(var r=0;r<t.Ya.length;r++){var u=t.Ya[r],e=u.da().I,o=f("left"===i?u.pa():u.ya()),a=o.To();h.drawImage(a,n,s,o.Mo(),e),s+=e}};t.df()&&(r("left"),n=f(i.pa()).Mo()),s=0;for(var u=0;u<t.Ya.length;u++){var e=t.Ya[u],o=e.da(),a=e.To();h.drawImage(a,n,s,o.F,o.I),s+=o.I}n+=i.da().F,t._f()&&(s=0,r("right"));var l=function(i){var r=f("left"===i?t.hf.Pa():t.hf.Fa()),u=r.da(),e=r.To();h.drawImage(e,n,s,u.F,u.I)};if(t.kt.timeScale.visible){n=0,t.df()&&(l("left"),n=f(i.pa()).Mo());var c=t.hf.da();a=t.hf.To();h.drawImage(a,n,s,c.F,c.I),t._f()&&(n=i.da().F,l("right"),h.restore())}})),n},t.prototype.wf=function(t){return"none"===t?0:("left"!==t||this.df())&&("right"!==t||this._f())?0===this.Ya.length?0:f("left"===t?this.Ya[0].pa():this.Ya[0].ya()).Mo():0},t.prototype.Mf=function(){for(var t=0,i=0,n=0,h=0,s=this.Ya;h<s.length;h++){var r=s[h];this.df()&&(i=Math.max(i,f(r.pa()).do())),this._f()&&(n=Math.max(n,f(r.ya()).do())),t+=r.ta()}var u=this.fn,e=this.ni,o=Math.max(u-i-n,0),a=this.kt.timeScale.visible?this.hf.Wa():0;a%2&&(a+=1);for(var l=0+a,c=e<l?0:e-l,v=c/t,d=0,_=0;_<this.Ya.length;++_){(r=this.Ya[_]).Go(this.ot.panes()[_]);var w,M=0;M=_===this.Ya.length-1?c-d:Math.round(r.ta()*v),d+=w=Math.max(M,2),r.wo(new Gi(o,w)),this.df()&&r.va(i,"left"),this._f()&&r.va(n,"right"),r.yo()&&this.ot.setPaneHeight(r.yo(),w)}this.hf.Ia(new Gi(o,a),i,n),this.ot.setWidth(o),this.$a!==i&&(this.$a=i),this.Xa!==n&&(this.Xa=n)},t.prototype.tf=function(t){var i=t.deltaX/100,n=-t.deltaY/100;if(0!==i&&this.kt.handleScroll.mouseWheel||0!==n&&this.kt.handleScale.mouseWheel){switch(t.cancelable&&t.preventDefault(),t.deltaMode){case t.DOM_DELTA_PAGE:i*=120,n*=120;break;case t.DOM_DELTA_LINE:i*=32,n*=32}if(0!==n&&this.kt.handleScale.mouseWheel){var h=Math.sign(n)*Math.min(1,Math.abs(n)),s=t.clientX-this.Ba.getBoundingClientRect().left;this.He().zoomTime(s,h)}0!==i&&this.kt.handleScroll.mouseWheel&&this.He().scrollChart(-80*i)}},t.prototype.af=function(t){var i=t.fullInvalidation();if(3===i&&this.bf(),3===i||2===i){for(var n=this.ot.panes(),h=0;h<n.length;h++)t.invalidateForPane(h).autoScale&&n[h].momentaryAutoScale();for(var s=t.timeScaleInvalidations(),r=0,u=s;r<u.length;r++){var e=u[r];this.hh(e)}s.length>0&&(this.ot.recalculateAllPanes(),this.ot.updateCrosshair(),this.ot.lightUpdate()),this.hf.Y()}this.ko(t)},t.prototype.hh=function(t){var i=this.ot.timeScale();switch(t.type){case 0:i.fitContent();break;case 1:i.setLogicalRange(t.value);break;case 2:i.setBarSpacing(t.value);break;case 3:i.setRightOffset(t.value);break;case 4:i.restoreDefault()}},t.prototype.lu=function(t){var i=this;null!==this.Za?this.Za.merge(t):this.Za=t,this.Ja||(this.Ja=!0,this.Ka=window.requestAnimationFrame((function(){i.Ja=!1,i.Ka=0,null!==i.Za&&(i.af(i.Za),i.Za=null)})))},t.prototype.bf=function(){this.rf()},t.prototype.rf=function(){for(var t=this.ot.panes(),i=t.length,n=this.Ya.length,h=i;h<n;h++){var s=a(this.Ya.pop());this.Ga.removeChild(s.oo()),s.la().unsubscribeAll(this),s.destroy()}for(h=n;h<i;h++){(s=new _n(this,t[h])).la().subscribe(this.mf.bind(this),this),this.Ya.push(s),this.Ga.insertBefore(s.oo(),this.hf.oo())}for(h=0;h<i;h++){var r=t[h];(s=this.Ya[h]).yo()!==r?s.Go(r):s.Jo()}this.uf(),this.Mf()},t.prototype.gf=function(t,i){var n,h=new Map;null!==t&&this.ot.serieses().forEach((function(i){var n=i.dataAt(t);null!==n&&h.set(i,n)}));if(null!==t){var s=this.ot.timeScale().indexToTime(t);null!==s&&(n=s)}var r=this.He().hoveredSource(),u=null!==r&&r.source instanceof Wi?r.source:void 0,e=null!==r&&void 0!==r.object?r.object.externalId:void 0;return{at:n,pf:i||void 0,yf:u,kf:h,xf:e}},t.prototype.Nf=function(t,i){return{Sf:t,Cf:i}},t.prototype.mf=function(t,i){var n=this;this.Fo.Wt((function(){return n.gf(t,i)}))},t.prototype.if=function(t,i){var n=this;this.au.Wt((function(){return n.gf(t,i)}))},t.prototype.nf=function(t,i){var n=this;this.fu.Wt((function(){return n.Nf(t,i)}))},t.prototype.uf=function(){var t=this.kt.timeScale.visible?"":"none";this.hf.oo().style.display=t},t.prototype.df=function(){return this.kt.leftPriceScale.visible},t.prototype._f=function(){return this.kt.rightPriceScale.visible},t}();function gn(t,i,n){var h=n.value,s={index:i,time:t,value:[h,h,h,h]};return"color"in n&&void 0!==n.color&&(s.color=n.color),s}function pn(t,i,n){return{index:i,time:t,value:[n.open,n.high,n.low,n.close]}}function yn(t){return void 0!==t.value}function kn(t){return function(i,n,h){return void 0===(s=h).open&&void 0===s.value?{time:i,index:n}:t(i,n,h);var s}}var xn={Candlestick:kn(pn),Bar:kn(pn),Area:kn(gn),Histogram:kn(gn),Line:kn(gn)};function Nn(t){return xn[t]}function Sn(t){return 60*t*60*1e3}function Cn(t){return 60*t*1e3}var Dn,Tn=[{Df:1,Tf:20},{Df:(Dn=1,1e3*Dn),Tf:19},{Df:Cn(1),Tf:20},{Df:Cn(5),Tf:21},{Df:Cn(30),Tf:22},{Df:Sn(1),Tf:30},{Df:Sn(3),Tf:31},{Df:Sn(6),Tf:32},{Df:Sn(12),Tf:33}];function En(t,i){if(null!==i){var n=new Date(1e3*i),h=new Date(1e3*t);if(h.getUTCFullYear()!==n.getUTCFullYear())return 70;if(h.getUTCMonth()!==n.getUTCMonth())return 60;if(h.getUTCDate()!==n.getUTCDate())return 50;for(var s=Tn.length-1;s>=0;--s)if(Math.floor(n.getTime()/Tn[s].Df)!==Math.floor(h.getTime()/Tn[s].Df))return Tn[s].Tf}return 20}function Ln(t){if(!Bt(t))throw new Error("time must be of type BusinessDay");var i=new Date(Date.UTC(t.year,t.month-1,t.day,0,0,0,0));return{timestamp:Math.round(i.getTime()/1e3),businessDay:t}}function Bn(t){if(!At(t))throw new Error("time must be of type isUTCTimestamp");return{timestamp:t}}function An(t){return 0===t.length?null:Bt(t[0].time)?Ln:Bn}function On(t){return At(t)?Bn(t):Bt(t)?Ln(t):Ln(Vn(t))}function Vn(t){var i=new Date(t);if(isNaN(i.getTime()))throw new Error("Invalid date string="+t+", expected format=yyyy-mm-dd");return{day:i.getUTCDate(),month:i.getUTCMonth()+1,year:i.getUTCFullYear()}}function zn(t){_(t.time)&&(t.time=Vn(t.time))}function Pn(t){return{Ef:0,Lf:new Map,Bf:t}}var Fn=function(){function t(){this.Af=new Map,this.Of=new Map,this.Vf=new Map,this.zf=[]}return t.prototype.Ut=function(){this.Af.clear(),this.Of.clear(),this.Vf.clear(),this.zf=[]},t.prototype.Pf=function(t,i){var n=this;this.Vf.has(t)&&this.Af.forEach((function(i){return i.Lf.delete(t)}));var h=[];if(0!==i.length){!function(t){t.forEach(zn)}(i);var s=f(An(i)),r=Nn(t.seriesType());h=i.map((function(i){var h=s(i.time),u=n.Af.get(h.timestamp);void 0===u&&(u=Pn(h),n.Af.set(h.timestamp,u));var e=r(h,u.Ef,i);return u.Lf.set(t,e),e}))}return this.Ff(),this.If(t,h),this.Wf(t)},t.prototype.Rf=function(t){return this.Pf(t,[])},t.prototype.Uf=function(t,i){zn(i);var n=f(An([i]))(i.time),h=this.Vf.get(t);if(void 0!==h&&n.timestamp<h.timestamp)throw new Error("Cannot update oldest data, last time="+h.timestamp+", new time="+n.timestamp);var s=this.Af.get(n.timestamp),r=void 0===s;void 0===s&&(s=Pn(n),this.Af.set(n.timestamp,s));var u=Nn(t.seriesType())(n,s.Ef,i);s.Lf.set(t,u);var e=this.jf(t,u);if(!r){var o=new Map;return null!==e&&o.set(t,e),{qf:o,Hf:{Yf:this.Kf()}}}return this.Wf(t)},t.prototype.jf=function(t,i){var n=this.Of.get(t);void 0===n&&(n=[],this.Of.set(t,n));var h=0!==n.length?n[n.length-1]:null,s=null;return null===h||i.time.timestamp>h.time.timestamp?yn(i)&&(n.push(i),s={$f:!1,Xf:[i]}):yn(i)?(n[n.length-1]=i,s={$f:!1,Xf:[i]}):(n.splice(-1,1),s={$f:!0,Xf:n}),this.Vf.set(t,i.time),s},t.prototype.If=function(t,i){0!==i.length?(this.Of.set(t,i.filter(yn)),this.Vf.set(t,i[i.length-1].time)):(this.Of.delete(t),this.Vf.delete(t))},t.prototype.Ff=function(){var t=new Map;this.Af.forEach((function(i,n){i.Lf.size>0&&t.set(n,i)})),this.Af=t},t.prototype.Zf=function(t){for(var i=-1,n=0;n<this.zf.length&&n<t.length;++n){var h=this.zf[n],s=t[n];if(h.time.timestamp!==s.time.timestamp){i=n;break}s.timeWeight=h.timeWeight}if(-1===i&&this.zf.length!==t.length&&(i=Math.min(this.zf.length,t.length)),-1===i)return-1;var r=function(i){var n=a(u.Af.get(t[i].time.timestamp));n.Ef=i,n.Lf.forEach((function(t){t.index=i}))},u=this;for(n=i;n<t.length;++n)r(n);return function(t,i){void 0===i&&(i=0);for(var n=0===i||0===t.length?null:t[i-1].time.timestamp,h=0,s=i;s<t.length;++s){var r=t[s];r.timeWeight=En(r.time.timestamp,n),h+=r.time.timestamp-(n||r.time.timestamp),n=r.time.timestamp}if(0===i&&t.length>1){var u=Math.ceil(h/(t.length-1)),e=t[0].time.timestamp-u;t[0].timeWeight=En(t[0].time.timestamp,e)}}(t,i),this.zf=t,i},t.prototype.Kf=function(){if(0===this.Of.size)return null;var t=0;return this.Of.forEach((function(i){0!==i.length&&(t=Math.max(t,i[i.length-1].index))})),t},t.prototype.Wf=function(t){var i=Array.from(this.Af.values()).map((function(t){return{timeWeight:0,time:t.Bf}}));i.sort((function(t,i){return t.time.timestamp-i.time.timestamp}));var n=this.Zf(i),h={qf:new Map,Hf:{Yf:this.Kf()}};if(-1!==n)this.Of.forEach((function(t,i){h.qf.set(i,{Xf:t,$f:!0})})),this.Of.has(t)||h.qf.set(t,{Xf:[],$f:!0}),h.Hf.Jf=this.zf;else{var s=this.Of.get(t);h.qf.set(t,{Xf:s||[],$f:!0})}return h},t}();var In={color:"#FF0000",price:0,lineStyle:2,lineWidth:1,axisLabelVisible:!0,title:"",draggable:!1},Wn=function(){function t(t){this.Os=t}return t.prototype.applyOptions=function(t){this.Os.applyOptions(t)},t.prototype.options=function(){return this.Os.options()},t.prototype.Gf=function(){return this.Os},t}();function Rn(t){var i=t.overlay,n=function(t,i){var n={};for(var h in t)Object.prototype.hasOwnProperty.call(t,h)&&i.indexOf(h)<0&&(n[h]=t[h]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(h=Object.getOwnPropertySymbols(t);s<h.length;s++)i.indexOf(h[s])<0&&Object.prototype.propertyIsEnumerable.call(t,h[s])&&(n[h[s]]=t[h[s]])}return n}(t,["overlay"]);return i&&(n.priceScaleId=""),n}var Un=function(){function t(t,i,n){this.bh=t,this.Qf=i,this.tl=n}return t.prototype.priceFormatter=function(){return this.bh.formatter()},t.prototype.priceToCoordinate=function(t){var i=this.bh.firstValue();return null===i?null:this.bh.priceScale().priceToCoordinate(t,i.value)},t.prototype.coordinateToPrice=function(t){var i=this.bh.firstValue();return null===i?null:this.bh.priceScale().coordinateToPrice(t,i.value)},t.prototype.barsInLogicalRange=function(t){if(null===t)return null;var i=new Et(new St(t.from,t.to)).en(),n=this.bh.bars();if(n.isEmpty())return null;var h=n.search(i.left(),1),s=n.search(i.right(),-1),r=f(n.firstIndex()),u=f(n.lastIndex());if(null!==h&&null!==s&&h.index>s.index)return{barsBefore:t.from-r,barsAfter:u-t.to};var e={barsBefore:null===h||h.index===r?t.from-r:h.index-r,barsAfter:null===s||s.index===u?u-t.to:u-s.index};return null!==h&&null!==s&&(e.from=h.time.businessDay||h.time.timestamp,e.to=s.time.businessDay||s.time.timestamp),e},t.prototype.setData=function(t){this.bh.seriesType(),this.Qf.il(this.bh,t)},t.prototype.update=function(t){this.bh.seriesType(),this.Qf.nl(this.bh,t)},t.prototype.setMarkers=function(t){var i=t.map((function(t){return u(u({},t),{time:On(t.time)})}));this.bh.setMarkers(i)},t.prototype.applyOptions=function(t){var i=Rn(t);this.bh.applyOptions(i)},t.prototype.options=function(){return M(this.bh.options())},t.prototype.priceScale=function(){return this.tl.priceScale(this.bh.priceScale().id())},t.prototype.createPriceLine=function(t){var i=c(M(In),t),n=this.bh.createPriceLine(i);return new Wn(n)},t.prototype.removePriceLine=function(t){this.bh.removePriceLine(t.Gf())},t.prototype.seriesType=function(){return this.bh.seriesType()},t}(),jn=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return r(i,t),i.prototype.applyOptions=function(i){bt(i),t.prototype.applyOptions.call(this,i)},i}(Un),qn={autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,borderVisible:!0,borderColor:"#2B2B43",entireTextOnly:!1,visible:!1,drawTicks:!0,scaleMargins:{bottom:.1,top:.2},width:0},Hn={color:"rgba(0, 0, 0, 0)",visible:!1,fontSize:48,fontFamily:Ot,fontStyle:"",text:"",horzAlign:"center",vertAlign:"center"},Yn={width:0,height:0,layout:{backgroundColor:"#FFFFFF",textColor:"#191919",fontSize:11,fontFamily:Ot},crosshair:{vertLine:{color:"#758696",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#4c525e"},horzLine:{color:"#758696",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#4c525e"},mode:1},grid:{vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}},overlayPriceScales:u({},qn),leftPriceScale:u(u({},qn),{visible:!1}),rightPriceScale:u(u({},qn),{visible:!0}),timeScale:{rightOffset:0,barSpacing:6,minBarSpacing:.5,fixLeftEdge:!1,fixRightEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",visible:!0,timeVisible:!1,secondsVisible:!0,shiftVisibleRangeOnNewBar:!0},watermark:Hn,localization:{locale:sn?navigator.language:"",dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:{time:!0,price:!0},axisDoubleClickReset:!0,mouseWheel:!0,pinch:!0}},Kn={upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"},$n={upColor:"#26a69a",downColor:"#ef5350",openVisible:!0,thinBars:!0},Xn={color:"#2196f3",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:""},Zn={topColor:"rgba( 46, 220, 135, 0.4)",bottomColor:"rgba( 40, 221, 100, 0)",lineColor:"#33D778",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:""},Jn={color:"#26a69a",base:0},Gn={title:"",visible:!0,lastValueVisible:!0,priceLineVisible:!0,priceLineSource:0,priceLineWidth:1,priceLineColor:"",priceLineStyle:2,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01}},Qn=function(){function t(t,i){this.hl=t,this.sl=i}return t.prototype.applyOptions=function(t){this.hl.He().applyPriceScaleOptions(this.sl,t)},t.prototype.options=function(){return this.st().options()},t.prototype.width=function(){return Pt(this.sl)?this.hl.wf("left"===this.sl?"left":"right"):0},t.prototype.formatPrice=function(t,i){return void 0===i&&(i=0),this.st().formatPrice(t,i)},t.prototype.st=function(){return f(this.hl.He().findPriceScale(this.sl)).priceScale},t}(),th=function(){function t(t){this.rl=new Z,this.bn=new Z,this.ot=t,this.Pr().visibleBarsChanged().subscribe(this.ul.bind(this)),this.Pr().logicalRangeChanged().subscribe(this.el.bind(this))}return t.prototype.destroy=function(){this.Pr().visibleBarsChanged().unsubscribeAll(this),this.Pr().logicalRangeChanged().unsubscribeAll(this),this.rl.Ut()},t.prototype.scrollPosition=function(){return this.Pr().rightOffset()},t.prototype.scrollToPosition=function(t,i){i?this.Pr().scrollToOffsetAnimated(t,1e3):this.ot.setRightOffset(t)},t.prototype.scrollToRealTime=function(){this.Pr().scrollToRealTime()},t.prototype.getVisibleRange=function(){var t,i,n=this.Pr().visibleTimeRange();return null===n?null:{from:null!==(t=n.from.businessDay)&&void 0!==t?t:n.from.timestamp,to:null!==(i=n.to.businessDay)&&void 0!==i?i:n.to.timestamp}},t.prototype.setVisibleRange=function(t){var i={from:On(t.from),to:On(t.to)},n=this.Pr().logicalRangeForTimeRange(i);this.ot.setTargetLogicalRange(n)},t.prototype.getVisibleLogicalRange=function(){var t=this.Pr().visibleLogicalRange();return null===t?null:{from:t.left(),to:t.right()}},t.prototype.setVisibleLogicalRange=function(t){o(t.from<=t.to,"The from index cannot be after the to index."),this.ot.setTargetLogicalRange(t)},t.prototype.resetTimeScale=function(){this.ot.resetTimeScale()},t.prototype.fitContent=function(){this.ot.fitContent()},t.prototype.logicalToCoordinate=function(t){var i=this.ot.timeScale();return i.isEmpty()?null:i.indexToCoordinate(t)},t.prototype.coordinateToLogical=function(t){var i=this.ot.timeScale();return i.isEmpty()?null:i.coordinateToIndex(t)},t.prototype.timeToCoordinate=function(t){var i=On(t),n=this.ot.timeScale(),h=n.timeToIndex(i,!1);return null===h?null:n.indexToCoordinate(h)},t.prototype.coordinateToTime=function(t){var i,n=this.ot.timeScale(),h=n.coordinateToIndex(t),s=n.indexToTime(h);return null===s?null:null!==(i=s.businessDay)&&void 0!==i?i:s.timestamp},t.prototype.subscribeVisibleTimeRangeChange=function(t){this.rl.subscribe(t)},t.prototype.unsubscribeVisibleTimeRangeChange=function(t){this.rl.unsubscribe(t)},t.prototype.subscribeVisibleLogicalRangeChange=function(t){this.bn.subscribe(t)},t.prototype.unsubscribeVisibleLogicalRangeChange=function(t){this.bn.unsubscribe(t)},t.prototype.applyOptions=function(t){this.Pr().applyOptions(t)},t.prototype.options=function(){return M(this.Pr().options())},t.prototype.Pr=function(){return this.ot.timeScale()},t.prototype.ul=function(){this.rl.Rt()&&this.rl.Wt(this.getVisibleRange())},t.prototype.el=function(){this.bn.Rt()&&this.bn.Wt(this.getVisibleLogicalRange())},t}();function ih(t){if(void 0!==t&&"custom"!==t.type){var i=t;void 0!==i.minMove&&void 0===i.precision&&(i.precision=function(t){if(t>=1)return 0;for(var i=0;i<8;i++){var n=Math.round(t);if(Math.abs(n-t)<1e-8)return i;t*=10}return i}(i.minMove))}}function nh(t){return function(t){if(w(t.handleScale)){var i=t.handleScale;t.handleScale={axisDoubleClickReset:i,axisPressedMouseMove:{time:i,price:i},mouseWheel:i,pinch:i}}else if(void 0!==t.handleScale&&w(t.handleScale.axisPressedMouseMove)){var n=t.handleScale.axisPressedMouseMove;t.handleScale.axisPressedMouseMove={time:n,price:n}}var h=t.handleScroll;w(h)&&(t.handleScroll={horzTouchDrag:h,vertTouchDrag:h,mouseWheel:h,pressedMouseMove:h})}(t),function(t){if(t.priceScale){t.leftPriceScale=t.leftPriceScale||{},t.rightPriceScale=t.rightPriceScale||{};var i=t.priceScale.position;delete t.priceScale.position,t.leftPriceScale=c(t.leftPriceScale,t.priceScale),t.rightPriceScale=c(t.rightPriceScale,t.priceScale),"left"===i&&(t.leftPriceScale.visible=!0,t.rightPriceScale.visible=!1),"right"===i&&(t.leftPriceScale.visible=!1,t.rightPriceScale.visible=!0),"none"===i&&(t.leftPriceScale.visible=!1,t.rightPriceScale.visible=!1),t.overlayPriceScales=t.overlayPriceScales||{},void 0!==t.priceScale.invertScale&&(t.overlayPriceScales.invertScale=t.priceScale.invertScale),void 0!==t.priceScale.scaleMargins&&(t.overlayPriceScales.scaleMargins=t.priceScale.scaleMargins)}}(t),t}var hh=function(){function t(t,i){var n=this;this.ol=new Fn,this.al=new Map,this.fl=new Map,this.ll=new Z,this.cl=new Z,this.vl=new Z;var h=void 0===i?M(Yn):c(M(Yn),nh(i));this.hl=new mn(t,h),this.hl.la().subscribe((function(t){n.ll.Rt()&&n.ll.Wt(n.dl(t()))}),this),this.hl.lf().subscribe((function(t){n.cl.Rt()&&n.cl.Wt(n.dl(t()))}),this),this.hl.cf().subscribe((function(t){n.vl.Rt()&&n.vl.Wt(n._l(t()))}),this);var s=this.hl.He();this.wl=new th(s)}return t.prototype.remove=function(){this.hl.la().unsubscribeAll(this),this.hl.lf().unsubscribeAll(this),this.hl.cf().unsubscribeAll(this),this.wl.destroy(),this.hl.destroy(),this.al.clear(),this.fl.clear(),this.ll.Ut(),this.cl.Ut(),this.vl.Ut(),this.ol.Ut()},t.prototype.resize=function(t,i,n){this.hl.sf(t,i,n)},t.prototype.addAreaSeries=function(t){void 0===t&&(t={}),ih((t=Rn(t)).priceFormat);var i=c(M(Gn),Zn,t),n=this.hl.He().createSeries("Area",i),h=new Un(n,this,this);return this.al.set(h,n),this.fl.set(n,h),h},t.prototype.addBarSeries=function(t){void 0===t&&(t={}),ih((t=Rn(t)).priceFormat);var i=c(M(Gn),$n,t),n=this.hl.He().createSeries("Bar",i),h=new Un(n,this,this);return this.al.set(h,n),this.fl.set(n,h),h},t.prototype.addCandlestickSeries=function(t){void 0===t&&(t={}),bt(t=Rn(t)),ih(t.priceFormat);var i=c(M(Gn),Kn,t),n=this.hl.He().createSeries("Candlestick",i),h=new jn(n,this,this);return this.al.set(h,n),this.fl.set(n,h),h},t.prototype.addHistogramSeries=function(t){void 0===t&&(t={}),ih((t=Rn(t)).priceFormat);var i=c(M(Gn),Jn,t),n=this.hl.He().createSeries("Histogram",i),h=new Un(n,this,this);return this.al.set(h,n),this.fl.set(n,h),h},t.prototype.addLineSeries=function(t){void 0===t&&(t={}),ih((t=Rn(t)).priceFormat);var i=c(M(Gn),Xn,t),n=this.hl.He().createSeries("Line",i),h=new Un(n,this,this);return this.al.set(h,n),this.fl.set(n,h),h},t.prototype.removeSeries=function(t){var i=a(this.al.get(t)),n=this.ol.Rf(i);this.hl.He().removeSeries(i),this.Ml(n),this.al.delete(t),this.fl.delete(i)},t.prototype.il=function(t,i){this.Ml(this.ol.Pf(t,i))},t.prototype.nl=function(t,i){this.Ml(this.ol.Uf(t,i))},t.prototype.subscribeClick=function(t){this.ll.subscribe(t)},t.prototype.unsubscribeClick=function(t){this.ll.unsubscribe(t)},t.prototype.moveCrosshair=function(t){if(t){var i=this.hl.ef(),n={pe:t.x,ye:t.y};i[0].Yu(n)}},t.prototype.subscribeCrosshairMove=function(t){this.cl.subscribe(t)},t.prototype.unsubscribeCrosshairMove=function(t){this.cl.unsubscribe(t)},t.prototype.subscribeCustomPriceLineDragged=function(t){this.vl.subscribe(t)},t.prototype.unsubscribeCustomPriceLineDragged=function(t){this.vl.unsubscribe(t)},t.prototype.priceScale=function(t){return void 0===t&&(t=this.hl.He().defaultVisiblePriceScaleId()),new Qn(this.hl,t)},t.prototype.timeScale=function(){return this.wl},t.prototype.applyOptions=function(t){this.hl.ff(nh(t))},t.prototype.options=function(){return this.hl.Ao()},t.prototype.takeScreenshot=function(){return this.hl.vf()},t.prototype.Ml=function(t){var i=this.hl.He();i.updateTimeScale(t.Hf.Yf,t.Hf.Jf),t.qf.forEach((function(t,i){return i.updateData(t.Xf,t.$f)})),i.recalculateAllPanes()},t.prototype.bl=function(t){return a(this.fl.get(t))},t.prototype.dl=function(t){var i=this,n=new Map;t.kf.forEach((function(t,h){n.set(i.bl(h),t)}));var h=void 0===t.yf?void 0:this.bl(t.yf);return{time:t.at&&(t.at.businessDay||t.at.timestamp),point:t.pf,hoveredSeries:h,hoveredMarkerId:t.xf,seriesPrices:n}},t.prototype._l=function(t){return{customPriceLine:t.Sf,fromPriceString:t.Cf}},t}();var sh=Object.freeze({__proto__:null,version:function(){return"3.4.0-dev+202107100546"},get LineStyle(){return i},get LineType(){return t},get CrosshairMode(){return P},get PriceScaleMode(){return ft},get PriceLineSource(){return dt},get TickMarkType(){return Dt},PriceFormatter:$,isBusinessDay:Bt,isUTCTimestamp:At,createChart:function(t,i){var n;if(_(t)){var h=document.getElementById(t);o(null!==h,"Cannot find element in DOM with id="+t),n=h}else n=t;return new hh(n,i)}});window.LightweightCharts=sh}();
